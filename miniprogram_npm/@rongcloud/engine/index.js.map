{"version":3,"sources":["index.js","dist/engine.cjs.prod.js","dist/engine.cjs.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["\n\ntry {\n  if (process.env.NODE_ENV === 'production') {\n    module.exports = require('./dist/engine.cjs.prod.js')\n  } else {\n    module.exports = require('./dist/engine.cjs.js')\n  }\n} catch (e) {\n  module.exports = require('./dist/engine.cjs.prod.js')\n}\n","var e;Object.defineProperty(exports,\"__esModule\",{value:!0}),function(e){e[e.READ=1]=\"READ\",e[e.LISTENED=2]=\"LISTENED\",e[e.DOWNLOADED=4]=\"DOWNLOADED\",e[e.RETRIEVED=8]=\"RETRIEVED\",e[e.UNREAD=0]=\"UNREAD\"}(e||(e={}));var t=e;var n;!function(e){e[e.TIMEOUT=-1]=\"TIMEOUT\",e[e.UNKNOWN=-2]=\"UNKNOWN\",e[e.PARAMETER_ERROR=-3]=\"PARAMETER_ERROR\",e[e.SUCCESS=0]=\"SUCCESS\",e[e.RC_MSG_UNAUTHORIZED=20406]=\"RC_MSG_UNAUTHORIZED\",e[e.RC_DISCUSSION_GROUP_ID_INVALID=20407]=\"RC_DISCUSSION_GROUP_ID_INVALID\",e[e.SEND_FREQUENCY_TOO_FAST=20604]=\"SEND_FREQUENCY_TOO_FAST\",e[e.NOT_IN_DISCUSSION=21406]=\"NOT_IN_DISCUSSION\",e[e.FORBIDDEN_IN_GROUP=22408]=\"FORBIDDEN_IN_GROUP\",e[e.RECALL_MESSAGE=25101]=\"RECALL_MESSAGE\",e[e.NOT_IN_GROUP=22406]=\"NOT_IN_GROUP\",e[e.NOT_IN_CHATROOM=23406]=\"NOT_IN_CHATROOM\",e[e.FORBIDDEN_IN_CHATROOM=23408]=\"FORBIDDEN_IN_CHATROOM\",e[e.RC_CHATROOM_USER_KICKED=23409]=\"RC_CHATROOM_USER_KICKED\",e[e.RC_CHATROOM_NOT_EXIST=23410]=\"RC_CHATROOM_NOT_EXIST\",e[e.RC_CHATROOM_IS_FULL=23411]=\"RC_CHATROOM_IS_FULL\",e[e.RC_CHATROOM_PATAMETER_INVALID=23412]=\"RC_CHATROOM_PATAMETER_INVALID\",e[e.CHATROOM_GET_HISTORYMSG_ERROR=23413]=\"CHATROOM_GET_HISTORYMSG_ERROR\",e[e.CHATROOM_NOT_OPEN_HISTORYMSG_STORE=23414]=\"CHATROOM_NOT_OPEN_HISTORYMSG_STORE\",e[e.CHATROOM_KV_EXCEED=23423]=\"CHATROOM_KV_EXCEED\",e[e.CHATROOM_KV_OVERWRITE_INVALID=23424]=\"CHATROOM_KV_OVERWRITE_INVALID\",e[e.CHATROOM_KV_STORE_NOT_OPEN=23426]=\"CHATROOM_KV_STORE_NOT_OPEN\",e[e.CHATROOM_KEY_NOT_EXIST=23427]=\"CHATROOM_KEY_NOT_EXIST\",e[e.SENSITIVE_SHIELD=21501]=\"SENSITIVE_SHIELD\",e[e.SENSITIVE_REPLACE=21502]=\"SENSITIVE_REPLACE\",e[e.JOIN_IN_DISCUSSION=21407]=\"JOIN_IN_DISCUSSION\",e[e.CREATE_DISCUSSION=21408]=\"CREATE_DISCUSSION\",e[e.INVITE_DICUSSION=21409]=\"INVITE_DICUSSION\",e[e.GET_USERINFO_ERROR=23407]=\"GET_USERINFO_ERROR\",e[e.REJECTED_BY_BLACKLIST=405]=\"REJECTED_BY_BLACKLIST\",e[e.RC_NET_CHANNEL_INVALID=30001]=\"RC_NET_CHANNEL_INVALID\",e[e.RC_NET_UNAVAILABLE=30002]=\"RC_NET_UNAVAILABLE\",e[e.RC_MSG_RESP_TIMEOUT=30003]=\"RC_MSG_RESP_TIMEOUT\",e[e.RC_HTTP_SEND_FAIL=30004]=\"RC_HTTP_SEND_FAIL\",e[e.RC_HTTP_REQ_TIMEOUT=30005]=\"RC_HTTP_REQ_TIMEOUT\",e[e.RC_HTTP_RECV_FAIL=30006]=\"RC_HTTP_RECV_FAIL\",e[e.RC_NAVI_RESOURCE_ERROR=30007]=\"RC_NAVI_RESOURCE_ERROR\",e[e.RC_NODE_NOT_FOUND=30008]=\"RC_NODE_NOT_FOUND\",e[e.RC_DOMAIN_NOT_RESOLVE=30009]=\"RC_DOMAIN_NOT_RESOLVE\",e[e.RC_SOCKET_NOT_CREATED=30010]=\"RC_SOCKET_NOT_CREATED\",e[e.RC_SOCKET_DISCONNECTED=30011]=\"RC_SOCKET_DISCONNECTED\",e[e.RC_PING_SEND_FAIL=30012]=\"RC_PING_SEND_FAIL\",e[e.RC_PONG_RECV_FAIL=30013]=\"RC_PONG_RECV_FAIL\",e[e.RC_MSG_SEND_FAIL=30014]=\"RC_MSG_SEND_FAIL\",e[e.RC_MSG_CONTENT_EXCEED_LIMIT=30016]=\"RC_MSG_CONTENT_EXCEED_LIMIT\",e[e.RC_CONN_ACK_TIMEOUT=31e3]=\"RC_CONN_ACK_TIMEOUT\",e[e.RC_CONN_PROTO_VERSION_ERROR=31001]=\"RC_CONN_PROTO_VERSION_ERROR\",e[e.RC_CONN_ID_REJECT=31002]=\"RC_CONN_ID_REJECT\",e[e.RC_CONN_SERVER_UNAVAILABLE=31003]=\"RC_CONN_SERVER_UNAVAILABLE\",e[e.RC_CONN_USER_OR_PASSWD_ERROR=31004]=\"RC_CONN_USER_OR_PASSWD_ERROR\",e[e.RC_CONN_NOT_AUTHRORIZED=31005]=\"RC_CONN_NOT_AUTHRORIZED\",e[e.RC_CONN_REDIRECTED=31006]=\"RC_CONN_REDIRECTED\",e[e.RC_CONN_PACKAGE_NAME_INVALID=31007]=\"RC_CONN_PACKAGE_NAME_INVALID\",e[e.RC_CONN_APP_BLOCKED_OR_DELETED=31008]=\"RC_CONN_APP_BLOCKED_OR_DELETED\",e[e.RC_CONN_USER_BLOCKED=31009]=\"RC_CONN_USER_BLOCKED\",e[e.RC_DISCONN_KICK=31010]=\"RC_DISCONN_KICK\",e[e.RC_DISCONN_EXCEPTION=31011]=\"RC_DISCONN_EXCEPTION\",e[e.RC_QUERY_ACK_NO_DATA=32001]=\"RC_QUERY_ACK_NO_DATA\",e[e.RC_MSG_DATA_INCOMPLETE=32002]=\"RC_MSG_DATA_INCOMPLETE\",e[e.BIZ_ERROR_CLIENT_NOT_INIT=33001]=\"BIZ_ERROR_CLIENT_NOT_INIT\",e[e.BIZ_ERROR_DATABASE_ERROR=33002]=\"BIZ_ERROR_DATABASE_ERROR\",e[e.BIZ_ERROR_INVALID_PARAMETER=33003]=\"BIZ_ERROR_INVALID_PARAMETER\",e[e.BIZ_ERROR_NO_CHANNEL=33004]=\"BIZ_ERROR_NO_CHANNEL\",e[e.BIZ_ERROR_RECONNECT_SUCCESS=33005]=\"BIZ_ERROR_RECONNECT_SUCCESS\",e[e.BIZ_ERROR_CONNECTING=33006]=\"BIZ_ERROR_CONNECTING\",e[e.MSG_ROAMING_SERVICE_UNAVAILABLE=33007]=\"MSG_ROAMING_SERVICE_UNAVAILABLE\",e[e.MSG_INSERT_ERROR=33008]=\"MSG_INSERT_ERROR\",e[e.MSG_DEL_ERROR=33009]=\"MSG_DEL_ERROR\",e[e.CONVER_REMOVE_ERROR=34001]=\"CONVER_REMOVE_ERROR\",e[e.CONVER_GETLIST_ERROR=34002]=\"CONVER_GETLIST_ERROR\",e[e.CONVER_SETOP_ERROR=34003]=\"CONVER_SETOP_ERROR\",e[e.CONVER_TOTAL_UNREAD_ERROR=34004]=\"CONVER_TOTAL_UNREAD_ERROR\",e[e.CONVER_TYPE_UNREAD_ERROR=34005]=\"CONVER_TYPE_UNREAD_ERROR\",e[e.CONVER_ID_TYPE_UNREAD_ERROR=34006]=\"CONVER_ID_TYPE_UNREAD_ERROR\",e[e.CONVER_CLEAR_ERROR=34007]=\"CONVER_CLEAR_ERROR\",e[e.EXPANSION_LIMIT_EXCEET=34010]=\"EXPANSION_LIMIT_EXCEET\",e[e.MESSAGE_KV_NOT_SUPPORT=34008]=\"MESSAGE_KV_NOT_SUPPORT\",e[e.CLEAR_HIS_TIME_ERROR=34011]=\"CLEAR_HIS_TIME_ERROR\",e[e.CONVER_GET_ERROR=34009]=\"CONVER_GET_ERROR\",e[e.GROUP_SYNC_ERROR=35001]=\"GROUP_SYNC_ERROR\",e[e.GROUP_MATCH_ERROR=35002]=\"GROUP_MATCH_ERROR\",e[e.CHATROOM_ID_ISNULL=36001]=\"CHATROOM_ID_ISNULL\",e[e.CHARTOOM_JOIN_ERROR=36002]=\"CHARTOOM_JOIN_ERROR\",e[e.CHATROOM_HISMESSAGE_ERROR=36003]=\"CHATROOM_HISMESSAGE_ERROR\",e[e.CHATROOM_KV_NOT_FOUND=36004]=\"CHATROOM_KV_NOT_FOUND\",e[e.BLACK_ADD_ERROR=37001]=\"BLACK_ADD_ERROR\",e[e.BLACK_GETSTATUS_ERROR=37002]=\"BLACK_GETSTATUS_ERROR\",e[e.BLACK_REMOVE_ERROR=37003]=\"BLACK_REMOVE_ERROR\",e[e.DRAF_GET_ERROR=38001]=\"DRAF_GET_ERROR\",e[e.DRAF_SAVE_ERROR=38002]=\"DRAF_SAVE_ERROR\",e[e.DRAF_REMOVE_ERROR=38003]=\"DRAF_REMOVE_ERROR\",e[e.SUBSCRIBE_ERROR=39001]=\"SUBSCRIBE_ERROR\",e[e.QNTKN_FILETYPE_ERROR=41001]=\"QNTKN_FILETYPE_ERROR\",e[e.QNTKN_GET_ERROR=41002]=\"QNTKN_GET_ERROR\",e[e.COOKIE_ENABLE=51001]=\"COOKIE_ENABLE\",e[e.GET_MESSAGE_BY_ID_ERROR=61001]=\"GET_MESSAGE_BY_ID_ERROR\",e[e.HAVNODEVICEID=24001]=\"HAVNODEVICEID\",e[e.DEVICEIDISHAVE=24002]=\"DEVICEIDISHAVE\",e[e.FEILD=24009]=\"FEILD\",e[e.VOIPISNULL=24013]=\"VOIPISNULL\",e[e.NOENGINETYPE=24010]=\"NOENGINETYPE\",e[e.NULLCHANNELNAME=24011]=\"NULLCHANNELNAME\",e[e.VOIPDYANMICERROR=24012]=\"VOIPDYANMICERROR\",e[e.NOVOIP=24014]=\"NOVOIP\",e[e.INTERNALERRROR=24015]=\"INTERNALERRROR\",e[e.VOIPCLOSE=24016]=\"VOIPCLOSE\",e[e.CLOSE_BEFORE_OPEN=51001]=\"CLOSE_BEFORE_OPEN\",e[e.ALREADY_IN_USE=51002]=\"ALREADY_IN_USE\",e[e.INVALID_CHANNEL_NAME=51003]=\"INVALID_CHANNEL_NAME\",e[e.VIDEO_CONTAINER_IS_NULL=51004]=\"VIDEO_CONTAINER_IS_NULL\",e[e.DELETE_MESSAGE_ID_IS_NULL=61001]=\"DELETE_MESSAGE_ID_IS_NULL\",e[e.CANCEL=1]=\"CANCEL\",e[e.REJECT=2]=\"REJECT\",e[e.HANGUP=3]=\"HANGUP\",e[e.BUSYLINE=4]=\"BUSYLINE\",e[e.NO_RESPONSE=5]=\"NO_RESPONSE\",e[e.ENGINE_UN_SUPPORTED=6]=\"ENGINE_UN_SUPPORTED\",e[e.NETWORK_ERROR=7]=\"NETWORK_ERROR\",e[e.REMOTE_CANCEL=11]=\"REMOTE_CANCEL\",e[e.REMOTE_REJECT=12]=\"REMOTE_REJECT\",e[e.REMOTE_HANGUP=13]=\"REMOTE_HANGUP\",e[e.REMOTE_BUSYLINE=14]=\"REMOTE_BUSYLINE\",e[e.REMOTE_NO_RESPONSE=15]=\"REMOTE_NO_RESPONSE\",e[e.REMOTE_ENGINE_UN_SUPPORTED=16]=\"REMOTE_ENGINE_UN_SUPPORTED\",e[e.REMOTE_NETWORK_ERROR=17]=\"REMOTE_NETWORK_ERROR\",e[e.VOIP_NOT_AVALIABLE=18]=\"VOIP_NOT_AVALIABLE\"}(n||(n={}));var i,s=n;!function(e){e[e.NONE=0]=\"NONE\",e[e.PRIVATE=1]=\"PRIVATE\",e[e.DISCUSSION=2]=\"DISCUSSION\",e[e.GROUP=3]=\"GROUP\",e[e.CHATROOM=4]=\"CHATROOM\",e[e.CUSTOMER_SERVICE=5]=\"CUSTOMER_SERVICE\",e[e.SYSTEM=6]=\"SYSTEM\",e[e.APP_PUBLIC_SERVICE=7]=\"APP_PUBLIC_SERVICE\",e[e.PUBLIC_SERVICE=8]=\"PUBLIC_SERVICE\",e[e.RTC_ROOM=12]=\"RTC_ROOM\"}(i||(i={}));var r,o=i;!function(e){e[e.IMAGE=1]=\"IMAGE\",e[e.AUDIO=2]=\"AUDIO\",e[e.VIDEO=3]=\"VIDEO\",e[e.FILE=4]=\"FILE\"}(r||(r={}));var a=r;const h=e=>\"string\"==typeof e,l=e=>\"number\"==typeof e&&!isNaN(e),u=e=>-1!==Object.prototype.toString.call(e).indexOf(\"Array\"),c=e=>\"[object ArrayBuffer]\"===Object.prototype.toString.call(e),f=e=>h(e)&&e.length>0,d=e=>\"[object Object]\"===Object.prototype.toString.call(e),p=e=>\"[object Function]\"===Object.prototype.toString.call(e),E=e=>void 0===e||\"[object Undefined]\"===Object.prototype.toString.call(e),_=e=>\"[object Null]\"===Object.prototype.toString.call(e),m=e=>{for(const t in e)return!0;return!1},y=e=>{if(!d(e)||void 0===e.low||void 0===e.high)return e;let t=e.low;t<0&&(t+=4294967296),t=t.toString(16);return parseInt(e.high.toString(16)+\"00000000\".replace(new RegExp(\"0{\"+t.length+\"}$\"),t),16)},T=[\"https://nav.cn.ronghub.com\",\"https://nav2-cn.ronghub.com\"],R=[\"wsproxy.cn.ronghub.com\",\"wsap-cn.ronghub.com\"],C=[\"cometproxy-cn.ronghub.com\",\"mini-cn.ronghub.com\"],I={\"RC:TxtMsg\":{isCounted:!0,isPersited:!0},\"RC:ImgMsg\":{isCounted:!0,isPersited:!0},\"RC:VcMsg\":{isCounted:!0,isPersited:!0},\"RC:ImgTextMsg\":{isCounted:!0,isPersited:!0},\"RC:FileMsg\":{isCounted:!0,isPersited:!0},\"RC:HQVCMsg\":{isCounted:!0,isPersited:!0},\"RC:LBSMsg\":{isCounted:!0,isPersited:!0},\"RC:PSImgTxtMsg\":{isCounted:!0,isPersited:!0},\"RC:PSMultiImgTxtMsg\":{isCounted:!0,isPersited:!0},\"RCJrmf:RpMsg\":{isCounted:!0,isPersited:!0},\"RCJrmf:RpOpendMsg\":{isCounted:!0,isPersited:!0},\"RC:CombineMsg\":{isCounted:!0,isPersited:!0},\"RC:ReferenceMsg\":{isCounted:!0,isPersited:!0},\"RC:InfoNtf\":{isCounted:!1,isPersited:!0},\"RC:ContactNtf\":{isCounted:!1,isPersited:!0},\"RC:ProfileNtf\":{isCounted:!1,isPersited:!0},\"RC:CmdNtf\":{isCounted:!1,isPersited:!0},\"RC:GrpNtf\":{isCounted:!1,isPersited:!0},\"RC:RcCmd\":{isCounted:!1,isPersited:!0},\"RC:CmdMsg\":{isCounted:!1,isPersited:!1},\"RC:TypSts\":{isCounted:!1,isPersited:!1},\"RC:PSCmd\":{isCounted:!1,isPersited:!1},\"RC:SRSMsg\":{isCounted:!1,isPersited:!1},\"RC:RRReqMsg\":{isCounted:!1,isPersited:!1},\"RC:RRRspMsg\":{isCounted:!1,isPersited:!1},\"RC:CsChaR\":{isCounted:!1,isPersited:!1},\"RC:CSCha\":{isCounted:!1,isPersited:!1},\"RC:CsEva\":{isCounted:!1,isPersited:!1},\"RC:CsContact\":{isCounted:!1,isPersited:!1},\"RC:CsHs\":{isCounted:!1,isPersited:!1},\"RC:CsHsR\":{isCounted:!1,isPersited:!1},\"RC:CsSp\":{isCounted:!1,isPersited:!1},\"RC:CsEnd\":{isCounted:!1,isPersited:!1},\"RC:CsUpdate\":{isCounted:!1,isPersited:!1},\"RC:ReadNtf\":{isCounted:!1,isPersited:!1},\"RC:chrmKVNotiMsg\":{isCounted:!1,isPersited:!1},\"RC:VCAccept\":{isCounted:!1,isPersited:!1},\"RC:VCRinging\":{isCounted:!1,isPersited:!1},\"RC:VCSummary\":{isCounted:!1,isPersited:!1},\"RC:VCHangup\":{isCounted:!1,isPersited:!1},\"RC:VCInvite\":{isCounted:!1,isPersited:!1},\"RC:VCModifyMedia\":{isCounted:!1,isPersited:!1},\"RC:VCModifyMem\":{isCounted:!1,isPersited:!1},\"RC:MsgExMsg\":{isCounted:!1,isPersited:!1}};let v;const S=e=>(v||(v={set:(t,n)=>{e.localStorage.setItem(t,JSON.stringify(n))},get:t=>{let n;try{n=JSON.parse(e.localStorage.getItem(t))}catch(e){n=null}return n},remove:t=>e.localStorage.removeItem(t),getKeys:()=>{const t=[];for(const n in e.localStorage)t.push(n);return t}}),v);class w{constructor(e){this._caches={},e&&(this._caches=e)}set(e,t){this._caches[e]=t}remove(e){const t=this.get(e);return delete this._caches[e],t}get(e){return this._caches[e]}getKeys(){const e=[];for(const t in this._caches)e.push(t);return e}}class N{constructor(e,t){const n=t?\"RCV4-\"+t:\"RCV4-\";this._rootStorage=S(e);const i=this._rootStorage.get(n)||{};this._cache=new w({[n]:i}),this._storageKey=n}_get(){const e=this._storageKey;return this._cache.get(e)||{}}_set(e){const t=this._storageKey;e=e||{},this._cache.set(t,e),this._rootStorage.set(t,e)}set(e,t){const n=this._get();n[e]=t,this._set(n)}remove(e){const t=this._get();delete t[e],this._set(t)}clear(){const e=this._storageKey;this._rootStorage.remove(e),this._cache.remove(e)}get(e){return this._get()[e]}getKeys(){const e=this._get(),t=[];for(const n in e)t.push(n);return t}getValues(){return this._get()||{}}}class O extends Error{constructor(e){super(\"TODO => \"+e)}}const b=(e,t,n)=>{if(void 0===t||void 0===n)return e.toUpperCase();const i=e.slice(t,n);return e=e.replace(i,(e=>e.toUpperCase()))};var M;(M=exports.LogLevel||(exports.LogLevel={}))[M.LOG=0]=\"LOG\",M[M.DEBUG=0]=\"DEBUG\",M[M.INFO=1]=\"INFO\",M[M.WARN=2]=\"WARN\",M[M.ERROR=3]=\"ERROR\";const A={[exports.LogLevel.DEBUG]:console.debug.bind(console),[exports.LogLevel.INFO]:console.info.bind(console),[exports.LogLevel.WARN]:console.warn.bind(console),[exports.LogLevel.ERROR]:console.error.bind(console)};class U{constructor(e){this._tag=e,this._outLevel=exports.LogLevel.WARN,this._stdout=this._defaultStdout,this.log=this._out,this.debug=this._out.bind(this,exports.LogLevel.DEBUG),this.info=this._out.bind(this,exports.LogLevel.INFO),this.warn=this._out.bind(this,exports.LogLevel.WARN),this.error=this._out.bind(this,exports.LogLevel.ERROR)}_defaultStdout(e,...t){A[e](`[${this._tag}](${(new Date).toUTCString()}):`,...t)}_out(e,...t){e>=this._outLevel&&this._stdout(e,...t)}set(e,t){this._outLevel=e,this._stdout=t||this._defaultStdout}}const P=new U(\"RCLog\");var L;(L=exports.AssertRules||(exports.AssertRules={}))[L.STRING=0]=\"STRING\",L[L.ONLY_STRING=1]=\"ONLY_STRING\",L[L.NUMBER=2]=\"NUMBER\",L[L.BOOLEAN=3]=\"BOOLEAN\",L[L.OBJECT=4]=\"OBJECT\",L[L.ARRAY=5]=\"ARRAY\",L[L.CALLBACK=6]=\"CALLBACK\";const D={[exports.AssertRules.STRING]:f,[exports.AssertRules.ONLY_STRING]:h,[exports.AssertRules.NUMBER]:l,[exports.AssertRules.BOOLEAN]:e=>\"boolean\"==typeof e,[exports.AssertRules.OBJECT]:d,[exports.AssertRules.ARRAY]:u,[exports.AssertRules.CALLBACK]:e=>{let t=!0;return d(e)||(t=!1),(e=e||{}).onSuccess&&!p(e.onSuccess)&&(t=!1),e.onError&&!p(e.onError)&&(t=!1),t}};class x extends Error{constructor(e){super(e),this.name=\"RCAssertError\"}}const V=(e,t,n,i=!1)=>{n=D[n]||n;const s=i&&!n(t)||!i&&!(E(t)||null===t||n(t));if(s){const t=e+\" is invalid.\";P.error(t)}return!s},k=(e,t,n)=>{n=n||{},t=t||function(){};const{isReverse:i}=n;d(e)&&(()=>{for(const n in e)t(e[n],n,e)})(),(u(e)||h(e))&&(()=>{if(i)for(let n=e.length-1;n>=0;n--)t(e[n],n);else for(let n=0,i=e.length;n<i;n++)t(e[n],n)})()},B=(e,t)=>(k(e,((n,i)=>{e[i]=t(n,i)})),e),F=(e,t)=>{if(e.indexOf)return e.indexOf(t);let n=-1;return k(e,((e,i)=>{t===e&&(n=i)})),n},Y=(e,t)=>{const n=[];k(e,(e=>{n.push(e)}));return-1!==F(n,t)},q=(e,t)=>{const n=Math.floor(1e3*Math.random()%1e4),i=\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return(\"x\"===e?t:3&t|8).toString(16)})),s=(e=>{e=e||\"-\";const t=new Date;return`${t.getFullYear()}${e}${t.getMonth()+1}${e}${t.getDate()}`})(),r=(new Date).getTime();let o=\"\";if(t){const e=t.split(\".\");o=\".\"+e[e.length-1]}return`${e}__RC-${s}_${n}_${r}${i}${o}`};var H;!function(e){e[e.UPDATE=1]=\"UPDATE\",e[e.DELETE=2]=\"DELETE\"}(H||(H={}));var G=H;const K=e=>{const t={},n=JSON.parse(e);return k(n,((e,n)=>{t[n]=e.v})),t},j={_delayTime:0,setTime:e=>{const t=(new Date).getTime();j._delayTime=t-e},getTime:()=>{const e=j._delayTime;return(new Date).getTime()-e}};\n/*! *****************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\nfunction $(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{h(i.next(e))}catch(e){r(e)}}function a(e){try{h(i.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}h((i=i.apply(e,t||[])).next())}))}var W,Q,z,Z;!function(e){e[e.AT_MOST_ONCE=0]=\"AT_MOST_ONCE\",e[e.AT_LEAST_ONCE=1]=\"AT_LEAST_ONCE\",e[e.EXACTLY_ONCE=2]=\"EXACTLY_ONCE\",e[e.DEFAULT=3]=\"DEFAULT\"}(W||(W={})),function(e){e[e.SYMMETRIC=0]=\"SYMMETRIC\",e[e.CONNECT=1]=\"CONNECT\",e[e.CONN_ACK=2]=\"CONN_ACK\",e[e.PUBLISH=3]=\"PUBLISH\",e[e.PUB_ACK=4]=\"PUB_ACK\",e[e.QUERY=5]=\"QUERY\",e[e.QUERY_ACK=6]=\"QUERY_ACK\",e[e.QUERY_CONFIRM=7]=\"QUERY_CONFIRM\",e[e.SUBSCRIBE=8]=\"SUBSCRIBE\",e[e.SUB_ACK=9]=\"SUB_ACK\",e[e.UNSUBSCRIBE=10]=\"UNSUBSCRIBE\",e[e.UNSUB_ACK=11]=\"UNSUB_ACK\",e[e.PING_REQ=12]=\"PING_REQ\",e[e.PING_RESP=13]=\"PING_RESP\",e[e.DISCONNECT=14]=\"DISCONNECT\",e[e.RESERVER2=15]=\"RESERVER2\"}(Q||(Q={})),function(e){e.CONN_ACK=\"ConnAckMessage\",e.DISCONNECT=\"DisconnectMessage\",e.PING_REQ=\"PingReqMessage\",e.PING_RESP=\"PingRespMessage\",e.PUBLISH=\"PublishMessage\",e.PUB_ACK=\"PubAckMessage\",e.QUERY=\"QueryMessage\",e.QUERY_CON=\"QueryConMessage\",e.QUERY_ACK=\"QueryAckMessage\"}(z||(z={})),function(e){e.PUB=\"pub\",e.QUERY=\"qry\"}(Z||(Z={}));class J{constructor(e,t=!1,n=W.AT_LEAST_ONCE,i=!1){this._retain=!1,this.qos=W.AT_LEAST_ONCE,this._dup=!1,this.syncMsg=!1;e&&e>0&&1===arguments.length?(this._retain=(1&e)>0,this.qos=(6&e)>>1,this._dup=(8&e)>0,this.type=e>>4&15,this.syncMsg=8==(8&e)):(this.type=e,this._retain=t,this.qos=n,this._dup=i)}encode(){let e=this.type<<4;return e|=this._retain?1:0,e|=this.qos<<1,e|=this._dup?8:0,e}}class X{static writeUTF(e,t){const n=[];let i=0;if(h(e))for(let t=0,r=e.length;t<r;t++){var s=e.charCodeAt(t);s>=0&&s<=127?(i+=1,n.push(s)):s>=128&&s<=2047?(i+=2,n.push(192|31&s>>6),n.push(128|63&s)):s>=2048&&s<=65535&&(i+=3,n.push(224|15&s>>12),n.push(128|63&s>>6),n.push(128|63&s))}for(let e=0,t=n.length;e<t;e++)n[e]>255&&(n[e]&=255);return t?n:i<=255?[0,i].concat(n):[i>>8,255&i].concat(n)}static readUTF(e){const t=[];let n,i,s=-1;const r=e;let o=\"\";for(;++s<r.length;){var a=Number(r[s]);if(a===(127&a)||(240==(240&a)?a=(a=(a=(a^=240)<<6|128^r[++s])<<6|128^r[++s])<<6|128^r[++s]:224==(224&a)?a=(a=(a^=224)<<6|128^r[++s])<<6|128^r[++s]:192==(192&a)&&(a=(a^=192)<<6|128^r[++s])),!isFinite(a)||a<0||a>1114111||Math.floor(a)!==a)throw RangeError(\"Invalid code point: \"+a);a<=65535?t.push(a):(n=(a-=65536)>>10|55296,i=a%1024|56320,t.push(n,i)),(s+1===r.length||t.length>16384)&&(o+=String.fromCharCode.apply(null,t),t.length=0)}return o}}class ee{constructor(e){this._position=0,this._poolLen=0,this._pool=e,this._poolLen=e.length}check(){return this._position>=this._pool.length}readInt(){const e=this;if(e.check())return-1;let t=\"\";for(let n=0;n<4;n++){let n=e._pool[e._position++].toString(16);1===n.length&&(n=\"0\"+n),t+=n.toString()}return parseInt(t,16)}readLong(){const e=this;if(e.check())return-1;let t=\"\";for(let n=0;n<8;n++){let n=e._pool[e._position++].toString(16);1===n.length&&(n=\"0\"+n),t+=n}return parseInt(t,16)}readByte(){if(this.check())return-1;let e=this._pool[this._position++];return e>255&&(e&=255),e}readUTF(){if(this.check())return\"\";const e=this.readByte()<<8|this.readByte(),t=this._pool.subarray(this._position,this._position+=e);return X.readUTF(t)}readAll(){return this._pool.subarray(this._position,this._poolLen)}}class te{constructor(){this._pool=[],this._position=0,this._writen=0}write(e){return-1!==Object.prototype.toString.call(e).indexOf(\"Array\")?this._pool=this._pool.concat(e):e>=0&&(e>255&&(e&=255),this._pool.push(e),this._writen++),e}writeArr(e){return this._pool=this._pool.concat(e),e}writeUTF(e){const t=X.writeUTF(e);this._pool=this._pool.concat(t),this._writen+=t.length}getBytesArray(){return this._pool}}var ne=\"UpStreamMessage\",ie=\"DownStreamMessage\",se=\"DownStreamMessages\",re=\"SessionsAttQryInput\",oe=\"SessionsAttOutput\",ae=\"SyncRequestMsg\",he=\"ChrmPullMsg\",le=\"NotifyMsg\",ue=\"HistoryMsgInput\",ce=\"HistoryMsgOuput\",fe=\"RelationQryInput\",de=\"RelationsOutput\",ge=\"DeleteSessionsInput\",pe=\"SessionInfo\",Ee=\"DeleteSessionsOutput\",_e=\"RelationsInput\",me=\"DeleteMsgInput\",ye=\"CleanHisMsgInput\",Te=\"SessionMsgReadInput\",Re=\"ChrmInput\",Ce=\"QueryChatRoomInfoInput\",Ie=\"QueryChatRoomInfoOutput\",ve=\"RtcInput\",Se=\"RtcUserListOutput\",we=\"SetUserStatusInput\",Ne=\"RtcSetDataInput\",Oe=\"RtcUserSetDataInput\",be=\"RtcDataInput\",Me=\"RtcSetOutDataInput\",Ae=\"MCFollowInput\",Ue=\"RtcTokenOutput\",Pe=\"RtcQryOutput\",Le=\"RtcQryUserOutDataInput\",De=\"RtcUserOutDataOutput\",xe=\"RtcQueryListInput\",Ve=\"RtcRoomInfoOutput\",ke=\"RtcValueInfo\",Be=\"RtcKeyDeleteInput\",Fe=\"GetQNupTokenInput\",Ye=\"GetQNupTokenOutput\",qe=\"GetQNdownloadUrlInput\",He=\"GetQNdownloadUrlOutput\",Ge=\"SetChrmKV\",Ke=\"ChrmKVOutput\",je=\"QueryChrmKV\",$e=\"SetUserSettingInput\",We=\"SetUserSettingOutput\",Qe=\"PullUserSettingInput\",ze=\"PullUserSettingOutput\",Ze=\"SessionReq\",Je=\"SessionStates\",Xe=\"SessionState\",et=\"SessionStateItem\",tt=\"SessionStateModifyReq\",nt=\"SessionStateModifyResp\";const it={[ne]:[\"sessionId\",\"classname\",\"content\",\"pushText\",\"userId\",\"configFlag\",\"appData\",\"extraContent\"],[se]:[\"list\",\"syncTime\",\"finished\"],[ie]:[\"fromUserId\",\"type\",\"groupId\",\"classname\",\"content\",\"dataTime\",\"status\",\"msgId\",\"extraContent\"],[re]:[\"nothing\"],[oe]:[\"inboxTime\",\"sendboxTime\",\"totalUnreadCount\"],[ae]:[\"syncTime\",\"ispolling\",\"isweb\",\"isPullSend\",\"isKeeping\",\"sendBoxSyncTime\"],[he]:[\"syncTime\",\"count\"],[le]:[\"type\",\"time\",\"chrmId\"],[ue]:[\"targetId\",\"time\",\"count\",\"order\"],[ce]:[\"list\",\"syncTime\",\"hasMsg\"],[fe]:[\"type\",\"count\",\"startTime\",\"order\"],[de]:[\"info\"],[ge]:[\"sessions\"],[pe]:[\"type\",\"channelId\"],[Ee]:[\"nothing\"],[_e]:[\"type\",\"msg\",\"count\",\"offset\",\"startTime\",\"endTime\"],[me]:[\"type\",\"conversationId\",\"msgs\"],[ye]:[\"targetId\",\"dataTime\",\"conversationType\"],[Te]:[\"type\",\"msgTime\",\"channelId\"],[Re]:[\"nothing\"],[Ce]:[\"count\",\"order\"],[Ie]:[\"userTotalNums\",\"userInfos\"],[Fe]:[\"type\",\"key\"],[qe]:[\"type\",\"key\",\"fileName\"],[Ye]:[\"deadline\",\"token\"],[He]:[\"downloadUrl\"],[Ge]:[\"entry\",\"bNotify\",\"notification\",\"type\"],[Ke]:[\"entries\",\"bFullUpdate\",\"syncTime\"],[je]:[\"timestamp\"],[$e]:[\"version\",\"value\"],[We]:[\"version\",\"reserve\"],[Qe]:[\"version\",\"reserve\"],[ze]:[\"items\",\"version\"],[Ze]:[\"time\"],[Je]:[\"version\",\"state\"],[Xe]:[\"type\",\"channelId\",\"time\",\"stateItem\"],[et]:[\"sessionStateType\",\"value\"],[tt]:[\"version\",\"state\"],[nt]:[\"version\"]},st={};for(var rt in it){const e=it[rt];st[rt]=()=>{const t={},n={getArrayData:()=>t};for(let i=0;i<e.length;i++){const s=e[i];n[\"set\"+b(s,0,1)]=e=>{t[s]=e}}return n},st[rt].decode=function(e){const t={};h(e)&&(e=JSON.parse(e));for(const n in e){const i=\"get\"+b(n,0,1);t[n]=e[n],t[i]=()=>e[n]}return t}}st.getModule=e=>st[e]();const ot=`\\npackage Modules;\\nmessage probuf {\\n  message ${we}\\n  {\\n    optional int32 status=1;\\n  }\\n\\n  message SetUserStatusOutput\\n  {\\n    optional int32 nothing=1;\\n  }\\n\\n  message GetUserStatusInput\\n  {\\n    optional int32 nothing=1;\\n  }\\n\\n  message GetUserStatusOutput\\n  {\\n    optional string status=1;\\n    optional string subUserId=2;\\n  }\\n\\n  message SubUserStatusInput\\n  {\\n    repeated string userid =1;\\n  }\\n\\n  message SubUserStatusOutput\\n  {\\n    optional int32 nothing=1; \\n  }\\n  message VoipDynamicInput\\n  {\\n    required int32  engineType = 1;\\n    required string channelName = 2;\\n    optional string channelExtra = 3;\\n  }\\n\\n  message VoipDynamicOutput\\n  {\\n      required string dynamicKey=1;\\n  }\\n  message ${le} {\\n    required int32 type = 1;\\n    optional int64 time = 2;\\n    optional string chrmId=3;\\n  }\\n  message ${ae} {\\n    required int64 syncTime = 1;\\n    required bool ispolling = 2;\\n    optional bool isweb=3;\\n    optional bool isPullSend=4;\\n    optional bool isKeeping=5;\\n    optional int64 sendBoxSyncTime=6;\\n  }\\n  message ${ne} {\\n    required int32 sessionId = 1;\\n    required string classname = 2;\\n    required bytes content = 3;\\n    optional string pushText = 4;\\n    optional string appData = 5;\\n    repeated string userId = 6;\\n    optional int64 delMsgTime = 7;\\n    optional string delMsgId = 8;\\n    optional int32 configFlag = 9;\\n    optional int64 clientUniqueId = 10;\\n    optional string extraContent = 11;\\n  }\\n  message ${se} {\\n    repeated DownStreamMessage list = 1;\\n    required int64 syncTime = 2;\\n    optional bool finished = 3;\\n  }\\n  message ${ie} {\\n    required string fromUserId = 1;\\n    required ChannelType type = 2;\\n    optional string groupId = 3;\\n    required string classname = 4;\\n    required bytes content = 5;\\n    required int64 dataTime = 6;\\n    required int64 status = 7;\\n    optional int64 extra = 8;\\n    optional string msgId = 9;\\n    optional int32 direction = 10;\\n    optional int32 plantform =11;\\n    optional int32 isRemoved = 12; \\n    optional string source = 13; \\n    optional int64 clientUniqueId = 14; \\n    optional string extraContent = 15; \\n\\n  }\\n  enum ChannelType {\\n    PERSON = 1;\\n    PERSONS = 2;\\n    GROUP = 3;\\n    TEMPGROUP = 4;\\n    CUSTOMERSERVICE = 5;\\n    NOTIFY = 6;\\n    MC=7;\\n    MP=8;\\n  }\\n  message CreateDiscussionInput {\\n    optional string name = 1;\\n  }\\n  message CreateDiscussionOutput {\\n    required string id = 1;\\n  }\\n  message ChannelInvitationInput {\\n    repeated string users = 1;\\n  }\\n  message LeaveChannelInput {\\n    required int32 nothing = 1;\\n  }\\n  message ChannelEvictionInput {\\n    required string user = 1;\\n  }\\n  message RenameChannelInput {\\n    required string name = 1;\\n  }\\n  message ChannelInfoInput {\\n    required int32 nothing = 1;\\n  }\\n  message ChannelInfoOutput {\\n    required ChannelType type = 1;\\n    required string channelId = 2;\\n    required string channelName = 3;\\n    required string adminUserId = 4;\\n    repeated string firstTenUserIds = 5;\\n    required int32 openStatus = 6;\\n  }\\n  message ChannelInfosInput {\\n    required int32 page = 1;\\n    optional int32 number = 2;\\n  }\\n  message ChannelInfosOutput {\\n    repeated ChannelInfoOutput channels = 1;\\n    required int32 total = 2;\\n  }\\n  message MemberInfo {\\n    required string userId = 1;\\n    required string userName = 2;\\n    required string userPortrait = 3;\\n    required string extension = 4;\\n  }\\n  message GroupMembersInput {\\n    required int32 page = 1;\\n    optional int32 number = 2;\\n  }\\n  message GroupMembersOutput {\\n    repeated MemberInfo members = 1;\\n    required int32 total = 2;\\n  }\\n  message GetUserInfoInput {\\n    required int32 nothing = 1;\\n  }\\n  message GetUserInfoOutput {\\n    required string userId = 1;\\n    required string userName = 2;\\n    required string userPortrait = 3;\\n  }\\n  message GetSessionIdInput {\\n    required int32 nothing = 1;\\n  }\\n  message GetSessionIdOutput {\\n    required int32 sessionId = 1;\\n  }\\n  enum FileType {\\n    image = ${a.IMAGE};\\n    audio = ${a.AUDIO};\\n    video = ${a.VIDEO};\\n    file = ${a.FILE};\\n  }\\n  message ${Fe} {\\n    required FileType type = 1;\\n    optional string key = 2;\\n  }\\n  message ${qe} {\\n    required FileType type = 1;\\n    required string key = 2;\\n    optional string  fileName = 3;\\n  }\\n  message ${Ye} {\\n    required int64 deadline = 1;\\n    required string token = 2;\\n    optional string bosToken = 3;\\n    optional string bosDate = 4;\\n    optional string path = 5;\\n  }\\n  message ${He} {\\n    required string downloadUrl = 1;\\n  }\\n  message Add2BlackListInput {\\n    required string userId = 1;\\n  }\\n  message RemoveFromBlackListInput {\\n    required string userId = 1;\\n  }\\n  message QueryBlackListInput {\\n    required int32 nothing = 1;\\n  }\\n  message QueryBlackListOutput {\\n    repeated string userIds = 1;\\n  }\\n  message BlackListStatusInput {\\n    required string userId = 1;\\n  }\\n  message BlockPushInput {\\n    required string blockeeId = 1;\\n  }\\n  message ModifyPermissionInput {\\n    required int32 openStatus = 1;\\n  }\\n  message GroupInput {\\n    repeated GroupInfo groupInfo = 1;\\n  }\\n  message GroupOutput {\\n    required int32 nothing = 1;\\n  }\\n  message GroupInfo {\\n    required string id = 1;\\n    required string name = 2;\\n  }\\n  message GroupHashInput {\\n    required string userId = 1;\\n    required string groupHashCode = 2;\\n  }\\n  message GroupHashOutput {\\n    required GroupHashType result = 1;\\n  }\\n  enum GroupHashType {\\n    group_success = 0x00;\\n    group_failure = 0x01;\\n  }\\n  message ${Re} {\\n    required int32 nothing = 1;\\n  }\\n  message ChrmOutput {\\n    required int32 nothing = 1;\\n  }\\n  message ${he} {\\n    required int64 syncTime = 1;\\n    required int32 count = 2;\\n  }\\n  \\n  message ChrmPullMsgNew \\n  {\\n    required int32 count = 1;\\n    required int64 syncTime = 2;\\n    optional string chrmId=3;\\n  }\\n  message ${fe}\\n  {\\n    optional ChannelType type = 1;\\n    optional int32 count = 2;\\n    optional int64 startTime = 3;\\n    optional int32 order = 4;\\n  }\\n  message ${_e}\\n  {\\n    required ChannelType type = 1;\\n    optional DownStreamMessage msg =2;\\n    optional int32 count = 3;\\n    optional int32 offset = 4;\\n    optional int64 startTime = 5;\\n    optional int64 endTime = 6;\\n  }\\n  message ${de}\\n  {\\n    repeated RelationInfo info = 1;\\n  }\\n  message RelationInfo\\n  {\\n    required ChannelType type = 1;\\n    required string userId = 2;\\n    optional DownStreamMessage msg =3;\\n    optional int64 readMsgTime= 4;\\n    optional int64 unreadCount= 5;\\n  }\\n  message RelationInfoReadTime\\n  {\\n    required ChannelType type = 1;\\n    required int64 readMsgTime= 2;\\n    required string targetId = 3;\\n  }\\n  message ${ye}\\n  {\\n      required string targetId = 1;\\n      required int64 dataTime = 2;\\n      optional int32 conversationType= 3;\\n  }\\n  message HistoryMessageInput\\n  {\\n    required string targetId = 1;\\n    required int64 dataTime =2;\\n    required int32 size  = 3;\\n  }\\n\\n  message HistoryMessagesOuput\\n  {\\n    repeated DownStreamMessage list = 1;\\n    required int64 syncTime = 2;\\n    required int32 hasMsg = 3;\\n  }\\n  message ${Ce}\\n  {\\n    required int32 count= 1;\\n    optional int32 order= 2;\\n  }\\n\\n  message ${Ie}\\n  {\\n    optional int32 userTotalNums = 1;\\n    repeated ChrmMember userInfos = 2;\\n  }\\n  message ChrmMember\\n  {\\n    required int64 time = 1;\\n    required string id = 2;\\n  }\\n  message MPFollowInput\\n  {\\n    required string id = 1;\\n  }\\n\\n  message MPFollowOutput\\n  {\\n    required int32 nothing = 1;\\n    optional MpInfo info =2;\\n  }\\n\\n  message ${Ae}\\n  {\\n    required string id = 1;\\n  }\\n\\n  message MCFollowOutput\\n  {\\n    required int32 nothing = 1;\\n    optional MpInfo info =2;\\n  }\\n\\n  message MpInfo  \\n  {\\n    required string mpid=1;\\n    required string name = 2;\\n    required string type = 3;\\n    required int64 time=4;\\n    optional string portraitUrl=5;\\n    optional string extra =6;\\n  }\\n\\n  message SearchMpInput\\n  {\\n    required int32 type=1;\\n    required string id=2;\\n  }\\n\\n  message SearchMpOutput\\n  {\\n    required int32 nothing=1;\\n    repeated MpInfo info = 2;\\n  }\\n\\n  message PullMpInput\\n  {\\n    required int64 time=1;\\n    required string mpid=2;\\n  }\\n\\n  message PullMpOutput\\n  {\\n    required int32 status=1;\\n    repeated MpInfo info = 2;\\n  }\\n  message ${ue}\\n  {\\n    optional string targetId = 1;\\n    optional int64 time = 2;\\n    optional int32 count  = 3;\\n    optional int32 order = 4;\\n  }\\n\\n  message ${ce}\\n  {\\n    repeated DownStreamMessage list=1;\\n    required int64 syncTime=2;\\n    required int32 hasMsg=3;\\n  }\\n  message ${xe}{\\n    optional int32 order=1;\\n  }\\n\\n  message ${Be}{\\n    repeated string key=1;\\n  }\\n\\n  message ${ke}{\\n    required string key=1;\\n    required string value=2;\\n  }\\n\\n  message RtcUserInfo{\\n    required string userId=1;\\n    repeated ${ke} userData=2;\\n  }\\n\\n  message ${Se}{\\n    repeated RtcUserInfo list=1;\\n    optional string token=2;\\n    optional string sessionId=3;\\n  }\\n  message RtcRoomInfoOutput{\\n    optional string roomId = 1;\\n    repeated ${ke} roomData = 2;\\n    optional int32 userCount = 3;\\n    repeated RtcUserInfo list=4;\\n  }\\n  message ${ve}{\\n    required int32 roomType=1;\\n    optional int32 broadcastType=2;\\n  }\\n  message RtcQryInput{ \\n    required bool isInterior=1;\\n    required targetType target=2;\\n    repeated string key=3;\\n  }\\n  message ${Pe}{\\n    repeated ${ke} outInfo=1;\\n  }\\n  message RtcDelDataInput{\\n    repeated string key=1;\\n    required bool isInterior=2;\\n    required targetType target=3;\\n  }\\n  message ${be}{ \\n    required bool interior=1;\\n    required targetType target=2;\\n    repeated string key=3;\\n    optional string objectName=4;\\n    optional string content=5;\\n  }\\n  message ${Ne}{\\n    required bool interior=1;\\n    required targetType target=2;\\n    required string key=3;\\n    required string value=4;\\n    optional string objectName=5;\\n    optional string content=6;\\n  }\\n  message ${Oe} {\\n    repeated ${ke} valueInfo = 1;\\n    required string objectName = 2;\\n    repeated ${ke} content = 3;\\n  }\\n  message RtcOutput\\n  {\\n    optional int32 nothing=1; \\n  }\\n  message ${Ue}{\\n    required string rtcToken=1;\\n  }\\n  enum targetType {\\n    ROOM =1 ;\\n    PERSON = 2;\\n  }\\n  message ${Me}{\\n    required targetType target=1;\\n    repeated ${ke} valueInfo=2;\\n    optional string objectName=3;\\n    optional string content=4;\\n  }\\n  message ${Le}{\\n    repeated string userId = 1;\\n  }\\n  message ${De}{\\n    repeated RtcUserInfo user = 1;\\n  }\\n  message ${re}{\\n    required int32 nothing = 1;\\n  }\\n  message ${oe}{\\n    required int64 inboxTime = 1;\\n    required int64 sendboxTime = 2;\\n    required int64 totalUnreadCount = 3;\\n  }\\n  message ${Te}\\n  {\\n    required ChannelType type = 1;\\n    required int64 msgTime = 2;\\n    required string channelId = 3;\\n  }\\n  message SessionMsgReadOutput\\n  {\\n    optional int32 nothing=1; \\n  }\\n  message ${ge}\\n  {\\n    repeated SessionInfo sessions = 1;\\n  }\\n  message ${pe}\\n  {\\n    required ChannelType type = 1;\\n    required string channelId = 2;\\n  }\\n  message ${Ee}\\n  {\\n    optional int32 nothing=1; \\n  }\\n  message ${me}\\n  {\\n    optional ChannelType type = 1;\\n    optional string conversationId = 2;\\n    repeated DeleteMsg msgs = 3;\\n  }\\n  message DeleteMsg\\n  {\\n    optional string msgId = 1;\\n    optional int64 msgDataTime = 2;\\n    optional int32 direct = 3;\\n  }\\n  message ChrmKVEntity {\\n    required string key = 1;\\n    required string value = 2;\\n    optional int32 status = 3;\\n    optional int64 timestamp = 4;\\n    optional string uid = 5;\\n  }\\n  message ${Ge} {\\n    required ChrmKVEntity entry = 1;\\n    optional bool bNotify = 2;\\n    optional UpStreamMessage notification = 3;\\n    optional ChannelType type = 4;\\n  }\\n  message ${Ke} {\\n    repeated ChrmKVEntity entries = 1;\\n    optional bool bFullUpdate = 2;\\n    optional int64 syncTime = 3;\\n  }\\n  message ${je} {\\n    required int64 timestamp = 1;\\n  }\\n  message ${$e} {\\n    required int64 version=1;\\n    required string value=2;\\n  }\\n  message ${We} {\\n    required int64 version=1;\\n    required bool reserve=2;\\n  }\\n  message ${Qe} {\\n    required int64 version=1;//\\n    optional bool reserve=2;\\n  }\\n  message ${ze} {\\n    repeated UserSettingItem items = 1;\\n    required int64 version=2;\\n  }\\n  message UserSettingItem {\\n    required string targetId= 1;\\n    required ChannelType type = 2;\\n    required string key = 4;\\n    required bytes value = 5;\\n    required int64 version=6;\\n    required int32 status=7;\\n  }\\n  message ${Ze} {\\n    required int64 time = 1;\\n  }\\n  message ${Je} {\\n    required int64 version=1;\\n    repeated SessionState state= 2;\\n  }\\n  message ${Xe} {\\n    required ChannelType type = 1;\\n    required string channelId = 2;  \\n    optional int64 time = 3;\\n    repeated SessionStateItem stateItem = 4;\\n  }\\n  message ${et} {\\n    required SessionStateType sessionStateType = 1;\\n    required string value = 2;\\n  }\\n  enum SessionStateType {\\n    IsSilent = 1;\\n    IsTop = 2;\\n  }\\n  message ${tt} {\\n    required int64 version=1;\\n    repeated SessionState state= 2;\\n  }\\n  message ${nt} {\\n    required int64 version=1;\\n  }\\n}\\n`;const at=(ht=ot,function(e,t){var n,i,s={};return s.ByteBuffer=e,s.c=e,n=e,s.Long=t||null,s.VERSION=\"5.0.1\",s.WIRE_TYPES={},s.WIRE_TYPES.VARINT=0,s.WIRE_TYPES.BITS64=1,s.WIRE_TYPES.LDELIM=2,s.WIRE_TYPES.STARTGROUP=3,s.WIRE_TYPES.ENDGROUP=4,s.WIRE_TYPES.BITS32=5,s.PACKABLE_WIRE_TYPES=[s.WIRE_TYPES.VARINT,s.WIRE_TYPES.BITS64,s.WIRE_TYPES.BITS32],s.TYPES={int32:{name:\"int32\",wireType:s.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:\"uint32\",wireType:s.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:\"sint32\",wireType:s.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:\"int64\",wireType:s.WIRE_TYPES.VARINT,defaultValue:s.Long?s.Long.ZERO:void 0},uint64:{name:\"uint64\",wireType:s.WIRE_TYPES.VARINT,defaultValue:s.Long?s.Long.UZERO:void 0},sint64:{name:\"sint64\",wireType:s.WIRE_TYPES.VARINT,defaultValue:s.Long?s.Long.ZERO:void 0},bool:{name:\"bool\",wireType:s.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:\"double\",wireType:s.WIRE_TYPES.BITS64,defaultValue:0},string:{name:\"string\",wireType:s.WIRE_TYPES.LDELIM,defaultValue:\"\"},bytes:{name:\"bytes\",wireType:s.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:\"fixed32\",wireType:s.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:\"sfixed32\",wireType:s.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:\"fixed64\",wireType:s.WIRE_TYPES.BITS64,defaultValue:s.Long?s.Long.UZERO:void 0},sfixed64:{name:\"sfixed64\",wireType:s.WIRE_TYPES.BITS64,defaultValue:s.Long?s.Long.ZERO:void 0},float:{name:\"float\",wireType:s.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:\"enum\",wireType:s.WIRE_TYPES.VARINT,defaultValue:0},message:{name:\"message\",wireType:s.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:\"group\",wireType:s.WIRE_TYPES.STARTGROUP,defaultValue:null}},s.MAP_KEY_TYPES=[s.TYPES.int32,s.TYPES.sint32,s.TYPES.sfixed32,s.TYPES.uint32,s.TYPES.fixed32,s.TYPES.int64,s.TYPES.sint64,s.TYPES.sfixed64,s.TYPES.uint64,s.TYPES.fixed64,s.TYPES.bool,s.TYPES.string,s.TYPES.bytes],s.ID_MIN=1,s.ID_MAX=536870911,s.convertFieldsToCamelCase=!1,s.populateAccessors=!0,s.populateDefaults=!0,s.Util=function(){var e={};return e.IS_NODE=!(\"object\"!=typeof process||process+\"\"!=\"[object process]\"||process.browser),e.XHR=function(){var e,t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject(\"Msxml2.XMLHTTP\")},function(){return new ActiveXObject(\"Msxml3.XMLHTTP\")},function(){return new ActiveXObject(\"Microsoft.XMLHTTP\")}],n=null;for(e=0;e<t.length;e++){try{n=t[e]()}catch(e){continue}break}if(!n)throw Error(\"XMLHttpRequest is not supported\");return n},e.fetch=function(t,n){if(n&&\"function\"!=typeof n&&(n=null),e.IS_NODE)if(n)g.readFile(t,(function(e,t){n(e?null:\"\"+t)}));else try{return g.readFileSync(t)}catch(e){return null}else{var i=e.XHR();if(i.open(\"GET\",t,!!n),i.setRequestHeader(\"Accept\",\"text/plain\"),\"function\"==typeof i.overrideMimeType&&i.overrideMimeType(\"text/plain\"),!n)return i.send(null),200==i.status||0==i.status&&\"string\"==typeof i.responseText?i.responseText:null;if(i.onreadystatechange=function(){4==i.readyState&&(200==i.status||0==i.status&&\"string\"==typeof i.responseText?n(i.responseText):n(null))},4==i.readyState)return;i.send(null)}},e.toCamelCase=function(e){return e.replace(/_([a-zA-Z])/g,(function(e,t){return t.toUpperCase()}))},e}(),s.Lang={DELIM:/[\\s\\{\\}=;:\\[\\],'\"\\(\\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\\s/,STRING:/(?:\"([^\"\\\\]*(?:\\\\.[^\"\\\\]*)*)\")|(?:'([^'\\\\]*(?:\\\\.[^'\\\\]*)*)')/g,STRING_DQ:/(?:\"([^\"\\\\]*(?:\\\\.[^\"\\\\]*)*)\")/g,STRING_SQ:/(?:'([^'\\\\]*(?:\\\\.[^'\\\\]*)*)')/g},s.DotProto=function(e,t){function n(e,n){var i=-1,s=1;if(\"-\"==e.charAt(0)&&(s=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))i=parseInt(e);else if(t.NUMBER_HEX.test(e))i=parseInt(e.substring(2),16);else{if(!t.NUMBER_OCT.test(e))throw Error(\"illegal id value: \"+(s<0?\"-\":\"\")+e);i=parseInt(e.substring(1),8)}if(i=0|s*i,!n&&i<0)throw Error(\"illegal id value: \"+(s<0?\"-\":\"\")+e);return i}function i(e){var n=1;if(\"-\"==e.charAt(0)&&(n=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))return n*parseInt(e,10);if(t.NUMBER_HEX.test(e))return n*parseInt(e.substring(2),16);if(t.NUMBER_OCT.test(e))return n*parseInt(e.substring(1),8);if(\"inf\"===e)return 1/0*n;if(\"nan\"===e)return NaN;if(t.NUMBER_FLT.test(e))return n*parseFloat(e);throw Error(\"illegal number value: \"+(n<0?\"-\":\"\")+e)}function s(e,t,n){void 0===e[t]?e[t]=n:(Array.isArray(e[t])||(e[t]=[e[t]]),e[t].push(n))}var r,o,a={},h=function(e){this.source=e+\"\",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},l=h.prototype;return l._readString=function(){var e,n='\"'===this._stringOpen?t.STRING_DQ:t.STRING_SQ;if(n.lastIndex=this.index-1,!(e=n.exec(this.source)))throw Error(\"unterminated string\");return this.index=n.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,e[1]},l.next=function(){var e,n,i,s,r;if(this.stack.length>0)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();do{for(e=!1;t.WHITESPACE.test(i=this.source.charAt(this.index));)if(\"\\n\"===i&&++this.line,++this.index===this.source.length)return null;if(\"/\"===this.source.charAt(this.index))if(++this.index,\"/\"===this.source.charAt(this.index)){for(;\"\\n\"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,e=!0}else{if(\"*\"!==(i=this.source.charAt(this.index)))return\"/\";do{if(\"\\n\"===i&&++this.line,++this.index===this.source.length)return null;n=i,i=this.source.charAt(this.index)}while(\"*\"!==n||\"/\"!==i);++this.index,e=!0}}while(e);if(this.index===this.source.length)return null;if(s=this.index,t.DELIM.lastIndex=0,!t.DELIM.test(this.source.charAt(s++)))for(;s<this.source.length&&!t.DELIM.test(this.source.charAt(s));)++s;return('\"'===(r=this.source.substring(this.index,this.index=s))||\"'\"===r)&&(this._stringOpen=r),r},l.peek=function(){if(0===this.stack.length){var e=this.next();if(null===e)return null;this.stack.push(e)}return this.stack[0]},l.skip=function(e){var t=this.next();if(t!==e)throw Error(\"illegal '\"+t+\"', '\"+e+\"' expected\")},l.omit=function(e){return this.peek()===e&&(this.next(),!0)},l.toString=function(){return\"Tokenizer (\"+this.index+\"/\"+this.source.length+\" at line \"+this.line+\")\"},a.Tokenizer=h,(o=(r=function(e){this.tn=new h(e),this.proto3=!1}).prototype).parse=function(){var e,n={name:\"[ROOT]\",package:null,messages:[],enums:[],imports:[],options:{},services:[]},i=!0;try{for(;e=this.tn.next();)switch(e){case\"package\":if(!i||null!==n.package)throw Error(\"unexpected 'package'\");if(e=this.tn.next(),!t.TYPEREF.test(e))throw Error(\"illegal package name: \"+e);this.tn.skip(\";\"),n.package=e;break;case\"import\":if(!i)throw Error(\"unexpected 'import'\");\"public\"===(e=this.tn.peek())&&this.tn.next(),e=this._readString(),this.tn.skip(\";\"),n.imports.push(e);break;case\"syntax\":if(!i)throw Error(\"unexpected 'syntax'\");this.tn.skip(\"=\"),\"proto3\"===(n.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(\";\");break;case\"message\":this._parseMessage(n,null),i=!1;break;case\"enum\":this._parseEnum(n),i=!1;break;case\"option\":this._parseOption(n);break;case\"service\":this._parseService(n);break;case\"extend\":this._parseExtend(n);break;default:throw Error(\"unexpected '\"+e+\"'\")}}catch(e){throw e.message=\"Parse error at line \"+this.tn.line+\": \"+e.message,e}return delete n.name,n},r.parse=function(e){return new r(e).parse()},o._readString=function(){var e,t,n=\"\";do{if(\"'\"!==(t=this.tn.next())&&'\"'!==t)throw Error(\"illegal string delimiter: \"+t);n+=this.tn.next(),this.tn.skip(t),e=this.tn.peek()}while('\"'===e||'\"'===e);return n},o._readValue=function(e){var n=this.tn.peek();if('\"'===n||\"'\"===n)return this._readString();if(this.tn.next(),t.NUMBER.test(n))return i(n);if(t.BOOL.test(n))return\"true\"===n.toLowerCase();if(e&&t.TYPEREF.test(n))return n;throw Error(\"illegal value: \"+n)},o._parseOption=function(e,n){var i,s=this.tn.next(),r=!1;if(\"(\"===s&&(r=!0,s=this.tn.next()),!t.TYPEREF.test(s))throw Error(\"illegal option name: \"+s);i=s,r&&(this.tn.skip(\")\"),i=\"(\"+i+\")\",s=this.tn.peek(),t.FQTYPEREF.test(s)&&(i+=s,this.tn.next())),this.tn.skip(\"=\"),this._parseOptionValue(e,i),n||this.tn.skip(\";\")},o._parseOptionValue=function(e,n){var i=this.tn.peek();if(\"{\"!==i)s(e.options,n,this._readValue(!0));else for(this.tn.skip(\"{\");\"}\"!==(i=this.tn.next());){if(!t.NAME.test(i))throw Error(\"illegal option name: \"+n+\".\"+i);this.tn.omit(\":\")?s(e.options,n+\".\"+i,this._readValue(!0)):this._parseOptionValue(e,n+\".\"+i)}},o._parseService=function(e){var n,i=this.tn.next();if(!t.NAME.test(i))throw Error(\"illegal service name at line \"+this.tn.line+\": \"+i);for(n={name:i,rpc:{},options:{}},this.tn.skip(\"{\");\"}\"!==(i=this.tn.next());)if(\"option\"===i)this._parseOption(n);else{if(\"rpc\"!==i)throw Error(\"illegal service token: \"+i);this._parseServiceRPC(n)}this.tn.omit(\";\"),e.services.push(n)},o._parseServiceRPC=function(e){var n,i,s=\"rpc\",r=this.tn.next();if(!t.NAME.test(r))throw Error(\"illegal rpc service method name: \"+r);if(n=r,i={request:null,response:null,request_stream:!1,response_stream:!1,options:{}},this.tn.skip(\"(\"),\"stream\"===(r=this.tn.next()).toLowerCase()&&(i.request_stream=!0,r=this.tn.next()),!t.TYPEREF.test(r))throw Error(\"illegal rpc service request type: \"+r);if(i.request=r,this.tn.skip(\")\"),\"returns\"!==(r=this.tn.next()).toLowerCase())throw Error(\"illegal rpc service request type delimiter: \"+r);if(this.tn.skip(\"(\"),\"stream\"===(r=this.tn.next()).toLowerCase()&&(i.response_stream=!0,r=this.tn.next()),i.response=r,this.tn.skip(\")\"),\"{\"===(r=this.tn.peek())){for(this.tn.next();\"}\"!==(r=this.tn.next());){if(\"option\"!==r)throw Error(\"illegal rpc service token: \"+r);this._parseOption(i)}this.tn.omit(\";\")}else this.tn.skip(\";\");void 0===e[s]&&(e[s]={}),e[s][n]=i},o._parseMessage=function(e,i){var s=!!i,r=this.tn.next(),o={name:\"\",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!t.NAME.test(r))throw Error(\"illegal \"+(s?\"group\":\"message\")+\" name: \"+r);for(o.name=r,s&&(this.tn.skip(\"=\"),i.id=n(this.tn.next()),o.isGroup=!0),\"[\"===(r=this.tn.peek())&&i&&this._parseFieldOptions(i),this.tn.skip(\"{\");\"}\"!==(r=this.tn.next());)if(t.RULE.test(r))this._parseMessageField(o,r);else if(\"oneof\"===r)this._parseMessageOneOf(o);else if(\"enum\"===r)this._parseEnum(o);else if(\"message\"===r)this._parseMessage(o);else if(\"option\"===r)this._parseOption(o);else if(\"service\"===r)this._parseService(o);else if(\"extensions\"===r)o.extensions=this._parseExtensionRanges();else if(\"reserved\"===r)this._parseIgnored();else if(\"extend\"===r)this._parseExtend(o);else{if(!t.TYPEREF.test(r))throw Error(\"illegal message token: \"+r);if(!this.proto3)throw Error(\"illegal field rule: \"+r);this._parseMessageField(o,\"optional\",r)}return this.tn.omit(\";\"),e.messages.push(o),o},o._parseIgnored=function(){for(;\";\"!==this.tn.peek();)this.tn.next();this.tn.skip(\";\")},o._parseMessageField=function(e,i,s){var r,o,a;if(!t.RULE.test(i))throw Error(\"illegal message field rule: \"+i);if(r={rule:i,type:\"\",name:\"\",options:{},id:0},\"map\"===i){if(s)throw Error(\"illegal type: \"+s);if(this.tn.skip(\"<\"),o=this.tn.next(),!t.TYPE.test(o)&&!t.TYPEREF.test(o))throw Error(\"illegal message field type: \"+o);if(r.keytype=o,this.tn.skip(\",\"),o=this.tn.next(),!t.TYPE.test(o)&&!t.TYPEREF.test(o))throw Error(\"illegal message field: \"+o);if(r.type=o,this.tn.skip(\">\"),o=this.tn.next(),!t.NAME.test(o))throw Error(\"illegal message field name: \"+o);r.name=o,this.tn.skip(\"=\"),r.id=n(this.tn.next()),\"[\"===(o=this.tn.peek())&&this._parseFieldOptions(r),this.tn.skip(\";\")}else if(\"group\"===(s=void 0!==s?s:this.tn.next())){if(a=this._parseMessage(e,r),!/^[A-Z]/.test(a.name))throw Error(\"illegal group name: \"+a.name);r.type=a.name,r.name=a.name.toLowerCase(),this.tn.omit(\";\")}else{if(!t.TYPE.test(s)&&!t.TYPEREF.test(s))throw Error(\"illegal message field type: \"+s);if(r.type=s,o=this.tn.next(),!t.NAME.test(o))throw Error(\"illegal message field name: \"+o);r.name=o,this.tn.skip(\"=\"),r.id=n(this.tn.next()),\"[\"===(o=this.tn.peek())&&this._parseFieldOptions(r),this.tn.skip(\";\")}return e.fields.push(r),r},o._parseMessageOneOf=function(e){var n,i,s,r=this.tn.next();if(!t.NAME.test(r))throw Error(\"illegal oneof name: \"+r);for(i=r,s=[],this.tn.skip(\"{\");\"}\"!==(r=this.tn.next());)(n=this._parseMessageField(e,\"optional\",r)).oneof=i,s.push(n.id);this.tn.omit(\";\"),e.oneofs[i]=s},o._parseFieldOptions=function(e){this.tn.skip(\"[\");for(var t=!0;\"]\"!==this.tn.peek();)t||this.tn.skip(\",\"),this._parseOption(e,!0),t=!1;this.tn.next()},o._parseEnum=function(e){var i,s={name:\"\",values:[],options:{}},r=this.tn.next();if(!t.NAME.test(r))throw Error(\"illegal name: \"+r);for(s.name=r,this.tn.skip(\"{\");\"}\"!==(r=this.tn.next());)if(\"option\"===r)this._parseOption(s);else{if(!t.NAME.test(r))throw Error(\"illegal name: \"+r);this.tn.skip(\"=\"),i={name:r,id:n(this.tn.next(),!0)},\"[\"===(r=this.tn.peek())&&this._parseFieldOptions({options:{}}),this.tn.skip(\";\"),s.values.push(i)}this.tn.omit(\";\"),e.enums.push(s)},o._parseExtensionRanges=function(){var t,n,s,r=[];do{for(n=[];;){switch(t=this.tn.next()){case\"min\":s=e.ID_MIN;break;case\"max\":s=e.ID_MAX;break;default:s=i(t)}if(n.push(s),2===n.length)break;if(\"to\"!==this.tn.peek()){n.push(s);break}this.tn.next()}r.push(n)}while(this.tn.omit(\",\"));return this.tn.skip(\";\"),r},o._parseExtend=function(e){var n,i=this.tn.next();if(!t.TYPEREF.test(i))throw Error(\"illegal extend reference: \"+i);for(n={ref:i,fields:[]},this.tn.skip(\"{\");\"}\"!==(i=this.tn.next());)if(t.RULE.test(i))this._parseMessageField(n,i);else{if(!t.TYPEREF.test(i))throw Error(\"illegal extend token: \"+i);if(!this.proto3)throw Error(\"illegal field rule: \"+i);this._parseMessageField(n,\"optional\",i)}return this.tn.omit(\";\"),e.messages.push(n),n},o.toString=function(){return\"Parser at line \"+this.tn.line},a.Parser=r,a}(s,s.Lang),s.Reflect=function(t){function i(e,n){if(e&&\"number\"==typeof e.low&&\"number\"==typeof e.high&&\"boolean\"==typeof e.unsigned&&e.low==e.low&&e.high==e.high)return new t.Long(e.low,e.high,void 0===n?e.unsigned:n);if(\"string\"==typeof e)return t.Long.fromString(e,n||!1,10);if(\"number\"==typeof e)return t.Long.fromNumber(e,n||!1);throw Error(\"not convertible to Long\")}function s(e,n){var i=n.readVarint32(),r=7&i,o=i>>>3;switch(r){case t.WIRE_TYPES.VARINT:do{i=n.readUint8()}while(128==(128&i));break;case t.WIRE_TYPES.BITS64:n.offset+=8;break;case t.WIRE_TYPES.LDELIM:i=n.readVarint32(),n.offset+=i;break;case t.WIRE_TYPES.STARTGROUP:s(o,n);break;case t.WIRE_TYPES.ENDGROUP:if(o===e)return!1;throw Error(\"Illegal GROUPEND after unknown group: \"+o+\" (\"+e+\" expected)\");case t.WIRE_TYPES.BITS32:n.offset+=4;break;default:throw Error(\"Illegal wire type in unknown group \"+e+\": \"+r)}return!0}var r,o,a,h,l,u,c,f,d,g,p,E,_,m,y,T,R={},C=function(e,t,n){this.builder=e,this.parent=t,this.name=n,this.className},I=C.prototype;return I.fqn=function(){for(var e=this.name,t=this;null!=(t=t.parent);)e=t.name+\".\"+e;return e},I.toString=function(e){return(e?this.className+\" \":\"\")+this.fqn()},I.build=function(){throw Error(this.toString(!0)+\" cannot be built directly\")},R.T=C,(o=(r=function(e,t,n,i,s){C.call(this,e,t,n),this.className=\"Namespace\",this.children=[],this.options=i||{},this.syntax=s||\"proto2\"}).prototype=Object.create(C.prototype)).getChildren=function(e){var t,n,i;if(null==(e=e||null))return this.children.slice();for(t=[],n=0,i=this.children.length;i>n;++n)this.children[n]instanceof e&&t.push(this.children[n]);return t},o.addChild=function(e){var t;if(t=this.getChild(e.name))if(t instanceof l.Field&&t.name!==t.originalName&&null===this.getChild(t.originalName))t.name=t.originalName;else{if(!(e instanceof l.Field&&e.name!==e.originalName&&null===this.getChild(e.originalName)))throw Error(\"Duplicate name in namespace \"+this.toString(!0)+\": \"+e.name);e.name=e.originalName}this.children.push(e)},o.getChild=function(e){var t,n,i=\"number\"==typeof e?\"id\":\"name\";for(t=0,n=this.children.length;n>t;++t)if(this.children[t][i]===e)return this.children[t];return null},o.resolve=function(e,t){var n,i=\"string\"==typeof e?e.split(\".\"):e,s=this,r=0;if(\"\"===i[r]){for(;null!==s.parent;)s=s.parent;r++}do{do{if(!(s instanceof R.Namespace)){s=null;break}if(!((n=s.getChild(i[r]))&&n instanceof R.T&&(!t||n instanceof R.Namespace))){s=null;break}s=n,r++}while(r<i.length);if(null!=s)break;if(null!==this.parent)return this.parent.resolve(e,t)}while(null!=s);return s},o.qn=function(e){var t,n,i=[],s=e;do{i.unshift(s.name),s=s.parent}while(null!==s);for(t=1;t<=i.length;t++)if(n=i.slice(i.length-t),e===this.resolve(n,e instanceof R.Namespace))return n.join(\".\");return e.fqn()},o.build=function(){var e,t,n,i={},s=this.children;for(t=0,n=s.length;n>t;++t)(e=s[t])instanceof r&&(i[e.name]=e.build());return Object.defineProperty&&Object.defineProperty(i,\"$options\",{value:this.buildOpt()}),i},o.buildOpt=function(){var e,t,n,i,s={},r=Object.keys(this.options);for(e=0,t=r.length;t>e;++e)n=r[e],i=this.options[r[e]],s[n]=i;return s},o.getOption=function(e){return void 0===e?this.options:void 0!==this.options[e]?this.options[e]:null},R.Namespace=r,h=(a=function(e,n,i,s){if(this.type=e,this.resolvedType=n,this.isMapKey=i,this.syntax=s,i&&t.MAP_KEY_TYPES.indexOf(e)<0)throw Error(\"Invalid map key type: \"+e.name)}).prototype,a.defaultFieldValue=function(e){if(\"string\"==typeof e&&(e=t.TYPES[e]),void 0===e.defaultValue)throw Error(\"default value for type \"+e.name+\" is not supported\");return e==t.TYPES.bytes?new n(0):e.defaultValue},h.verifyValue=function(n){var s,r,o,a=function(e,t){throw Error(\"Illegal value for \"+this.toString(!0)+\" of type \"+this.type.name+\": \"+e+\" (\"+t+\")\")}.bind(this);switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:return(\"number\"!=typeof n||n==n&&n%1!=0)&&a(typeof n,\"not an integer\"),n>4294967295?0|n:n;case t.TYPES.uint32:case t.TYPES.fixed32:return(\"number\"!=typeof n||n==n&&n%1!=0)&&a(typeof n,\"not an integer\"),n<0?n>>>0:n;case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:if(t.Long)try{return i(n,!1)}catch(e){a(typeof n,e.message)}else a(typeof n,\"requires Long.js\");case t.TYPES.uint64:case t.TYPES.fixed64:if(t.Long)try{return i(n,!0)}catch(e){a(typeof n,e.message)}else a(typeof n,\"requires Long.js\");case t.TYPES.bool:return\"boolean\"!=typeof n&&a(typeof n,\"not a boolean\"),n;case t.TYPES.float:case t.TYPES.double:return\"number\"!=typeof n&&a(typeof n,\"not a number\"),n;case t.TYPES.string:return\"string\"==typeof n||n&&n instanceof String||a(typeof n,\"not a string\"),\"\"+n;case t.TYPES.bytes:return e.isByteBuffer(n)?n:e.wrap(n);case t.TYPES.enum:for(s=this.resolvedType.getChildren(t.Reflect.Enum.Value),o=0;o<s.length;o++){if(s[o].name==n)return s[o].id;if(s[o].id==n)return s[o].id}if(\"proto3\"===this.syntax)return(\"number\"!=typeof n||n==n&&n%1!=0)&&a(typeof n,\"not an integer\"),(n>4294967295||n<0)&&a(typeof n,\"not in range for uint32\"),n;a(n,\"not a valid enum value\");case t.TYPES.group:case t.TYPES.message:if(n&&\"object\"==typeof n||a(typeof n,\"object expected\"),n instanceof this.resolvedType.clazz)return n;if(n instanceof t.Builder.Message){for(o in r={},n)n.hasOwnProperty(o)&&(r[o]=n[o]);n=r}return new this.resolvedType.clazz(n)}throw Error(\"[INTERNAL] Illegal value for \"+this.toString(!0)+\": \"+n+\" (undefined type \"+this.type+\")\")},h.calculateLength=function(e,i){if(null===i)return 0;var s;switch(this.type){case t.TYPES.int32:return i<0?n.calculateVarint64(i):n.calculateVarint32(i);case t.TYPES.uint32:return n.calculateVarint32(i);case t.TYPES.sint32:return n.calculateVarint32(n.zigZagEncode32(i));case t.TYPES.fixed32:case t.TYPES.sfixed32:case t.TYPES.float:return 4;case t.TYPES.int64:case t.TYPES.uint64:return n.calculateVarint64(i);case t.TYPES.sint64:return n.calculateVarint64(n.zigZagEncode64(i));case t.TYPES.fixed64:case t.TYPES.sfixed64:return 8;case t.TYPES.bool:return 1;case t.TYPES.enum:return n.calculateVarint32(i);case t.TYPES.double:return 8;case t.TYPES.string:return s=n.calculateUTF8Bytes(i),n.calculateVarint32(s)+s;case t.TYPES.bytes:if(i.remaining()<0)throw Error(\"Illegal value for \"+this.toString(!0)+\": \"+i.remaining()+\" bytes remaining\");return n.calculateVarint32(i.remaining())+i.remaining();case t.TYPES.message:return s=this.resolvedType.calculate(i),n.calculateVarint32(s)+s;case t.TYPES.group:return(s=this.resolvedType.calculate(i))+n.calculateVarint32(e<<3|t.WIRE_TYPES.ENDGROUP)}throw Error(\"[INTERNAL] Illegal value to encode in \"+this.toString(!0)+\": \"+i+\" (unknown type)\")},h.encodeValue=function(e,i,s){var r,o;if(null===i)return s;switch(this.type){case t.TYPES.int32:i<0?s.writeVarint64(i):s.writeVarint32(i);break;case t.TYPES.uint32:s.writeVarint32(i);break;case t.TYPES.sint32:s.writeVarint32ZigZag(i);break;case t.TYPES.fixed32:s.writeUint32(i);break;case t.TYPES.sfixed32:s.writeInt32(i);break;case t.TYPES.int64:case t.TYPES.uint64:s.writeVarint64(i);break;case t.TYPES.sint64:s.writeVarint64ZigZag(i);break;case t.TYPES.fixed64:s.writeUint64(i);break;case t.TYPES.sfixed64:s.writeInt64(i);break;case t.TYPES.bool:\"string\"==typeof i?s.writeVarint32(\"false\"===i.toLowerCase()?0:!!i):s.writeVarint32(i?1:0);break;case t.TYPES.enum:s.writeVarint32(i);break;case t.TYPES.float:s.writeFloat32(i);break;case t.TYPES.double:s.writeFloat64(i);break;case t.TYPES.string:s.writeVString(i);break;case t.TYPES.bytes:if(i.remaining()<0)throw Error(\"Illegal value for \"+this.toString(!0)+\": \"+i.remaining()+\" bytes remaining\");r=i.offset,s.writeVarint32(i.remaining()),s.append(i),i.offset=r;break;case t.TYPES.message:o=(new n).LE(),this.resolvedType.encode(i,o),s.writeVarint32(o.offset),s.append(o.flip());break;case t.TYPES.group:this.resolvedType.encode(i,s),s.writeVarint32(e<<3|t.WIRE_TYPES.ENDGROUP);break;default:throw Error(\"[INTERNAL] Illegal value to encode in \"+this.toString(!0)+\": \"+i+\" (unknown type)\")}return s},h.decode=function(e,n,i){if(n!=this.type.wireType)throw Error(\"Unexpected wire type for element\");var s,r;switch(this.type){case t.TYPES.int32:return 0|e.readVarint32();case t.TYPES.uint32:return e.readVarint32()>>>0;case t.TYPES.sint32:return 0|e.readVarint32ZigZag();case t.TYPES.fixed32:return e.readUint32()>>>0;case t.TYPES.sfixed32:return 0|e.readInt32();case t.TYPES.int64:return e.readVarint64();case t.TYPES.uint64:return e.readVarint64().toUnsigned();case t.TYPES.sint64:return e.readVarint64ZigZag();case t.TYPES.fixed64:return e.readUint64();case t.TYPES.sfixed64:return e.readInt64();case t.TYPES.bool:return!!e.readVarint32();case t.TYPES.enum:return e.readVarint32();case t.TYPES.float:return e.readFloat();case t.TYPES.double:return e.readDouble();case t.TYPES.string:return e.readVString();case t.TYPES.bytes:if(r=e.readVarint32(),e.remaining()<r)throw Error(\"Illegal number of bytes for \"+this.toString(!0)+\": \"+r+\" required but got only \"+e.remaining());return(s=e.clone()).limit=s.offset+r,e.offset+=r,s;case t.TYPES.message:return r=e.readVarint32(),this.resolvedType.decode(e,r);case t.TYPES.group:return this.resolvedType.decode(e,-1,i)}throw Error(\"[INTERNAL] Illegal decode type\")},h.valueFromString=function(e){if(!this.isMapKey)throw Error(\"valueFromString() called on non-map-key element\");switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:case t.TYPES.uint32:case t.TYPES.fixed32:return this.verifyValue(parseInt(e));case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:case t.TYPES.uint64:case t.TYPES.fixed64:return this.verifyValue(e);case t.TYPES.bool:return\"true\"===e;case t.TYPES.string:return this.verifyValue(e);case t.TYPES.bytes:return n.fromBinary(e)}},h.valueToString=function(e){if(!this.isMapKey)throw Error(\"valueToString() called on non-map-key element\");return this.type===t.TYPES.bytes?e.toString(\"binary\"):e.toString()},R.Element=a,(u=(l=function(e,t,n,i,s,o){r.call(this,e,t,n,i,o),this.className=\"Message\",this.extensions=void 0,this.clazz=null,this.isGroup=!!s,this._fields=null,this._fieldsById=null,this._fieldsByName=null}).prototype=Object.create(r.prototype)).build=function(i){var s,r,o,a;if(this.clazz&&!i)return this.clazz;for(s=function(t,i){function s(e,i,r,o){var a,h,l,u,c,f,d;if(null===e||\"object\"!=typeof e)return o&&o instanceof t.Reflect.Enum&&null!==(a=t.Reflect.Enum.getName(o.object,e))?a:e;if(n.isByteBuffer(e))return i?e.toBase64():e.toBuffer();if(t.Long.isLong(e))return r?e.toString():t.Long.fromValue(e);if(Array.isArray(e))return h=[],e.forEach((function(e,t){h[t]=s(e,i,r,o)})),h;if(h={},e instanceof t.Map){for(u=(l=e.entries()).next();!u.done;u=l.next())h[e.keyElem.valueToString(u.value[0])]=s(u.value[1],i,r,e.valueElem.resolvedType);return h}for(d in c=e.$type,f=void 0,e)e.hasOwnProperty(d)&&(h[d]=c&&(f=c.getChild(d))?s(e[d],i,r,f.resolvedType):s(e[d],i,r));return h}var r,o,a=i.getChildren(t.Reflect.Message.Field),h=i.getChildren(t.Reflect.Message.OneOf),l=function(e){var s,r,o,u;for(t.Builder.Message.call(this),s=0,r=h.length;r>s;++s)this[h[s].name]=null;for(s=0,r=a.length;r>s;++s)this[(o=a[s]).name]=o.repeated?[]:o.map?new t.Map(o):null,!o.required&&\"proto3\"!==i.syntax||null===o.defaultValue||(this[o.name]=o.defaultValue);if(arguments.length>0)if(1!==arguments.length||null===e||\"object\"!=typeof e||!(\"function\"!=typeof e.encode||e instanceof l)||Array.isArray(e)||e instanceof t.Map||n.isByteBuffer(e)||e instanceof ArrayBuffer||t.Long&&e instanceof t.Long)for(s=0,r=arguments.length;r>s;++s)void 0!==(u=arguments[s])&&this.$set(a[s].name,u);else this.$set(e)},u=l.prototype=Object.create(t.Builder.Message.prototype);for(u.add=function(e,n,s){var r=i._fieldsByName[e];if(!s){if(!r)throw Error(this+\"#\"+e+\" is undefined\");if(!(r instanceof t.Reflect.Message.Field))throw Error(this+\"#\"+e+\" is not a field: \"+r.toString(!0));if(!r.repeated)throw Error(this+\"#\"+e+\" is not a repeated field\");n=r.verifyValue(n,!0)}return null===this[e]&&(this[e]=[]),this[e].push(n),this},u.$add=u.add,u.set=function(e,n,s){var r,o,a;if(e&&\"object\"==typeof e){for(r in s=n,e)e.hasOwnProperty(r)&&void 0!==(n=e[r])&&this.$set(r,n,s);return this}if(o=i._fieldsByName[e],s)this[e]=n;else{if(!o)throw Error(this+\"#\"+e+\" is not a field: undefined\");if(!(o instanceof t.Reflect.Message.Field))throw Error(this+\"#\"+e+\" is not a field: \"+o.toString(!0));this[o.name]=n=o.verifyValue(n)}return o&&o.oneof&&(a=this[o.oneof.name],null!==n?(null!==a&&a!==o.name&&(this[a]=null),this[o.oneof.name]=o.name):a===e&&(this[o.oneof.name]=null)),this},u.$set=u.set,u.get=function(e,n){if(n)return this[e];var s=i._fieldsByName[e];if(!(s&&s instanceof t.Reflect.Message.Field))throw Error(this+\"#\"+e+\" is not a field: undefined\");if(!(s instanceof t.Reflect.Message.Field))throw Error(this+\"#\"+e+\" is not a field: \"+s.toString(!0));return this[s.name]},u.$get=u.get,r=0;r<a.length;r++)(o=a[r])instanceof t.Reflect.Message.ExtensionField||i.builder.options.populateAccessors&&function(e){var t,n,s,r=e.originalName.replace(/(_[a-zA-Z])/g,(function(e){return e.toUpperCase().replace(\"_\",\"\")}));r=r.substring(0,1).toUpperCase()+r.substring(1),t=e.originalName.replace(/([A-Z])/g,(function(e){return\"_\"+e})),n=function(t,n){return this[e.name]=n?t:e.verifyValue(t),this},s=function(){return this[e.name]},null===i.getChild(\"set\"+r)&&(u[\"set\"+r]=n),null===i.getChild(\"set_\"+t)&&(u[\"set_\"+t]=n),null===i.getChild(\"get\"+r)&&(u[\"get\"+r]=s),null===i.getChild(\"get_\"+t)&&(u[\"get_\"+t]=s)}(o);return u.encode=function(t,n){var s,r;\"boolean\"==typeof t&&(n=t,t=void 0),s=!1,t||(t=new e,s=!0),r=t.littleEndian;try{return i.encode(this,t.LE(),n),(s?t.flip():t).LE(r)}catch(e){throw t.LE(r),e}},l.encode=function(e,t,n){return new l(e).encode(t,n)},u.calculate=function(){return i.calculate(this)},u.encodeDelimited=function(e){var t,s=!1;return e||(e=new n,s=!0),t=(new n).LE(),i.encode(this,t).flip(),e.writeVarint32(t.remaining()),e.append(t),s?e.flip():e},u.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toArrayBuffer()),e}},u.toArrayBuffer=u.encodeAB,u.encodeNB=function(){try{return this.encode().toBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBuffer()),e}},u.toBuffer=u.encodeNB,u.encode64=function(){try{return this.encode().toBase64()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBase64()),e}},u.toBase64=u.encode64,u.encodeHex=function(){try{return this.encode().toHex()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toHex()),e}},u.toHex=u.encodeHex,u.toRaw=function(e,t){return s(this,!!e,!!t,this.$type)},u.encodeJSON=function(){return JSON.stringify(s(this,!0,!0,this.$type))},l.decode=function(e,t){var s,r;\"string\"==typeof e&&(e=n.wrap(e,t||\"base64\")),s=(e=n.isByteBuffer(e)?e:n.wrap(e)).littleEndian;try{return r=i.decode(e.LE()),e.LE(s),r}catch(t){throw e.LE(s),t}},l.decodeDelimited=function(e,t){var s,r,o;if(\"string\"==typeof e&&(e=n.wrap(e,t||\"base64\")),(e=n.isByteBuffer(e)?e:n.wrap(e)).remaining()<1)return null;if(s=e.offset,r=e.readVarint32(),e.remaining()<r)return e.offset=s,null;try{return o=i.decode(e.slice(e.offset,e.offset+r).LE()),e.offset+=r,o}catch(t){throw e.offset+=r,t}},l.decode64=function(e){return l.decode(e,\"base64\")},l.decodeHex=function(e){return l.decode(e,\"hex\")},l.decodeJSON=function(e){return new l(JSON.parse(e))},u.toString=function(){return i.toString()},Object.defineProperty&&(Object.defineProperty(l,\"$options\",{value:i.buildOpt()}),Object.defineProperty(u,\"$options\",{value:l.$options}),Object.defineProperty(l,\"$type\",{value:i}),Object.defineProperty(u,\"$type\",{value:i})),l}(t,this),this._fields=[],this._fieldsById={},this._fieldsByName={},o=0,a=this.children.length;a>o;o++)if((r=this.children[o])instanceof p||r instanceof l||r instanceof m){if(s.hasOwnProperty(r.name))throw Error(\"Illegal reflect child of \"+this.toString(!0)+\": \"+r.toString(!0)+\" cannot override static property '\"+r.name+\"'\");s[r.name]=r.build()}else if(r instanceof l.Field)r.build(),this._fields.push(r),this._fieldsById[r.id]=r,this._fieldsByName[r.name]=r;else if(!(r instanceof l.OneOf||r instanceof _))throw Error(\"Illegal reflect child of \"+this.toString(!0)+\": \"+this.children[o].toString(!0));return this.clazz=s},u.encode=function(e,t,n){var i,s,r,o,a,h=null;for(r=0,o=this._fields.length;o>r;++r)s=e[(i=this._fields[r]).name],i.required&&null===s?null===h&&(h=i):i.encode(n?s:i.verifyValue(s),t,e);if(null!==h)throw(a=Error(\"Missing at least one required field for \"+this.toString(!0)+\": \"+h)).encoded=t,a;return t},u.calculate=function(e){for(var t,n,i=0,s=0,r=this._fields.length;r>s;++s){if(n=e[(t=this._fields[s]).name],t.required&&null===n)throw Error(\"Missing at least one required field for \"+this.toString(!0)+\": \"+t);i+=t.calculate(n,e)}return i},u.decode=function(e,n,i){var r,o,a,h,l,u,c,f,d,g,p,E;for(n=\"number\"==typeof n?n:-1,l=e.offset,u=new this.clazz;e.offset<l+n||-1===n&&e.remaining()>0;){if(a=(r=e.readVarint32())>>>3,(o=7&r)===t.WIRE_TYPES.ENDGROUP){if(a!==i)throw Error(\"Illegal group end indicator for \"+this.toString(!0)+\": \"+a+\" (\"+(i?i+\" expected\":\"not a group\")+\")\");break}if(h=this._fieldsById[a])h.repeated&&!h.options.packed?u[h.name].push(h.decode(o,e)):h.map?(f=h.decode(o,e),u[h.name].set(f[0],f[1])):(u[h.name]=h.decode(o,e),h.oneof&&(null!==(d=u[h.oneof.name])&&d!==h.name&&(u[d]=null),u[h.oneof.name]=h.name));else switch(o){case t.WIRE_TYPES.VARINT:e.readVarint32();break;case t.WIRE_TYPES.BITS32:e.offset+=4;break;case t.WIRE_TYPES.BITS64:e.offset+=8;break;case t.WIRE_TYPES.LDELIM:c=e.readVarint32(),e.offset+=c;break;case t.WIRE_TYPES.STARTGROUP:for(;s(a,e););break;default:throw Error(\"Illegal wire type for unknown field \"+a+\" in \"+this.toString(!0)+\"#decode: \"+o)}}for(g=0,p=this._fields.length;p>g;++g)if(null===u[(h=this._fields[g]).name])if(\"proto3\"===this.syntax)u[h.name]=h.defaultValue;else{if(h.required)throw(E=Error(\"Missing at least one required field for \"+this.toString(!0)+\": \"+h.name)).decoded=u,E;t.populateDefaults&&null!==h.defaultValue&&(u[h.name]=h.defaultValue)}return u},R.Message=l,(f=(c=function(e,n,i,s,r,o,a,h,u,c){C.call(this,e,n,o),this.className=\"Message.Field\",this.required=\"required\"===i,this.repeated=\"repeated\"===i,this.map=\"map\"===i,this.keyType=s||null,this.type=r,this.resolvedType=null,this.id=a,this.options=h||{},this.defaultValue=null,this.oneof=u||null,this.syntax=c||\"proto2\",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof l.ExtensionField||(this.name=t.Util.toCamelCase(this.name))}).prototype=Object.create(C.prototype)).build=function(){this.element=new a(this.type,this.resolvedType,!1,this.syntax),this.map&&(this.keyElement=new a(this.keyType,void 0,!0,this.syntax)),\"proto3\"!==this.syntax||this.repeated||this.map?void 0!==this.options.default&&(this.defaultValue=this.verifyValue(this.options.default)):this.defaultValue=a.defaultFieldValue(this.type)},f.verifyValue=function(e,n){var i,s,r;if(n=n||!1,i=function(e,t){throw Error(\"Illegal value for \"+this.toString(!0)+\" of type \"+this.type.name+\": \"+e+\" (\"+t+\")\")}.bind(this),null===e)return this.required&&i(typeof e,\"required\"),\"proto3\"===this.syntax&&this.type!==t.TYPES.message&&i(typeof e,\"proto3 field without field presence cannot be null\"),null;if(this.repeated&&!n){for(Array.isArray(e)||(e=[e]),r=[],s=0;s<e.length;s++)r.push(this.element.verifyValue(e[s]));return r}return this.map&&!n?e instanceof t.Map?e:(e instanceof Object||i(typeof e,\"expected ProtoBuf.Map or raw object for map field\"),new t.Map(this,e)):(!this.repeated&&Array.isArray(e)&&i(typeof e,\"no array expected\"),this.element.verifyValue(e))},f.hasWirePresence=function(e,n){if(\"proto3\"!==this.syntax)return null!==e;if(this.oneof&&n[this.oneof.name]===this.name)return!0;switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:case t.TYPES.uint32:case t.TYPES.fixed32:return 0!==e;case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:case t.TYPES.uint64:case t.TYPES.fixed64:return 0!==e.low||0!==e.high;case t.TYPES.bool:return e;case t.TYPES.float:case t.TYPES.double:return 0!==e;case t.TYPES.string:return e.length>0;case t.TYPES.bytes:return e.remaining()>0;case t.TYPES.enum:return 0!==e;case t.TYPES.message:return null!==e;default:return!0}},f.encode=function(e,i,s){var r,o,a,h,l;if(null===this.type||\"object\"!=typeof this.type)throw Error(\"[INTERNAL] Unresolved type in \"+this.toString(!0)+\": \"+this.type);if(null===e||this.repeated&&0==e.length)return i;try{if(this.repeated)if(this.options.packed&&t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){for(i.writeVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),i.ensureCapacity(i.offset+=1),o=i.offset,r=0;r<e.length;r++)this.element.encodeValue(this.id,e[r],i);a=i.offset-o,(h=n.calculateVarint32(a))>1&&(l=i.slice(o,i.offset),o+=h-1,i.offset=o,i.append(l)),i.writeVarint32(a,o-h)}else for(r=0;r<e.length;r++)i.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,e[r],i);else this.map?e.forEach((function(e,s){var r=n.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,s)+n.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,e);i.writeVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),i.writeVarint32(r),i.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,s,i),i.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,e,i)}),this):this.hasWirePresence(e,s)&&(i.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,e,i))}catch(t){throw Error(\"Illegal value for \"+this.toString(!0)+\": \"+e+\" (\"+t+\")\")}return i},f.calculate=function(e,i){var s,r,o;if(e=this.verifyValue(e),null===this.type||\"object\"!=typeof this.type)throw Error(\"[INTERNAL] Unresolved type in \"+this.toString(!0)+\": \"+this.type);if(null===e||this.repeated&&0==e.length)return 0;s=0;try{if(this.repeated)if(this.options.packed&&t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){for(s+=n.calculateVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),o=0,r=0;r<e.length;r++)o+=this.element.calculateLength(this.id,e[r]);s+=n.calculateVarint32(o),s+=o}else for(r=0;r<e.length;r++)s+=n.calculateVarint32(this.id<<3|this.type.wireType),s+=this.element.calculateLength(this.id,e[r]);else this.map?e.forEach((function(e,i){var r=n.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,i)+n.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,e);s+=n.calculateVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),s+=n.calculateVarint32(r),s+=r}),this):this.hasWirePresence(e,i)&&(s+=n.calculateVarint32(this.id<<3|this.type.wireType),s+=this.element.calculateLength(this.id,e))}catch(t){throw Error(\"Illegal value for \"+this.toString(!0)+\": \"+e+\" (\"+t+\")\")}return s},f.decode=function(e,n,i){var s,r,o,h,l,u,c;if(!(!this.map&&e==this.type.wireType||!i&&this.repeated&&this.options.packed&&e==t.WIRE_TYPES.LDELIM||this.map&&e==t.WIRE_TYPES.LDELIM))throw Error(\"Illegal wire type for field \"+this.toString(!0)+\": \"+e+\" (\"+this.type.wireType+\" expected)\");if(e==t.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0&&!i){for(r=n.readVarint32(),r=n.offset+r,o=[];n.offset<r;)o.push(this.decode(this.type.wireType,n,!0));return o}if(this.map){if(h=a.defaultFieldValue(this.keyType),s=a.defaultFieldValue(this.type),r=n.readVarint32(),n.remaining()<r)throw Error(\"Illegal number of bytes for \"+this.toString(!0)+\": \"+r+\" required but got only \"+n.remaining());for((l=n.clone()).limit=l.offset+r,n.offset+=r;l.remaining()>0;)if(e=7&(u=l.readVarint32()),1==(c=u>>>3))h=this.keyElement.decode(l,e,c);else{if(2!==c)throw Error(\"Unexpected tag in map field key/value submessage\");s=this.element.decode(l,e,c)}return[h,s]}return this.element.decode(n,e,this.id)},R.Message.Field=c,(d=function(e,t,n,i,s,r,o){c.call(this,e,t,n,null,i,s,r,o),this.extension}).prototype=Object.create(c.prototype),R.Message.ExtensionField=d,g=function(e,t,n){C.call(this,e,t,n),this.fields=[]},R.Message.OneOf=g,(p=function(e,t,n,i,s){r.call(this,e,t,n,i,s),this.className=\"Enum\",this.object=null}).getName=function(e,t){var n,i,s=Object.keys(e);for(i=0;i<s.length;++i)if(e[n=s[i]]===t)return n;return null},(p.prototype=Object.create(r.prototype)).build=function(e){var n,i,s,r;if(this.object&&!e)return this.object;for(n=new t.Builder.Enum,s=0,r=(i=this.getChildren(p.Value)).length;r>s;++s)n[i[s].name]=i[s].id;return Object.defineProperty&&Object.defineProperty(n,\"$options\",{value:this.buildOpt(),enumerable:!1}),this.object=n},R.Enum=p,(E=function(e,t,n,i){C.call(this,e,t,n),this.className=\"Enum.Value\",this.id=i}).prototype=Object.create(C.prototype),R.Enum.Value=E,(_=function(e,t,n,i){C.call(this,e,t,n),this.field=i}).prototype=Object.create(C.prototype),R.Extension=_,((m=function(e,t,n,i){r.call(this,e,t,n,i),this.className=\"Service\",this.clazz=null}).prototype=Object.create(r.prototype)).build=function(e){return this.clazz&&!e?this.clazz:this.clazz=function(e,t){var i,s=function(t){e.Builder.Service.call(this),this.rpcImpl=t||function(e,t,n){setTimeout(n.bind(this,Error(\"Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services\")),0)}},r=s.prototype=Object.create(e.Builder.Service.prototype),o=t.getChildren(e.Reflect.Service.RPCMethod);for(i=0;i<o.length;i++)!function(e){r[e.name]=function(i,s){try{try{i=e.resolvedRequestType.clazz.decode(n.wrap(i))}catch(e){if(!(e instanceof TypeError))throw e}if(null===i||\"object\"!=typeof i)throw Error(\"Illegal arguments\");i instanceof e.resolvedRequestType.clazz||(i=new e.resolvedRequestType.clazz(i)),this.rpcImpl(e.fqn(),i,(function(n,i){if(!n){try{i=e.resolvedResponseType.clazz.decode(i)}catch(e){}return i&&i instanceof e.resolvedResponseType.clazz?void s(null,i):void s(Error(\"Illegal response type received in service method \"+t.name+\"#\"+e.name))}s(n)}))}catch(e){setTimeout(s.bind(this,e),0)}},s[e.name]=function(t,n,i){new s(t)[e.name](n,i)},Object.defineProperty&&(Object.defineProperty(s[e.name],\"$options\",{value:e.buildOpt()}),Object.defineProperty(r[e.name],\"$options\",{value:s[e.name].$options}))}(o[i]);return Object.defineProperty&&(Object.defineProperty(s,\"$options\",{value:t.buildOpt()}),Object.defineProperty(r,\"$options\",{value:s.$options}),Object.defineProperty(s,\"$type\",{value:t}),Object.defineProperty(r,\"$type\",{value:t})),s}(t,this)},R.Service=m,((y=function(e,t,n,i){C.call(this,e,t,n),this.className=\"Service.Method\",this.options=i||{}}).prototype=Object.create(C.prototype)).buildOpt=o.buildOpt,R.Service.Method=y,(T=function(e,t,n,i,s,r,o,a){y.call(this,e,t,n,a),this.className=\"Service.RPCMethod\",this.requestName=i,this.responseName=s,this.requestStream=r,this.responseStream=o,this.resolvedRequestType=null,this.resolvedResponseType=null}).prototype=Object.create(y.prototype),R.Service.RPCMethod=T,R}(s),s.Builder=function(e,t,n){function i(e){e.messages&&e.messages.forEach((function(t){t.syntax=e.syntax,i(t)})),e.enums&&e.enums.forEach((function(t){t.syntax=e.syntax}))}var s=function(e){this.ns=new n.Namespace(this,null,\"\"),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=e||{}},r=s.prototype;return s.isMessage=function(e){return\"string\"==typeof e.name&&void 0===e.values&&void 0===e.rpc},s.isMessageField=function(e){return\"string\"==typeof e.rule&&\"string\"==typeof e.name&&\"string\"==typeof e.type&&void 0!==e.id},s.isEnum=function(e){return\"string\"==typeof e.name&&!(void 0===e.values||!Array.isArray(e.values)||0===e.values.length)},s.isService=function(e){return!(\"string\"!=typeof e.name||\"object\"!=typeof e.rpc||!e.rpc)},s.isExtend=function(e){return\"string\"==typeof e.ref},r.reset=function(){return this.ptr=this.ns,this},r.define=function(e){if(\"string\"!=typeof e||!t.TYPEREF.test(e))throw Error(\"illegal namespace: \"+e);return e.split(\".\").forEach((function(e){var t=this.ptr.getChild(e);null===t&&this.ptr.addChild(t=new n.Namespace(this,this.ptr,e)),this.ptr=t}),this),this},r.create=function(t){var i,r,o,a,h;if(!t)return this;if(Array.isArray(t)){if(0===t.length)return this;t=t.slice()}else t=[t];for(i=[t];i.length>0;){if(t=i.pop(),!Array.isArray(t))throw Error(\"not a valid namespace: \"+JSON.stringify(t));for(;t.length>0;){if(r=t.shift(),s.isMessage(r)){if(o=new n.Message(this,this.ptr,r.name,r.options,r.isGroup,r.syntax),a={},r.oneofs&&Object.keys(r.oneofs).forEach((function(e){o.addChild(a[e]=new n.Message.OneOf(this,o,e))}),this),r.fields&&r.fields.forEach((function(e){if(null!==o.getChild(0|e.id))throw Error(\"duplicate or invalid field id in \"+o.name+\": \"+e.id);if(e.options&&\"object\"!=typeof e.options)throw Error(\"illegal field options in \"+o.name+\"#\"+e.name);var t=null;if(\"string\"==typeof e.oneof&&!(t=a[e.oneof]))throw Error(\"illegal oneof in \"+o.name+\"#\"+e.name+\": \"+e.oneof);e=new n.Message.Field(this,o,e.rule,e.keytype,e.type,e.name,e.id,e.options,t,r.syntax),t&&t.fields.push(e),o.addChild(e)}),this),h=[],r.enums&&r.enums.forEach((function(e){h.push(e)})),r.messages&&r.messages.forEach((function(e){h.push(e)})),r.services&&r.services.forEach((function(e){h.push(e)})),r.extensions&&(o.extensions=\"number\"==typeof r.extensions[0]?[r.extensions]:r.extensions),this.ptr.addChild(o),h.length>0){i.push(t),t=h,h=null,this.ptr=o,o=null;continue}h=null}else if(s.isEnum(r))o=new n.Enum(this,this.ptr,r.name,r.options,r.syntax),r.values.forEach((function(e){o.addChild(new n.Enum.Value(this,o,e.name,e.id))}),this),this.ptr.addChild(o);else if(s.isService(r))o=new n.Service(this,this.ptr,r.name,r.options),Object.keys(r.rpc).forEach((function(e){var t=r.rpc[e];o.addChild(new n.Service.RPCMethod(this,o,e,t.request,t.response,!!t.request_stream,!!t.response_stream,t.options))}),this),this.ptr.addChild(o);else{if(!s.isExtend(r))throw Error(\"not a valid definition: \"+JSON.stringify(r));if(o=this.ptr.resolve(r.ref,!0))r.fields.forEach((function(t){var i,s,r,a;if(null!==o.getChild(0|t.id))throw Error(\"duplicate extended field id in \"+o.name+\": \"+t.id);if(o.extensions&&(i=!1,o.extensions.forEach((function(e){t.id>=e[0]&&t.id<=e[1]&&(i=!0)})),!i))throw Error(\"illegal extended field id in \"+o.name+\": \"+t.id+\" (not within valid ranges)\");s=t.name,this.options.convertFieldsToCamelCase&&(s=e.Util.toCamelCase(s)),r=new n.Message.ExtensionField(this,o,t.rule,t.type,this.ptr.fqn()+\".\"+s,t.id,t.options),a=new n.Extension(this,this.ptr,t.name,r),r.extension=a,this.ptr.addChild(a),o.addChild(r)}),this);else if(!/\\.?google\\.protobuf\\./.test(r.ref))throw Error(\"extended message \"+r.ref+\" is not defined\")}r=null,o=null}t=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},r.import=function(t,n){var s,r,o,a,h,l,u,c,f=\"/\";if(\"string\"==typeof n){if(e.Util.IS_NODE,!0===this.files[n])return this.reset();this.files[n]=!0}else if(\"object\"==typeof n){if(s=n.root,e.Util.IS_NODE,(s.indexOf(\"\\\\\")>=0||n.file.indexOf(\"\\\\\")>=0)&&(f=\"\\\\\"),r=s+f+n.file,!0===this.files[r])return this.reset();this.files[r]=!0}if(t.imports&&t.imports.length>0){for(a=!1,\"object\"==typeof n?(this.importRoot=n.root,a=!0,o=this.importRoot,n=n.file,(o.indexOf(\"\\\\\")>=0||n.indexOf(\"\\\\\")>=0)&&(f=\"\\\\\")):\"string\"==typeof n?this.importRoot?o=this.importRoot:n.indexOf(\"/\")>=0?\"\"===(o=n.replace(/\\/[^\\/]*$/,\"\"))&&(o=\"/\"):n.indexOf(\"\\\\\")>=0?(o=n.replace(/\\\\[^\\\\]*$/,\"\"),f=\"\\\\\"):o=\".\":o=null,h=0;h<t.imports.length;h++)if(\"string\"==typeof t.imports[h]){if(!o)throw Error(\"cannot determine import root\");if(\"google/protobuf/descriptor.proto\"===(l=t.imports[h]))continue;if(l=o+f+l,!0===this.files[l])continue;if(/\\.proto$/i.test(l)&&!e.DotProto&&(l=l.replace(/\\.proto$/,\".json\")),null===(u=e.Util.fetch(l)))throw Error(\"failed to import '\"+l+\"' in '\"+n+\"': file not found\");/\\.json$/i.test(l)?this.import(JSON.parse(u+\"\"),l):this.import(e.DotProto.Parser.parse(u),l)}else n?/\\.(\\w+)$/.test(n)?this.import(t.imports[h],n.replace(/^(.+)\\.(\\w+)$/,(function(e,t,n){return t+\"_import\"+h+\".\"+n}))):this.import(t.imports[h],n+\"_import\"+h):this.import(t.imports[h]);a&&(this.importRoot=null)}return t.package&&this.define(t.package),t.syntax&&i(t),c=this.ptr,t.options&&Object.keys(t.options).forEach((function(e){c.options[e]=t.options[e]})),t.messages&&(this.create(t.messages),this.ptr=c),t.enums&&(this.create(t.enums),this.ptr=c),t.services&&(this.create(t.services),this.ptr=c),t.extends&&this.create(t.extends),this.reset()},r.resolveAll=function(){var i;if(null==this.ptr||\"object\"==typeof this.ptr.type)return this;if(this.ptr instanceof n.Namespace)this.ptr.children.forEach((function(e){this.ptr=e,this.resolveAll()}),this);else if(this.ptr instanceof n.Message.Field){if(t.TYPE.test(this.ptr.type))this.ptr.type=e.TYPES[this.ptr.type];else{if(!t.TYPEREF.test(this.ptr.type))throw Error(\"illegal type reference in \"+this.ptr.toString(!0)+\": \"+this.ptr.type);if(!(i=(this.ptr instanceof n.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0)))throw Error(\"unresolvable type reference in \"+this.ptr.toString(!0)+\": \"+this.ptr.type);if(this.ptr.resolvedType=i,i instanceof n.Enum){if(this.ptr.type=e.TYPES.enum,\"proto3\"===this.ptr.syntax&&\"proto3\"!==i.syntax)throw Error(\"proto3 message cannot reference proto2 enum\")}else{if(!(i instanceof n.Message))throw Error(\"illegal type reference in \"+this.ptr.toString(!0)+\": \"+this.ptr.type);this.ptr.type=i.isGroup?e.TYPES.group:e.TYPES.message}}if(this.ptr.map){if(!t.TYPE.test(this.ptr.keyType))throw Error(\"illegal key type for map field in \"+this.ptr.toString(!0)+\": \"+this.ptr.keyType);this.ptr.keyType=e.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof e.Reflect.Service.Method){if(!(this.ptr instanceof e.Reflect.Service.RPCMethod))throw Error(\"illegal service type in \"+this.ptr.toString(!0));if(!((i=this.ptr.parent.resolve(this.ptr.requestName,!0))&&i instanceof e.Reflect.Message))throw Error(\"Illegal type reference in \"+this.ptr.toString(!0)+\": \"+this.ptr.requestName);if(this.ptr.resolvedRequestType=i,!((i=this.ptr.parent.resolve(this.ptr.responseName,!0))&&i instanceof e.Reflect.Message))throw Error(\"Illegal type reference in \"+this.ptr.toString(!0)+\": \"+this.ptr.responseName);this.ptr.resolvedResponseType=i}else if(!(this.ptr instanceof e.Reflect.Message.OneOf||this.ptr instanceof e.Reflect.Extension||this.ptr instanceof e.Reflect.Enum.Value))throw Error(\"illegal object in namespace: \"+typeof this.ptr+\": \"+this.ptr);return this.reset()},r.build=function(e){var t,n,i;if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!e)return this.result;for(t=\"string\"==typeof e?e.split(\".\"):e,n=this.result,i=0;i<t.length;i++){if(!n[t[i]]){n=null;break}n=n[t[i]]}return n},r.lookup=function(e,t){return e?this.ns.resolve(e,t):this.ns},r.toString=function(){return\"Builder\"},s.Message=function(){},s.Enum=function(){},s.Service=function(){},s}(s,s.Lang,s.Reflect),s.Map=function(e,t){function n(e){var t=0;return{next:function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}}var i=function(e,n){var i,s,r,o;if(!e.map)throw Error(\"field is not a map\");if(this.field=e,this.keyElem=new t.Element(e.keyType,null,!0,e.syntax),this.valueElem=new t.Element(e.type,e.resolvedType,!1,e.syntax),this.map={},Object.defineProperty(this,\"size\",{get:function(){return Object.keys(this.map).length}}),n)for(i=Object.keys(n),s=0;s<i.length;s++)r=this.keyElem.valueFromString(i[s]),o=this.valueElem.verifyValue(n[i[s]]),this.map[this.keyElem.valueToString(r)]={key:r,value:o}},s=i.prototype;return s.clear=function(){this.map={}},s.delete=function(e){var t=this.keyElem.valueToString(this.keyElem.verifyValue(e)),n=t in this.map;return delete this.map[t],n},s.entries=function(){var e,t,i=[],s=Object.keys(this.map);for(t=0;t<s.length;t++)i.push([(e=this.map[s[t]]).key,e.value]);return n(i)},s.keys=function(){var e,t=[],i=Object.keys(this.map);for(e=0;e<i.length;e++)t.push(this.map[i[e]].key);return n(t)},s.values=function(){var e,t=[],i=Object.keys(this.map);for(e=0;e<i.length;e++)t.push(this.map[i[e]].value);return n(t)},s.forEach=function(e,t){var n,i,s=Object.keys(this.map);for(i=0;i<s.length;i++)e.call(t,(n=this.map[s[i]]).value,n.key,this)},s.set=function(e,t){var n=this.keyElem.verifyValue(e),i=this.valueElem.verifyValue(t);return this.map[this.keyElem.valueToString(n)]={key:n,value:i},this},s.get=function(e){var t=this.keyElem.valueToString(this.keyElem.verifyValue(e));return t in this.map?this.map[t].value:void 0},s.has=function(e){return this.keyElem.valueToString(this.keyElem.verifyValue(e))in this.map},i}(0,s.Reflect),s.loadProto=function(e,t,n){return(\"string\"==typeof t||t&&\"string\"==typeof t.file&&\"string\"==typeof t.root)&&(n=t,t=void 0),s.loadJson(s.DotProto.Parser.parse(e),t,n)},s.protoFromString=s.loadProto,s.loadProtoFile=function(e,t,n){if(t&&\"object\"==typeof t?(n=t,t=null):t&&\"function\"==typeof t||(t=null),t)return s.Util.fetch(\"string\"==typeof e?e:e.root+\"/\"+e.file,(function(i){if(null!==i)try{t(null,s.loadProto(i,n,e))}catch(e){t(e)}else t(Error(\"Failed to fetch file\"))}));var i=s.Util.fetch(\"object\"==typeof e?e.root+\"/\"+e.file:e);return null===i?null:s.loadProto(i,n,e)},s.protoFromFile=s.loadProtoFile,s.newBuilder=function(e){return void 0===(e=e||{}).convertFieldsToCamelCase&&(e.convertFieldsToCamelCase=s.convertFieldsToCamelCase),void 0===e.populateAccessors&&(e.populateAccessors=s.populateAccessors),new s.Builder(e)},s.loadJson=function(e,t,n){return(\"string\"==typeof t||t&&\"string\"==typeof t.file&&\"string\"==typeof t.root)&&(n=t,t=null),t&&\"object\"==typeof t||(t=s.newBuilder()),\"string\"==typeof e&&(e=JSON.parse(e)),t.import(e,n),t.resolveAll(),t},s.loadJsonFile=function(e,t,n){if(t&&\"object\"==typeof t?(n=t,t=null):t&&\"function\"==typeof t||(t=null),t)return s.Util.fetch(\"string\"==typeof e?e:e.root+\"/\"+e.file,(function(i){if(null!==i)try{t(null,s.loadJson(JSON.parse(i),n,e))}catch(e){t(e)}else t(Error(\"Failed to fetch file\"))}));var i=s.Util.fetch(\"object\"==typeof e?e.root+\"/\"+e.file:e);return null===i?null:s.loadJson(JSON.parse(i),n,e)},i=ht,s.loadProto(i,void 0,\"\").build(\"Modules\").probuf}(function(e){function t(e){var t=0;return function(){return t<e.length?e.charCodeAt(t++):null}}function n(){var e=[],t=[];return function(){return 0===arguments.length?t.join(\"\")+a.apply(String,e):(e.length+arguments.length>1024&&(t.push(a.apply(String,e)),e.length=0),void Array.prototype.push.apply(e,arguments))}}function i(e,t,n,i,s){var r,o,a=8*s-i-1,h=(1<<a)-1,l=h>>1,u=-7,c=n?s-1:0,f=n?-1:1,d=e[t+c];for(c+=f,r=d&(1<<-u)-1,d>>=-u,u+=a;u>0;r=256*r+e[t+c],c+=f,u-=8);for(o=r&(1<<-u)-1,r>>=-u,u+=i;u>0;o=256*o+e[t+c],c+=f,u-=8);if(0===r)r=1-l;else{if(r===h)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,i),r-=l}return(d?-1:1)*o*Math.pow(2,r-i)}function s(e,t,n,i,s,r){var o,a,h,l=8*r-s-1,u=(1<<l)-1,c=u>>1,f=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:r-1,g=i?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||1/0===t?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(h=Math.pow(2,-o))<1&&(o--,h*=2),(t+=o+c>=1?f/h:f*Math.pow(2,1-c))*h>=2&&(o++,h/=2),o+c>=u?(a=0,o=u):o+c>=1?(a=(t*h-1)*Math.pow(2,s),o+=c):(a=t*Math.pow(2,c-1)*Math.pow(2,s),o=0));s>=8;e[n+d]=255&a,d+=g,a/=256,s-=8);for(o=o<<s|a,l+=s;l>0;e[n+d]=255&o,d+=g,o/=256,l-=8);e[n+d-g]|=128*p}var r,o,a,h,l,u=function(e,t,n){if(void 0===e&&(e=u.DEFAULT_CAPACITY),void 0===t&&(t=u.DEFAULT_ENDIAN),void 0===n&&(n=u.DEFAULT_NOASSERT),!n){if((e|=0)<0)throw RangeError(\"Illegal capacity\");t=!!t,n=!!n}this.buffer=0===e?o:new ArrayBuffer(e),this.view=0===e?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=e,this.littleEndian=t,this.noAssert=n};return u.VERSION=\"5.0.1\",u.LITTLE_ENDIAN=!0,u.BIG_ENDIAN=!1,u.DEFAULT_CAPACITY=16,u.DEFAULT_ENDIAN=u.BIG_ENDIAN,u.DEFAULT_NOASSERT=!1,u.Long=e||null,(r=u.prototype).__isByteBuffer__,Object.defineProperty(r,\"__isByteBuffer__\",{value:!0,enumerable:!1,configurable:!1}),o=new ArrayBuffer(0),a=String.fromCharCode,u.accessor=function(){return Uint8Array},u.allocate=function(e,t,n){return new u(e,t,n)},u.concat=function(e,t,n,i){var s,r,o,a,h,l;for((\"boolean\"==typeof t||\"string\"!=typeof t)&&(i=n,n=t,t=void 0),s=0,o=0,a=e.length;a>o;++o)u.isByteBuffer(e[o])||(e[o]=u.wrap(e[o],t)),(r=e[o].limit-e[o].offset)>0&&(s+=r);if(0===s)return new u(0,n,i);for(l=new u(s,n,i),o=0;a>o;)(r=(h=e[o++]).limit-h.offset)<=0||(l.view.set(h.view.subarray(h.offset,h.limit),l.offset),l.offset+=r);return l.limit=l.offset,l.offset=0,l},u.isByteBuffer=function(e){return!0===(e&&e.__isByteBuffer__)},u.type=function(){return ArrayBuffer},u.wrap=function(e,t,n,i){var s,o;if(\"string\"!=typeof t&&(i=n,n=t,t=void 0),\"string\"==typeof e)switch(void 0===t&&(t=\"utf8\"),t){case\"base64\":return u.fromBase64(e,n);case\"hex\":return u.fromHex(e,n);case\"binary\":return u.fromBinary(e,n);case\"utf8\":return u.fromUTF8(e,n);case\"debug\":return u.fromDebug(e,n);default:throw Error(\"Unsupported encoding: \"+t)}if(null===e||\"object\"!=typeof e)throw TypeError(\"Illegal buffer\");if(u.isByteBuffer(e))return(s=r.clone.call(e)).markedOffset=-1,s;if(e instanceof Uint8Array)s=new u(0,n,i),e.length>0&&(s.buffer=e.buffer,s.offset=e.byteOffset,s.limit=e.byteOffset+e.byteLength,s.view=new Uint8Array(e.buffer));else if(e instanceof ArrayBuffer)s=new u(0,n,i),e.byteLength>0&&(s.buffer=e,s.offset=0,s.limit=e.byteLength,s.view=e.byteLength>0?new Uint8Array(e):null);else{if(\"[object Array]\"!==Object.prototype.toString.call(e))throw TypeError(\"Illegal buffer\");for((s=new u(e.length,n,i)).limit=e.length,o=0;o<e.length;++o)s.view[o]=e[o]}return s},r.writeBitSet=function(e,t){var n,i,s,r,o,a,h=void 0===t;if(h&&(t=this.offset),!this.noAssert){if(!(e instanceof Array))throw TypeError(\"Illegal BitSet: Not an array\");if(\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+0) <= \"+this.buffer.byteLength)}for(i=t,r=(s=e.length)>>3,o=0,t+=this.writeVarint32(s,t);r--;)n=1&!!e[o++]|(1&!!e[o++])<<1|(1&!!e[o++])<<2|(1&!!e[o++])<<3|(1&!!e[o++])<<4|(1&!!e[o++])<<5|(1&!!e[o++])<<6|(1&!!e[o++])<<7,this.writeByte(n,t++);if(s>o){for(a=0,n=0;s>o;)n|=(1&!!e[o++])<<a++;this.writeByte(n,t++)}return h?(this.offset=t,this):t-i},r.readBitSet=function(e){var t,n,i,s,r,o,a,h=void 0===e;for(h&&(e=this.offset),s=(i=(n=this.readVarint32(e)).value)>>3,r=0,o=[],e+=n.length;s--;)t=this.readByte(e++),o[r++]=!!(1&t),o[r++]=!!(2&t),o[r++]=!!(4&t),o[r++]=!!(8&t),o[r++]=!!(16&t),o[r++]=!!(32&t),o[r++]=!!(64&t),o[r++]=!!(128&t);if(i>r)for(a=0,t=this.readByte(e++);i>r;)o[r++]=!!(1&t>>a++);return h&&(this.offset=e),o},r.readBytes=function(e,t){var n,i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+e>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+\"+e+\") <= \"+this.buffer.byteLength)}return n=this.slice(t,t+e),i&&(this.offset+=e),n},r.writeBytes=r.append,r.writeInt8=function(e,t){var n,i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal value: \"+e+\" (not an integer)\");if(e|=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+0) <= \"+this.buffer.byteLength)}return(t+=1)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=1,this.view[t]=e,i&&(this.offset+=1),this},r.writeByte=r.writeInt8,r.readInt8=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+1) <= \"+this.buffer.byteLength)}return 128==(128&(t=this.view[e]))&&(t=-(255-t+1)),n&&(this.offset+=1),t},r.readByte=r.readInt8,r.writeUint8=function(e,t){var n,i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal value: \"+e+\" (not an integer)\");if(e>>>=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+0) <= \"+this.buffer.byteLength)}return(t+=1)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=1,this.view[t]=e,i&&(this.offset+=1),this},r.writeUInt8=r.writeUint8,r.readUint8=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+1) <= \"+this.buffer.byteLength)}return t=this.view[e],n&&(this.offset+=1),t},r.readUInt8=r.readUint8,r.writeInt16=function(e,t){var n,i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal value: \"+e+\" (not an integer)\");if(e|=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+0) <= \"+this.buffer.byteLength)}return(t+=2)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),i&&(this.offset+=2),this},r.writeShort=r.writeInt16,r.readInt16=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+2) <= \"+this.buffer.byteLength)}return t=0,this.littleEndian?(t=this.view[e],t|=this.view[e+1]<<8):(t=this.view[e]<<8,t|=this.view[e+1]),32768==(32768&t)&&(t=-(65535-t+1)),n&&(this.offset+=2),t},r.readShort=r.readInt16,r.writeUint16=function(e,t){var n,i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal value: \"+e+\" (not an integer)\");if(e>>>=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+0) <= \"+this.buffer.byteLength)}return(t+=2)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),i&&(this.offset+=2),this},r.writeUInt16=r.writeUint16,r.readUint16=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+2) <= \"+this.buffer.byteLength)}return t=0,this.littleEndian?(t=this.view[e],t|=this.view[e+1]<<8):(t=this.view[e]<<8,t|=this.view[e+1]),n&&(this.offset+=2),t},r.readUInt16=r.readUint16,r.writeInt32=function(e,t){var n,i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal value: \"+e+\" (not an integer)\");if(e|=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+0) <= \"+this.buffer.byteLength)}return(t+=4)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=4,this.littleEndian?(this.view[t+3]=255&e>>>24,this.view[t+2]=255&e>>>16,this.view[t+1]=255&e>>>8,this.view[t]=255&e):(this.view[t]=255&e>>>24,this.view[t+1]=255&e>>>16,this.view[t+2]=255&e>>>8,this.view[t+3]=255&e),i&&(this.offset+=4),this},r.writeInt=r.writeInt32,r.readInt32=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+4) <= \"+this.buffer.byteLength)}return t=0,this.littleEndian?(t=this.view[e+2]<<16,t|=this.view[e+1]<<8,t|=this.view[e],t+=this.view[e+3]<<24>>>0):(t=this.view[e+1]<<16,t|=this.view[e+2]<<8,t|=this.view[e+3],t+=this.view[e]<<24>>>0),t|=0,n&&(this.offset+=4),t},r.readInt=r.readInt32,r.writeUint32=function(e,t){var n,i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal value: \"+e+\" (not an integer)\");if(e>>>=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+0) <= \"+this.buffer.byteLength)}return(t+=4)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=4,this.littleEndian?(this.view[t+3]=255&e>>>24,this.view[t+2]=255&e>>>16,this.view[t+1]=255&e>>>8,this.view[t]=255&e):(this.view[t]=255&e>>>24,this.view[t+1]=255&e>>>16,this.view[t+2]=255&e>>>8,this.view[t+3]=255&e),i&&(this.offset+=4),this},r.writeUInt32=r.writeUint32,r.readUint32=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+4) <= \"+this.buffer.byteLength)}return t=0,this.littleEndian?(t=this.view[e+2]<<16,t|=this.view[e+1]<<8,t|=this.view[e],t+=this.view[e+3]<<24>>>0):(t=this.view[e+1]<<16,t|=this.view[e+2]<<8,t|=this.view[e+3],t+=this.view[e]<<24>>>0),n&&(this.offset+=4),t},r.readUInt32=r.readUint32,e&&(r.writeInt64=function(t,n){var i,s,r,o=void 0===n;if(o&&(n=this.offset),!this.noAssert){if(\"number\"==typeof t)t=e.fromNumber(t);else if(\"string\"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError(\"Illegal value: \"+t+\" (not an integer or Long)\");if(\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal offset: \"+n+\" (not an integer)\");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+n+\" (+0) <= \"+this.buffer.byteLength)}return\"number\"==typeof t?t=e.fromNumber(t):\"string\"==typeof t&&(t=e.fromString(t)),(n+=8)>(i=this.buffer.byteLength)&&this.resize((i*=2)>n?i:n),n-=8,s=t.low,r=t.high,this.littleEndian?(this.view[n+3]=255&s>>>24,this.view[n+2]=255&s>>>16,this.view[n+1]=255&s>>>8,this.view[n]=255&s,n+=4,this.view[n+3]=255&r>>>24,this.view[n+2]=255&r>>>16,this.view[n+1]=255&r>>>8,this.view[n]=255&r):(this.view[n]=255&r>>>24,this.view[n+1]=255&r>>>16,this.view[n+2]=255&r>>>8,this.view[n+3]=255&r,n+=4,this.view[n]=255&s>>>24,this.view[n+1]=255&s>>>16,this.view[n+2]=255&s>>>8,this.view[n+3]=255&s),o&&(this.offset+=8),this},r.writeLong=r.writeInt64,r.readInt64=function(t){var n,i,s,r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+8) <= \"+this.buffer.byteLength)}return n=0,i=0,this.littleEndian?(n=this.view[t+2]<<16,n|=this.view[t+1]<<8,n|=this.view[t],n+=this.view[t+3]<<24>>>0,t+=4,i=this.view[t+2]<<16,i|=this.view[t+1]<<8,i|=this.view[t],i+=this.view[t+3]<<24>>>0):(i=this.view[t+1]<<16,i|=this.view[t+2]<<8,i|=this.view[t+3],i+=this.view[t]<<24>>>0,t+=4,n=this.view[t+1]<<16,n|=this.view[t+2]<<8,n|=this.view[t+3],n+=this.view[t]<<24>>>0),s=new e(n,i,!1),r&&(this.offset+=8),s},r.readLong=r.readInt64,r.writeUint64=function(t,n){var i,s,r,o=void 0===n;if(o&&(n=this.offset),!this.noAssert){if(\"number\"==typeof t)t=e.fromNumber(t);else if(\"string\"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError(\"Illegal value: \"+t+\" (not an integer or Long)\");if(\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal offset: \"+n+\" (not an integer)\");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+n+\" (+0) <= \"+this.buffer.byteLength)}return\"number\"==typeof t?t=e.fromNumber(t):\"string\"==typeof t&&(t=e.fromString(t)),(n+=8)>(i=this.buffer.byteLength)&&this.resize((i*=2)>n?i:n),n-=8,s=t.low,r=t.high,this.littleEndian?(this.view[n+3]=255&s>>>24,this.view[n+2]=255&s>>>16,this.view[n+1]=255&s>>>8,this.view[n]=255&s,n+=4,this.view[n+3]=255&r>>>24,this.view[n+2]=255&r>>>16,this.view[n+1]=255&r>>>8,this.view[n]=255&r):(this.view[n]=255&r>>>24,this.view[n+1]=255&r>>>16,this.view[n+2]=255&r>>>8,this.view[n+3]=255&r,n+=4,this.view[n]=255&s>>>24,this.view[n+1]=255&s>>>16,this.view[n+2]=255&s>>>8,this.view[n+3]=255&s),o&&(this.offset+=8),this},r.writeUInt64=r.writeUint64,r.readUint64=function(t){var n,i,s,r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+8) <= \"+this.buffer.byteLength)}return n=0,i=0,this.littleEndian?(n=this.view[t+2]<<16,n|=this.view[t+1]<<8,n|=this.view[t],n+=this.view[t+3]<<24>>>0,t+=4,i=this.view[t+2]<<16,i|=this.view[t+1]<<8,i|=this.view[t],i+=this.view[t+3]<<24>>>0):(i=this.view[t+1]<<16,i|=this.view[t+2]<<8,i|=this.view[t+3],i+=this.view[t]<<24>>>0,t+=4,n=this.view[t+1]<<16,n|=this.view[t+2]<<8,n|=this.view[t+3],n+=this.view[t]<<24>>>0),s=new e(n,i,!0),r&&(this.offset+=8),s},r.readUInt64=r.readUint64),r.writeFloat32=function(e,t){var n,i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof e)throw TypeError(\"Illegal value: \"+e+\" (not a number)\");if(\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+0) <= \"+this.buffer.byteLength)}return(t+=4)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=4,s(this.view,e,t,this.littleEndian,23,4),i&&(this.offset+=4),this},r.writeFloat=r.writeFloat32,r.readFloat32=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+4) <= \"+this.buffer.byteLength)}return t=i(this.view,e,this.littleEndian,23,4),n&&(this.offset+=4),t},r.readFloat=r.readFloat32,r.writeFloat64=function(e,t){var n,i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof e)throw TypeError(\"Illegal value: \"+e+\" (not a number)\");if(\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+0) <= \"+this.buffer.byteLength)}return(t+=8)>(n=this.buffer.byteLength)&&this.resize((n*=2)>t?n:t),t-=8,s(this.view,e,t,this.littleEndian,52,8),i&&(this.offset+=8),this},r.writeDouble=r.writeFloat64,r.readFloat64=function(e){var t,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+8) <= \"+this.buffer.byteLength)}return t=i(this.view,e,this.littleEndian,52,8),n&&(this.offset+=8),t},r.readDouble=r.readFloat64,u.MAX_VARINT32_BYTES=5,u.calculateVarint32=function(e){return(e>>>=0)<128?1:e<16384?2:1<<21>e?3:1<<28>e?4:5},u.zigZagEncode32=function(e){return((e|=0)<<1^e>>31)>>>0},u.zigZagDecode32=function(e){return 0|e>>>1^-(1&e)},r.writeVarint32=function(e,t){var n,i,s,r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal value: \"+e+\" (not an integer)\");if(e|=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+0) <= \"+this.buffer.byteLength)}for((t+=i=u.calculateVarint32(e))>(s=this.buffer.byteLength)&&this.resize((s*=2)>t?s:t),t-=i,e>>>=0;e>=128;)n=128|127&e,this.view[t++]=n,e>>>=7;return this.view[t++]=e,r?(this.offset=t,this):i},r.writeVarint32ZigZag=function(e,t){return this.writeVarint32(u.zigZagEncode32(e),t)},r.readVarint32=function(e){var t,n,i,s,r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+1) <= \"+this.buffer.byteLength)}n=0,i=0;do{if(!this.noAssert&&e>this.limit)throw(s=Error(\"Truncated\")).truncated=!0,s;t=this.view[e++],n<5&&(i|=(127&t)<<7*n),++n}while(0!=(128&t));return i|=0,r?(this.offset=e,i):{value:i,length:n}},r.readVarint32ZigZag=function(e){var t=this.readVarint32(e);return\"object\"==typeof t?t.value=u.zigZagDecode32(t.value):t=u.zigZagDecode32(t),t},e&&(u.MAX_VARINT64_BYTES=10,u.calculateVarint64=function(t){\"number\"==typeof t?t=e.fromNumber(t):\"string\"==typeof t&&(t=e.fromString(t));var n=t.toInt()>>>0,i=t.shiftRightUnsigned(28).toInt()>>>0,s=t.shiftRightUnsigned(56).toInt()>>>0;return 0==s?0==i?n<16384?n<128?1:2:1<<21>n?3:4:i<16384?i<128?5:6:1<<21>i?7:8:s<128?9:10},u.zigZagEncode64=function(t){return\"number\"==typeof t?t=e.fromNumber(t,!1):\"string\"==typeof t?t=e.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned()),t.shiftLeft(1).xor(t.shiftRight(63)).toUnsigned()},u.zigZagDecode64=function(t){return\"number\"==typeof t?t=e.fromNumber(t,!1):\"string\"==typeof t?t=e.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned()),t.shiftRightUnsigned(1).xor(t.and(e.ONE).toSigned().negate()).toSigned()},r.writeVarint64=function(t,n){var i,s,r,o,a,h=void 0===n;if(h&&(n=this.offset),!this.noAssert){if(\"number\"==typeof t)t=e.fromNumber(t);else if(\"string\"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError(\"Illegal value: \"+t+\" (not an integer or Long)\");if(\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal offset: \"+n+\" (not an integer)\");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+n+\" (+0) <= \"+this.buffer.byteLength)}switch(\"number\"==typeof t?t=e.fromNumber(t,!1):\"string\"==typeof t?t=e.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned()),i=u.calculateVarint64(t),s=t.toInt()>>>0,r=t.shiftRightUnsigned(28).toInt()>>>0,o=t.shiftRightUnsigned(56).toInt()>>>0,(n+=i)>(a=this.buffer.byteLength)&&this.resize((a*=2)>n?a:n),n-=i,i){case 10:this.view[n+9]=1&o>>>7;case 9:this.view[n+8]=9!==i?128|o:127&o;case 8:this.view[n+7]=8!==i?128|r>>>21:127&r>>>21;case 7:this.view[n+6]=7!==i?128|r>>>14:127&r>>>14;case 6:this.view[n+5]=6!==i?128|r>>>7:127&r>>>7;case 5:this.view[n+4]=5!==i?128|r:127&r;case 4:this.view[n+3]=4!==i?128|s>>>21:127&s>>>21;case 3:this.view[n+2]=3!==i?128|s>>>14:127&s>>>14;case 2:this.view[n+1]=2!==i?128|s>>>7:127&s>>>7;case 1:this.view[n]=1!==i?128|s:127&s}return h?(this.offset+=i,this):i},r.writeVarint64ZigZag=function(e,t){return this.writeVarint64(u.zigZagEncode64(e),t)},r.readVarint64=function(t){var n,i,s,r,o,a,h=void 0===t;if(h&&(t=this.offset),!this.noAssert){if(\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal offset: \"+t+\" (not an integer)\");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+t+\" (+1) <= \"+this.buffer.byteLength)}if(n=t,i=0,s=0,r=0,o=0,i=127&(o=this.view[t++]),128&o&&(i|=(127&(o=this.view[t++]))<<7,(128&o||this.noAssert&&void 0===o)&&(i|=(127&(o=this.view[t++]))<<14,(128&o||this.noAssert&&void 0===o)&&(i|=(127&(o=this.view[t++]))<<21,(128&o||this.noAssert&&void 0===o)&&(s=127&(o=this.view[t++]),(128&o||this.noAssert&&void 0===o)&&(s|=(127&(o=this.view[t++]))<<7,(128&o||this.noAssert&&void 0===o)&&(s|=(127&(o=this.view[t++]))<<14,(128&o||this.noAssert&&void 0===o)&&(s|=(127&(o=this.view[t++]))<<21,(128&o||this.noAssert&&void 0===o)&&(r=127&(o=this.view[t++]),(128&o||this.noAssert&&void 0===o)&&(r|=(127&(o=this.view[t++]))<<7,128&o||this.noAssert&&void 0===o))))))))))throw Error(\"Buffer overrun\");return a=e.fromBits(i|s<<28,s>>>4|r<<24,!1),h?(this.offset=t,a):{value:a,length:t-n}},r.readVarint64ZigZag=function(t){var n=this.readVarint64(t);return n&&n.value instanceof e?n.value=u.zigZagDecode64(n.value):n=u.zigZagDecode64(n),n}),r.writeCString=function(e,n){var i,s,r,o=void 0===n;if(o&&(n=this.offset),s=e.length,!this.noAssert){if(\"string\"!=typeof e)throw TypeError(\"Illegal str: Not a string\");for(i=0;s>i;++i)if(0===e.charCodeAt(i))throw RangeError(\"Illegal str: Contains NULL-characters\");if(\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal offset: \"+n+\" (not an integer)\");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+n+\" (+0) <= \"+this.buffer.byteLength)}return s=l.calculateUTF16asUTF8(t(e))[1],n+=s+1,r=this.buffer.byteLength,n>r&&this.resize((r*=2)>n?r:n),n-=s+1,l.encodeUTF16toUTF8(t(e),function(e){this.view[n++]=e}.bind(this)),this.view[n++]=0,o?(this.offset=n,this):s},r.readCString=function(e){var t,i,s,r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+1) <= \"+this.buffer.byteLength)}return t=e,s=-1,l.decodeUTF8toUTF16(function(){if(0===s)return null;if(e>=this.limit)throw RangeError(\"Illegal range: Truncated data, \"+e+\" < \"+this.limit);return 0===(s=this.view[e++])?null:s}.bind(this),i=n(),!0),r?(this.offset=e,i()):{string:i(),length:e-t}},r.writeIString=function(e,n){var i,s,r,o=void 0===n;if(o&&(n=this.offset),!this.noAssert){if(\"string\"!=typeof e)throw TypeError(\"Illegal str: Not a string\");if(\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal offset: \"+n+\" (not an integer)\");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+n+\" (+0) <= \"+this.buffer.byteLength)}if(s=n,i=l.calculateUTF16asUTF8(t(e),this.noAssert)[1],n+=4+i,r=this.buffer.byteLength,n>r&&this.resize((r*=2)>n?r:n),n-=4+i,this.littleEndian?(this.view[n+3]=255&i>>>24,this.view[n+2]=255&i>>>16,this.view[n+1]=255&i>>>8,this.view[n]=255&i):(this.view[n]=255&i>>>24,this.view[n+1]=255&i>>>16,this.view[n+2]=255&i>>>8,this.view[n+3]=255&i),n+=4,l.encodeUTF16toUTF8(t(e),function(e){this.view[n++]=e}.bind(this)),n!==s+4+i)throw RangeError(\"Illegal range: Truncated data, \"+n+\" == \"+(n+4+i));return o?(this.offset=n,this):n-s},r.readIString=function(e){var t,n,i,s=void 0===e;if(s&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+4) <= \"+this.buffer.byteLength)}return t=e,n=this.readUint32(e),i=this.readUTF8String(n,u.METRICS_BYTES,e+=4),e+=i.length,s?(this.offset=e,i.string):{string:i.string,length:e-t}},u.METRICS_CHARS=\"c\",u.METRICS_BYTES=\"b\",r.writeUTF8String=function(e,n){var i,s,r,o=void 0===n;if(o&&(n=this.offset),!this.noAssert){if(\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal offset: \"+n+\" (not an integer)\");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+n+\" (+0) <= \"+this.buffer.byteLength)}return s=n,i=l.calculateUTF16asUTF8(t(e))[1],n+=i,r=this.buffer.byteLength,n>r&&this.resize((r*=2)>n?r:n),n-=i,l.encodeUTF16toUTF8(t(e),function(e){this.view[n++]=e}.bind(this)),o?(this.offset=n,this):n-s},r.writeString=r.writeUTF8String,u.calculateUTF8Chars=function(e){return l.calculateUTF16asUTF8(t(e))[0]},u.calculateUTF8Bytes=function(e){return l.calculateUTF16asUTF8(t(e))[1]},u.calculateString=u.calculateUTF8Bytes,r.readUTF8String=function(e,t,i){var s,r,o,a,h;if(\"number\"==typeof t&&(i=t,t=void 0),(s=void 0===i)&&(i=this.offset),void 0===t&&(t=u.METRICS_CHARS),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal length: \"+e+\" (not an integer)\");if(e|=0,\"number\"!=typeof i||i%1!=0)throw TypeError(\"Illegal offset: \"+i+\" (not an integer)\");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+i+\" (+0) <= \"+this.buffer.byteLength)}if(o=0,a=i,t===u.METRICS_CHARS){if(r=n(),l.decodeUTF8(function(){return e>o&&i<this.limit?this.view[i++]:null}.bind(this),(function(e){++o,l.UTF8toUTF16(e,r)})),o!==e)throw RangeError(\"Illegal range: Truncated data, \"+o+\" == \"+e);return s?(this.offset=i,r()):{string:r(),length:i-a}}if(t===u.METRICS_BYTES){if(!this.noAssert){if(\"number\"!=typeof i||i%1!=0)throw TypeError(\"Illegal offset: \"+i+\" (not an integer)\");if((i>>>=0)<0||i+e>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+i+\" (+\"+e+\") <= \"+this.buffer.byteLength)}if(h=i+e,l.decodeUTF8toUTF16(function(){return h>i?this.view[i++]:null}.bind(this),r=n(),this.noAssert),i!==h)throw RangeError(\"Illegal range: Truncated data, \"+i+\" == \"+h);return s?(this.offset=i,r()):{string:r(),length:i-a}}throw TypeError(\"Unsupported metrics: \"+t)},r.readString=r.readUTF8String,r.writeVString=function(e,n){var i,s,r,o,a=void 0===n;if(a&&(n=this.offset),!this.noAssert){if(\"string\"!=typeof e)throw TypeError(\"Illegal str: Not a string\");if(\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal offset: \"+n+\" (not an integer)\");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+n+\" (+0) <= \"+this.buffer.byteLength)}if(r=n,i=l.calculateUTF16asUTF8(t(e),this.noAssert)[1],s=u.calculateVarint32(i),n+=s+i,o=this.buffer.byteLength,n>o&&this.resize((o*=2)>n?o:n),n-=s+i,n+=this.writeVarint32(i,n),l.encodeUTF16toUTF8(t(e),function(e){this.view[n++]=e}.bind(this)),n!==r+i+s)throw RangeError(\"Illegal range: Truncated data, \"+n+\" == \"+(n+i+s));return a?(this.offset=n,this):n-r},r.readVString=function(e){var t,n,i,s=void 0===e;if(s&&(e=this.offset),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+1) <= \"+this.buffer.byteLength)}return t=e,n=this.readVarint32(e),i=this.readUTF8String(n.value,u.METRICS_BYTES,e+=n.length),e+=i.length,s?(this.offset=e,i.string):{string:i.string,length:e-t}},r.append=function(e,t,n){var i,s,r;if((\"number\"==typeof t||\"string\"!=typeof t)&&(n=t,t=void 0),(i=void 0===n)&&(n=this.offset),!this.noAssert){if(\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal offset: \"+n+\" (not an integer)\");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+n+\" (+0) <= \"+this.buffer.byteLength)}return e instanceof u||(e=u.wrap(e,t)),(s=e.limit-e.offset)<=0||((n+=s)>(r=this.buffer.byteLength)&&this.resize((r*=2)>n?r:n),n-=s,this.view.set(e.view.subarray(e.offset,e.limit),n),e.offset+=s,i&&(this.offset+=s)),this},r.appendTo=function(e,t){return e.append(this,t),this},r.assert=function(e){return this.noAssert=!e,this},r.capacity=function(){return this.buffer.byteLength},r.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},r.clone=function(e){var t=new u(0,this.littleEndian,this.noAssert);return e?(t.buffer=new ArrayBuffer(this.buffer.byteLength),t.view=new Uint8Array(t.buffer)):(t.buffer=this.buffer,t.view=this.view),t.offset=this.offset,t.markedOffset=this.markedOffset,t.limit=this.limit,t},r.compact=function(e,t){var n,i,s;if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal begin: Not an integer\");if(e>>>=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal end: Not an integer\");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError(\"Illegal range: 0 <= \"+e+\" <= \"+t+\" <= \"+this.buffer.byteLength)}return 0===e&&t===this.buffer.byteLength?this:0==(n=t-e)?(this.buffer=o,this.view=null,this.markedOffset>=0&&(this.markedOffset-=e),this.offset=0,this.limit=0,this):(i=new ArrayBuffer(n),(s=new Uint8Array(i)).set(this.view.subarray(e,t)),this.buffer=i,this.view=s,this.markedOffset>=0&&(this.markedOffset-=e),this.offset=0,this.limit=n,this)},r.copy=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal begin: Not an integer\");if(e>>>=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal end: Not an integer\");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError(\"Illegal range: 0 <= \"+e+\" <= \"+t+\" <= \"+this.buffer.byteLength)}if(e===t)return new u(0,this.littleEndian,this.noAssert);var n=t-e,i=new u(n,this.littleEndian,this.noAssert);return i.offset=0,i.limit=n,i.markedOffset>=0&&(i.markedOffset-=e),this.copyTo(i,0,e,t),i},r.copyTo=function(e,t,n,i){var s,r,o;if(!this.noAssert&&!u.isByteBuffer(e))throw TypeError(\"Illegal target: Not a ByteBuffer\");if(t=(r=void 0===t)?e.offset:0|t,n=(s=void 0===n)?this.offset:0|n,i=void 0===i?this.limit:0|i,t<0||t>e.buffer.byteLength)throw RangeError(\"Illegal target range: 0 <= \"+t+\" <= \"+e.buffer.byteLength);if(n<0||i>this.buffer.byteLength)throw RangeError(\"Illegal source range: 0 <= \"+n+\" <= \"+this.buffer.byteLength);return 0==(o=i-n)?e:(e.ensureCapacity(t+o),e.view.set(this.view.subarray(n,i),t),s&&(this.offset+=o),r&&(e.offset+=o),this)},r.ensureCapacity=function(e){var t=this.buffer.byteLength;return e>t?this.resize((t*=2)>e?t:e):this},r.fill=function(e,t,n){var i=void 0===t;if(i&&(t=this.offset),\"string\"==typeof e&&e.length>0&&(e=e.charCodeAt(0)),void 0===t&&(t=this.offset),void 0===n&&(n=this.limit),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal value: \"+e+\" (not an integer)\");if(e|=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal begin: Not an integer\");if(t>>>=0,\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal end: Not an integer\");if(n>>>=0,t<0||t>n||n>this.buffer.byteLength)throw RangeError(\"Illegal range: 0 <= \"+t+\" <= \"+n+\" <= \"+this.buffer.byteLength)}if(t>=n)return this;for(;n>t;)this.view[t++]=e;return i&&(this.offset=t),this},r.flip=function(){return this.limit=this.offset,this.offset=0,this},r.mark=function(e){if(e=void 0===e?this.offset:e,!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal offset: \"+e+\" (not an integer)\");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+e+\" (+0) <= \"+this.buffer.byteLength)}return this.markedOffset=e,this},r.order=function(e){if(!this.noAssert&&\"boolean\"!=typeof e)throw TypeError(\"Illegal littleEndian: Not a boolean\");return this.littleEndian=!!e,this},r.LE=function(e){return this.littleEndian=void 0===e||!!e,this},r.BE=function(e){return this.littleEndian=void 0!==e&&!e,this},r.prepend=function(e,t,n){var i,s,r,o,a;if((\"number\"==typeof t||\"string\"!=typeof t)&&(n=t,t=void 0),(i=void 0===n)&&(n=this.offset),!this.noAssert){if(\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal offset: \"+n+\" (not an integer)\");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError(\"Illegal offset: 0 <= \"+n+\" (+0) <= \"+this.buffer.byteLength)}return e instanceof u||(e=u.wrap(e,t)),(s=e.limit-e.offset)<=0||((r=s-n)>0?(o=new ArrayBuffer(this.buffer.byteLength+r),(a=new Uint8Array(o)).set(this.view.subarray(n,this.buffer.byteLength),s),this.buffer=o,this.view=a,this.offset+=r,this.markedOffset>=0&&(this.markedOffset+=r),this.limit+=r,n+=r):new Uint8Array(this.buffer),this.view.set(e.view.subarray(e.offset,e.limit),n-s),e.offset=e.limit,i&&(this.offset-=s)),this},r.prependTo=function(e,t){return e.prepend(this,t),this},r.printDebug=function(e){\"function\"!=typeof e&&(e=console.log.bind(console)),e(this.toString()+\"\\n-------------------------------------------------------------------\\n\"+this.toDebug(!0))},r.remaining=function(){return this.limit-this.offset},r.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},r.resize=function(e){var t,n;if(!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal capacity: \"+e+\" (not an integer)\");if((e|=0)<0)throw RangeError(\"Illegal capacity: 0 <= \"+e)}return this.buffer.byteLength<e&&(t=new ArrayBuffer(e),(n=new Uint8Array(t)).set(this.view),this.buffer=t,this.view=n),this},r.reverse=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal begin: Not an integer\");if(e>>>=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal end: Not an integer\");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError(\"Illegal range: 0 <= \"+e+\" <= \"+t+\" <= \"+this.buffer.byteLength)}return e===t||Array.prototype.reverse.call(this.view.subarray(e,t)),this},r.skip=function(e){if(!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal length: \"+e+\" (not an integer)\");e|=0}var t=this.offset+e;if(!this.noAssert&&(t<0||t>this.buffer.byteLength))throw RangeError(\"Illegal length: 0 <= \"+this.offset+\" + \"+e+\" <= \"+this.buffer.byteLength);return this.offset=t,this},r.slice=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal begin: Not an integer\");if(e>>>=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal end: Not an integer\");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError(\"Illegal range: 0 <= \"+e+\" <= \"+t+\" <= \"+this.buffer.byteLength)}var n=this.clone();return n.offset=e,n.limit=t,n},r.toBuffer=function(e){var t,n=this.offset,i=this.limit;if(!this.noAssert){if(\"number\"!=typeof n||n%1!=0)throw TypeError(\"Illegal offset: Not an integer\");if(n>>>=0,\"number\"!=typeof i||i%1!=0)throw TypeError(\"Illegal limit: Not an integer\");if(i>>>=0,n<0||n>i||i>this.buffer.byteLength)throw RangeError(\"Illegal range: 0 <= \"+n+\" <= \"+i+\" <= \"+this.buffer.byteLength)}return e||0!==n||i!==this.buffer.byteLength?n===i?o:(t=new ArrayBuffer(i-n),new Uint8Array(t).set(new Uint8Array(this.buffer).subarray(n,i),0),t):this.buffer},r.toArrayBuffer=r.toBuffer,r.toString=function(e,t,n){if(void 0===e)return\"ByteBufferAB(offset=\"+this.offset+\",markedOffset=\"+this.markedOffset+\",limit=\"+this.limit+\",capacity=\"+this.capacity()+\")\";switch(\"number\"==typeof e&&(n=t=e=\"utf8\"),e){case\"utf8\":return this.toUTF8(t,n);case\"base64\":return this.toBase64(t,n);case\"hex\":return this.toHex(t,n);case\"binary\":return this.toBinary(t,n);case\"debug\":return this.toDebug();case\"columns\":return this.toColumns();default:throw Error(\"Unsupported encoding: \"+e)}},h=function(){var e,t,n={},i=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],s=[];for(e=0,t=i.length;t>e;++e)s[i[e]]=e;return n.encode=function(e,t){for(var n,s;null!==(n=e());)t(i[63&n>>2]),s=(3&n)<<4,null!==(n=e())?(t(i[63&((s|=15&n>>4)|15&n>>4)]),s=(15&n)<<2,null!==(n=e())?(t(i[63&(s|3&n>>6)]),t(i[63&n])):(t(i[63&s]),t(61))):(t(i[63&s]),t(61),t(61))},n.decode=function(e,t){function n(e){throw Error(\"Illegal character code: \"+e)}for(var i,r,o;null!==(i=e());)if(void 0===(r=s[i])&&n(i),null!==(i=e())&&(void 0===(o=s[i])&&n(i),t(r<<2>>>0|(48&o)>>4),null!==(i=e()))){if(void 0===(r=s[i])){if(61===i)break;n(i)}if(t((15&o)<<4>>>0|(60&r)>>2),null!==(i=e())){if(void 0===(o=s[i])){if(61===i)break;n(i)}t((3&r)<<6>>>0|o)}}},n.test=function(e){return/^(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+\\/]{3}=)?$/.test(e)},n}(),r.toBase64=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),t|=0,(e|=0)<0||t>this.capacity||e>t)throw RangeError(\"begin, end\");var i;return h.encode(function(){return t>e?this.view[e++]:null}.bind(this),i=n()),i()},u.fromBase64=function(e,n){if(\"string\"!=typeof e)throw TypeError(\"str\");var i=new u(e.length/4*3,n),s=0;return h.decode(t(e),(function(e){i.view[s++]=e})),i.limit=s,i},u.btoa=function(e){return u.fromBinary(e).toBase64()},u.atob=function(e){return u.fromBase64(e).toBinary()},r.toBinary=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),t|=0,(e|=0)<0||t>this.capacity()||e>t)throw RangeError(\"begin, end\");if(e===t)return\"\";for(var n=[],i=[];t>e;)n.push(this.view[e++]),n.length>=1024&&(i.push(String.fromCharCode.apply(String,n)),n=[]);return i.join(\"\")+String.fromCharCode.apply(String,n)},u.fromBinary=function(e,t){if(\"string\"!=typeof e)throw TypeError(\"str\");for(var n,i=0,s=e.length,r=new u(s,t);s>i;){if((n=e.charCodeAt(i))>255)throw RangeError(\"illegal char code: \"+n);r.view[i++]=n}return r.limit=s,r},r.toDebug=function(e){for(var t,n=-1,i=this.buffer.byteLength,s=\"\",r=\"\",o=\"\";i>n;){if(-1!==n&&(s+=(t=this.view[n])<16?\"0\"+t.toString(16).toUpperCase():t.toString(16).toUpperCase(),e&&(r+=t>32&&t<127?String.fromCharCode(t):\".\")),++n,e&&n>0&&n%16==0&&n!==i){for(;s.length<51;)s+=\" \";o+=s+r+\"\\n\",s=r=\"\"}s+=n===this.offset&&n===this.limit?n===this.markedOffset?\"!\":\"|\":n===this.offset?n===this.markedOffset?\"[\":\"<\":n===this.limit?n===this.markedOffset?\"]\":\">\":n===this.markedOffset?\"'\":e||0!==n&&n!==i?\" \":\"\"}if(e&&\" \"!==s){for(;s.length<51;)s+=\" \";o+=s+r+\"\\n\"}return e?o:s},u.fromDebug=function(e,t,n){for(var i,s,r=e.length,o=new u(0|(r+1)/3,t,n),a=0,h=0,l=!1,c=!1,f=!1,d=!1,g=!1;r>a;){switch(i=e.charAt(a++)){case\"!\":if(!n){if(c||f||d){g=!0;break}c=f=d=!0}o.offset=o.markedOffset=o.limit=h,l=!1;break;case\"|\":if(!n){if(c||d){g=!0;break}c=d=!0}o.offset=o.limit=h,l=!1;break;case\"[\":if(!n){if(c||f){g=!0;break}c=f=!0}o.offset=o.markedOffset=h,l=!1;break;case\"<\":if(!n){if(c){g=!0;break}c=!0}o.offset=h,l=!1;break;case\"]\":if(!n){if(d||f){g=!0;break}d=f=!0}o.limit=o.markedOffset=h,l=!1;break;case\">\":if(!n){if(d){g=!0;break}d=!0}o.limit=h,l=!1;break;case\"'\":if(!n){if(f){g=!0;break}f=!0}o.markedOffset=h,l=!1;break;case\" \":l=!1;break;default:if(!n&&l){g=!0;break}if(s=parseInt(i+e.charAt(a++),16),!n&&(isNaN(s)||s<0||s>255))throw TypeError(\"Illegal str: Not a debug encoded string\");o.view[h++]=s,l=!0}if(g)throw TypeError(\"Illegal str: Invalid symbol at \"+a)}if(!n){if(!c||!d)throw TypeError(\"Illegal str: Missing offset or limit\");if(h<o.buffer.byteLength)throw TypeError(\"Illegal str: Not a debug encoded string (is it hex?) \"+h+\" < \"+r)}return o},r.toHex=function(e,t){if(e=void 0===e?this.offset:e,t=void 0===t?this.limit:t,!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal begin: Not an integer\");if(e>>>=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal end: Not an integer\");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError(\"Illegal range: 0 <= \"+e+\" <= \"+t+\" <= \"+this.buffer.byteLength)}for(var n,i=new Array(t-e);t>e;)(n=this.view[e++])<16?i.push(\"0\",n.toString(16)):i.push(n.toString(16));return i.join(\"\")},u.fromHex=function(e,t,n){var i,s,r,o,a;if(!n){if(\"string\"!=typeof e)throw TypeError(\"Illegal str: Not a string\");if(e.length%2!=0)throw TypeError(\"Illegal str: Length not a multiple of 2\")}for(s=e.length,r=new u(0|s/2,t),o=0,a=0;s>o;o+=2){if(i=parseInt(e.substring(o,o+2),16),!n&&(!isFinite(i)||i<0||i>255))throw TypeError(\"Illegal str: Contains non-hex characters\");r.view[a++]=i}return r.limit=a,r},l=function(){var e={MAX_CODEPOINT:1114111,encodeUTF8:function(e,t){var n=null;for(\"number\"==typeof e&&(n=e,e=function(){return null});null!==n||null!==(n=e());)n<128?t(127&n):n<2048?(t(192|31&n>>6),t(128|63&n)):n<65536?(t(224|15&n>>12),t(128|63&n>>6),t(128|63&n)):(t(240|7&n>>18),t(128|63&n>>12),t(128|63&n>>6),t(128|63&n)),n=null},decodeUTF8:function(e,t){for(var n,i,s,r,o=function(e){e=e.slice(0,e.indexOf(null));var t=Error(e.toString());throw t.name=\"TruncatedError\",t.bytes=e,t};null!==(n=e());)if(0==(128&n))t(n);else if(192==(224&n))null===(i=e())&&o([n,i]),t((31&n)<<6|63&i);else if(224==(240&n))(null===(i=e())||null===(s=e()))&&o([n,i,s]),t((15&n)<<12|(63&i)<<6|63&s);else{if(240!=(248&n))throw RangeError(\"Illegal starting byte: \"+n);(null===(i=e())||null===(s=e())||null===(r=e()))&&o([n,i,s,r]),t((7&n)<<18|(63&i)<<12|(63&s)<<6|63&r)}},UTF16toUTF8:function(e,t){for(var n,i=null;null!==(n=null!==i?i:e());)n>=55296&&n<=57343&&null!==(i=e())&&i>=56320&&i<=57343?(t(1024*(n-55296)+i-56320+65536),i=null):t(n);null!==i&&t(i)},UTF8toUTF16:function(e,t){var n=null;for(\"number\"==typeof e&&(n=e,e=function(){return null});null!==n||null!==(n=e());)n<=65535?t(n):(t(55296+((n-=65536)>>10)),t(n%1024+56320)),n=null},encodeUTF16toUTF8:function(t,n){e.UTF16toUTF8(t,(function(t){e.encodeUTF8(t,n)}))},decodeUTF8toUTF16:function(t,n){e.decodeUTF8(t,(function(t){e.UTF8toUTF16(t,n)}))},calculateCodePoint:function(e){return e<128?1:e<2048?2:e<65536?3:4},calculateUTF8:function(e){for(var t,n=0;null!==(t=e());)n+=t<128?1:t<2048?2:t<65536?3:4;return n},calculateUTF16asUTF8:function(t){var n=0,i=0;return e.UTF16toUTF8(t,(function(e){++n,i+=e<128?1:e<2048?2:e<65536?3:4})),[n,i]}};return e}(),r.toUTF8=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if(\"number\"!=typeof e||e%1!=0)throw TypeError(\"Illegal begin: Not an integer\");if(e>>>=0,\"number\"!=typeof t||t%1!=0)throw TypeError(\"Illegal end: Not an integer\");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError(\"Illegal range: 0 <= \"+e+\" <= \"+t+\" <= \"+this.buffer.byteLength)}var i;try{l.decodeUTF8toUTF16(function(){return t>e?this.view[e++]:null}.bind(this),i=n())}catch(n){if(e!==t)throw RangeError(\"Illegal range: Truncated data, \"+e+\" != \"+t)}return i()},u.fromUTF8=function(e,n,i){if(!i&&\"string\"!=typeof e)throw TypeError(\"Illegal str: Not a string\");var s=new u(l.calculateUTF16asUTF8(t(e),!0)[1],n,i),r=0;return l.encodeUTF16toUTF8(t(e),(function(e){s.view[r++]=e})),s.limit=r,s},u}(lt=function(){function e(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function t(e){return!0===(e&&e.__isLong__)}function n(e,t){var n,i,r;return t?(r=(e>>>=0)>=0&&e<256)&&(i=h[e])?i:(n=s(e,(0|e)<0?-1:0,!0),r&&(h[e]=n),n):(r=(e|=0)>=-128&&e<128)&&(i=a[e])?i:(n=s(e,e<0?-1:0,!1),r&&(a[e]=n),n)}function i(e,t){if(isNaN(e)||!isFinite(e))return t?p:g;if(t){if(e<0)return p;if(e>=c)return T}else{if(-f>=e)return R;if(e+1>=f)return y}return e<0?i(-e,t).neg():s(0|e%u,0|e/u,t)}function s(t,n,i){return new e(t,n,i)}function r(e,t,n){var s,o,a,h,u,c,f;if(0===e.length)throw Error(\"empty string\");if(\"NaN\"===e||\"Infinity\"===e||\"+Infinity\"===e||\"-Infinity\"===e)return g;if(\"number\"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||n>36)throw RangeError(\"radix\");if((s=e.indexOf(\"-\"))>0)throw Error(\"interior hyphen\");if(0===s)return r(e.substring(1),t,n).neg();for(o=i(l(n,8)),a=g,h=0;h<e.length;h+=8)u=Math.min(8,e.length-h),c=parseInt(e.substring(h,h+u),n),u<8?(f=i(l(n,u)),a=a.mul(f).add(i(c))):a=(a=a.mul(o)).add(i(c));return a.unsigned=t,a}function o(t){return t instanceof e?t:\"number\"==typeof t?i(t):\"string\"==typeof t?r(t):s(t.low,t.high,t.unsigned)}var a,h,l,u,c,f,d,g,p,E,_,m,y,T,R,C;return e.prototype.__isLong__,Object.defineProperty(e.prototype,\"__isLong__\",{value:!0,enumerable:!1,configurable:!1}),e.isLong=t,a={},h={},e.fromInt=n,e.fromNumber=i,e.fromBits=s,l=Math.pow,e.fromString=r,e.fromValue=o,f=(c=(u=4294967296)*u)/2,d=n(16777216),g=n(0),e.ZERO=g,p=n(0,!0),e.UZERO=p,E=n(1),e.ONE=E,_=n(1,!0),e.UONE=_,m=n(-1),e.NEG_ONE=m,y=s(-1,2147483647,!1),e.MAX_VALUE=y,T=s(-1,-1,!0),e.MAX_UNSIGNED_VALUE=T,R=s(0,-2147483648,!1),e.MIN_VALUE=R,(C=e.prototype).toInt=function(){return this.unsigned?this.low>>>0:this.low},C.toNumber=function(){return this.unsigned?(this.high>>>0)*u+(this.low>>>0):this.high*u+(this.low>>>0)},C.toString=function(e){var t,n,s,r,o,a,h,u;if((e=e||10)<2||e>36)throw RangeError(\"radix\");if(this.isZero())return\"0\";if(this.isNegative())return this.eq(R)?(t=i(e),s=(n=this.div(t)).mul(t).sub(this),n.toString(e)+s.toInt().toString(e)):\"-\"+this.neg().toString(e);for(r=i(l(e,6),this.unsigned),o=this,a=\"\";;){if(h=o.div(r),u=(o.sub(h.mul(r)).toInt()>>>0).toString(e),(o=h).isZero())return u+a;for(;u.length<6;)u=\"0\"+u;a=\"\"+u+a}},C.getHighBits=function(){return this.high},C.getHighBitsUnsigned=function(){return this.high>>>0},C.getLowBits=function(){return this.low},C.getLowBitsUnsigned=function(){return this.low>>>0},C.getNumBitsAbs=function(){var e,t;if(this.isNegative())return this.eq(R)?64:this.neg().getNumBitsAbs();for(e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},C.isZero=function(){return 0===this.high&&0===this.low},C.isNegative=function(){return!this.unsigned&&this.high<0},C.isPositive=function(){return this.unsigned||this.high>=0},C.isOdd=function(){return 1==(1&this.low)},C.isEven=function(){return 0==(1&this.low)},C.equals=function(e){return t(e)||(e=o(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},C.eq=C.equals,C.notEquals=function(e){return!this.eq(e)},C.neq=C.notEquals,C.lessThan=function(e){return this.comp(e)<0},C.lt=C.lessThan,C.lessThanOrEqual=function(e){return this.comp(e)<=0},C.lte=C.lessThanOrEqual,C.greaterThan=function(e){return this.comp(e)>0},C.gt=C.greaterThan,C.greaterThanOrEqual=function(e){return this.comp(e)>=0},C.gte=C.greaterThanOrEqual,C.compare=function(e){if(t(e)||(e=o(e)),this.eq(e))return 0;var n=this.isNegative(),i=e.isNegative();return n&&!i?-1:!n&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},C.comp=C.compare,C.negate=function(){return!this.unsigned&&this.eq(R)?R:this.not().add(E)},C.neg=C.negate,C.add=function(e){var n,i,r,a,h,l,u,c,f,d,g;return t(e)||(e=o(e)),n=this.high>>>16,i=65535&this.high,r=this.low>>>16,a=65535&this.low,h=e.high>>>16,l=65535&e.high,u=e.low>>>16,c=0,f=0,d=0,g=0,d+=(g+=a+(65535&e.low))>>>16,f+=(d+=r+u)>>>16,c+=(f+=i+l)>>>16,c+=n+h,s((d&=65535)<<16|(g&=65535),(c&=65535)<<16|(f&=65535),this.unsigned)},C.subtract=function(e){return t(e)||(e=o(e)),this.add(e.neg())},C.sub=C.subtract,C.multiply=function(e){var n,r,a,h,l,u,c,f,p,E,_,m;return this.isZero()?g:(t(e)||(e=o(e)),e.isZero()?g:this.eq(R)?e.isOdd()?R:g:e.eq(R)?this.isOdd()?R:g:this.isNegative()?e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg():e.isNegative()?this.mul(e.neg()).neg():this.lt(d)&&e.lt(d)?i(this.toNumber()*e.toNumber(),this.unsigned):(n=this.high>>>16,r=65535&this.high,a=this.low>>>16,h=65535&this.low,l=e.high>>>16,u=65535&e.high,c=e.low>>>16,p=0,E=0,_=0,m=0,_+=(m+=h*(f=65535&e.low))>>>16,E+=(_+=a*f)>>>16,_&=65535,E+=(_+=h*c)>>>16,p+=(E+=r*f)>>>16,E&=65535,p+=(E+=a*c)>>>16,E&=65535,p+=(E+=h*u)>>>16,p+=n*f+r*c+a*u+h*l,s((_&=65535)<<16|(m&=65535),(p&=65535)<<16|(E&=65535),this.unsigned)))},C.mul=C.multiply,C.divide=function(e){var n,s,r,a,h,u,c;if(t(e)||(e=o(e)),e.isZero())throw Error(\"division by zero\");if(this.isZero())return this.unsigned?p:g;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return p;if(e.gt(this.shru(1)))return _;r=p}else{if(this.eq(R))return e.eq(E)||e.eq(m)?R:e.eq(R)?E:(n=this.shr(1).div(e).shl(1)).eq(g)?e.isNegative()?E:m:(s=this.sub(e.mul(n)),r=n.add(s.div(e)));if(e.eq(R))return this.unsigned?p:g;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=g}for(s=this;s.gte(e);){for(n=Math.max(1,Math.floor(s.toNumber()/e.toNumber())),h=(a=Math.ceil(Math.log(n)/Math.LN2))<=48?1:l(2,a-48),c=(u=i(n)).mul(e);c.isNegative()||c.gt(s);)c=(u=i(n-=h,this.unsigned)).mul(e);u.isZero()&&(u=E),r=r.add(u),s=s.sub(c)}return r},C.div=C.divide,C.modulo=function(e){return t(e)||(e=o(e)),this.sub(this.div(e).mul(e))},C.mod=C.modulo,C.not=function(){return s(~this.low,~this.high,this.unsigned)},C.and=function(e){return t(e)||(e=o(e)),s(this.low&e.low,this.high&e.high,this.unsigned)},C.or=function(e){return t(e)||(e=o(e)),s(this.low|e.low,this.high|e.high,this.unsigned)},C.xor=function(e){return t(e)||(e=o(e)),s(this.low^e.low,this.high^e.high,this.unsigned)},C.shiftLeft=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?s(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):s(0,this.low<<e-32,this.unsigned)},C.shl=C.shiftLeft,C.shiftRight=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?s(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):s(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},C.shr=C.shiftRight,C.shiftRightUnsigned=function(e){var n;return t(e)&&(e=e.toInt()),0==(e&=63)?this:(n=this.high,e<32?s(this.low>>>e|n<<32-e,n>>>e,this.unsigned):s(32===e?n:n>>>e-32,0,this.unsigned))},C.shru=C.shiftRightUnsigned,C.toSigned=function(){return this.unsigned?s(this.low,this.high,!1):this},C.toUnsigned=function(){return this.unsigned?this:s(this.low,this.high,!0)},C.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},C.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,255&t>>>8,255&t>>>16,255&t>>>24,255&e,255&e>>>8,255&e>>>16,255&e>>>24]},C.toBytesBE=function(){var e=this.high,t=this.low;return[255&e>>>24,255&e>>>16,255&e>>>8,255&e,255&t>>>24,255&t>>>16,255&t>>>8,255&t]},e}()),lt));var ht,lt,ut;at.getModule=e=>{const t=new at[e];return t.getArrayData=()=>{let e=t.toArrayBuffer();return e=c(e)?[].slice.call(new Int8Array(e)):e,e},t},function(e){e[e.ALL=1]=\"ALL\",e[e.SINGAL=2]=\"SINGAL\"}(ut||(ut={}));var ct,ft=ut;!function(e){e.TextMessage=\"RC:TxtMsg\",e.VOICE=\"RC:VcMsg\",e.HQ_VOICE=\"RC:HQVCMsg\",e.IMAGE=\"RC:ImgMsg\",e.GIF=\"RC:GIFMsg\",e.RICH_CONTENT=\"RC:ImgTextMsg\",e.LOCATION=\"RC:LBSMsg\",e.FILE=\"RC:FileMsg\",e.SIGHT=\"RC:SightMsg\",e.COMBINE=\"RC:CombineMsg\",e.CHRM_KV_NOTIFY=\"RC:chrmKVNotiMsg\",e.LOG_COMMAND=\"RC:LogCmdMsg\",e.EXPANSION_NOTIFY=\"RC:MsgExMsg\",e.REFERENCE=\"RC:ReferenceMsg\",e.RECALL=\"RC:RcCmd\"}(ct||(ct={}));var dt,gt=ct;!function(e){e[e.OPEN=1]=\"OPEN\",e[e.CLOSE=2]=\"CLOSE\"}(dt||(dt={}));var pt=dt;const Et=\"pgMsgP\",_t=\"chatMsg\",mt=\"pcMsgP\",yt={PRIVATE:\"ppMsgS\",GROUP:\"pgMsgS\",CHATROOM:\"chatMsgS\"},Tt=\"delMsg\",Rt=\"joinChrm\",Ct=\"joinChrmR\",It=\"exitChrm\",vt=\"setKV\",St=\"delKV\",wt=\"qryRelationR\",Nt=\"delRelation\",Ot=\"setSeAtt\",bt={PRIVATE:\"cleanPMsg\",GROUP:\"cleanGMsg\",CUSTOMER_SERVICE:\"cleanCMsg\",SYSTEM:\"cleanSMsg\"},Mt=\"qryPMsg\",At=\"qryGMsg\",Ut=\"qryCHMsg\",Pt=\"qryCMsg\",Lt=\"qrySMsg\",Dt={[\"ppMsgP\"]:o.PRIVATE,[Et]:o.GROUP,[_t]:o.CHATROOM,[mt]:o.CUSTOMER_SERVICE},xt={[o.PRIVATE]:Mt,[o.GROUP]:At,[o.CHATROOM]:Ut,[o.CUSTOMER_SERVICE]:Pt,[o.SYSTEM]:Lt},Vt={[o.PRIVATE]:bt.PRIVATE,[o.GROUP]:bt.GROUP,[o.CUSTOMER_SERVICE]:bt.CUSTOMER_SERVICE,[o.SYSTEM]:bt.SYSTEM},kt=\"1\",Bt=\"0\",Ft=1,Yt=2;var qt;!function(e){e[e.SEND=1]=\"SEND\",e[e.RECEIVE=2]=\"RECEIVE\"}(qt||(qt={}));var Ht=qt;class Gt{constructor(e){this._codec=\"websocket\"===e?at:st,this._connectType=e}decodeByPBName(e,t,n){const i=this;let s=e;const r={[se]:i._formatSyncMessages,[ie]:i._formatReceivedMessage,[ne]:i._formatSentMessage,[ce]:i._formatHistoryMessages,[de]:i._formatConversationList,[Ie]:i._formatChatRoomInfos,[Se]:i._formatRTCUserList,[Pe]:i._formatRTCData,[Ke]:i._formatChatRoomKVList,[ze]:i._formatUserSetting,[Je]:i._formatConversationStatus}[t];try{s=e.length>0&&i._codec[t].decode(e),d(s)&&(s=(e=>{for(const t in e)d(e[t])&&(e[t]=y(e[t]));return e})(s)),p(r)&&(s=r.call(this,s,n))}catch(e){P.error(\"PB parse error\\n\",e)}return s}_readBytes(e){const{offset:t,buffer:n,limit:i}=e;if(t)try{const e=c(n)?new Uint8Array(n):n;return X.readUTF(e.subarray(t,i))}catch(e){P.info(\"readBytes error\\n\",e)}return e}_formatBytes(e){let t=this._readBytes(e);try{t=JSON.parse(t)}catch(e){P.info(\"formatBytes error\\n\",e)}return t||e}_formatSyncMessages(e,t){t=t||{};const n=this,{list:i,syncTime:s,finished:r}=e;return(E(r)||null===r)&&(e.finished=!0),e.syncTime=y(s),e.list=B(i,(e=>n._formatReceivedMessage(e,t))),e}_formatReceivedMessage(e,n){n=n||{};const{currentUserId:i,connectedTime:s}=n,{content:r,fromUserId:a,type:h,groupId:l,status:u,dataTime:c,classname:f,msgId:d,extraContent:g}=e,p=(e.direction||Ht.RECEIVE)===Ht.SEND,{isPersited:E,isCounted:_,isMentioned:m,disableNotification:T,receivedStatus:R,canIncludeExpansion:C}=(e=>{let n=!0,i=!0,s=!1,r=!1,o=t.READ,a=!1,h=!1;return n=!!(16&e),i=!!(32&e),s=!!(64&e),r=!!(256&e),a=!!(2&e),o=a?t.RETRIEVED:o,h=!!(1024&e),{isPersited:n,isCounted:i,isMentioned:s,disableNotification:r,receivedStatus:o,canIncludeExpansion:h}})(u),I=h===o.GROUP||h===o.CHATROOM?l:a,v=p?i:a,S=y(c),w=S<s,N=h===o.CHATROOM,O=this._formatBytes(r);let b,M=p?Ht.SEND:Ht.RECEIVE;return N&&a===i&&(M=Ht.SEND),g&&(b={},b=K(g)),{conversationType:h,targetId:I,senderUserId:v,messageType:f,messageUId:d,isPersited:E,isCounted:_,isMentioned:m,sentTime:S,isOffLineMessage:w,messageDirection:M,receivedTime:j.getTime(),disableNotification:T,receivedStatus:R,canIncludeExpansion:C,content:O,expansion:b}}_formatSentMessage(e,t){const{content:n,classname:i,sessionId:s,msgId:r,extraContent:a}=e,{signal:h,currentUserId:l}=t,{date:u,topic:c,targetId:f}=h,{isPersited:d,isCounted:g,disableNotification:p,canIncludeExpansion:E}=(e=>{let t=!1,n=!1,i=!1,s=!1;return t=!!(1&e),n=!!(2&e),i=!!(16&e),s=!!(64&e),{isPersited:t,isCounted:n,disableNotification:i,canIncludeExpansion:s}})(s),_=Dt[c]||o.PRIVATE,m=Y(yt,c);let y;return a&&(y={},y=K(a)),{conversationType:_,targetId:f,messageType:i,messageUId:r,isPersited:d,isCounted:g,isStatusMessage:m,senderUserId:l,content:this._formatBytes(n),sentTime:1e3*u,receivedTime:j.getTime(),messageDirection:Ht.SEND,isOffLineMessage:!1,disableNotification:p,canIncludeExpansion:E,expansion:y}}_formatHistoryMessages(e,t){const n=t.conversation||{},{list:i,hasMsg:s}=e,r=n.targetId,o=y(e.syncTime),a=[];return k(i,(e=>{const n=this._formatReceivedMessage(e,t);n.targetId=r,a.push(n)}),{isReverse:!0}),{syncTime:o,list:a,hasMore:!!s}}_formatConversationList(e,t){const n=this;let{info:i}=e;const s=t.afterDecode||function(){};return i=B(i,(e=>{const{msg:i,userId:r,type:o,unreadCount:a}=e,h=n._formatReceivedMessage(i,t);h.targetId=r;const l={targetId:r,conversationType:o,unreadMessageCount:a,latestMessage:h};return s(l)||l})),i||[]}_formatChatRoomInfos(e){const{userTotalNums:t,userInfos:n}=e;return{userCount:t,userInfos:B(n,(e=>{const{id:t,time:n}=e;return{id:t,time:y(n)}}))}}_formatChatRoomKVList(e){let{entries:t,bFullUpdate:n,syncTime:i}=e;return t=t||[],t=B(t,(e=>{const{key:t,value:n,status:i,timestamp:s,uid:r}=e,{isAutoDelete:o,isOverwrite:a,type:h}=(e=>({isAutoDelete:!!(1&e),isOverwrite:!!(2&e),type:4&e?G.DELETE:G.UPDATE}))(i);return{key:t,value:n,isAutoDelete:o,isOverwrite:a,type:h,userId:r,timestamp:y(s)}})),{kvEntries:t,isFullUpdate:n,syncTime:i}}_formatUserSetting(e){const{items:t,version:n}=e,i={};return k(t||[],(e=>{const{key:t,version:n,value:s}=e;e.version=y(n),e.value=this._readBytes(s),i[t]=e})),{settings:i,version:n}}_formatConversationStatus(e){const{state:t}=e,n=[];return k(t,(e=>{const{type:t,channelId:i,time:s,stateItem:r}=e;let o=pt.CLOSE,a=!1;k(r,(e=>{const{sessionStateType:t,value:n}=e;switch(t){case Ft:o=n===kt?pt.OPEN:pt.CLOSE;break;case Yt:a=n===kt}})),n.push({type:t,targetId:i,notificationStatus:o,isTop:a,updatedTime:y(s)})})),n}_formatRTCUserList(e){const{list:t,token:n,sessionId:i}=e,s={};return k(t,(e=>{const{userId:t,userData:n}=e,i={};k(n,(e=>{const{key:t,value:n}=e;i[t]=n})),s[t]=i})),{users:s,token:n,sessionId:i}}_formatRTCData(e){const{outInfo:t}=e,n={};return k(t,(e=>{n[e.key]=e.value})),n}_formatRTCRoomInfo(e){const{roomId:t,userCount:n,roomData:i}=e,s={id:t,total:n};return k(i,(e=>{s[e.key]=e.value})),s}encodeServerConfParams(){const e=this._codec.getModule(re);return e.setNothing(1),e.getArrayData()}_getUpMsgModule(e,t){const{type:n}=e,{messageType:i,isMentioned:s,mentionedType:r,mentionedUserIdList:a,content:h,pushContent:l,pushData:u,directionalUserIdList:c,isFilerWhiteBlacklist:f,isVoipPush:d,canIncludeExpansion:g,expansion:p}=t,E=n===o.GROUP,_=this._codec.getModule(ne),m=(e=>{const{isStatusMessage:t}=e;let{isPersited:n,isCounted:i,isMentioned:s,disableNotification:r,canIncludeExpansion:o}=e;t&&(n=i=!1);let a=0;return n&&(a|=1),i&&(a|=2),s&&(a|=4),r&&(a|=32),o&&(a|=64),a})(t);let y=0;if(_.setSessionId(m),E&&s&&h&&(h.mentionedInfo={userIdList:a,type:r||ft.ALL}),l&&_.setPushText(l),u&&_.setAppData(u),c&&_.setUserId(c),y|=d?1:0,y|=f?2:0,_.setConfigFlag(y),_.setClassname(i),_.setContent(JSON.stringify(h)),g&&p){const e={};k(p,((t,n)=>{e[n]={v:t}})),_.setExtraContent(JSON.stringify(e))}return _}encodeUpMsg(e,t){return this._getUpMsgModule(e,t).getArrayData()}encodeSyncMsg(e){const{sendboxTime:t,inboxTime:n}=e,i=this._codec.getModule(ae);return i.setIspolling(!1),i.setIsPullSend(!0),i.setSendBoxSyncTime(t),i.setSyncTime(n),i.getArrayData()}encodeChrmSyncMsg(e,t){e=e||0,t=t||0;const n=this._codec.getModule(he);return n.setCount(t),n.setSyncTime(e),n.getArrayData()}encodeGetHistoryMsg(e,t){const{count:n,order:i,timestamp:s}=t,r=this._codec.getModule(ue);return r.setTargetId(e),r.setTime(s),r.setCount(n),r.setOrder(i),r.getArrayData()}encodeGetConversationList(e){e=e||{};const{count:t,startTime:n}=e,i=this._codec.getModule(fe);return i.setType(1),i.setCount(t),i.setStartTime(n),i.getArrayData()}encodeOldConversationList(e){e=e||{};let{count:t,type:n,startTime:i,order:s}=e;t=t||0,i=i||0,s=s||0;const r=this._codec.getModule(fe);return r.setType(n),r.setCount(t),r.setStartTime(i),r.setOrder(s),r.getArrayData()}encodeRemoveConversationList(e){const t=this._codec.getModule(ge),n=[];return k(e,(e=>{const{type:t,targetId:i}=e,s=this._codec.getModule(pe);s.setType(t),s.setChannelId(i),n.push(s)})),t.setSessions(n),t.getArrayData()}encodeDeleteMessages(e,t,n){const i=this._codec.getModule(me),s=[];return k(n,(e=>{s.push({msgId:e.messageUId,msgDataTime:e.sentTime,direct:e.messageDirection})})),i.setType(e),i.setConversationId(t),i.setMsgs(s),i.getArrayData()}encodeClearMessages(e,t){const n=this._codec.getModule(ye);return t=t||(new Date).getTime(),n.setDataTime(t),n.setTargetId(e),n.getArrayData()}encodeClearUnreadCount(e,t){const{type:n,targetId:i}=e;let{timestamp:s}=t;const r=this._codec.getModule(Te);return s=s||+new Date,r.setType(n),r.setChannelId(i),r.setMsgTime(s),r.getArrayData()}encodeJoinOrQuitChatRoom(){const e=this._codec.getModule(Re);return e.setNothing(1),e.getArrayData()}encodeGetChatRoomInfo(e,t){const n=this._codec.getModule(Ce);return n.setCount(e),n.setOrder(t),n.getArrayData()}encodeGetFileToken(e,t){const n=this._codec.getModule(Fe);return n.setType(e),n.setKey(t),n.getArrayData()}encodeGetFileUrl(e,t,n){const i=this._codec.getModule(qe);return i.setType(e),i.setKey(t),n&&i.setFileName(n),i.getArrayData()}encodeModifyChatRoomKV(e,t,n){const i=\"comet\"===this._connectType,s=this._codec.getModule(Ge),{key:r,value:a,notificationExtra:h,isSendNotification:l,type:u}=t,c=u||G.UPDATE,f=((e,t)=>{let n=0;return e.isAutoDelete&&(n|=1),e.isOverwrite&&(n|=2),2===t&&(n|=4),n})(t,c),d={key:r,value:a||\"\",uid:n};if(E(f)||(d.status=f),s.setEntry(d),l){const t={type:o.CHATROOM,targetId:e},n={key:r,value:a,extra:h,type:c},l=this._getUpMsgModule(t,{messageType:gt.CHRM_KV_NOTIFY,content:n,isPersited:!1,isCounted:!1});i?s.setNotification(l.getArrayData()):s.setNotification(l),s.setBNotify(!0),s.setType(o.CHATROOM)}return s.getArrayData()}encodePullChatRoomKV(e){const t=this._codec.getModule(je);return t.setTimestamp(e),t.getArrayData()}encodePullUserSetting(e){const t=this._codec.getModule(Qe);return t.setVersion(e),t.getArrayData()}encodeGetConversationStatus(e){const t=this._codec.getModule(Ze);return t.setTime(e),t.getArrayData()}encodeSetConversationStatus(e){const t=\"comet\"===this._connectType,n=this._codec.getModule(tt),i=j.getTime(),s=[];return k(e,(e=>{const n=this._codec.getModule(Xe),{conversationType:r,targetId:o,notificationStatus:a,isTop:h}=e,l=[];n.setType(r),n.setChannelId(o),n.setTime(i);const u=a===pt.OPEN,c={};E(a)||(c[Ft]=u),E(h)||(c[Yt]=h),k(c,((e,n)=>{if(!E(e)){const i=this._codec.getModule(et);e=e?kt:Bt,i.setSessionStateType(Number(n)),i.setValue(e);const s=t?i.getArrayData():i;l.push(s)}})),n.setStateItem(l);const f=t?n.getArrayData():n;s.push(f)})),n.setVersion(i),n.setState(s),n.getArrayData()}encodeJoinRTCRoom(e,t){const n=this._codec.getModule(ve);return e=e||0,n.setRoomType(e),E(t)||n.setBroadcastType(t),n.getArrayData()}encodeQuitRTCRoom(){return this._codec.getModule(we).getArrayData()}encodeSetRTCData(e,t,n,i,s){const r=this._codec.getModule(Ne);r.setInterior(n),r.setTarget(i),r.setKey(e),r.setValue(t),s=s||{};let{name:o,content:a}=s;return!E(o)&&r.setObjectName(o),E(a)||(d(a)&&(a=JSON.stringify(a)),r.setContent(a)),r.getArrayData()}encodeUserSetRTCData(e,t,n){const i=this._codec.getModule(Oe);i.setObjectName(n);let s=this._codec.getModule(ke);return s.setKey(e.name),s.setValue(e.content),i.setContent(s),s=this._codec.getModule(ke),s.setKey(\"uris\"),s.setValue(t),i.setValueInfo(s),i.getArrayData()}encodeGetRTCData(e,t,n){const i=this._codec.getModule(be);return i.setInterior(t),i.setTarget(n),i.setKey(e),i.getArrayData()}encodeRemoveRTCData(e,t,n,i){const s=this._codec.getModule(be);s.setInterior(t),s.setTarget(n),s.setKey(e),i=i||{};let{name:r,content:o}=i;return!E(r)&&s.setObjectName(r),E(o)||(d(o)&&(o=JSON.stringify(o)),s.setContent(o)),s.getArrayData()}encodeSetRTCOutData(e,t,n){const i=this._codec.getModule(Me);i.setTarget(t),u(e)||(e=[e]),k(e,((t,n)=>{t.key=t.key?t.key.toString():t.key,t.value=t.value?t.value.toString():t.value,e[n]=t})),i.setValueInfo(e),n=n||{};let{name:s,content:r}=n;return!E(s)&&i.setObjectName(s),E(r)||(d(r)&&(r=JSON.stringify(r)),i.setContent(r)),i.getArrayData()}ecnodeGetRTCOutData(e){const t=this._codec.getModule(Le);return t.setUserId(e),t.getArrayData()}encodeSetRTCState(e){const t=this._codec.getModule(Ae);return t.setId(e),t.getArrayData()}encodeGetRTCRoomInfo(){const e=this._codec.getModule(xe);return e.setOrder(2),e.getArrayData()}encodeSetRTCUserInfo(e,t){const n=this._codec.getModule(ke);return n.setKey(e),n.setValue(t),n.getArrayData()}encodeRemoveRTCUserInfo(e){const t=this._codec.getModule(Be);return t.setKey(e),t.getArrayData()}}class Kt{constructor(e,t){this._watcher=t,this.codec=new Gt(e)}static matchVersion(e){return e.match(/\\d+(\\.\\d+){2}/)[0]}}const jt=(e,t)=>e&&t?t+\"_\"+e:e||Date.now();class $t{constructor(e){this.header=e,this._name=null,this.lengthSize=0,this.messageId=0,this.timestamp=0,this.syncMsg=!1,this.identifier=\"\"}getIdentifier(){const{messageId:e,identifier:t}=this;return jt(e,t)}read(e,t){this.readMessage(e,t)}readMessage(e,t){return{stream:e,length:t}}}class Wt{constructor(e){this.lengthSize=0,this.messageId=0,this.topic=\"\",this.targetId=\"\",this.identifier=\"\",this._header=new J(e,!1,W.AT_MOST_ONCE,!1)}getIdentifier(){const{messageId:e,identifier:t}=this;return jt(e,t)}write(e){var t=this.getHeaderFlag();e.write(t),this.writeMessage(e)}setHeaderQos(e){this._header.qos=e}getHeaderFlag(){return this._header.encode()}getLengthSize(){return this.lengthSize}getBufferData(){const e=new te;this.write(e);const t=e.getBytesArray();return new Int8Array(t)}getCometData(){const e=this.data||{};return JSON.stringify(e)}}class Qt extends $t{constructor(){super(...arguments),this._name=z.CONN_ACK,this.status=null,this.userId=null,this.timestamp=0}readMessage(e,t){return e.readByte(),this.status=+e.readByte(),t>Qt.MESSAGE_LENGTH&&(this.userId=e.readUTF(),e.readUTF(),this.timestamp=e.readLong()),{stream:e,length:t}}}Qt.MESSAGE_LENGTH=2;class zt extends $t{constructor(){super(...arguments),this._name=z.DISCONNECT,this.status=0}readMessage(e,t){return e.readByte(),this.status=+e.readByte(),{stream:e,length:t}}}zt.MESSAGE_LENGTH=2;class Zt extends Wt{constructor(){super(Q.PING_REQ),this._name=z.PING_REQ}writeMessage(e){}}class Jt extends $t{constructor(e){super(e),this._name=z.PING_RESP}}class Xt extends $t{constructor(){super(...arguments),this.messageId=0}readMessage(e,t){const n=256*e.readByte()+e.readByte();return this.messageId=parseInt(n.toString(),10),{stream:e,length:t}}}class en extends Wt{constructor(){super(...arguments),this.messageId=0}writeMessage(e){const t=this.messageId,n=255&t,i=(65280&t)>>8;e.write(i),e.write(n)}}class tn extends Xt{constructor(){super(...arguments),this._name=z.PUBLISH,this.topic=\"\",this.targetId=\"\",this.syncMsg=!1,this.identifier=Z.PUB}readMessage(e,t){return this.date=e.readInt(),this.topic=e.readUTF(),this.targetId=e.readUTF(),super.readMessage(e,t),this.data=e.readAll(),{stream:e,length:t}}}class nn extends en{constructor(e,t,n){super(Q.PUBLISH),this._name=z.PUBLISH,this.syncMsg=!1,this.identifier=Z.PUB,this.topic=e,this.data=h(t)?X.writeUTF(t):t,this.targetId=n}writeMessage(e){e.writeUTF(this.topic),e.writeUTF(this.targetId),super.writeMessage(e),e.write(this.data)}}class sn extends Xt{constructor(){super(...arguments),this._name=z.PUB_ACK,this.status=0,this.date=0,this.millisecond=0,this.messageUId=\"\",this.timestamp=0,this.identifier=Z.PUB,this.topic=\"\",this.targetId=\"\"}readMessage(e,t){return super.readMessage(e,t),this.date=e.readInt(),this.status=256*e.readByte()+e.readByte(),this.millisecond=256*e.readByte()+e.readByte(),this.timestamp=1e3*this.date+this.millisecond,this.messageUId=e.readUTF(),{stream:e,length:t}}}class rn extends en{constructor(e){super(Q.PUB_ACK),this._name=z.PUB_ACK,this.status=0,this.date=0,this.millisecond=0,this.messageUId=\"\",this.timestamp=0,this.messageId=e}writeMessage(e){super.writeMessage(e)}}class on extends en{constructor(e,t,n){super(Q.QUERY),this.name=z.QUERY,this.identifier=Z.QUERY,this.topic=e,this.data=h(t)?X.writeUTF(t):t,this.targetId=n}writeMessage(e){e.writeUTF(this.topic),e.writeUTF(this.targetId),super.writeMessage(e),e.write(this.data)}}class an extends en{constructor(e){super(Q.QUERY_CONFIRM),this._name=z.QUERY_CON,this.messageId=e}}class hn extends Xt{constructor(){super(...arguments),this._name=z.QUERY_ACK,this.status=0,this.identifier=Z.QUERY,this.topic=\"\",this.targetId=\"\"}readMessage(e,t){return super.readMessage(e,t),this.date=e.readInt(),this.status=256*e.readByte()+e.readByte(),this.data=e.readAll(),{stream:e,length:t}}}const ln=e=>{const t=e.type;let n;switch(t){case Q.CONN_ACK:n=new Qt(e);break;case Q.PUBLISH:n=new tn(e),n.syncMsg=e.syncMsg;break;case Q.PUB_ACK:n=new sn(e);break;case Q.QUERY_ACK:n=new hn(e);break;case Q.SUB_ACK:case Q.UNSUB_ACK:case Q.PING_RESP:n=new Jt(e);break;case Q.DISCONNECT:n=new zt(e);break;default:n=new $t(e),P.error(\"No support for deserializing \"+t+\" messages\")}return n},un=e=>{const t=new Uint8Array(e),n=new ee(t),i=n.readByte(),s=new J(i),r=ln(s);return r.read(n,t.length-1),r},cn={ACCEPTED:0,UNACCEPTABLE_PROTOCOL_VERSION:1,IDENTIFIER_REJECTED:2,SERVER_UNAVAILABLE:3,TOKEN_INCORRECT:4,NOT_AUTHORIZED:5,REDIRECT:6,PACKAGE_ERROR:7,APP_BLOCK_OR_DELETE:8,BLOCK:9,TOKEN_EXPIRE:10,DEVICE_ERROR:11,HOSTNAME_ERROR:12,HASOHTERSAMECLIENTONLINE:13};var fn;!function(e){e[e.CONNECTED=0]=\"CONNECTED\",e[e.CONNECTING=1]=\"CONNECTING\",e[e.DISCONNECTED=2]=\"DISCONNECTED\",e[e.NETWORK_UNAVAILABLE=3]=\"NETWORK_UNAVAILABLE\",e[e.CONNECTION_CLOSED=4]=\"CONNECTION_CLOSED\",e[e.KICKED_OFFLINE_BY_OTHER_CLIENT=6]=\"KICKED_OFFLINE_BY_OTHER_CLIENT\",e[e.WEBSOCKET_UNAVAILABLE=7]=\"WEBSOCKET_UNAVAILABLE\",e[e.WEBSOCKET_ERROR=8]=\"WEBSOCKET_ERROR\",e[e.BLOCKED=9]=\"BLOCKED\",e[e.DOMAIN_INCORRECT=12]=\"DOMAIN_INCORRECT\",e[e.APPKEY_IS_FAKE=20]=\"APPKEY_IS_FAKE\",e[e.ULTRALIMIT=1101]=\"ULTRALIMIT\",e[e.REQUEST_NAVI=201]=\"REQUEST_NAVI\",e[e.RESPONSE_NAVI=202]=\"RESPONSE_NAVI\",e[e.RESPONSE_NAVI_ERROR=203]=\"RESPONSE_NAVI_ERROR\",e[e.RESPONSE_NAVI_TIMEOUT=204]=\"RESPONSE_NAVI_TIMEOUT\"}(fn||(fn={}));var dn,gn=fn;!function(e){e[e.ppMsgP=1]=\"ppMsgP\",e[e.ppMsgN=2]=\"ppMsgN\",e[e.ppMsgS=3]=\"ppMsgS\",e[e.pgMsgP=4]=\"pgMsgP\",e[e.chatMsg=5]=\"chatMsg\",e[e.pcMsgP=6]=\"pcMsgP\",e[e.qryPMsg=7]=\"qryPMsg\",e[e.qryGMsg=8]=\"qryGMsg\",e[e.qryCHMsg=9]=\"qryCHMsg\",e[e.qryCMsg=10]=\"qryCMsg\",e[e.qrySMsg=11]=\"qrySMsg\",e[e.recallMsg=12]=\"recallMsg\",e[e.prMsgS=13]=\"prMsgS\",e[e.s_ntf=14]=\"s_ntf\",e[e.s_msg=15]=\"s_msg\",e[e.s_stat=16]=\"s_stat\",e[e.s_cmd=17]=\"s_cmd\",e[e.s_us=18]=\"s_us\",e[e.pullUS=19]=\"pullUS\",e[e.pgMsgS=20]=\"pgMsgS\",e[e.chatMsgS=21]=\"chatMsgS\",e[e.qrySessionsAtt=22]=\"qrySessionsAtt\",e[e.pullMsg=23]=\"pullMsg\",e[e.qrySessions=24]=\"qrySessions\",e[e.delSessions=25]=\"delSessions\",e[e.delMsg=26]=\"delMsg\",e[e.updRRTime=27]=\"updRRTime\",e[e.chrmPull=28]=\"chrmPull\",e[e.joinChrm=29]=\"joinChrm\",e[e.joinChrmR=30]=\"joinChrmR\",e[e.exitChrm=31]=\"exitChrm\",e[e.queryChrmI=32]=\"queryChrmI\",e[e.setKV=33]=\"setKV\",e[e.delKV=34]=\"delKV\",e[e.pullKV=35]=\"pullKV\",e[e.qryRelation=36]=\"qryRelation\",e[e.delRelation=37]=\"delRelation\",e[e.pullSeAtts=38]=\"pullSeAtts\",e[e.setSeAtt=39]=\"setSeAtt\",e[e.qnTkn=40]=\"qnTkn\",e[e.qnUrl=41]=\"qnUrl\",e[e.cleanPMsg=42]=\"cleanPMsg\",e[e.cleanGMsg=43]=\"cleanGMsg\",e[e.cleanCMsg=44]=\"cleanCMsg\",e[e.cleanSMsg=45]=\"cleanSMsg\",e[e.rtcRJoin_data=46]=\"rtcRJoin_data\",e[e.rtcRExit=47]=\"rtcRExit\",e[e.rtcPing=48]=\"rtcPing\",e[e.rtcSetData=49]=\"rtcSetData\",e[e.userSetData=50]=\"userSetData\",e[e.rtcQryData=51]=\"rtcQryData\",e[e.rtcDelData=52]=\"rtcDelData\",e[e.rtcSetOutData=53]=\"rtcSetOutData\",e[e.rtcQryUserOutData=54]=\"rtcQryUserOutData\",e[e.rtcToken=55]=\"rtcToken\",e[e.rtcUserState=56]=\"rtcUserState\",e[e.rtcRInfo=57]=\"rtcRInfo\",e[e.rtcUData=58]=\"rtcUData\",e[e.rtcUPut=59]=\"rtcUPut\",e[e.rtcUDel=60]=\"rtcUDel\",e[e.rtcUList=61]=\"rtcUList\"}(dn||(dn={}));var pn=dn;const En=(e,t,n)=>$(void 0,void 0,void 0,(function*(){let i=yield Promise.all(e.map((e=>$(void 0,void 0,void 0,(function*(){const i=Date.now(),s=`${t}://${e}/ping?r=${r=1e3,o=9999,r+Math.floor(Math.random()*(o-r))}`;var r,o;return{status:(yield n.httpReq({url:s,timeout:5e3})).status,host:e,cost:Date.now()-i}})))));return i=i.filter((e=>200===e.status)),i.length>1&&(i=i.sort(((e,t)=>e.cost-t.cost))),i.map((e=>e.host))})),_n=(e,t,n,i,s,r,o)=>`${e}://${t}/websocket?appId=${n}&token=${encodeURIComponent(i)}&sdkVer=${r}&pid=${o}&apiVer=${s.isFromUniapp?\"uniapp\":\"normal\"}${s.connectPlatform?\"&platform=\"+s.connectPlatform:\"\"}`,mn=(e,t)=>[e,t].join(\"-\"),yn=e=>[pn.ppMsgS,pn.pgMsgS,pn.chatMsgS].map((e=>pn[e])).indexOf(e)>=0,Tn=(e,t)=>{e instanceof Zt||P.debug(\"Websocket ==>\",e);const n=e.getBufferData();t.send(n.buffer)};var Rn;(Rn=exports.HttpMethod||(exports.HttpMethod={})).GET=\"GET\",Rn.POST=\"POST\";const Cn=(e,t)=>[\"navi\",e,t].join(\"_\"),In=(e,t,n)=>{const i=Cn(e,t),s=n.getItem(i);if(!s)return null;let r;try{r=JSON.parse(s)}catch(e){return n.removeItem(i),null}return Date.now()-r.timestamp>=72e5?(n.removeItem(i),null):r.naviInfo},vn=(e,t,n,i)=>{const s=Cn(e,t),r={naviInfo:n,timestamp:Date.now()};i.setItem(s,JSON.stringify(r))};class Sn{constructor(e,t,n,i=[],s,r){this._runtime=e,this._appkey=t,this._navigators=n,this._customCMP=i,this._apiVersion=s,this._connectType=r}_formatNaviUrl(e,t,n,i,s){return`${e}/${this._runtime.isSupportSocket()&&\"websocket\"===s?\"navi\":\"cometnavi\"}.js?appId=${n}&token=${encodeURIComponent(t)}&callBack=${i}&v=${this._apiVersion}&r=${Date.now()}`}_reqNavi(e,t,n,i){return $(this,void 0,void 0,(function*(){const s=\"getServerEndpoint\";for(let r=0,o=e.length;r<o;r+=1){const o=this._formatNaviUrl(e[r],n,t,s,i);P.debug(\"req navi => \"+o);const a=yield this._runtime.httpReq({url:o,timeout:1e4});if(200===a.status)try{const e=a.data.replace(s+\"(\",\"\").replace(/\\);?$/,\"\"),t=JSON.parse(e),n=/^https/.test(o)?\"https\":\"http\";return t.protocol=n,t}catch(e){P.error(\"parse navi err =>\",e)}}return null}))}getInfo(e,t,n){var i;return $(this,void 0,void 0,(function*(){if(!this._runtime.useNavi){let t;t=this._runtime.isSupportSocket()?R.join(\",\"):C.join(\",\");const n={code:200,protocol:\"https\",server:\"\",voipCallInfo:\"\",kvStorage:0,openHttpDNS:!1,historyMsg:!1,chatroomMsg:!1,uploadServer:\"https://upload.qiniup.com\",bosAddr:\"https://gz.bcebos.com\",location:\"\",monitor:0,joinMChrm:!1,openMp:0,openUS:0,grpMsgLimit:0,isFormatted:0,gifSize:2048,logSwitch:0,logPolicy:\"\",compDays:0,msgAck:\"\",activeServer:\"\",qnAddr:\"\",extkitSwitch:0,alone:!1,voipServer:\"\",offlinelogserver:\"\",backupServer:(null===(i=this._customCMP)||void 0===i?void 0:i.length)?this._customCMP.join(\",\"):t};return vn(this._appkey,e,n,this._runtime.localStorage),n}n&&this._clear(e);let s=In(this._appkey,e,this._runtime.localStorage);if(s)return s;const r=this._navigators.slice();return t.length&&t.forEach((e=>{r.indexOf(e)<0&&r.push(e)})),s=yield this._reqNavi(r,this._appkey,e,this._connectType),s?(vn(this._appkey,e,s,this._runtime.localStorage),s):s}))}getInfoFromCache(e){return In(this._appkey,e,this._runtime.localStorage)}_clear(e){((e,t,n)=>{n.removeItem(Cn(e,t))})(this._appkey,e,this._runtime.localStorage)}}class wn{constructor(e,t,n,i){this.runtime=e,this._appkey=t,this._watcher=n,this._apiVersion=i,this.currentUserId=\"\",this.connectedTime=0}}const Nn=(e,t,n)=>[e,t,n].join(\"_\");class On{constructor(e,t){this._runtime=e,this._appkey=t,this._inboxTime=0,this._outboxTime=0}setInboxTime(e,t){if(this._inboxTime>e)return;this._inboxTime=e;const n=Nn(\"inbox\",this._appkey,t);this._runtime.localStorage.setItem(n,e.toString())}getInboxTime(e){if(0===this._inboxTime){const t=Nn(\"inbox\",this._appkey,e);this._inboxTime=parseInt(this._runtime.localStorage.getItem(t))||0}return this._inboxTime}setOutboxTime(e,t){if(this._outboxTime>e)return;this._outboxTime=e;const n=Nn(\"outbox\",this._appkey,t);this._runtime.localStorage.setItem(n,e.toString())}getOutboxTime(e){if(0===this._outboxTime){const t=Nn(\"outbox\",this._appkey,e);this._outboxTime=parseInt(this._runtime.localStorage.getItem(t))||0}return this._outboxTime}}const bn={_caches:{},set(e,t){this._caches[e]=t},get(e){return this._caches[e]||0},clear(e){this._caches[e]=0}};class Mn{constructor(e,t){this._kvCaches={},this._chatroomId=e,this._currentUserId=t}_add(e){const{key:t}=e;e.isDeleted=!1,this._kvCaches[t]=e}_remove(e){const{key:t}=e,n=this._kvCaches[t];n.isDeleted=!0,this._kvCaches[t]=n}_setEntry(e,t){const{key:n,type:i,isOverwrite:s,userId:r}=e,o=this._getSetUserId(n),a=i===G.DELETE,h=o===r,l=!this._isExisted(n),u=a?this._remove:this._add;(t||s||h||l)&&u.call(this,e)}getValue(e){const t=this._kvCaches[e]||{},{isDeleted:n}=t;return n?null:t.value}getAllValue(){const e={};for(const t in this._kvCaches)this._kvCaches[t].isDeleted||(e[t]=this._kvCaches[t].value);return e}_getSetUserId(e){return(this._kvCaches[e]||{}).userId}_isExisted(e){const t=this._kvCaches[e]||{},{value:n,isDeleted:i}=t;return n&&!i}setEntries(e){let{kvEntries:t,isFullUpdate:n}=e;t=t||[],n=n||!1,n&&this.clear(),t.forEach((e=>{this._setEntry(e,n)}))}clear(){this._kvCaches={}}}class An{constructor(e){this._pullQueue=[],this._isPulling=!1,this._storeCaches={},this._engine=e}_startPull(){return $(this,void 0,void 0,(function*(){if(this._isPulling||0===this._pullQueue.length)return;this._isPulling=!0;const{chrmId:e,timestamp:t}=this._pullQueue.splice(0,1)[0];if(bn.get(e)>t)return void(this._isPulling=!1);const{code:n,data:i}=yield this._engine.pullChatroomEntry(e,t);n===s.SUCCESS?(this._isPulling=!1,bn.set(e,i.syncTime||0),this._startPull()):this._startPull()}))}reset(e){bn.clear(e);this._storeCaches[e].clear()}pullEntry(e,t){this._pullQueue.push({chrmId:e,timestamp:t}),this._startPull()}setLocal(e,t,n){let i=this._storeCaches[e];m(i)||(i=new Mn(e,n)),i.setEntries(t),this._storeCaches[e]=i}getValue(e,t){const n=this._storeCaches[e];return n?n.getValue(t):null}getAll(e){const t=this._storeCaches[e];let n={};return t&&(n=t.getAllValue()),n}}class Un{constructor(e,t,n,i){this._runtime=e,this._appkey=t,this._userId=n,this._canJoinMulipleChrm=i,this._sessionKey=\"\",this._joinedChrmsInfo={},this._sessionKey=`sync-chrm-${this._appkey}-${this._userId}`}set(e,t=10){!this._canJoinMulipleChrm&&(this._joinedChrmsInfo={}),this._joinedChrmsInfo[e]=t,this._runtime.sessionStorage.setItem(this._sessionKey,JSON.stringify(this._joinedChrmsInfo))}get(){let e;try{e=this._runtime.sessionStorage.getItem(this._sessionKey)}catch(t){P.error(\"parse rejoined chrm infos error\",t),e={}}return e}remove(e){delete this._joinedChrmsInfo[e],m(this._joinedChrmsInfo)?this._runtime.sessionStorage.setItem(this._sessionKey,JSON.stringify(this._joinedChrmsInfo)):this.clear()}clear(){this._joinedChrmsInfo={},this._runtime.sessionStorage.removeItem(this._sessionKey)}}class Pn{constructor(){this._map={}}on(e,t){const n=this._map[e]||(this._map[e]=[]);n.includes(t)||n.push(t)}off(e,t){const n=this._map[e];if(!n)return;const i=n.length;for(let s=i-1;s>=0;s-=1)if(n[s]===t){n.splice(s,1),1===i&&delete this._map[e];break}}emit(e,t){const n=this._map[e];n&&n.forEach((e=>e(t)))}removeAll(e){delete this._map[e]}clear(){Object.keys(this._map).forEach(this.removeAll,this)}}const Ln=\"converStatusChanged\";class Dn{constructor(e,t,n){this._eventEmitter=new Pn,this._pullQueue=[],this._isPulling=!1,this._storage=S(e.runtime),this._appkey=t,this._currentUserId=n,this._engine=e,this._storagePullTimeKey=`con-s-${t}-${n}`}_set(e){if(E(e))return;let t=this._storage.get(this._storagePullTimeKey)||0;const n=e.length;e.forEach(((e,i)=>{const s=e.updatedTime||0;t=s>t?s:t,e.conversationType=e.type,this._eventEmitter.emit(Ln,{statusItem:e,isLastPull:i===n-1})})),this._storage.set(this._storagePullTimeKey,t)}_startPull(){return $(this,void 0,void 0,(function*(){if(this._isPulling||0===this._pullQueue.length)return;this._isPulling=!0;const e=this._pullQueue.splice(0,1)[0],{code:t,data:n}=yield this._engine.pullConversationStatus(e);t===s.SUCCESS?(this._isPulling=!1,this._set(n),this._startPull()):this._startPull()}))}pull(e){const t=this._storage.get(this._storagePullTimeKey)||0;(e>t||0===e)&&(this._pullQueue.push(t),this._startPull())}watch(e){this._eventEmitter.on(Ln,(t=>{e(t)}))}unwatch(){this._eventEmitter.off(Ln,(e=>{}))}}const xn={c:{keyName:\"unreadMessageCount\",defaultVal:0},hm:{keyName:\"hasMentioned\",defaultVal:!1},m:{keyName:\"mentionedInfo\",defaultVal:null},t:{keyName:\"lastUnreadTime\",defaultVal:0},nc:{keyName:\"notificationStatus\",defaultVal:2},to:{keyName:\"isTop\",defaultVal:!1}},Vn={};for(const e in xn){const t=xn[e].keyName;Vn[t]=e}class kn{constructor(e,t,n){this._appkey=t,this._currentUserId=n;const i=`con-${t}-${n}`;this.storage=new N(e,i)}_getStoreKey(e,t){return`${e}_${t}`}_getConOptionByKey(e){const t=(e=e||\"\").split(\"_\");return 2===t.length?{conversationType:t[0],targetId:t[1]}:{conversationType:o.PRIVATE,targetId:\"\"}}updateMentionedData(e){const{conversationType:t,targetId:n,messageType:i,isMentioned:s,content:r,senderUserId:a}=e,h=this._getStoreKey(t,n),l=this.storage.get(h)||{},u=Vn.mentionedInfo,c=Vn.hasMentioned;let f=[];const d=(l[u]||{}).userIdList||[];let g=r.mentionedInfo;if(s&&t===o.GROUP&&g.userIdList){const e=g.userIdList,t=d.indexOf(a)<0;e.forEach((e=>{e===this._currentUserId&&t&&d.push(a)})),g.type===ft.ALL&&t&&d.push(a),f=d}if(i===gt.RECALL&&t===o.GROUP){const e=d;d.forEach(((t,n)=>{t===a&&e.splice(n,1)})),f=e}g={userIdList:f,type:null==g?void 0:g.type},0!==f.length?(l[u]=g,l[c]=!0):(delete l[u],delete l[c]),m(l)?this.storage.set(h,l):this.storage.remove(h)}set(e,t,n){const i=this._getStoreKey(e,t),s=this.storage.get(i)||{};for(const e in n){const t=Vn[e],i=n[e];if(E(t)||E(i)||\"hasMentioned\"===e||\"MentionedInfo\"===e)continue;i===xn[t].defaultVal?delete s[t]:s[t]=i,s.c||delete s.t}m(s)?this.storage.set(i,s):this.storage.remove(i)}get(e,t){const n=this._getStoreKey(e,t),i=this.storage.get(n)||{},s={};for(const e in xn){const{keyName:t,defaultVal:n}=xn[e];s[t]=i[e]||n}return s}getValue(e){const t=this.storage.getValues()||{},n=[];for(const i in t){const{conversationType:s,targetId:r}=this._getConOptionByKey(i);let o={};const a=t[i];for(const e in a){const{keyName:t,defaultVal:n}=xn[e];o[t]=a[e]||n}o=Object.assign(o,{conversationType:s,targetId:r}),o=e?e(o):o,n.push(o)}return n}}const Bn=[o.PRIVATE,o.GROUP,o.SYSTEM],Fn=\"conversationChanged\";class Yn{constructor(e,t,n,i){this._updatedConversations={},this._eventEmitter=new Pn,this._draftMap={},this._appkey=t,this._loginUserId=n,this._store=new kn(e.runtime,t,n),this._statusManager=new Dn(e,t,n),this._statusManager.watch((e=>{const{statusItem:t,isLastPull:n}=e;this.addStatus(t,n)})),this._eventEmitter.on(Fn,(e=>{i(e)}))}_calcUnreadCount(e,t){const{content:n,messageType:i,sentTime:s,isCounted:r,messageDirection:o,senderUserId:a}=e,h=o===Ht.SEND&&a===this._loginUserId,l=i===gt.RECALL,u=d(n);let c=!1;const f=t.lastUnreadTime||0,g=t.unreadMessageCount||0;if(f>s||h)return{hasChanged:c,localConversation:t};if(r&&(t.unreadMessageCount=g+1,t.lastUnreadTime=s,c=!0),l&&u){f>=n.sentTime&&g&&(t.unreadMessageCount=g-1,c=!0)}return{hasChanged:c,localConversation:t}}_calcMentionedInfo(e,t){const{content:n,messageDirection:i,isMentioned:s}=e,r=(Ht.SEND,d(n));let o=!1;return s&&r&&n.mentionedInfo&&(t.hasMentioned=!0,t.mentionedInfo=n.mentionedInfo,o=!0),{hasChanged:o,localConversation:t}}_setUpdatedConversation(e){if(d(e)){const{conversationType:t,targetId:n}=e,i=`${t}_${n}`,s=this._store.get(t,n)||{};this._updatedConversations[i]=Object.assign(s,e)}}addStatus(e,t){const{conversationType:n,targetId:i,updatedTime:s,notificationStatus:r,isTop:o}=e,a={};E(r)||(a.notificationStatus={time:s,val:r}),E(o)||(a.isTop={time:s,val:o}),this._store.set(n,i,{notificationStatus:r,isTop:o}),this._setUpdatedConversation({conversationType:n,targetId:i,updatedItems:a}),t&&this._notifyConversationChanged()}_notifyConversationChanged(){const e=[];for(const t in this._updatedConversations)e.push(this._updatedConversations[t]);this._eventEmitter.emit(Fn,e),this._updatedConversations={}}setConversationCacheByMessage(e,t){const{conversationType:n,isPersited:i,targetId:s}=e;if(!(Bn.indexOf(n)>=0))return;let r=!1,o=this._store.get(n,s);if([this._calcUnreadCount,this._calcMentionedInfo].forEach((t=>{const{hasChanged:n,localConversation:i}=t.call(this,e,o);r=r||n,o=i})),r&&this._store.set(n,s,o),this._store.updateMentionedData(e),i){const t=this._store.get(n,s);t.updatedItems={latestMessage:{time:e.sentTime,val:e}},t.latestMessage=e;const i=Object.assign(t,{conversationType:n,targetId:s});this._setUpdatedConversation(i)}t&&this._notifyConversationChanged()}get(e,t){return this._store.get(e,t)}getAllUnreadCount(){const e=this._store.getValue();let t=0;return e.forEach((({unreadMessageCount:e})=>{e=e||0,t+=Number(e)})),t}getUnreadCount(e,t){return this._store.get(e,t).unreadMessageCount||0}clearUnreadCount(e,t){const n=this._store.get(e,t),{unreadMessageCount:i,hasMentioned:s}=n;(i||s)&&(n.unreadMessageCount=0,n.hasMentioned=!1),this._store.set(e,t,n);const r=Object.assign(n,{conversationType:e,targetId:t});this._setUpdatedConversation(r),this._notifyConversationChanged()}startPullConversationStatus(e){this._statusManager.pull(e)}setDraft(e,t,n){const i=`${e}_${t}`;this._draftMap[i]=n}getDraft(e,t){const n=`${e}_${t}`;return this._draftMap[n]}clearDraft(e,t){const n=`${e}_${t}`;delete this._draftMap[n]}}const qn=(e,n,i,s,r,o)=>({conversationType:e,targetId:n,senderUserId:o,messageDirection:Ht.SEND,isCounted:!!i.isCounted,isMentioned:!!i.isMentioned,content:i.content,messageType:i.messageType,isOffLineMessage:!1,isPersited:!!i.isPersited,messageUId:s,sentTime:r,receivedTime:0,disableNotification:!!i.disableNotification,isStatusMessage:!!i.isStatusMessage,canIncludeExpansion:!!i.canIncludeExpansion,expansion:i.canIncludeExpansion?i.expansion:null,receivedStatus:t.UNREAD});class Hn extends wn{constructor(e,t,n,i){super(e,t,n,i),this._customMessageType={},this._pullingMsg=!1,this._pullQueue=[],this._chrmsQueue={},this._letterbox=new On(e,t),this._chrmEntryHandler=new An(this)}connect(e,t,n){return $(this,void 0,void 0,(function*(){const i=[];this._naviInfo=t,t.server?i.push(t.server):P.warn(\"navi.server is invalid\");const r=t.backupServer;if(r&&r.split(\",\").forEach((e=>{i.indexOf(e)<0&&i.push(e)})),0===i.length)return P.error(\"navi invaild.\",i),s.UNKNOWN;const o=this.runtime.createDataChannel({status:n=>{this._connectionStatusHandler(n,e,i,t.protocol)},signal:this._signalHandler.bind(this)},n),a=yield o.connect(this._appkey,e,i,t.protocol,this._apiVersion);return a===s.SUCCESS?(this._channel=o,this.currentUserId=o.userId,this.connectedTime=o.connectedTime,this._conversationManager=new Yn(this,this._appkey,this.currentUserId,this._watcher.conversation),this._conversationManager.startPullConversationStatus(0),this._joinedChrmManager=new Un(this.runtime,this._appkey,this.currentUserId,t.joinMChrm),this._syncMsg()):o.close(),a}))}_connectionStatusHandler(e,t,n,i){if(P.warn(\"connection status changed:\",e),e!==gn.CONNECTING&&e!==gn.CONNECTED){if(this._channel&&e!==gn.DISCONNECTED)return e===gn.BLOCKED||e===gn.KICKED_OFFLINE_BY_OTHER_CLIENT?(this.disconnect(),void this._watcher.status(e)):void this._try2Reconnect(t,n,i);this._watcher.status(e)}else this._watcher.status(e)}_try2Reconnect(e,t,n){return $(this,void 0,void 0,(function*(){if(!this._channel)return;(yield this._channel.connect(this._appkey,e,t,n,this._apiVersion))!==s.SUCCESS?(this._watcher.status(gn.WEBSOCKET_UNAVAILABLE),setTimeout((()=>{this._try2Reconnect(e,t,n)}),5e3)):this._rejoinChrm()}))}_signalHandler(e,t){const{syncMsg:n,topic:i}=e;if(n)return void this._receiveSyncMsg(e,t);const s=pn[i];if(s)switch(s){case pn.s_ntf:this._pullMsg(e);break;case pn.s_msg:this._receiveMsg(e);break;case pn.s_cmd:this._receiveStateNotify(e);break;case pn.s_us:this._receiveSettingNotify(e)}else P.error(\"unknown topic:\",i)}_receiveStateNotify(e){var t;const{time:n,type:i,chrmId:s}=null===(t=this._channel)||void 0===t?void 0:t.codec.decodeByPBName(e.data,le);switch(i){case 2:P.warn(\"server notify chrm:\",s,n),this._chrmEntryHandler.pullEntry(s,n);break;case 3:this._conversationManager.startPullConversationStatus(n)}}_receiveSettingNotify(e){}_receiveMessageExpansion(e){const{content:t}=e,{put:n,del:i,mid:s}=t;n&&this._watcher.expansion({updatedExpansion:{messageUId:s,expansion:n}}),i&&this._watcher.expansion({deletedExpansion:{messageUId:s,deletedKeys:i}})}_receiveSyncMsg(e,t){var n;let i=null===(n=this._channel)||void 0===n?void 0:n.codec.decodeByPBName(e.data,ne,{currentUserId:this.currentUserId,signal:e});i=this._handleMsgProperties(i),i.sentTime=t.timestamp,i.messageUId=t.messageUId,this._pullingMsg?this._pullQueue.push(t.timestamp):(this._letterbox.setOutboxTime(t.timestamp,this.currentUserId),i.messageType!==gt.EXPANSION_NOTIFY?(this._watcher.message(i),this._conversationManager.setConversationCacheByMessage(i,!0)):this._receiveMessageExpansion(i))}_pullMsg(e){if(!this._channel)return;const{type:t,chrmId:n,time:i}=this._channel.codec.decodeByPBName(e.data,le);if(2===t){this._chrmsQueue[n].queue.push(i),this._pullChrmMsg(n)}else this._pullQueue.push(i),this._syncMsg()}_syncMsg(){return $(this,void 0,void 0,(function*(){if(this._pullingMsg)return;if(!this._channel)return void(this._pullingMsg=!1);this._pullingMsg=!0;const e=this._letterbox.getOutboxTime(this.currentUserId),t=this._letterbox.getInboxTime(this.currentUserId);P.warn(\"outboxTime\",e),P.warn(\"inboxTime\",t);const n=this._channel.codec.encodeSyncMsg({sendboxTime:e,inboxTime:t}),i=new on(pn[pn.pullMsg],n,this.currentUserId),{code:r,data:o}=yield this._channel.send(i,se,{connectedTime:this._channel.connectedTime,currentUserId:this.currentUserId});if(r!==s.SUCCESS||!o)return P.warn(\"Pull msg failed, code:\",r,\", data: \",o),void(this._pullingMsg=!1);const{list:a,finished:h,syncTime:l}=o;let u=0;a.forEach((e=>{e.messageDirection===Ht.SEND&&(u=Math.max(e.sentTime,u)),e.messageType!==gt.EXPANSION_NOTIFY?(this._watcher.message(e),this._conversationManager.setConversationCacheByMessage(e,!0)):this._receiveMessageExpansion(e)})),this._letterbox.setInboxTime(l,this.currentUserId),this._letterbox.setOutboxTime(u,this.currentUserId),this._pullingMsg=!1;const c=this._pullQueue.filter((e=>e>l));this._pullQueue.length=0,this._pullQueue.push(...c),(!h||c.length>0)&&this._syncMsg()}))}_receiveMsg(e){if(!this._channel)return;let t=this._channel.codec.decodeByPBName(e.data,ie,{currentUserId:this.currentUserId,connectedTime:this._channel.connectedTime});t=this._handleMsgProperties(t),this._pullingMsg||(this._letterbox.setInboxTime(t.sentTime,this.currentUserId),t.messageType!==gt.EXPANSION_NOTIFY?(this._watcher.message(t),this._conversationManager.setConversationCacheByMessage(t,!0)):this._receiveMessageExpansion(t))}_handleMsgProperties(e,t=!1){const{messageType:n,isCounted:i,isPersited:s,isStatusMessage:r}=e;let o;const a=n in I,h=n in this._customMessageType;return o=a?I[n]:h?this._customMessageType[n]:{isCounted:!_(i)&&i,isPersited:!_(s)&&s},Object.assign(e,{isCounted:o.isCounted,isPersited:o.isPersited,isStatusMessage:!(e.isCounted&&e.isPersited)}),t&&(e.isStatusMessage=r),e}getConnectTime(){return this._channel?Promise.resolve({code:s.SUCCESS,data:this._channel.connectedTime}):Promise.resolve({code:s.RC_NET_CHANNEL_INVALID})}getHistoryMessage(e,t,n,i,r){return $(this,void 0,void 0,(function*(){const{currentUserId:o,_channel:a}=this,h=xt[e]||Mt;if(a){const e=a.codec.encodeGetHistoryMsg(t,{timestamp:n,count:i,order:r}),l=yield a.send(new on(h,e,o),ce,{currentUserId:o,connectedTime:a.connectedTime,conversation:{targetId:t}}),{code:u}=l;if(u!==s.SUCCESS)return{code:u};const c=l.data;return{code:u,data:{list:c.list,hasMore:c.hasMore}}}return{code:s.RC_NET_CHANNEL_INVALID}}))}deleteRemoteMessage(e,t,n){return $(this,void 0,void 0,(function*(){const{currentUserId:i,_channel:r}=this;if(r){const o=r.codec.encodeDeleteMessages(e,t,n),a=new on(Tt,o,i),h=yield r.send(a),{code:l}=h;return s.SUCCESS,l}return s.RC_NET_CHANNEL_INVALID}))}deleteRemoteMessageByTimestamp(e,t,n){return $(this,void 0,void 0,(function*(){const{currentUserId:i,_channel:r}=this;if(r){const o=r.codec.encodeClearMessages(t,n),a=new on(Vt[e],o,i),h=yield r.send(a),{code:l}=h;return s.SUCCESS,l}return s.RC_NET_CHANNEL_INVALID}))}getConversationList(e=300,t,n,i){return $(this,void 0,void 0,(function*(){const{currentUserId:r,_channel:a}=this;if(t=t||o.PRIVATE,a){const o=a.codec.encodeOldConversationList({count:e,type:t,startTime:n,order:i}),h=new on(wt,o,r),l=yield a.send(h,de,{currentUserId:r,connectedTime:a.connectedTime,afterDecode:e=>{const{conversationType:t,targetId:n}=e,i=this._conversationManager.get(t,n);return Object.assign(e,i),e}});P.info(\"GetConversationList =>\",l);const{code:u,data:c}=l;return u!==s.SUCCESS?{code:u}:{code:u,data:c}}return{code:s.RC_NET_CHANNEL_INVALID}}))}removeConversation(e,t){return $(this,void 0,void 0,(function*(){const{_channel:n}=this;if(n){const i=n.codec.encodeOldConversationList({type:e}),r=new on(Nt,i,t),o=yield n.send(r);P.info(\"RemoveConversation =>\",o);const{code:a}=o;return s.SUCCESS,a}return s.RC_NET_CHANNEL_INVALID}))}getConversation(e,t){throw new Error(\"Method not implemented.\")}getAllConversationUnreadCount(){const e=this._conversationManager.getAllUnreadCount();return Promise.resolve({code:s.SUCCESS,data:e})}getConversationUnreadCount(e,t){const n=this._conversationManager.getUnreadCount(e,t);return Promise.resolve({code:s.SUCCESS,data:n})}clearConversationUnreadCount(e,t){return this._conversationManager.clearUnreadCount(e,t),Promise.resolve(s.SUCCESS)}saveConversationMessageDraft(e,t,n){return this._conversationManager.setDraft(e,t,n),Promise.resolve(s.SUCCESS)}getConversationMessageDraft(e,t){const n=this._conversationManager.getDraft(e,t);return Promise.resolve({code:s.SUCCESS,data:n})}clearConversationMessageDraft(e,t){return this._conversationManager.clearDraft(e,t),Promise.resolve(s.SUCCESS)}pullConversationStatus(e){return $(this,void 0,void 0,(function*(){const{_channel:t,currentUserId:n}=this;if(t){const i=t.codec.encodeGetConversationStatus(e),r=new on(pn[pn.pullSeAtts],i,n),o=yield t.send(r,Je),{code:a,data:h}=o;return a!==s.SUCCESS?{code:a}:{code:a,data:h}}return{code:s.RC_NET_CHANNEL_INVALID}}))}batchSetConversationStatus(e){return $(this,void 0,void 0,(function*(){const{currentUserId:t,_channel:n}=this;if(n){const i=n.codec.encodeSetConversationStatus(e),r=new on(Ot,i,t),o=yield n.send(r,nt),{code:a,data:h}=o;if(a===s.SUCCESS){const t=h;return e.forEach((e=>{this._conversationManager.addStatus(Object.assign(Object.assign({},e),{updatedTime:t.version}),!0)})),a}return a}return s.RC_NET_CHANNEL_INVALID}))}_joinChrm(e,t,n){return $(this,void 0,void 0,(function*(){const{_channel:i}=this;if(!i)return s.RC_NET_CHANNEL_INVALID;const r=i.codec.encodeJoinOrQuitChatRoom(),o=new on(n?Ct:Rt,r,e),{code:a,data:h}=yield i.send(o);if(a===s.SUCCESS){this._chrmsQueue[e]||(this._chrmsQueue[e]={pulling:!1,queue:[],timestamp:0}),this._pullChrmMsg(e,t);const{kvStorage:n}=this._naviInfo;n&&this._chrmEntryHandler.pullEntry(e,0),this._joinedChrmManager.set(e,t)}return a}))}_rejoinChrm(){return $(this,void 0,void 0,(function*(){const e=this._joinedChrmManager.get();for(const t in e){const n=yield this._joinChrm(t,e[t],!0);n===s.SUCCESS?this._watcher.chatroom({rejoinedRoom:{chatroomId:t,count:e[t]}}):this._watcher.chatroom({rejoinedRoom:{chatroomId:t,errorCode:n}})}}))}_pullChrmMsg(e,t=10){return $(this,void 0,void 0,(function*(){if(!this._channel)return;const n=this._chrmsQueue[e],{pulling:i,timestamp:r}=n;if(i)return;const o=this._channel.codec.encodeChrmSyncMsg(r,t),a=new on(pn[pn.chrmPull],o,e),{code:h,data:l}=yield this._channel.send(a,se,{connectedTime:this._channel.connectedTime,currentUserId:this.currentUserId});if(h!==s.SUCCESS||!l)return void P.warn(\"pull chatroom msg failed, code:\",h,\", data:\",l);const{list:u,syncTime:c,finished:f}=l;n.timestamp=c,n.pulling=!1,n.queue=n.queue.filter((e=>e>r)),u.forEach((e=>{e.sentTime<r||this._watcher.message(e)})),(!f||n.queue.length>0)&&this._pullChrmMsg(e)}))}joinChatroom(e,t){return $(this,void 0,void 0,(function*(){return this._joinChrm(e,t,!1)}))}joinExistChatroom(e,t){return $(this,void 0,void 0,(function*(){return this._joinChrm(e,t,!0)}))}quitChatroom(e){return $(this,void 0,void 0,(function*(){const{_channel:t}=this;if(!t)return s.RC_NET_CHANNEL_INVALID;const n=t.codec.encodeJoinOrQuitChatRoom(),i=new on(It,n,e),r=yield t.send(i),{code:o}=r;return o===s.SUCCESS&&(delete this._chrmsQueue[e],this._chrmEntryHandler.reset(e),this._joinedChrmManager.remove(e)),o}))}getChatroomInfo(e,t,n){return $(this,void 0,void 0,(function*(){const{_channel:i}=this;if(!i)return{code:s.RC_NET_CHANNEL_INVALID};const r=i.codec.encodeGetChatRoomInfo(t,n),o=new on(pn[pn.queryChrmI],r,e),a=yield i.send(o,Ie),{code:h,data:l}=a;return h!==s.SUCCESS?{code:h}:{code:h,data:l}}))}getChatroomHistoryMessages(e,t,n,i){return $(this,void 0,void 0,(function*(){const{_channel:r}=this;if(!r)return{code:s.RC_NET_CHANNEL_INVALID};const o=r.codec.encodeGetHistoryMsg(e,{timestamp:t,count:n,order:i}),a=new on(Ut,o,e),h=yield r.send(a,ce,{conversation:{targetId:e}}),{code:l}=h,u=h.data;return l!==s.SUCCESS?{code:l}:{code:l,data:{list:u.list,hasMore:u.hasMore}}}))}_modifyChatroomKV(e,t){return $(this,void 0,void 0,(function*(){const{_channel:n,currentUserId:i}=this;if(!n)return s.RC_NET_CHANNEL_INVALID;const r=n.codec.encodeModifyChatRoomKV(e,t,i),o=t.type===G.UPDATE?vt:St,a=new on(o,r,e),h=yield n.send(a),{code:l}=h;return l===s.SUCCESS?(this._chrmEntryHandler.setLocal(e,{kvEntries:[t],syncTime:(new Date).getTime()},i),l):l}))}setChatroomEntry(e,t){return $(this,void 0,void 0,(function*(){return t.type=G.UPDATE,this._modifyChatroomKV(e,t)}))}forceSetChatroomEntry(e,t){return $(this,void 0,void 0,(function*(){return t.type=G.UPDATE,t.isOverwrite=!0,this._modifyChatroomKV(e,t)}))}removeChatroomEntry(e,t){return $(this,void 0,void 0,(function*(){return t.type=G.DELETE,this._modifyChatroomKV(e,t)}))}forceRemoveChatroomEntry(e,t){return $(this,void 0,void 0,(function*(){return t.type=G.DELETE,t.isOverwrite=!0,this._modifyChatroomKV(e,t)}))}getChatroomEntry(e,t){const n=this._chrmEntryHandler.getValue(e,t);return n?Promise.resolve({code:s.SUCCESS,data:n}):Promise.resolve({code:s.CHATROOM_KEY_NOT_EXIST})}getAllChatroomEntry(e){const t=this._chrmEntryHandler.getAll(e);return Promise.resolve({code:s.SUCCESS,data:t})}pullChatroomEntry(e,t){return $(this,void 0,void 0,(function*(){const{_channel:n,currentUserId:i}=this;if(!n)return{code:s.RC_NET_CHANNEL_INVALID};const r=n.codec.encodePullChatRoomKV(t),o=new on(pn[pn.pullKV],r,e),a=yield n.send(o,Ke),{code:h,data:l}=a;if(h===s.SUCCESS){this._chrmEntryHandler.setLocal(e,l,i);const{kvEntries:t}=l,n=[];return t.length>0&&(t.forEach((t=>{const{key:i,value:s,type:r,timestamp:o}=t;n.push({key:i,value:s,type:r,timestamp:o,chatroomId:e})})),this._watcher.chatroom({updatedEntries:n})),{code:h,data:l}}return{code:h}}))}sendMessage(e,t,n){return $(this,void 0,void 0,(function*(){if(!this._channel)return{code:s.RC_NET_CHANNEL_INVALID};n=this._handleMsgProperties(n,!0);const i=!![o.PRIVATE,o.GROUP].includes(e)&&n.isStatusMessage,r=i?(a=e,{[o.PRIVATE]:pn.ppMsgS,[o.GROUP]:pn.pgMsgS}[a]):(e=>({[o.PRIVATE]:pn.ppMsgP,[o.GROUP]:pn.pgMsgP,[o.CHATROOM]:pn.chatMsg,[o.CUSTOMER_SERVICE]:pn.pcMsgP,[o.RTC_ROOM]:pn.prMsgS}[e]))(e)||pn.ppMsgP;var a;const h=this._channel.codec.encodeUpMsg({type:e,targetId:t},n),l=new nn(pn[r],h,t);if(l.setHeaderQos(W.AT_LEAST_ONCE),i)return this._channel.sendOnly(l),{code:s.SUCCESS,data:qn(e,t,Object.assign({},n),\"\",0,this.currentUserId)};const{code:u,data:c}=yield this._channel.send(l);if(u!==s.SUCCESS)return{code:u};const f=c;this._letterbox.setOutboxTime(f.timestamp,this.currentUserId);const d=qn(e,t,Object.assign({},n),f.messageUId,f.timestamp,this.currentUserId);return this._conversationManager.setConversationCacheByMessage(d,!0),{code:s.SUCCESS,data:d}}))}recallMsg(e,t,n,i,r){return $(this,void 0,void 0,(function*(){if(!this._channel)return{code:s.RC_NET_CHANNEL_INVALID};const o={content:{conversationType:e,targetId:t,messageUId:n,sentTime:i,user:r},messageType:\"RC:RcCmd\"},a=pn[pn.recallMsg],h=this._channel.codec.encodeUpMsg({type:e,targetId:t},o),l=new nn(a,h,this.currentUserId);l.setHeaderQos(W.AT_LEAST_ONCE);const{code:u,data:c}=yield this._channel.send(l);if(u!==s.SUCCESS)return{code:u};const f=c;return{code:s.SUCCESS,data:qn(e,t,Object.assign({},o),f.messageUId,f.timestamp,this.currentUserId)}}))}pullUserSettings(e){return $(this,void 0,void 0,(function*(){if(!this._channel)return{code:s.RC_NET_CHANNEL_INVALID};const t=this._channel.codec.encodePullUserSetting(e),n=new on(pn[pn.pullUS],t,this.currentUserId);return this._channel.send(n,ze)}))}getFileToken(e,t){return $(this,void 0,void 0,(function*(){if(!this._channel)return{code:s.RC_NET_CHANNEL_INVALID};const n=q(e,t),i=this._channel.codec.encodeGetFileToken(e,n),r=new on(pn[pn.qnTkn],i,this.currentUserId),{code:o,data:a}=yield this._channel.send(r,Ye);return o===s.SUCCESS?{code:o,data:a}:{code:o}}))}getFileUrl(e,t,n){return $(this,void 0,void 0,(function*(){if(!this._channel)return{code:s.RC_NET_CHANNEL_INVALID};const i=this._channel.codec.encodeGetFileUrl(e,t,n),r=new on(pn[pn.qnUrl],i,this.currentUserId),{code:o,data:a}=yield this._channel.send(r,He),h=a;return o===s.SUCCESS?{code:o,data:h}:{code:o}}))}disconnect(){this._channel&&(this._channel.close(),this._channel=void 0)}destroy(){throw new Error(\"JSEngine's method not implemented.\")}registerMessageType(e,t,n,i){this._customMessageType[e]={isPersited:t,isCounted:n}}joinRTCRoom(e,t,n){return $(this,void 0,void 0,(function*(){if(!this._channel)return{code:s.RC_NET_CHANNEL_INVALID};const i=this._channel.codec.encodeJoinRTCRoom(t,n),r=new on(pn[pn.rtcRJoin_data],i,e);return this._channel.send(r,Se)}))}quitRTCRoom(e){return $(this,void 0,void 0,(function*(){if(!this._channel)return s.RC_NET_CHANNEL_INVALID;const t=this._channel.codec.encodeQuitRTCRoom(),n=new on(pn[pn.rtcRExit],t,e),{code:i}=yield this._channel.send(n);return i}))}rtcPing(e,t,n){return $(this,void 0,void 0,(function*(){if(!this._channel)return s.RC_NET_CHANNEL_INVALID;const i=this._channel.codec.encodeJoinRTCRoom(t,n),r=new on(pn[pn.rtcPing],i,e),{code:o}=yield this._channel.send(r);return o}))}getRTCRoomInfo(e){return $(this,void 0,void 0,(function*(){if(!this._channel)return{code:s.RC_NET_CHANNEL_INVALID};const t=this._channel.codec.encodeGetRTCRoomInfo(),n=new on(pn[pn.rtcRInfo],t,e);return this._channel.send(n,Ve)}))}getRTCUserInfoList(e){return $(this,void 0,void 0,(function*(){if(!this._channel)return{code:s.RC_NET_CHANNEL_INVALID};const t=this._channel.codec.encodeGetRTCRoomInfo(),n=new on(pn[pn.rtcUData],t,e),{code:i,data:r}=yield this._channel.send(n,Se);return{code:i,data:r?{users:r.users}:r}}))}setRTCUserInfo(e,t,n){return $(this,void 0,void 0,(function*(){if(!this._channel)return s.RC_NET_CHANNEL_INVALID;const i=this._channel.codec.encodeSetRTCUserInfo(t,n),r=new on(pn[pn.rtcUPut],i,e),{code:o}=yield this._channel.send(r);return o}))}removeRTCUserInfo(e,t){return $(this,void 0,void 0,(function*(){if(!this._channel)return s.RC_NET_CHANNEL_INVALID;const n=this._channel.codec.encodeRemoveRTCUserInfo(t),i=new nn(pn[pn.rtcUDel],n,e),{code:r}=yield this._channel.send(i);return r}))}setRTCData(e,t,n,i,r,o){return $(this,void 0,void 0,(function*(){if(!this._channel)return s.RC_NET_CHANNEL_INVALID;const a=this._channel.codec.encodeSetRTCData(t,n,i,r,o),h=new nn(pn[pn.rtcSetData],a,e),{code:l}=yield this._channel.send(h);return l}))}setRTCTotalRes(e,t,n,i){return $(this,void 0,void 0,(function*(){if(!this._channel)return s.RC_NET_CHANNEL_INVALID;const r=this._channel.codec.encodeUserSetRTCData(t,n,i),o=new nn(pn[pn.userSetData],r,e),{code:a}=yield this._channel.send(o);return a}))}getRTCData(e,t,n,i){if(!this._channel)return Promise.resolve({code:s.RC_NET_CHANNEL_INVALID});const r=this._channel.codec.encodeGetRTCData(t,n,i),o=new on(pn[pn.rtcQryData],r,e);return this._channel.send(o,Pe)}removeRTCData(e,t,n,i,r){return $(this,void 0,void 0,(function*(){if(!this._channel)return s.RC_NET_CHANNEL_INVALID;const o=this._channel.codec.encodeRemoveRTCData(t,n,i,r),a=new nn(pn[pn.rtcDelData],o,e),{code:h}=yield this._channel.send(a);return h}))}setRTCOutData(e,t,n,i){throw new Error(\"JSEngine's method not implemented.\")}getRTCOutData(e,t){throw new Error(\"JSEngine's method not implemented.\")}getRTCToken(e,t,n){return $(this,void 0,void 0,(function*(){if(!this._channel)return{code:s.RC_NET_CHANNEL_INVALID};const i=this._channel.codec.encodeJoinRTCRoom(t,n),r=new on(pn[pn.rtcToken],i,e);return this._channel.send(r,Ue)}))}setRTCState(e,t){return $(this,void 0,void 0,(function*(){if(!this._channel)return s.RC_NET_CHANNEL_INVALID;const n=this._channel.codec.encodeSetRTCState(t),i=new on(pn[pn.rtcUserState],n,e),{code:r}=yield this._channel.send(i);return r}))}getRTCUserInfo(e){return $(this,void 0,void 0,(function*(){throw new Error(\"Method not implemented.\")}))}getRTCUserList(e){if(!this._channel)return Promise.resolve({code:s.RC_NET_CHANNEL_INVALID});const t=this._channel.codec.encodeGetRTCRoomInfo(),n=new on(pn[pn.rtcUList],t,e);return this._channel.send(n,Se)}}class Gn extends wn{constructor(e,t,n,i,s){super(e,t,n,i),this._cppProtocol=s}connect(e,t){throw new Error(\"Method not implemented.\")}getConnectTime(){throw new Error(\"Method not implemented.\")}getHistoryMessage(e,t,n,i,s){throw new Error(\"Method not implemented.\")}deleteRemoteMessage(e,t,n){throw new Error(\"Method not implemented.\")}recallMsg(e,t,n,i,s){throw new Error(\"Method not implemented.\")}deleteRemoteMessageByTimestamp(e,t,n){throw new Error(\"Method not implemented.\")}getConversationList(e,t,n,i){throw new Error(\"Method not implemented.\")}getConversation(e,t){throw new Error(\"Method not implemented.\")}removeConversation(e,t){throw new Error(\"Method not implemented.\")}getAllConversationUnreadCount(){throw new Error(\"Method not implemented.\")}getConversationUnreadCount(e,t){throw new Error(\"Method not implemented.\")}clearConversationUnreadCount(e,t){throw new Error(\"Method not implemented.\")}saveConversationMessageDraft(e,t,n){throw new Error(\"Method not implemented.\")}getConversationMessageDraft(e,t){throw new Error(\"Method not implemented.\")}clearConversationMessageDraft(e,t){throw new Error(\"Method not implemented.\")}pullConversationStatus(e){throw new Error(\"Method not implemented.\")}batchSetConversationStatus(e){throw new Error(\"Method not implemented.\")}sendMessage(e,t,n){throw new Error(\"Method not implemented.\")}disconnect(){throw new Error(\"Method not implemented.\")}pullUserSettings(e){throw new Error(\"Method not implemented.\")}registerMessageType(e,t,n,i){throw new Error(\"Method not implemented.\")}joinChatroom(e,t){throw new Error(\"Method not implemented.\")}joinExistChatroom(e,t){throw new Error(\"Method not implemented.\")}quitChatroom(e){throw new Error(\"Method not implemented.\")}getChatroomInfo(e,t,n){throw new Error(\"Method not implemented.\")}getChatroomHistoryMessages(e,t,n,i){throw new Error(\"Method not implemented.\")}setChatroomEntry(e,t){throw new Error(\"Method not implemented.\")}forceSetChatroomEntry(e,t){throw new Error(\"Method not implemented.\")}removeChatroomEntry(e,t){throw new Error(\"Method not implemented.\")}forceRemoveChatroomEntry(e,t){throw new Error(\"Method not implemented.\")}getChatroomEntry(e,t){throw new Error(\"Method not implemented.\")}getAllChatroomEntry(e){throw new Error(\"Method not implemented.\")}getFileToken(e,t){throw new Error(\"Method not implemented.\")}getFileUrl(e,t,n){throw new Error(\"Method not implemented.\")}joinRTCRoom(e,t,n){throw new Error(\"Method not implemented.\")}quitRTCRoom(e){throw new Error(\"Method not implemented.\")}rtcPing(e,t,n){throw new Error(\"Method not implemented.\")}getRTCRoomInfo(e){throw new Error(\"Method not implemented.\")}getRTCUserInfoList(e){throw new Error(\"Method not implemented.\")}getRTCUserInfo(e){throw new Error(\"Method not implemented.\")}setRTCUserInfo(e,t,n){throw new Error(\"Method not implemented.\")}removeRTCUserInfo(e,t){throw new Error(\"Method not implemented.\")}setRTCData(e,t,n,i,s,r){throw new Error(\"Method not implemented.\")}setRTCTotalRes(e,t,n,i){throw new Error(\"Method not implemented.\")}getRTCData(e,t,n,i){throw new Error(\"Method not implemented.\")}removeRTCData(e,t,n,i,s){throw new Error(\"Method not implemented.\")}setRTCOutData(e,t,n,i){throw new Error(\"Method not implemented.\")}getRTCOutData(e,t){throw new Error(\"Method not implemented.\")}getRTCToken(e,t,n){throw new Error(\"Method not implemented.\")}setRTCState(e,t){throw new Error(\"Method not implemented.\")}getRTCUserList(e){throw new Error(\"Method not implemented.\")}}var Kn,jn,$n;(Kn=exports.RTCMode||(exports.RTCMode={}))[Kn.RTC=0]=\"RTC\",Kn[Kn.LIVE=2]=\"LIVE\",(jn=exports.LiveType||(exports.LiveType={}))[jn.AUDIO_AND_VIDEO=0]=\"AUDIO_AND_VIDEO\",jn[jn.AUDIO=1]=\"AUDIO\",($n=exports.LiveRole||(exports.LiveRole={}))[$n.ANCHOR=1]=\"ANCHOR\",$n[$n.AUDIENCE=2]=\"AUDIENCE\";const Wn={\"RC:VCAccept\":\"RC:VCAccept\",\"RC:VCRinging\":\"RC:VCRinging\",\"RC:VCSummary\":\"RC:VCSummary\",\"RC:VCHangup\":\"RC:VCHangup\",\"RC:VCInvite\":\"RC:VCInvite\",\"RC:VCModifyMedia\":\"RC:VCModifyMedia\",\"RC:VCModifyMem\":\"RC:VCModifyMem\"};var Qn;(Qn=exports.RTCApiType||(exports.RTCApiType={}))[Qn.ROOM=1]=\"ROOM\",Qn[Qn.PERSON=2]=\"PERSON\";class zn{constructor(e){this._context=e}getCoreVersion(){return this._context.coreVersion}getAPIVersion(){return this._context.apiVersion}getAppkey(){return this._context.appkey}getCurrentId(){return this._context.getCurrentUserId()}getConnectionStatus(){return this._context.getConnectionStatus()}sendMessage(e,t,n){return this._context.sendMessage(e,t,n)}registerMessageType(e,t,n,i=[]){this._context.registerMessageType(e,t,n,i)}}class Zn extends zn{getNaviInfo(){return this._context.getInfoFromCache()}joinRTCRoom(e,t,n){return this._context.joinRTCRoom(e,t,n)}quitRTCRoom(e){return this._context.quitRTCRoom(e)}rtcPing(e,t,n){return this._context.rtcPing(e,t,n)}getRTCRoomInfo(e){return this._context.getRTCRoomInfo(e)}getRTCUserInfoList(e){return this._context.getRTCUserInfoList(e)}getRTCUserInfo(e){return this._context.getRTCUserInfo(e)}setRTCUserInfo(e,t,n){return this._context.setRTCUserInfo(e,t,n)}removeRTCUserInfo(e,t){return this._context.removeRTCUserInfo(e,t)}setRTCData(e,t,n,i,s,r){return this._context.setRTCData(e,t,n,i,s,r)}setRTCTotalRes(e,t,n,i){return this._context.setRTCTotalRes(e,t,n,i)}getRTCData(e,t,n,i){return this._context.getRTCData(e,t,n,i)}removeRTCData(e,t,n,i,s){return this._context.removeRTCData(e,t,n,i,s)}setRTCOutData(e,t,n,i){return this._context.setRTCOutData(e,t,n,i)}getRTCOutData(e,t){return this._context.getRTCOutData(e,t)}getRTCToken(e,t,n){return this._context.getRTCToken(e,t,n)}setRTCState(e,t){return this._context.setRTCState(e,t)}getRTCUserList(e){return this._context.getRTCUserList(e)}}function Jn(e){return Object.assign({},e)}class Xn{constructor(e,t){this._runtime=e,this._token=\"\",this._pluginContextQueue=[],this.coreVersion=\"0.1.0\",this._connectionStatus=gn.DISCONNECTED,this._watcher={message:void 0,conversationState:void 0,chatroomState:void 0,connectionState:void 0,rtcInnerWatcher:void 0,expansion:void 0},this._options=Object.assign({},t),this.appkey=this._options.appkey,this.apiVersion=this._options.apiVersion;const{isEnterPrise:n,appkey:i,miniCMPProxy:s,apiVersion:r,connectionType:o}=this._options;if(\"electron\"===e.tag&&!this._options.cppProtocol){const e=\"cppProtocol is required\";throw P.error(e),new Error(e)}if(n&&0===this._options.navigators.length){const e=\"private navigators is required\";throw P.error(e),new Error(e)}if(this._options.navigators=this._options.navigators.filter((e=>/^https?:\\/\\//.test(e))),0===this._options.navigators.length){if(n){const e=\"navi urls is invalid\";throw P.error(e),new Error(e)}this._options.navigators.push(...T)}this._navi=new Sn(e,i,this._options.navigators,s,r,o);const a={status:this._connectionStatusListener.bind(this),message:this._messageReceiver.bind(this),chatroom:this._chatroomInfoListener.bind(this),conversation:this._conversationInfoListener.bind(this),expansion:this._expansionInfoListener.bind(this)};this._engine=\"electron\"===e.tag?new Gn(e,i,a,r,this._options.cppProtocol):new Hn(e,i,a,r)}static init(e,t){return P.debug(\"APIContext.init =>\",t.appkey,t.navigators),this._context?(P.error(\"Repeat initialize!\"),this._context):(this._context=new Xn(e,t),this._context)}static destroy(){this._context&&(this._context._destroy(),this._context=void 0)}install(e,t){const n=\"RCRTC\"===e.tag?new Zn(this):new zn(this);let i=null;try{if(!e.verify(this._runtime))return null;i=e.setup(n,this._runtime,t)}catch(e){P.error(\"install plugin error!\\n\",e)}return i&&this._pluginContextQueue.push(n),i}_connectionStatusListener(e){var t;this._connectionStatus=e,(null===(t=this._watcher.rtcInnerWatcher)||void 0===t?void 0:t.status)&&this._watcher.rtcInnerWatcher.status(e),this._pluginContextQueue.forEach((t=>{t.onconnectionstatechange&&t.onconnectionstatechange(e)})),this._watcher.connectionState&&this._watcher.connectionState(e)}_messageReceiver(e){(e.conversationType===o.RTC_ROOM||Object.prototype.hasOwnProperty.call(Wn,e.messageType))&&this._watcher.rtcInnerWatcher&&this._watcher.rtcInnerWatcher.message?this._watcher.rtcInnerWatcher.message(Jn(e)):this._pluginContextQueue.some((t=>{if(!t.onmessage)return!1;try{return t.onmessage(Jn(e))}catch(e){return P.error(\"plugin error =>\",e),!1}}))||this._watcher.message&&this._watcher.message(Jn(e))}_chatroomInfoListener(e){this._watcher.chatroomState&&this._watcher.chatroomState(e)}_conversationInfoListener(e){this._watcher.conversationState&&this._watcher.conversationState(e)}_expansionInfoListener(e){this._watcher.expansion&&this._watcher.expansion(e)}assignWatcher(e){Object.keys(this._watcher).forEach((t=>{if(Object.prototype.hasOwnProperty.call(e,t)){const n=e[t];this._watcher[t]=p(n)||d(n)?n:void 0}}))}getConnectedTime(){return this._engine.connectedTime}getCurrentUserId(){return this._engine.currentUserId}getConnectionStatus(){return this._connectionStatus}connect(e,t=!1){return $(this,void 0,void 0,(function*(){if(this._connectionStatus===gn.CONNECTED)return{code:s.SUCCESS,userId:this._engine.currentUserId};if(this._connectionStatus===gn.CONNECTING)return{code:s.BIZ_ERROR_CONNECTING};if(\"string\"!=typeof e||0===e.length)return{code:s.RC_CONN_USER_OR_PASSWD_ERROR};this._token=e;const n=e.split(\"@\"),i=n[1]?n[1].split(\";\").map((e=>/^https?:/.test(e)?e:\"https://\"+e)):[],r=yield this._navi.getInfo(this._getTokenWithoutNavi(),i,t);if(!r)return{code:s.RC_NAVI_RESOURCE_ERROR};const o=yield this._engine.connect(this._getTokenWithoutNavi(),r,this._options.connectionType);return o===s.SUCCESS&&1===r.openUS&&this._pullUserSettings(),{code:o,userId:this._engine.currentUserId}}))}getConnectTime(){return this._engine.getConnectTime()}_pullUserSettings(){return $(this,void 0,void 0,(function*(){}))}disconnect(){return this._engine.disconnect(),this._pluginContextQueue.forEach((e=>{if(e.ondisconnect)try{e.ondisconnect()}catch(e){P.error(\"plugin error =>\",e)}})),Promise.resolve()}reconnect(){return this.connect(this._getTokenWithoutNavi())}_getTokenWithoutNavi(){return this._token.replace(/@.+$/,\"@\")}getInfoFromCache(){return this._navi.getInfoFromCache(this._getTokenWithoutNavi())}registerMessageType(e,t,n,i=[]){this._engine.registerMessageType(e,t,n,i)}sendMessage(e,t,n){return((e,t=\"utf-8\")=>{let n,i=0;if(\"utf-16\"===t)for(let t=0,s=e.length;t<s;t++)n=e.charCodeAt(t),i+=n<=65535?2:4;else for(let t=0,s=e.length;t<s;t++)n=e.charCodeAt(t),i+=n<127?1:n<=2047?2:n<=65535?3:4;return i})(JSON.stringify(n.content))>131072?Promise.resolve({code:s.RC_MSG_CONTENT_EXCEED_LIMIT}):this._engine.sendMessage(e,t,n)}sendExpansionMessage(e){return $(this,void 0,void 0,(function*(){let{conversationType:t,targetId:n,messageUId:i,keys:r,expansion:o,originExpansion:a,removeAll:h,canIncludeExpansion:l}=e;if(!l)return{code:s.MESSAGE_KV_NOT_SUPPORT};let u=!1,c=!1;if(d(o)){a=a||{};const e=Object.keys(o).length,t=Object.assign(a,o);u=Object.keys(t).length>300||e>20;for(const e in o){const t=o[e];u=e.length>32||t.length>64,c=!/^[A-Za-z0-9_=+-]+$/.test(e)}}if(u)return{code:s.EXPANSION_LIMIT_EXCEET};if(c)return{code:s.BIZ_ERROR_INVALID_PARAMETER};const f={mid:i};o&&(f.put=o),r&&(f.del=r),h&&(f.removeAll=1);const{code:g}=yield this._engine.sendMessage(t,n,{content:f,messageType:gt.EXPANSION_NOTIFY});return{code:g}}))}_destroy(){this._watcher={},this._engine.disconnect(),this._pluginContextQueue.forEach((e=>{if(e.ondestroy)try{e.ondestroy()}catch(e){P.error(\"plugin error =>\",e)}})),this._pluginContextQueue.length=0}getHistoryMessage(e,t,n=0,i=20,s=0){return this._engine.getHistoryMessage(e,t,n,i,s)}getConversationList(e=300,t,n,i){return this._engine.getConversationList(e,t,n,i)}removeConversation(e,t){return this._engine.removeConversation(e,t)}clearUnreadCount(e,t){return this._engine.clearConversationUnreadCount(e,t)}getUnreadCount(e,t){return this._engine.getConversationUnreadCount(e,t)}getTotalUnreadCount(){return this._engine.getAllConversationUnreadCount()}setConversationStatus(e,t,n,i){const s=[{conversationType:e,targetId:t,isTop:n,notificationStatus:i}];return this._engine.batchSetConversationStatus(s)}saveConversationMessageDraft(e,t,n){return this._engine.saveConversationMessageDraft(e,t,n)}getConversationMessageDraft(e,t){return this._engine.getConversationMessageDraft(e,t)}clearConversationMessageDraft(e,t){return this._engine.clearConversationMessageDraft(e,t)}recallMessage(e,t,n,i,s){return this._engine.recallMsg(e,t,n,i,s)}deleteRemoteMessage(e,t,n){return this._engine.deleteRemoteMessage(e,t,n)}deleteRemoteMessageByTimestamp(e,t,n){return this._engine.deleteRemoteMessageByTimestamp(e,t,n)}joinChatroom(e,t=10){return this._engine.joinChatroom(e,t)}joinExistChatroom(e,t=10){return this._engine.joinExistChatroom(e,t)}quitChatroom(e){return this._engine.quitChatroom(e)}getChatroomInfo(e,t=0,n=0){return this._engine.getChatroomInfo(e,t,n)}setChatroomEntry(e,t){return this._engine.setChatroomEntry(e,t)}forceSetChatroomEntry(e,t){return this._engine.forceSetChatroomEntry(e,t)}removeChatroomEntry(e,t){return this._engine.removeChatroomEntry(e,t)}forceRemoveChatroomEntry(e,t){return this._engine.forceRemoveChatroomEntry(e,t)}getChatroomEntry(e,t){return this._engine.getChatroomEntry(e,t)}getAllChatroomEntries(e){return this._engine.getAllChatroomEntry(e)}getChatRoomHistoryMessages(e,t=20,n=0,i=0){return this._engine.getChatroomHistoryMessages(e,i,t,n)}getFileToken(e,t){return $(this,void 0,void 0,(function*(){const n=this.getInfoFromCache(),i=(null==n?void 0:n.bosAddr)||\"\",r=(null==n?void 0:n.uploadServer)||\"\",{code:o,data:a}=yield this._engine.getFileToken(e,t);return o===s.SUCCESS?Promise.resolve(Object.assign(a,{bos:i,qiniu:r})):Promise.reject(o)}))}getFileUrl(e,t,n,i){return $(this,void 0,void 0,(function*(){if(null==i?void 0:i.isBosRes)return Promise.resolve(i);const{code:r,data:o}=yield this._engine.getFileUrl(e,t,n);return r===s.SUCCESS?Promise.resolve(o):Promise.reject(r)}))}joinRTCRoom(e,t,n){return this._engine.joinRTCRoom(e,t,n)}quitRTCRoom(e){return this._engine.quitRTCRoom(e)}rtcPing(e,t,n){return this._engine.rtcPing(e,t,n)}getRTCRoomInfo(e){return this._engine.getRTCRoomInfo(e)}getRTCUserInfoList(e){return this._engine.getRTCUserInfoList(e)}getRTCUserInfo(e){return this._engine.getRTCUserInfo(e)}setRTCUserInfo(e,t,n){return this._engine.setRTCUserInfo(e,t,n)}removeRTCUserInfo(e,t){return this._engine.removeRTCUserInfo(e,t)}setRTCData(e,t,n,i,s,r){return this._engine.setRTCData(e,t,n,i,s,r)}setRTCTotalRes(e,t,n,i){return this._engine.setRTCTotalRes(e,t,n,i)}getRTCData(e,t,n,i){return this._engine.getRTCData(e,t,n,i)}removeRTCData(e,t,n,i,s){return this._engine.removeRTCData(e,t,n,i,s)}setRTCOutData(e,t,n,i){return this._engine.setRTCOutData(e,t,n,i)}getRTCOutData(e,t){return this._engine.getRTCOutData(e,t)}getRTCToken(e,t,n){return this._engine.getRTCToken(e,t,n)}setRTCState(e,t){return this._options.isEnterPrise?Promise.resolve(s.SUCCESS):this._engine.setRTCState(e,t)}getRTCUserList(e){return this._engine.getRTCUserList(e)}}exports.APIContext=Xn,exports.AppStorage=N,exports.CallLibMsgType=Wn,exports.CometChannel=class extends Kt{constructor(e,t){super(\"comet\",t),this._runtime=e,this._messageIds={},this._syncMessageIds={},this._idCount=0,this._generateMessageId=()=>++this._idCount,this._pid=encodeURIComponent((new Date).getTime()+Math.random()+\"\")}handleCometRes(e){if(200!==e.status&&202!==e.status)return!1;const t=h(e.data)?JSON.parse(e.data):e.data;return t?!u(t)||(k(t,(e=>$(this,void 0,void 0,(function*(){const{sessionid:t}=e;t&&(this._sessionid=t);const n=(e=>{const t=e.headerCode,n=new J(t),i=ln(n);for(const t in e)i[t]=e[t];return i})(e),{messageId:i,_header:s,status:r,identifier:o}=n,a=s&&s.qos!==W.AT_MOST_ONCE,h=mn(i,o);if(i&&n.getIdentifier){const e=this._messageIds[h];e&&e(n),this._syncMessageIds[h]&&this._syncMessageIds[h](n)}if(a){if(n instanceof tn&&!n.syncMsg){const e=new rn(i);this.sendOnly(e)}if(n instanceof hn){const e=new an(i);this.sendOnly(e)}}if(n instanceof zt){const e=1===r?gn.KICKED_OFFLINE_BY_OTHER_CLIENT:2===r?gn.BLOCKED:r;this._watcher.status(e)}if(n instanceof tn){const{syncMsg:e,topic:t}=n;if(!e||yn(t))return this._watcher.signal(n),!1;const i=yield new Promise((e=>{this._syncMessageIds[h]=e}));delete this._syncMessageIds[h],this._watcher.signal(n,i)}})))),!0):(P.warn(\"received data is not a validJson\",t),!1)}_startPullSignal(e){return $(this,void 0,void 0,(function*(){const t=(new Date).getTime(),n=`${e}://${this._domain}/pullmsg.js?sessionid=${this._sessionid}&timestrap=${t}&pid=${this._pid}`,i=yield this._runtime.httpReq({url:n,body:{pid:this._pid},timeout:45e3}),s=this.handleCometRes(i);this._isDisconnected||(s?this._startPullSignal(e):(this._watcher.status(gn.NETWORK_UNAVAILABLE),this.close()))}))}connect(e,t,n,i,r){return $(this,void 0,void 0,(function*(){r=Kt.matchVersion(r),this._protocol=i,this._isDisconnected=!1,this._watcher.status(gn.CONNECTING);const o=yield En(n,i,this._runtime);if(0===o.length)return P.error(\"No valid websocket server hosts!\"),s.RC_SOCKET_NOT_CREATED;const a=e=>(200===e.status||202===e.status)&&(!!e.data&&((e=>{if(d(e))return!0;let t=!1;try{const n=JSON.parse(e);t=JSON.stringify(n)===e}catch(e){t=!1}return t})(e.data)?d(e.data)?e.data:JSON.parse(e.data):(P.warn(\"received data is not a validJson\",e.data),!1)));for(let n=0,s=o.length;n<s;n+=1){const s=_n(i,o[n],e,t,this._runtime,r,this._pid),h=a(yield this._runtime.httpReq({url:s,body:{pid:this._pid},timeout:5e3}));if(this._domain=o[n],h&&0===h.status)return this._watcher.status(gn.CONNECTED),this._sessionid=h.sessionid,this._startPullSignal(i),this.userId=h.userId,this.connectedTime=h.timestamp,h.status}return s.RC_NET_UNAVAILABLE}))}sendCometData(e,t=3e4){return $(this,void 0,void 0,(function*(){const{_domain:t,_sessionid:n,_pid:i}=this,{messageId:s,topic:r,targetId:o,identifier:a}=e,h=e.getHeaderFlag();let l;l=r?`${this._protocol}://${t}/websocket?messageid=${s}&header=${h}&sessionid=${n}&topic=${r}&targetid=${o}&pid=${i}`:`${this._protocol}://${t}/websocket?messageid=${s}&header=${h}&sessionid=${n}&pid=${i}`;const u=yield this._runtime.httpReq({url:l,method:exports.HttpMethod.POST,body:e.getCometData()});this.handleCometRes(u)}))}sendOnly(e){this.sendCometData(e)}send(e,t,n,i=3e4){return $(this,void 0,void 0,(function*(){const r=this._generateMessageId();e.messageId=r,this.sendCometData(e);const{identifier:o}=e,a=yield new Promise((e=>{const t=mn(r,o);this._messageIds[t]=e,setTimeout((()=>{delete this._messageIds[t],e()}),i)}));if(!a)return{code:s.TIMEOUT};if(0!==a.status)return{code:a.status};const h=t?this.codec.decodeByPBName(a.data,t,n):a;return{code:s.SUCCESS,data:h}}))}close(){this._isDisconnected=!0,this._watcher.status(gn.DISCONNECTED)}},exports.ConnectResultCode=cn,exports.ConnectionStatus=gn,exports.ConversationType=o,exports.DelayTimer=j,exports.ErrorCode=s,exports.FileType=a,exports.Logger=U,exports.MentionedType=ft,exports.MessageDirection=Ht,exports.MessageType=gt,exports.NotificationStatus=pt,exports.PluginContext=zn,exports.RCAssertError=x,exports.RTCPluginContext=Zn,exports.ReceivedStatus=t,exports.WebSocketChannel=class extends Kt{constructor(e,t){super(\"websocket\",t),this._runtime=e,this._socket=null,this._messageIds={},this._syncMessageIds={},this._failedCount=0,this.ALLOW_FAILED_TIMES=4,this._idCount=0,this._generateMessageId=()=>(this._idCount>=65535&&(this._idCount=0),++this._idCount)}connect(e,t,n,i,r){return $(this,void 0,void 0,(function*(){r=Kt.matchVersion(r),this._watcher.status(gn.CONNECTING);const o=yield En(n,i,this._runtime);if(0===o.length)return P.error(\"No valid websocket server hosts!\"),s.RC_SOCKET_NOT_CREATED;const a=i.replace(\"http\",\"ws\");for(let n=0,i=o.length;n<i;n+=1){const i=_n(a,o[n],e,t,this._runtime,r),h=this._runtime.createWebSocket(i),l=e=>{this._socket===h&&(this._socket=null,this._watcher.status(e))},u=yield new Promise((e=>{h.onMessage((t=>{if(\"[object ArrayBuffer]\"!==Object.prototype.toString.call(t))return void P.warn(\"Socket received invalid data:\",t);const n=un(t);if(n instanceof Jt&&this._pingResolve)return this._pingResolve(s.SUCCESS),void(this._pingResolve=void 0);if(P.debug(\"Websocket <==\",n),n instanceof Qt)return n.status!==cn.ACCEPTED?(P.error(\"Websocket connAck status:\",n.status),void e(n.status)):(this.connectedTime=n.timestamp,this.userId=n.userId||\"\",void e(s.SUCCESS));if(n instanceof zt){const{status:e}=n,t=1===e?gn.KICKED_OFFLINE_BY_OTHER_CLIENT:2===e?gn.BLOCKED:e;this._watcher.status(t)}else this._onReceiveSignal(n)})),h.onClose(((t,n)=>{P.warn(\"websocket closed! code:\",t,\"reason:\",n),l(gn.CONNECTION_CLOSED),e(t)})),h.onError((t=>{P.error(\"websocket error!\",t),l(gn.WEBSOCKET_ERROR),e(s.NETWORK_ERROR)})),h.onOpen((()=>P.debug(\"websocket open =>\",i))),setTimeout((()=>{e(s.TIMEOUT)}),5e3)}));if(u===s.SUCCESS)return this._socket=h,this._checkAlive(),this._watcher.status(gn.CONNECTED),u;h.close()}return s.RC_NET_UNAVAILABLE}))}_checkAlive(){var e;return $(this,void 0,void 0,(function*(){if(!this._socket)return;this.sendOnly(new Zt);(yield new Promise((e=>{this._pingResolve=e,setTimeout((()=>{this._pingResolve=void 0,e(s.TIMEOUT)}),3e4)})))!==s.SUCCESS&&++this._failedCount>=this.ALLOW_FAILED_TIMES?null===(e=this._socket)||void 0===e||e.close():(this._failedCount=0,setTimeout((()=>this._checkAlive()),3e4))}))}_onReceiveSignal(e){return $(this,void 0,void 0,(function*(){const{messageId:t,identifier:n}=e;e.header&&e.header.qos!==W.AT_MOST_ONCE&&(e instanceof tn&&!e.syncMsg&&this.sendOnly(new rn(t)),e instanceof hn&&this.sendOnly(new an(t)));const i=mn(t,n);if(t>0){const t=this._messageIds[i];t&&t(e),this._syncMessageIds[i]&&this._syncMessageIds[i](e)}if(e instanceof tn){const{syncMsg:t,topic:n}=e;if(!t||yn(n))return void this._watcher.signal(e);const s=yield new Promise((e=>{this._syncMessageIds[i]=e}));delete this._syncMessageIds[i],this._watcher.signal(e,s)}}))}sendOnly(e){this._socket&&Tn(e,this._socket)}send(e,t,n,i=3e4){return $(this,void 0,void 0,(function*(){if(this._socket){const r=this._generateMessageId();e.messageId=r;const o=e.identifier;Tn(e,this._socket);const a=yield new Promise((e=>{const t=mn(r,o);this._messageIds[t]=e,setTimeout((()=>{delete this._messageIds[t],e()}),i)}));if(!a)return{code:s.TIMEOUT};if(0!==a.status)return{code:a.status};const h=t?this.codec.decodeByPBName(a.data,t,n):a;return{code:s.SUCCESS,data:h}}return{code:s.RC_NET_CHANNEL_INVALID}}))}close(){this._socket&&(this._socket.close(),this._socket=null,this._watcher.status(gn.DISCONNECTED))}},exports.appendUrl=(e,t)=>{if(e=e.replace(/\\?$/,\"\"),!t)return e;const n=Object.keys(t).map((e=>`${e}=${t[e]}`)).filter((e=>!!e));return n.length?[e,n.join(\"&\")].join(\"?\"):e},exports.assert=(e,t,n,i=!1)=>{if(!V(e,t,n,i))throw new x(e+\" is invalid.\")},exports.forEach=k,exports.getUploadFileName=q,exports.indexOf=F,exports.isArray=u,exports.isArrayBuffer=c,exports.isFunction=p,exports.isHttpUrl=e=>h(e)&&/https?:\\/\\//.test(e),exports.isInObject=Y,exports.isInclude=(e,t)=>-1!==F(e,t),exports.isNull=_,exports.isNumber=l,exports.isObject=d,exports.isString=h,exports.isUndefined=E,exports.isValidConversationType=e=>l(e)&&Object.prototype.hasOwnProperty.call(o,e),exports.isValidFileType=e=>l(e)&&Object.prototype.hasOwnProperty.call(a,e),exports.map=B,exports.notEmptyArray=e=>u(e)&&e.length>0,exports.notEmptyObject=m,exports.notEmptyString=f,exports.todo=e=>new O(e),exports.validate=V;\n","/**\n * @rongcloud/engine\n * Version: v0.1.0\n * CommitId: 535393139458d1b8d7dc5d2b8d49803a2a30e278\n * Date: Tue Nov 24 2020 15:05:10 GMT+0800 (GMT+08:00)\n * 2020 RongCloud, Inc. All rights reserved.\n */\n\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar ReceivedStatus;\r\n(function (ReceivedStatus) {\r\n    /**\r\n     * \r\n    */\r\n    ReceivedStatus[ReceivedStatus[\"READ\"] = 1] = \"READ\";\r\n    /**\r\n     * \r\n    */\r\n    ReceivedStatus[ReceivedStatus[\"LISTENED\"] = 2] = \"LISTENED\";\r\n    /**\r\n     * \r\n    */\r\n    ReceivedStatus[ReceivedStatus[\"DOWNLOADED\"] = 4] = \"DOWNLOADED\";\r\n    /**\r\n     * (  UI )\r\n    */\r\n    ReceivedStatus[ReceivedStatus[\"RETRIEVED\"] = 8] = \"RETRIEVED\";\r\n    /**\r\n     * \r\n    */\r\n    ReceivedStatus[ReceivedStatus[\"UNREAD\"] = 0] = \"UNREAD\";\r\n})(ReceivedStatus || (ReceivedStatus = {}));\r\nvar ReceivedStatus$1 = ReceivedStatus;\n\nconst randomNum = (min, max) => {\r\n    return min + Math.floor(Math.random() * (max - min));\r\n};\r\nconst getUUID = () => {\r\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\r\n        const r = Math.random() * 16 | 0;\r\n        const v = c === 'x' ? r : (r & 0x3 | 0x8);\r\n        return v.toString(16);\r\n    });\r\n};\n\nvar ErrorCode;\r\n(function (ErrorCode) {\r\n    /**  */\r\n    ErrorCode[ErrorCode[\"TIMEOUT\"] = -1] = \"TIMEOUT\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"UNKNOWN\"] = -2] = \"UNKNOWN\";\r\n    /**  */\r\n    ErrorCode[ErrorCode[\"PARAMETER_ERROR\"] = -3] = \"PARAMETER_ERROR\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"SUCCESS\"] = 0] = \"SUCCESS\";\r\n    ErrorCode[ErrorCode[\"RC_MSG_UNAUTHORIZED\"] = 20406] = \"RC_MSG_UNAUTHORIZED\";\r\n    /**\r\n     *  Id \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_DISCUSSION_GROUP_ID_INVALID\"] = 20407] = \"RC_DISCUSSION_GROUP_ID_INVALID\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"SEND_FREQUENCY_TOO_FAST\"] = 20604] = \"SEND_FREQUENCY_TOO_FAST\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"NOT_IN_DISCUSSION\"] = 21406] = \"NOT_IN_DISCUSSION\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"FORBIDDEN_IN_GROUP\"] = 22408] = \"FORBIDDEN_IN_GROUP\";\r\n    ErrorCode[ErrorCode[\"RECALL_MESSAGE\"] = 25101] = \"RECALL_MESSAGE\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"NOT_IN_GROUP\"] = 22406] = \"NOT_IN_GROUP\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"NOT_IN_CHATROOM\"] = 23406] = \"NOT_IN_CHATROOM\";\r\n    /**\r\n     *\r\n     */\r\n    ErrorCode[ErrorCode[\"FORBIDDEN_IN_CHATROOM\"] = 23408] = \"FORBIDDEN_IN_CHATROOM\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_CHATROOM_USER_KICKED\"] = 23409] = \"RC_CHATROOM_USER_KICKED\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_CHATROOM_NOT_EXIST\"] = 23410] = \"RC_CHATROOM_NOT_EXIST\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_CHATROOM_IS_FULL\"] = 23411] = \"RC_CHATROOM_IS_FULL\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_CHATROOM_PATAMETER_INVALID\"] = 23412] = \"RC_CHATROOM_PATAMETER_INVALID\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"CHATROOM_GET_HISTORYMSG_ERROR\"] = 23413] = \"CHATROOM_GET_HISTORYMSG_ERROR\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"CHATROOM_NOT_OPEN_HISTORYMSG_STORE\"] = 23414] = \"CHATROOM_NOT_OPEN_HISTORYMSG_STORE\";\r\n    /**\r\n     *  KV (,  100 )\r\n     */\r\n    ErrorCode[ErrorCode[\"CHATROOM_KV_EXCEED\"] = 23423] = \"CHATROOM_KV_EXCEED\";\r\n    /**\r\n     *  KV (kv , )\r\n     */\r\n    ErrorCode[ErrorCode[\"CHATROOM_KV_OVERWRITE_INVALID\"] = 23424] = \"CHATROOM_KV_OVERWRITE_INVALID\";\r\n    /**\r\n     *  KV \r\n     */\r\n    ErrorCode[ErrorCode[\"CHATROOM_KV_STORE_NOT_OPEN\"] = 23426] = \"CHATROOM_KV_STORE_NOT_OPEN\";\r\n    /**\r\n     * Key\r\n     */\r\n    ErrorCode[ErrorCode[\"CHATROOM_KEY_NOT_EXIST\"] = 23427] = \"CHATROOM_KEY_NOT_EXIST\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"SENSITIVE_SHIELD\"] = 21501] = \"SENSITIVE_SHIELD\";\r\n    ErrorCode[ErrorCode[\"SENSITIVE_REPLACE\"] = 21502] = \"SENSITIVE_REPLACE\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"JOIN_IN_DISCUSSION\"] = 21407] = \"JOIN_IN_DISCUSSION\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"CREATE_DISCUSSION\"] = 21408] = \"CREATE_DISCUSSION\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"INVITE_DICUSSION\"] = 21409] = \"INVITE_DICUSSION\";\r\n    /**\r\n     *\r\n     */\r\n    ErrorCode[ErrorCode[\"GET_USERINFO_ERROR\"] = 23407] = \"GET_USERINFO_ERROR\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"REJECTED_BY_BLACKLIST\"] = 405] = \"REJECTED_BY_BLACKLIST\";\r\n    /**\r\n     *  Socket \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_NET_CHANNEL_INVALID\"] = 30001] = \"RC_NET_CHANNEL_INVALID\";\r\n    /**\r\n     * Socket \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_NET_UNAVAILABLE\"] = 30002] = \"RC_NET_UNAVAILABLE\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_MSG_RESP_TIMEOUT\"] = 30003] = \"RC_MSG_RESP_TIMEOUT\";\r\n    /**\r\n     * Http \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_HTTP_SEND_FAIL\"] = 30004] = \"RC_HTTP_SEND_FAIL\";\r\n    /**\r\n     * HTTP \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_HTTP_REQ_TIMEOUT\"] = 30005] = \"RC_HTTP_REQ_TIMEOUT\";\r\n    /**\r\n     * HTTP \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_HTTP_RECV_FAIL\"] = 30006] = \"RC_HTTP_RECV_FAIL\";\r\n    /**\r\n     *  HTTP 200\r\n     */\r\n    ErrorCode[ErrorCode[\"RC_NAVI_RESOURCE_ERROR\"] = 30007] = \"RC_NAVI_RESOURCE_ERROR\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_NODE_NOT_FOUND\"] = 30008] = \"RC_NODE_NOT_FOUND\";\r\n    /**\r\n     *  IP \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_DOMAIN_NOT_RESOLVE\"] = 30009] = \"RC_DOMAIN_NOT_RESOLVE\";\r\n    /**\r\n     *  Socket \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_SOCKET_NOT_CREATED\"] = 30010] = \"RC_SOCKET_NOT_CREATED\";\r\n    /**\r\n     * Socket \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_SOCKET_DISCONNECTED\"] = 30011] = \"RC_SOCKET_DISCONNECTED\";\r\n    /**\r\n     * PING \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_PING_SEND_FAIL\"] = 30012] = \"RC_PING_SEND_FAIL\";\r\n    /**\r\n     * PING \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_PONG_RECV_FAIL\"] = 30013] = \"RC_PONG_RECV_FAIL\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_MSG_SEND_FAIL\"] = 30014] = \"RC_MSG_SEND_FAIL\";\r\n    /**\r\n     * JSON ,  128kb\r\n     */\r\n    ErrorCode[ErrorCode[\"RC_MSG_CONTENT_EXCEED_LIMIT\"] = 30016] = \"RC_MSG_CONTENT_EXCEED_LIMIT\";\r\n    /**\r\n     *  connect  ACK \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_CONN_ACK_TIMEOUT\"] = 31000] = \"RC_CONN_ACK_TIMEOUT\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_CONN_PROTO_VERSION_ERROR\"] = 31001] = \"RC_CONN_PROTO_VERSION_ERROR\";\r\n    /**\r\n     * App Id \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_CONN_ID_REJECT\"] = 31002] = \"RC_CONN_ID_REJECT\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_CONN_SERVER_UNAVAILABLE\"] = 31003] = \"RC_CONN_SERVER_UNAVAILABLE\";\r\n    /**\r\n     * Token \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_CONN_USER_OR_PASSWD_ERROR\"] = 31004] = \"RC_CONN_USER_OR_PASSWD_ERROR\";\r\n    /**\r\n     * websocket  Ping  Pong\r\n     */\r\n    ErrorCode[ErrorCode[\"RC_CONN_NOT_AUTHRORIZED\"] = 31005] = \"RC_CONN_NOT_AUTHRORIZED\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_CONN_REDIRECTED\"] = 31006] = \"RC_CONN_REDIRECTED\";\r\n    /**\r\n     * NAME \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_CONN_PACKAGE_NAME_INVALID\"] = 31007] = \"RC_CONN_PACKAGE_NAME_INVALID\";\r\n    /**\r\n     * APP \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_CONN_APP_BLOCKED_OR_DELETED\"] = 31008] = \"RC_CONN_APP_BLOCKED_OR_DELETED\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_CONN_USER_BLOCKED\"] = 31009] = \"RC_CONN_USER_BLOCKED\";\r\n    /**\r\n     * Disconnect\r\n     */\r\n    ErrorCode[ErrorCode[\"RC_DISCONN_KICK\"] = 31010] = \"RC_DISCONN_KICK\";\r\n    /**\r\n     * Disconnect\r\n     */\r\n    ErrorCode[ErrorCode[\"RC_DISCONN_EXCEPTION\"] = 31011] = \"RC_DISCONN_EXCEPTION\";\r\n    /**\r\n     * query\r\n     */\r\n    ErrorCode[ErrorCode[\"RC_QUERY_ACK_NO_DATA\"] = 32001] = \"RC_QUERY_ACK_NO_DATA\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"RC_MSG_DATA_INCOMPLETE\"] = 32002] = \"RC_MSG_DATA_INCOMPLETE\";\r\n    /**\r\n     *  init \r\n     */\r\n    ErrorCode[ErrorCode[\"BIZ_ERROR_CLIENT_NOT_INIT\"] = 33001] = \"BIZ_ERROR_CLIENT_NOT_INIT\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"BIZ_ERROR_DATABASE_ERROR\"] = 33002] = \"BIZ_ERROR_DATABASE_ERROR\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"BIZ_ERROR_INVALID_PARAMETER\"] = 33003] = \"BIZ_ERROR_INVALID_PARAMETER\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"BIZ_ERROR_NO_CHANNEL\"] = 33004] = \"BIZ_ERROR_NO_CHANNEL\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"BIZ_ERROR_RECONNECT_SUCCESS\"] = 33005] = \"BIZ_ERROR_RECONNECT_SUCCESS\";\r\n    /**\r\n     *  connect \r\n     */\r\n    ErrorCode[ErrorCode[\"BIZ_ERROR_CONNECTING\"] = 33006] = \"BIZ_ERROR_CONNECTING\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"MSG_ROAMING_SERVICE_UNAVAILABLE\"] = 33007] = \"MSG_ROAMING_SERVICE_UNAVAILABLE\";\r\n    ErrorCode[ErrorCode[\"MSG_INSERT_ERROR\"] = 33008] = \"MSG_INSERT_ERROR\";\r\n    ErrorCode[ErrorCode[\"MSG_DEL_ERROR\"] = 33009] = \"MSG_DEL_ERROR\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"CONVER_REMOVE_ERROR\"] = 34001] = \"CONVER_REMOVE_ERROR\";\r\n    /**\r\n     *\r\n     */\r\n    ErrorCode[ErrorCode[\"CONVER_GETLIST_ERROR\"] = 34002] = \"CONVER_GETLIST_ERROR\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"CONVER_SETOP_ERROR\"] = 34003] = \"CONVER_SETOP_ERROR\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"CONVER_TOTAL_UNREAD_ERROR\"] = 34004] = \"CONVER_TOTAL_UNREAD_ERROR\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"CONVER_TYPE_UNREAD_ERROR\"] = 34005] = \"CONVER_TYPE_UNREAD_ERROR\";\r\n    /**\r\n     * ID&\r\n     */\r\n    ErrorCode[ErrorCode[\"CONVER_ID_TYPE_UNREAD_ERROR\"] = 34006] = \"CONVER_ID_TYPE_UNREAD_ERROR\";\r\n    ErrorCode[ErrorCode[\"CONVER_CLEAR_ERROR\"] = 34007] = \"CONVER_CLEAR_ERROR\";\r\n    /**\r\n     *  key value  ()\r\n    */\r\n    ErrorCode[ErrorCode[\"EXPANSION_LIMIT_EXCEET\"] = 34010] = \"EXPANSION_LIMIT_EXCEET\";\r\n    /**\r\n     *  ()\r\n    */\r\n    ErrorCode[ErrorCode[\"MESSAGE_KV_NOT_SUPPORT\"] = 34008] = \"MESSAGE_KV_NOT_SUPPORT\";\r\n    ErrorCode[ErrorCode[\"CLEAR_HIS_TIME_ERROR\"] = 34011] = \"CLEAR_HIS_TIME_ERROR\";\r\n    ErrorCode[ErrorCode[\"CONVER_GET_ERROR\"] = 34009] = \"CONVER_GET_ERROR\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"GROUP_SYNC_ERROR\"] = 35001] = \"GROUP_SYNC_ERROR\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"GROUP_MATCH_ERROR\"] = 35002] = \"GROUP_MATCH_ERROR\";\r\n    // \r\n    /**\r\n     * Id\r\n     */\r\n    ErrorCode[ErrorCode[\"CHATROOM_ID_ISNULL\"] = 36001] = \"CHATROOM_ID_ISNULL\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"CHARTOOM_JOIN_ERROR\"] = 36002] = \"CHARTOOM_JOIN_ERROR\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"CHATROOM_HISMESSAGE_ERROR\"] = 36003] = \"CHATROOM_HISMESSAGE_ERROR\";\r\n    /**\r\n     *  kv \r\n     */\r\n    ErrorCode[ErrorCode[\"CHATROOM_KV_NOT_FOUND\"] = 36004] = \"CHATROOM_KV_NOT_FOUND\";\r\n    // \r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"BLACK_ADD_ERROR\"] = 37001] = \"BLACK_ADD_ERROR\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"BLACK_GETSTATUS_ERROR\"] = 37002] = \"BLACK_GETSTATUS_ERROR\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"BLACK_REMOVE_ERROR\"] = 37003] = \"BLACK_REMOVE_ERROR\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"DRAF_GET_ERROR\"] = 38001] = \"DRAF_GET_ERROR\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"DRAF_SAVE_ERROR\"] = 38002] = \"DRAF_SAVE_ERROR\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"DRAF_REMOVE_ERROR\"] = 38003] = \"DRAF_REMOVE_ERROR\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"SUBSCRIBE_ERROR\"] = 39001] = \"SUBSCRIBE_ERROR\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"QNTKN_FILETYPE_ERROR\"] = 41001] = \"QNTKN_FILETYPE_ERROR\";\r\n    /**\r\n     * token\r\n     */\r\n    ErrorCode[ErrorCode[\"QNTKN_GET_ERROR\"] = 41002] = \"QNTKN_GET_ERROR\";\r\n    /**\r\n     * cookie\r\n     */\r\n    ErrorCode[ErrorCode[\"COOKIE_ENABLE\"] = 51001] = \"COOKIE_ENABLE\";\r\n    ErrorCode[ErrorCode[\"GET_MESSAGE_BY_ID_ERROR\"] = 61001] = \"GET_MESSAGE_BY_ID_ERROR\";\r\n    // DeviveId \r\n    ErrorCode[ErrorCode[\"HAVNODEVICEID\"] = 24001] = \"HAVNODEVICEID\";\r\n    // \r\n    ErrorCode[ErrorCode[\"DEVICEIDISHAVE\"] = 24002] = \"DEVICEIDISHAVE\";\r\n    // token\r\n    ErrorCode[ErrorCode[\"FEILD\"] = 24009] = \"FEILD\";\r\n    // voip\r\n    ErrorCode[ErrorCode[\"VOIPISNULL\"] = 24013] = \"VOIPISNULL\";\r\n    // Voip\r\n    ErrorCode[ErrorCode[\"NOENGINETYPE\"] = 24010] = \"NOENGINETYPE\";\r\n    // channleName \r\n    ErrorCode[ErrorCode[\"NULLCHANNELNAME\"] = 24011] = \"NULLCHANNELNAME\";\r\n    // Voipkey\r\n    ErrorCode[ErrorCode[\"VOIPDYANMICERROR\"] = 24012] = \"VOIPDYANMICERROR\";\r\n    // voip\r\n    ErrorCode[ErrorCode[\"NOVOIP\"] = 24014] = \"NOVOIP\";\r\n    // \r\n    ErrorCode[ErrorCode[\"INTERNALERRROR\"] = 24015] = \"INTERNALERRROR\";\r\n    // VOIP close\r\n    ErrorCode[ErrorCode[\"VOIPCLOSE\"] = 24016] = \"VOIPCLOSE\";\r\n    ErrorCode[ErrorCode[\"CLOSE_BEFORE_OPEN\"] = 51001] = \"CLOSE_BEFORE_OPEN\";\r\n    ErrorCode[ErrorCode[\"ALREADY_IN_USE\"] = 51002] = \"ALREADY_IN_USE\";\r\n    ErrorCode[ErrorCode[\"INVALID_CHANNEL_NAME\"] = 51003] = \"INVALID_CHANNEL_NAME\";\r\n    ErrorCode[ErrorCode[\"VIDEO_CONTAINER_IS_NULL\"] = 51004] = \"VIDEO_CONTAINER_IS_NULL\";\r\n    /**\r\n     *  0 .\r\n     */\r\n    ErrorCode[ErrorCode[\"DELETE_MESSAGE_ID_IS_NULL\"] = 61001] = \"DELETE_MESSAGE_ID_IS_NULL\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"CANCEL\"] = 1] = \"CANCEL\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"REJECT\"] = 2] = \"REJECT\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"HANGUP\"] = 3] = \"HANGUP\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"BUSYLINE\"] = 4] = \"BUSYLINE\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"NO_RESPONSE\"] = 5] = \"NO_RESPONSE\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"ENGINE_UN_SUPPORTED\"] = 6] = \"ENGINE_UN_SUPPORTED\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"NETWORK_ERROR\"] = 7] = \"NETWORK_ERROR\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"REMOTE_CANCEL\"] = 11] = \"REMOTE_CANCEL\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"REMOTE_REJECT\"] = 12] = \"REMOTE_REJECT\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"REMOTE_HANGUP\"] = 13] = \"REMOTE_HANGUP\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"REMOTE_BUSYLINE\"] = 14] = \"REMOTE_BUSYLINE\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"REMOTE_NO_RESPONSE\"] = 15] = \"REMOTE_NO_RESPONSE\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"REMOTE_ENGINE_UN_SUPPORTED\"] = 16] = \"REMOTE_ENGINE_UN_SUPPORTED\";\r\n    /**\r\n     * \r\n     */\r\n    ErrorCode[ErrorCode[\"REMOTE_NETWORK_ERROR\"] = 17] = \"REMOTE_NETWORK_ERROR\";\r\n    /**\r\n     * VoIP \r\n     */\r\n    ErrorCode[ErrorCode[\"VOIP_NOT_AVALIABLE\"] = 18] = \"VOIP_NOT_AVALIABLE\";\r\n})(ErrorCode || (ErrorCode = {}));\r\nvar ErrorCode$1 = ErrorCode;\n\n/**\r\n * \r\n */\r\nvar ConversationType;\r\n(function (ConversationType) {\r\n    /**\r\n     * \r\n     */\r\n    ConversationType[ConversationType[\"NONE\"] = 0] = \"NONE\";\r\n    /**\r\n     * \r\n     */\r\n    ConversationType[ConversationType[\"PRIVATE\"] = 1] = \"PRIVATE\";\r\n    /**\r\n     * \r\n     */\r\n    ConversationType[ConversationType[\"DISCUSSION\"] = 2] = \"DISCUSSION\";\r\n    /**\r\n     * \r\n     */\r\n    ConversationType[ConversationType[\"GROUP\"] = 3] = \"GROUP\";\r\n    /**\r\n     * \r\n     */\r\n    ConversationType[ConversationType[\"CHATROOM\"] = 4] = \"CHATROOM\";\r\n    /**\r\n     * \r\n     */\r\n    ConversationType[ConversationType[\"CUSTOMER_SERVICE\"] = 5] = \"CUSTOMER_SERVICE\";\r\n    /**\r\n     * \r\n     */\r\n    ConversationType[ConversationType[\"SYSTEM\"] = 6] = \"SYSTEM\";\r\n    /**\r\n     * MC)\r\n     */\r\n    ConversationType[ConversationType[\"APP_PUBLIC_SERVICE\"] = 7] = \"APP_PUBLIC_SERVICE\";\r\n    /**\r\n     * MP)\r\n     */\r\n    ConversationType[ConversationType[\"PUBLIC_SERVICE\"] = 8] = \"PUBLIC_SERVICE\";\r\n    /**\r\n     * RTCLib \r\n     */\r\n    ConversationType[ConversationType[\"RTC_ROOM\"] = 12] = \"RTC_ROOM\";\r\n})(ConversationType || (ConversationType = {}));\r\nvar ConversationType$1 = ConversationType;\n\n/**\r\n * \r\n */\r\nvar FileType;\r\n(function (FileType) {\r\n    /**\r\n     * \r\n     */\r\n    FileType[FileType[\"IMAGE\"] = 1] = \"IMAGE\";\r\n    /**\r\n     * \r\n     */\r\n    FileType[FileType[\"AUDIO\"] = 2] = \"AUDIO\";\r\n    /**\r\n     * \r\n     */\r\n    FileType[FileType[\"VIDEO\"] = 3] = \"VIDEO\";\r\n    /**\r\n     * \r\n     */\r\n    FileType[FileType[\"FILE\"] = 4] = \"FILE\";\r\n})(FileType || (FileType = {}));\r\nvar FileType$1 = FileType;\n\n/**\r\n * \r\n *  0 true\r\n * @param str\r\n */\r\nconst isString = (value) => typeof value === 'string';\r\n/**\r\n *  number \r\n * @param value\r\n */\r\nconst isNumber = (value) => typeof value === 'number' && !isNaN(value);\r\n/**\r\n * \r\n * \r\n *  UnitArrayBufferArray \r\n * @param arr\r\n */\r\nconst isArray = (arr) => Object.prototype.toString.call(arr).indexOf('Array') !== -1;\r\n/**\r\n *  ArrayBuffer\r\n * @param arr\r\n */\r\nconst isArrayBuffer = (arr) => Object.prototype.toString.call(arr) === '[object ArrayBuffer]';\r\n/**\r\n *  0 \r\n * @param str\r\n */\r\nconst notEmptyString = (str) => isString(str) && str.length > 0;\r\n/**\r\n *  0 \r\n * @param str\r\n */\r\nconst notEmptyArray = (arr) => isArray(arr) && arr.length > 0;\r\n/**\r\n * \r\n * @param val\r\n */\r\nconst isObject = (val) => {\r\n    return Object.prototype.toString.call(val) === '[object Object]';\r\n};\r\n/**\r\n * \r\n * @param val\r\n */\r\nconst isFunction = (val) => {\r\n    return Object.prototype.toString.call(val) === '[object Function]';\r\n};\r\n/**\r\n * undefined\r\n * @param val\r\n */\r\nconst isUndefined = (val) => {\r\n    // IE  undefined  Object\r\n    return val === undefined || Object.prototype.toString.call(val) === '[object Undefined]';\r\n};\r\n/**\r\n *  null\r\n*/\r\nconst isNull = (val) => {\r\n    return Object.prototype.toString.call(val) === '[object Null]';\r\n};\r\n/**\r\n *  http(s)  url\r\n * @param value\r\n */\r\nconst isHttpUrl = (value) => isString(value) && /https?:\\/\\//.test(value);\r\n/**\r\n * \r\n * @param val\r\n*/\r\nconst notEmptyObject = (val) => {\r\n    for (const key in val) {\r\n        return true;\r\n    }\r\n    return false;\r\n};\r\nconst isValidConversationType = (conversation) => {\r\n    return isNumber(conversation) && Object.prototype.hasOwnProperty.call(ConversationType$1, conversation);\r\n};\r\n/**\r\n * \r\n */\r\nconst isValidFileType = (fileType) => {\r\n    return isNumber(fileType) && Object.prototype.hasOwnProperty.call(FileType$1, fileType);\r\n};\n\nconst timerSetTimeout = (fun, itv) => {\r\n    return setTimeout(fun, itv);\r\n};\r\nconst int64ToTimestamp = (obj) => {\r\n    if (!isObject(obj) || obj.low === undefined || obj.high === undefined) {\r\n        return obj;\r\n    }\r\n    let low = obj.low;\r\n    if (low < 0) {\r\n        low += 0xffffffff + 1;\r\n    }\r\n    low = low.toString(16);\r\n    const timestamp = parseInt(obj.high.toString(16) + '00000000'.replace(new RegExp('0{' + low.length + '}$'), low), 16);\r\n    return timestamp;\r\n};\r\nconst batchInt64ToTimestamp = (data) => {\r\n    for (const key in data) {\r\n        if (isObject(data[key])) {\r\n            data[key] = int64ToTimestamp(data[key]);\r\n        }\r\n    }\r\n    return data;\r\n};\r\nconst formatDate = (seperator) => {\r\n    seperator = seperator || '-';\r\n    const date = new Date();\r\n    const year = date.getFullYear();\r\n    const month = date.getMonth() + 1;\r\n    const day = date.getDate();\r\n    return `${year}${seperator}${month}${seperator}${day}`;\r\n};\n\n/**\r\n * Navi \r\n */\r\nconst NAVI_CACHE_DURATION = 2 * 60 * 60 * 1000;\r\n/**\r\n *  Navi \r\n */\r\nconst NAVI_REQ_TIMEOUT = 10 * 1000;\r\n/**\r\n * /ping?r= \r\n */\r\nconst PING_REQ_TIMEOUT = 5 * 1000;\r\n/**\r\n * WebSocket \r\n */\r\nconst WEB_SOCKET_TIMEOUT = 5 * 1000;\r\n/**\r\n *  Navi \r\n */\r\nconst PUBLIC_CLOUD_NAVI_URIS = ['https://nav.cn.ronghub.com', 'https://nav2-cn.ronghub.com'];\r\n/**\r\n *  websocket \r\n */\r\nconst MINI_SOCKET_CONNECT_URIS = ['wsproxy.cn.ronghub.com', 'wsap-cn.ronghub.com'];\r\n/**\r\n *   \r\n */\r\nconst MINI_COMET_CONNECT_URIS = ['cometproxy-cn.ronghub.com', 'mini-cn.ronghub.com'];\r\n/**\r\n * IM \r\n */\r\nconst IM_SIGNAL_TIMEOUT = 30 * 1000;\r\n/**\r\n * IM Ping \r\n */\r\nconst IM_PING_INTERVAL_TIME = 30 * 1000;\r\n/**\r\n *  content 128 KB\r\n */\r\nconst MAX_MESSAGE_CONTENT_BYTES = 128 * 1024;\r\n/**\r\n * IM Comet  pullmsg( + )  45s\r\n */\r\nconst IM_COMET_PULLMSG_TIMEOUT = 45000;\r\n/**\r\n * storage key \r\n*/\r\nconst STORAGE_ROOT_KEY = 'RCV4-';\r\n/*\r\n * . , objectName , \r\n * : https://docs.rongcloud.cn/im/introduction/message_structure/#inherent\r\n*/\r\nconst SEND_MESSAGE_TYPE_OPTION = {\r\n    // \r\n    'RC:TxtMsg': { isCounted: true, isPersited: true },\r\n    'RC:ImgMsg': { isCounted: true, isPersited: true },\r\n    'RC:VcMsg': { isCounted: true, isPersited: true },\r\n    'RC:ImgTextMsg': { isCounted: true, isPersited: true },\r\n    'RC:FileMsg': { isCounted: true, isPersited: true },\r\n    'RC:HQVCMsg': { isCounted: true, isPersited: true },\r\n    'RC:LBSMsg': { isCounted: true, isPersited: true },\r\n    'RC:PSImgTxtMsg': { isCounted: true, isPersited: true },\r\n    'RC:PSMultiImgTxtMsg': { isCounted: true, isPersited: true },\r\n    'RCJrmf:RpMsg': { isCounted: true, isPersited: true },\r\n    'RCJrmf:RpOpendMsg': { isCounted: true, isPersited: true },\r\n    'RC:CombineMsg': { isCounted: true, isPersited: true },\r\n    'RC:ReferenceMsg': { isCounted: true, isPersited: true },\r\n    //  \r\n    'RC:InfoNtf': { isCounted: false, isPersited: true },\r\n    'RC:ContactNtf': { isCounted: false, isPersited: true },\r\n    'RC:ProfileNtf': { isCounted: false, isPersited: true },\r\n    'RC:CmdNtf': { isCounted: false, isPersited: true },\r\n    'RC:GrpNtf': { isCounted: false, isPersited: true },\r\n    'RC:RcCmd': { isCounted: false, isPersited: true },\r\n    //   - \r\n    //  \r\n    'RC:CmdMsg': { isCounted: false, isPersited: false },\r\n    'RC:TypSts': { isCounted: false, isPersited: false },\r\n    'RC:PSCmd': { isCounted: false, isPersited: false },\r\n    'RC:SRSMsg': { isCounted: false, isPersited: false },\r\n    'RC:RRReqMsg': { isCounted: false, isPersited: false },\r\n    'RC:RRRspMsg': { isCounted: false, isPersited: false },\r\n    'RC:CsChaR': { isCounted: false, isPersited: false },\r\n    'RC:CSCha': { isCounted: false, isPersited: false },\r\n    'RC:CsEva': { isCounted: false, isPersited: false },\r\n    'RC:CsContact': { isCounted: false, isPersited: false },\r\n    'RC:CsHs': { isCounted: false, isPersited: false },\r\n    'RC:CsHsR': { isCounted: false, isPersited: false },\r\n    'RC:CsSp': { isCounted: false, isPersited: false },\r\n    'RC:CsEnd': { isCounted: false, isPersited: false },\r\n    'RC:CsUpdate': { isCounted: false, isPersited: false },\r\n    'RC:ReadNtf': { isCounted: false, isPersited: false },\r\n    'RC:chrmKVNotiMsg': { isCounted: false, isPersited: false },\r\n    'RC:VCAccept': { isCounted: false, isPersited: false },\r\n    'RC:VCRinging': { isCounted: false, isPersited: false },\r\n    'RC:VCSummary': { isCounted: false, isPersited: false },\r\n    'RC:VCHangup': { isCounted: false, isPersited: false },\r\n    'RC:VCInvite': { isCounted: false, isPersited: false },\r\n    'RC:VCModifyMedia': { isCounted: false, isPersited: false },\r\n    'RC:VCModifyMem': { isCounted: false, isPersited: false },\r\n    'RC:MsgExMsg': { isCounted: false, isPersited: false }\r\n};\n\nlet rootStorage;\r\nconst createRootStorage = (runtime) => {\r\n    if (!rootStorage) {\r\n        rootStorage = {\r\n            set: (key, val) => {\r\n                runtime.localStorage.setItem(key, JSON.stringify(val));\r\n            },\r\n            get: (key) => {\r\n                let val;\r\n                try {\r\n                    val = JSON.parse(runtime.localStorage.getItem(key));\r\n                }\r\n                catch (e) {\r\n                    val = null;\r\n                }\r\n                return val;\r\n            },\r\n            remove: (key) => {\r\n                return runtime.localStorage.removeItem(key);\r\n            },\r\n            getKeys: () => {\r\n                const keys = [];\r\n                for (const key in runtime.localStorage) {\r\n                    keys.push(key);\r\n                }\r\n                return keys;\r\n            }\r\n        };\r\n    }\r\n    return rootStorage;\r\n};\r\nclass AppCache {\r\n    constructor(value) {\r\n        this._caches = {};\r\n        if (value) {\r\n            this._caches = value;\r\n        }\r\n    }\r\n    set(key, value) {\r\n        this._caches[key] = value;\r\n    }\r\n    remove(key) {\r\n        const val = this.get(key);\r\n        delete this._caches[key];\r\n        return val;\r\n    }\r\n    get(key) {\r\n        return this._caches[key];\r\n    }\r\n    getKeys() {\r\n        const keys = [];\r\n        for (const key in this._caches) {\r\n            keys.push(key);\r\n        }\r\n        return keys;\r\n    }\r\n}\r\nclass AppStorage {\r\n    constructor(runtime, suffix) {\r\n        const key = suffix ? `${STORAGE_ROOT_KEY}${suffix}` : STORAGE_ROOT_KEY;\r\n        this._rootStorage = createRootStorage(runtime);\r\n        const localCache = this._rootStorage.get(key) || {};\r\n        this._cache = new AppCache({\r\n            [key]: localCache\r\n        });\r\n        this._storageKey = key;\r\n    }\r\n    _get() {\r\n        const key = this._storageKey;\r\n        return this._cache.get(key) || {};\r\n    }\r\n    _set(cache) {\r\n        const key = this._storageKey;\r\n        cache = cache || {};\r\n        this._cache.set(key, cache);\r\n        this._rootStorage.set(key, cache);\r\n    }\r\n    set(key, value) {\r\n        const localValue = this._get();\r\n        localValue[key] = value;\r\n        this._set(localValue);\r\n    }\r\n    remove(key) {\r\n        const localValue = this._get();\r\n        delete localValue[key];\r\n        this._set(localValue);\r\n    }\r\n    clear() {\r\n        const key = this._storageKey;\r\n        this._rootStorage.remove(key);\r\n        this._cache.remove(key);\r\n    }\r\n    get(key) {\r\n        const localValue = this._get();\r\n        return localValue[key];\r\n    }\r\n    getKeys() {\r\n        const localValue = this._get();\r\n        const keyList = [];\r\n        for (const key in localValue) {\r\n            keyList.push(key);\r\n        }\r\n        return keyList;\r\n    }\r\n    getValues() {\r\n        return this._get() || {};\r\n    }\r\n}\n\nclass Todo extends Error {\r\n    constructor(message) {\r\n        super(`TODO => ${message}`);\r\n    }\r\n}\r\nconst todo = (message) => new Todo(message);\n\n/**\r\n * \r\n * @todo \r\n * @param str\r\n * @param startIndex \r\n * @param endIndex \r\n*/\r\nconst toUpperCase = (str, startIndex, endIndex) => {\r\n    if (startIndex === undefined || endIndex === undefined) {\r\n        return str.toUpperCase();\r\n    }\r\n    const sliceStr = str.slice(startIndex, endIndex);\r\n    str = str.replace(sliceStr, (text) => {\r\n        return text.toUpperCase();\r\n    });\r\n    return str;\r\n};\r\nconst getByteLength = (str, charset = 'utf-8') => {\r\n    let total = 0;\r\n    let chatCode;\r\n    if (charset === 'utf-16') {\r\n        for (let i = 0, max = str.length; i < max; i++) {\r\n            chatCode = str.charCodeAt(i);\r\n            if (chatCode <= 0xffff) {\r\n                total += 2;\r\n            }\r\n            else {\r\n                total += 4;\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        for (let i = 0, max = str.length; i < max; i++) {\r\n            chatCode = str.charCodeAt(i);\r\n            if (chatCode < 0x007f) {\r\n                total += 1;\r\n            }\r\n            else if (chatCode <= 0x07ff) {\r\n                total += 2;\r\n            }\r\n            else if (chatCode <= 0xffff) {\r\n                total += 3;\r\n            }\r\n            else {\r\n                total += 4;\r\n            }\r\n        }\r\n    }\r\n    return total;\r\n};\r\nconst appendUrl = (url, query) => {\r\n    url = url.replace(/\\?$/, '');\r\n    if (!query) {\r\n        return url;\r\n    }\r\n    const searchArr = Object.keys(query).map(key => `${key}=${query[key]}`).filter(item => !!item);\r\n    if (searchArr.length) {\r\n        return [url, searchArr.join('&')].join('?');\r\n    }\r\n    return url;\r\n};\n\n(function (LogLevel) {\r\n    /**\r\n     *  `LogLevel.DEBUG`\r\n     */\r\n    LogLevel[LogLevel[\"LOG\"] = 0] = \"LOG\";\r\n    LogLevel[LogLevel[\"DEBUG\"] = 0] = \"DEBUG\";\r\n    LogLevel[LogLevel[\"INFO\"] = 1] = \"INFO\";\r\n    LogLevel[LogLevel[\"WARN\"] = 2] = \"WARN\";\r\n    LogLevel[LogLevel[\"ERROR\"] = 3] = \"ERROR\";\r\n})(exports.LogLevel || (exports.LogLevel = {}));\n\nconst methods = {\r\n    [exports.LogLevel.DEBUG]: console.debug.bind(console),\r\n    [exports.LogLevel.INFO]: console.info.bind(console),\r\n    [exports.LogLevel.WARN]: console.warn.bind(console),\r\n    [exports.LogLevel.ERROR]: console.error.bind(console)\r\n};\r\nclass Logger {\r\n    constructor(_tag) {\r\n        this._tag = _tag;\r\n        /**\r\n         * \r\n         */\r\n        this._outLevel = exports.LogLevel.WARN;\r\n        /**\r\n         * \r\n         */\r\n        this._stdout = this._defaultStdout;\r\n        this.log = this._out;\r\n        this.debug = this._out.bind(this, exports.LogLevel.DEBUG);\r\n        this.info = this._out.bind(this, exports.LogLevel.INFO);\r\n        this.warn = this._out.bind(this, exports.LogLevel.WARN);\r\n        this.error = this._out.bind(this, exports.LogLevel.ERROR);\r\n    }\r\n    /**\r\n     * \r\n     * @param level\r\n     * @param args\r\n     */\r\n    _defaultStdout(level, ...args) {\r\n        methods[level](`[${this._tag}](${new Date().toUTCString()}):`, ...args);\r\n    }\r\n    _out(level, ...args) {\r\n        level >= this._outLevel && this._stdout(level, ...args);\r\n    }\r\n    /**\r\n     * \r\n     * @param outLevel\r\n     * @param stdout\r\n     */\r\n    set(outLevel, stdout) {\r\n        this._outLevel = outLevel;\r\n        this._stdout = stdout || this._defaultStdout;\r\n    }\r\n}\r\nconst logger = new Logger('RCLog');\n\n(function (AssertRules) {\r\n    /**\r\n     *  0\r\n     */\r\n    AssertRules[AssertRules[\"STRING\"] = 0] = \"STRING\";\r\n    /**\r\n     *  String\r\n    */\r\n    AssertRules[AssertRules[\"ONLY_STRING\"] = 1] = \"ONLY_STRING\";\r\n    /**\r\n     * \r\n     */\r\n    AssertRules[AssertRules[\"NUMBER\"] = 2] = \"NUMBER\";\r\n    /**\r\n     * \r\n     */\r\n    AssertRules[AssertRules[\"BOOLEAN\"] = 3] = \"BOOLEAN\";\r\n    /**\r\n     * \r\n    */\r\n    AssertRules[AssertRules[\"OBJECT\"] = 4] = \"OBJECT\";\r\n    /**\r\n     * \r\n    */\r\n    AssertRules[AssertRules[\"ARRAY\"] = 5] = \"ARRAY\";\r\n    /**\r\n     *  callback  callback.onSuccesscallback.onError\r\n    */\r\n    AssertRules[AssertRules[\"CALLBACK\"] = 6] = \"CALLBACK\";\r\n})(exports.AssertRules || (exports.AssertRules = {}));\r\nconst validators = {\r\n    [exports.AssertRules.STRING]: notEmptyString,\r\n    [exports.AssertRules.ONLY_STRING]: isString,\r\n    [exports.AssertRules.NUMBER]: isNumber,\r\n    [exports.AssertRules.BOOLEAN]: (value) => typeof value === 'boolean',\r\n    [exports.AssertRules.OBJECT]: isObject,\r\n    [exports.AssertRules.ARRAY]: isArray,\r\n    [exports.AssertRules.CALLBACK]: (callback) => {\r\n        let flag = true;\r\n        if (!isObject(callback)) {\r\n            flag = false;\r\n        }\r\n        callback = callback || {};\r\n        if (callback.onSuccess && !isFunction(callback.onSuccess)) {\r\n            flag = false;\r\n        }\r\n        if (callback.onError && !isFunction(callback.onError)) {\r\n            flag = false;\r\n        }\r\n        return flag;\r\n    }\r\n};\r\nclass RCAssertError extends Error {\r\n    constructor(message) {\r\n        super(message);\r\n        this.name = 'RCAssertError';\r\n    }\r\n}\r\n/**\r\n * \r\n * @description\r\n * 1. value  validator \r\n * 2. value  undefined | null  validator \r\n * @param key \r\n * @param value \r\n * @param validator \r\n * @param required  `false`\r\n */\r\nconst assert = (key, value, validator, required = false) => {\r\n    if (!validate(key, value, validator, required)) {\r\n        throw new RCAssertError(`${key} is invalid.`);\r\n    }\r\n};\r\n/**\r\n *  `assert`  boolean \r\n * @description\r\n * 1. value  validator \r\n * 2. value  undefined | null  validator \r\n * @param key \r\n * @param value \r\n * @param validator \r\n * @param required  `false`\r\n */\r\nconst validate = (key, value, validator, required = false) => {\r\n    validator = validators[validator] || validator;\r\n    const invalid = \r\n    // \r\n    (required && !validator(value)) ||\r\n        // \r\n        (!required && !(isUndefined(value) || value === null || validator(value)));\r\n    if (invalid) {\r\n        // \r\n        const msg = `${key} is invalid.`;\r\n        logger.error(msg);\r\n    }\r\n    return !invalid;\r\n};\n\n/**\r\n * @todo \r\n * @deprecated\r\n * @param source\r\n * @param event\r\n * @param options\r\n */\r\nconst forEach = (source, event, options) => {\r\n    options = options || {};\r\n    event = event || function () { };\r\n    const { isReverse } = options;\r\n    const loopObj = () => {\r\n        for (const key in source) {\r\n            event(source[key], key, source);\r\n        }\r\n    };\r\n    const loopArr = () => {\r\n        if (isReverse) {\r\n            for (let i = source.length - 1; i >= 0; i--) {\r\n                event(source[i], i);\r\n            }\r\n        }\r\n        else {\r\n            for (let j = 0, len = source.length; j < len; j++) {\r\n                event(source[j], j);\r\n            }\r\n        }\r\n    };\r\n    if (isObject(source)) {\r\n        loopObj();\r\n    }\r\n    if (isArray(source) || isString(source)) {\r\n        loopArr();\r\n    }\r\n};\r\n/**\r\n * @deprecated\r\n * @param source\r\n * @param event\r\n */\r\nconst map = (source, event) => {\r\n    forEach(source, (item, index) => {\r\n        source[index] = event(item, index);\r\n    });\r\n    return source;\r\n};\r\nconst indexOf = (source, searchVal) => {\r\n    // :  indexof  IE3\r\n    if (source.indexOf) {\r\n        return source.indexOf(searchVal);\r\n    }\r\n    let index = -1;\r\n    forEach(source, (sub, i) => {\r\n        if (searchVal === sub) {\r\n            index = i;\r\n        }\r\n    });\r\n    return index;\r\n};\r\nconst isInclude = (source, searchVal) => {\r\n    const index = indexOf(source, searchVal);\r\n    return index !== -1;\r\n};\r\n/**\r\n * \r\n*/\r\nconst isInObject = (source, searchVal) => {\r\n    const arr = [];\r\n    forEach(source, (val) => {\r\n        arr.push(val);\r\n    });\r\n    const index = indexOf(arr, searchVal);\r\n    return index !== -1;\r\n};\r\nconst getUploadFileName = (type, fileName) => {\r\n    const random = Math.floor((Math.random() * 1000) % 10000);\r\n    const uuid = getUUID();\r\n    const date = formatDate();\r\n    const timestamp = new Date().getTime();\r\n    let extension = '';\r\n    if (fileName) {\r\n        const fileNameArr = fileName.split('.');\r\n        extension = '.' + fileNameArr[fileNameArr.length - 1];\r\n    }\r\n    return `${type}__RC-${date}_${random}_${timestamp}${uuid}${extension}`;\r\n};\n\n/**\r\n *   kv . , (RC:chrmKVNotiMsg). \r\n*/\r\nvar ChatroomEntryType;\r\n(function (ChatroomEntryType) {\r\n    ChatroomEntryType[ChatroomEntryType[\"UPDATE\"] = 1] = \"UPDATE\";\r\n    ChatroomEntryType[ChatroomEntryType[\"DELETE\"] = 2] = \"DELETE\";\r\n})(ChatroomEntryType || (ChatroomEntryType = {}));\r\nvar ChatroomEntryType$1 = ChatroomEntryType;\n\n/**\r\n *  status \r\n * @description\r\n * status , \r\n * :\r\n * 0000-0010 ()\r\n * 0001-0000 isPersited\r\n * 0010-0000 isCounted\r\n * 0100-0000 isMentioned\r\n * 0010-0000-0000 disableNotification\r\n * 0100-0000-0000 canIncludeExpansion\r\n*/\r\nconst getMessageOptionByStatus = (status) => {\r\n    let isPersited = true;\r\n    let isCounted = true;\r\n    let isMentioned = false;\r\n    let disableNotification = false;\r\n    let receivedStatus = ReceivedStatus$1.READ;\r\n    let isReceivedByOtherClient = false;\r\n    let canIncludeExpansion = false;\r\n    isPersited = !!(status & 0x10);\r\n    isCounted = !!(status & 0x20);\r\n    isMentioned = !!(status & 0x40);\r\n    disableNotification = !!(status & 0x100);\r\n    isReceivedByOtherClient = !!(status & 0x02);\r\n    receivedStatus = isReceivedByOtherClient ? ReceivedStatus$1.RETRIEVED : receivedStatus;\r\n    canIncludeExpansion = !!(status & 0x400);\r\n    return {\r\n        isPersited,\r\n        isCounted,\r\n        isMentioned,\r\n        disableNotification,\r\n        receivedStatus,\r\n        canIncludeExpansion\r\n    };\r\n};\r\n/**\r\n *  sessionId \r\n * @description\r\n * sessionId , \r\n * :\r\n * 0000-0001 isPersited\r\n * 0000-0010 isCounted\r\n * 0000-0100 isMentioned\r\n * 0010-0000 disableNotification\r\n * 0100-0000 canIncludeExpansion\r\n*/\r\nconst getUpMessageOptionBySessionId = (sessionId) => {\r\n    let isPersited = false;\r\n    let isCounted = false;\r\n    let disableNotification = false;\r\n    let canIncludeExpansion = false;\r\n    isPersited = !!(sessionId & 0x01);\r\n    isCounted = !!(sessionId & 0x02);\r\n    disableNotification = !!(sessionId & 0x10);\r\n    canIncludeExpansion = !!(sessionId & 0x40);\r\n    return {\r\n        isPersited,\r\n        isCounted,\r\n        disableNotification,\r\n        canIncludeExpansion\r\n    };\r\n};\r\nconst formatExtraContent = (extraContent) => {\r\n    const expansion = {}; // \r\n    const parseExtraContent = JSON.parse(extraContent);\r\n    forEach(parseExtraContent, (value, key) => {\r\n        expansion[key] = value.v;\r\n    });\r\n    return expansion;\r\n};\r\n/**\r\n * TODO: \r\n * @deprecated\r\n */\r\nconst DelayTimer = {\r\n    _delayTime: 0,\r\n    /**\r\n     * getTimer  Date.now()\r\n     * @deprecated\r\n     */\r\n    setTime: (time) => {\r\n        const currentTime = new Date().getTime();\r\n        DelayTimer._delayTime = currentTime - time;\r\n    },\r\n    getTime: () => {\r\n        const delayTime = DelayTimer._delayTime;\r\n        const currentTime = new Date().getTime();\r\n        return currentTime - delayTime;\r\n    }\r\n};\r\nconst getChatRoomKVByStatus = (status) => {\r\n    const isDeleteOpt = !!(status & 0x0004);\r\n    return {\r\n        isAutoDelete: !!(status & 0x0001),\r\n        isOverwrite: !!(status & 0x0002),\r\n        type: isDeleteOpt ? ChatroomEntryType$1.DELETE : ChatroomEntryType$1.UPDATE\r\n    };\r\n};\r\nconst getChatRoomKVOptStatus = (entity, action) => {\r\n    let status = 0;\r\n    // \r\n    if (entity.isAutoDelete) {\r\n        status = status | 0x0001;\r\n    }\r\n    // \r\n    if (entity.isOverwrite) {\r\n        status = status | 0x0002;\r\n    }\r\n    // \r\n    if (action === 2) {\r\n        status = status | 0x0004;\r\n    }\r\n    return status;\r\n};\r\nconst getSessionId = (option) => {\r\n    const { isStatusMessage } = option;\r\n    let { isPersited, isCounted, isMentioned, disableNotification, canIncludeExpansion } = option;\r\n    if (isStatusMessage) {\r\n        isPersited = isCounted = false;\r\n    }\r\n    let sessionId = 0;\r\n    if (isPersited) {\r\n        sessionId = sessionId | 0x01;\r\n    }\r\n    if (isCounted) {\r\n        sessionId = sessionId | 0x02;\r\n    }\r\n    if (isMentioned) {\r\n        sessionId = sessionId | 0x04;\r\n    }\r\n    if (disableNotification) {\r\n        sessionId = sessionId | 0x20;\r\n    }\r\n    if (canIncludeExpansion) {\r\n        sessionId = sessionId | 0x40;\r\n    }\r\n    return sessionId;\r\n};\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\n\n/**\r\n *  fixHeader  Qos \r\n * ```\r\n * fixHeadercommand(4 bit) | dup(1 bit) | Qos(2 bit) | retain(1 bit)\r\n * ```\r\n */\r\nvar QOS;\r\n(function (QOS) {\r\n    QOS[QOS[\"AT_MOST_ONCE\"] = 0] = \"AT_MOST_ONCE\";\r\n    QOS[QOS[\"AT_LEAST_ONCE\"] = 1] = \"AT_LEAST_ONCE\";\r\n    QOS[QOS[\"EXACTLY_ONCE\"] = 2] = \"EXACTLY_ONCE\";\r\n    QOS[QOS[\"DEFAULT\"] = 3] = \"DEFAULT\";\r\n})(QOS || (QOS = {}));\r\n/**\r\n *  fixHeader  command \r\n * ```\r\n * fixHeadercommand(4 bit) | dup(1 bit) | Qos(2 bit) | retain(1 bit)\r\n * ```\r\n */\r\nvar OperationType;\r\n(function (OperationType) {\r\n    /**  */\r\n    OperationType[OperationType[\"SYMMETRIC\"] = 0] = \"SYMMETRIC\";\r\n    /**  */\r\n    OperationType[OperationType[\"CONNECT\"] = 1] = \"CONNECT\";\r\n    /**  */\r\n    OperationType[OperationType[\"CONN_ACK\"] = 2] = \"CONN_ACK\";\r\n    /**  */\r\n    OperationType[OperationType[\"PUBLISH\"] = 3] = \"PUBLISH\";\r\n    /**  */\r\n    OperationType[OperationType[\"PUB_ACK\"] = 4] = \"PUB_ACK\";\r\n    /**  */\r\n    OperationType[OperationType[\"QUERY\"] = 5] = \"QUERY\";\r\n    /**  */\r\n    OperationType[OperationType[\"QUERY_ACK\"] = 6] = \"QUERY_ACK\";\r\n    /** QueryConfirm */\r\n    OperationType[OperationType[\"QUERY_CONFIRM\"] = 7] = \"QUERY_CONFIRM\";\r\n    OperationType[OperationType[\"SUBSCRIBE\"] = 8] = \"SUBSCRIBE\";\r\n    OperationType[OperationType[\"SUB_ACK\"] = 9] = \"SUB_ACK\";\r\n    OperationType[OperationType[\"UNSUBSCRIBE\"] = 10] = \"UNSUBSCRIBE\";\r\n    OperationType[OperationType[\"UNSUB_ACK\"] = 11] = \"UNSUB_ACK\";\r\n    OperationType[OperationType[\"PING_REQ\"] = 12] = \"PING_REQ\";\r\n    OperationType[OperationType[\"PING_RESP\"] = 13] = \"PING_RESP\";\r\n    /**  */\r\n    OperationType[OperationType[\"DISCONNECT\"] = 14] = \"DISCONNECT\";\r\n    OperationType[OperationType[\"RESERVER2\"] = 15] = \"RESERVER2\";\r\n})(OperationType || (OperationType = {}));\r\nvar MessageName;\r\n(function (MessageName) {\r\n    MessageName[\"CONN_ACK\"] = \"ConnAckMessage\";\r\n    MessageName[\"DISCONNECT\"] = \"DisconnectMessage\";\r\n    MessageName[\"PING_REQ\"] = \"PingReqMessage\";\r\n    MessageName[\"PING_RESP\"] = \"PingRespMessage\";\r\n    MessageName[\"PUBLISH\"] = \"PublishMessage\";\r\n    MessageName[\"PUB_ACK\"] = \"PubAckMessage\";\r\n    MessageName[\"QUERY\"] = \"QueryMessage\";\r\n    MessageName[\"QUERY_CON\"] = \"QueryConMessage\";\r\n    MessageName[\"QUERY_ACK\"] = \"QueryAckMessage\";\r\n})(MessageName || (MessageName = {}));\r\nvar IDENTIFIER;\r\n(function (IDENTIFIER) {\r\n    IDENTIFIER[\"PUB\"] = \"pub\";\r\n    IDENTIFIER[\"QUERY\"] = \"qry\";\r\n})(IDENTIFIER || (IDENTIFIER = {}));\n\n/**\r\n * @todo \r\n * @description\r\n * Header \r\n*/\r\nclass Header {\r\n    constructor(type, retain = false, qos = QOS.AT_LEAST_ONCE, dup = false) {\r\n        this._retain = false;\r\n        this.qos = QOS.AT_LEAST_ONCE;\r\n        this._dup = false;\r\n        this.syncMsg = false;\r\n        const isPlusType = type > 0; // \r\n        if (type && isPlusType && arguments.length === 1) {\r\n            this._retain = (type & 1) > 0;\r\n            this.qos = (type & 6) >> 1; // (_type & 0b110) >> 1\r\n            this._dup = (type & 8) > 0; // (_type & 0b1000) > 0\r\n            this.type = (type >> 4) & 15; // (_type >> 0b100) & 0b1111\r\n            this.syncMsg = (type & 8) === 8; // (_type & 0b1000) === 0b1000;\r\n        }\r\n        else {\r\n            this.type = type;\r\n            this._retain = retain;\r\n            this.qos = qos;\r\n            this._dup = dup;\r\n        }\r\n    }\r\n    encode() {\r\n        // const validQosList = [QOS.AT_MOST_ONCE, QOS.AT_LEAST_ONCE, QOS.EXACTLY_ONCE, QOS.DEFAULT]\r\n        // //  qos , \r\n        // for (let i = 0; i < validQosList.length; i++) {\r\n        //   if (this.qos === validQosList[i]) {\r\n        //     this.qos = validQosList[i]\r\n        //   }\r\n        // }\r\n        let byte = (this.type << 4); // 4 -> 100\r\n        byte |= this._retain ? 1 : 0;\r\n        byte |= this.qos << 1;\r\n        byte |= this._dup ? 8 : 0; // 8 -> 1000\r\n        return byte;\r\n    }\r\n}\r\n/**\r\n * @description\r\n * \r\n*/\r\nclass BinaryHelper {\r\n    /**\r\n     * @description\r\n     *  utf8 \r\n     * @param {string} str \r\n     * @param {boolean} isGetBytes \r\n     */\r\n    static writeUTF(str, isGetBytes) {\r\n        const back = [];\r\n        let byteSize = 0;\r\n        if (isString(str)) {\r\n            for (let i = 0, len = str.length; i < len; i++) {\r\n                var code = str.charCodeAt(i);\r\n                if (code >= 0 && code <= 127) {\r\n                    byteSize += 1;\r\n                    back.push(code);\r\n                }\r\n                else if (code >= 128 && code <= 2047) {\r\n                    byteSize += 2;\r\n                    back.push((192 | (31 & (code >> 6))));\r\n                    back.push((128 | (63 & code)));\r\n                }\r\n                else if (code >= 2048 && code <= 65535) {\r\n                    byteSize += 3;\r\n                    back.push((224 | (15 & (code >> 12))));\r\n                    back.push((128 | (63 & (code >> 6))));\r\n                    back.push((128 | (63 & code)));\r\n                }\r\n            }\r\n        }\r\n        for (let i = 0, len = back.length; i < len; i++) {\r\n            if (back[i] > 255) {\r\n                back[i] &= 255;\r\n            }\r\n        }\r\n        if (isGetBytes) {\r\n            return back;\r\n        }\r\n        if (byteSize <= 255) {\r\n            return [0, byteSize].concat(back);\r\n        }\r\n        else {\r\n            return [byteSize >> 8, byteSize & 255].concat(back);\r\n        }\r\n    }\r\n    /**\r\n     * @description\r\n     *  utf8 \r\n     * @param {Array<number>} arr \r\n     */\r\n    static readUTF(arr) {\r\n        const MAX_SIZE = 0x4000;\r\n        const codeUnits = [];\r\n        let highSurrogate;\r\n        let lowSurrogate;\r\n        let index = -1;\r\n        const strBytes = arr;\r\n        let result = '';\r\n        while (++index < strBytes.length) {\r\n            var codePoint = Number(strBytes[index]);\r\n            if (codePoint === (codePoint & 0x7F)) ;\r\n            else if ((codePoint & 0xF0) === 0xF0) {\r\n                codePoint ^= 0xF0;\r\n                codePoint = (codePoint << 6) | (strBytes[++index] ^ 0x80);\r\n                codePoint = (codePoint << 6) | (strBytes[++index] ^ 0x80);\r\n                codePoint = (codePoint << 6) | (strBytes[++index] ^ 0x80);\r\n            }\r\n            else if ((codePoint & 0xE0) === 0xE0) {\r\n                codePoint ^= 0xE0;\r\n                codePoint = (codePoint << 6) | (strBytes[++index] ^ 0x80);\r\n                codePoint = (codePoint << 6) | (strBytes[++index] ^ 0x80);\r\n            }\r\n            else if ((codePoint & 0xC0) === 0xC0) {\r\n                codePoint ^= 0xC0;\r\n                codePoint = (codePoint << 6) | (strBytes[++index] ^ 0x80);\r\n            }\r\n            if (!isFinite(codePoint) || codePoint < 0 || codePoint > 0x10FFFF || Math.floor(codePoint) !== codePoint) {\r\n                throw RangeError('Invalid code point: ' + codePoint);\r\n            }\r\n            if (codePoint <= 0xFFFF) {\r\n                codeUnits.push(codePoint);\r\n            }\r\n            else {\r\n                codePoint -= 0x10000;\r\n                highSurrogate = (codePoint >> 10) | 0xD800;\r\n                lowSurrogate = (codePoint % 0x400) | 0xDC00;\r\n                codeUnits.push(highSurrogate, lowSurrogate);\r\n            }\r\n            if (index + 1 === strBytes.length || codeUnits.length > MAX_SIZE) {\r\n                result += String.fromCharCode.apply(null, codeUnits);\r\n                codeUnits.length = 0;\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n}\r\n/**\r\n * @description\r\n * \r\n*/\r\nclass RongStreamReader {\r\n    constructor(arr) {\r\n        // \r\n        this._position = 0;\r\n        // \r\n        this._poolLen = 0;\r\n        this._pool = arr;\r\n        this._poolLen = arr.length;\r\n    }\r\n    check() {\r\n        return this._position >= this._pool.length;\r\n    }\r\n    /**\r\n     *  4 \r\n     */\r\n    readInt() {\r\n        const self = this;\r\n        if (self.check()) {\r\n            return -1;\r\n        }\r\n        let end = '';\r\n        for (let i = 0; i < 4; i++) {\r\n            let t = self._pool[self._position++].toString(16);\r\n            if (t.length === 1) {\r\n                t = '0' + t;\r\n            }\r\n            end += t.toString();\r\n        }\r\n        return parseInt(end, 16);\r\n    }\r\n    /**\r\n     *  8 \r\n     */\r\n    readLong() {\r\n        const self = this;\r\n        if (self.check()) {\r\n            return -1;\r\n        }\r\n        let end = '';\r\n        for (let i = 0; i < 8; i++) {\r\n            let t = self._pool[self._position++].toString(16);\r\n            if (t.length === 1) {\r\n                t = '0' + t;\r\n            }\r\n            end += t;\r\n        }\r\n        return parseInt(end, 16);\r\n    }\r\n    /**\r\n     *  1 \r\n     */\r\n    readByte() {\r\n        if (this.check()) {\r\n            return -1;\r\n        }\r\n        let val = this._pool[this._position++];\r\n        if (val > 255) {\r\n            val &= 255;\r\n        }\r\n        return val;\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    readUTF() {\r\n        if (this.check()) {\r\n            return '';\r\n        }\r\n        const big = (this.readByte() << 8) | this.readByte();\r\n        const pool = this._pool.subarray(this._position, this._position += big);\r\n        return BinaryHelper.readUTF(pool);\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    readAll() {\r\n        return this._pool.subarray(this._position, this._poolLen);\r\n    }\r\n}\r\n/**\r\n * @description\r\n * \r\n*/\r\nclass RongStreamWriter {\r\n    constructor() {\r\n        // ,  server \r\n        this._pool = [];\r\n        // \r\n        this._position = 0;\r\n        // \r\n        this._writen = 0;\r\n    }\r\n    /**\r\n     * , writen \r\n     */\r\n    write(byte) {\r\n        // todo\r\n        if (Object.prototype.toString.call(byte).indexOf('Array') !== -1) {\r\n            this._pool = this._pool.concat(byte);\r\n        }\r\n        else if (byte >= 0) {\r\n            if (byte > 255) {\r\n                byte &= 255;\r\n            }\r\n            this._pool.push(byte);\r\n            this._writen++;\r\n        }\r\n        return byte;\r\n    }\r\n    writeArr(byte) {\r\n        this._pool = this._pool.concat(byte);\r\n        return byte;\r\n    }\r\n    // PENDING.  ConnectMessage, \r\n    // writeChat(v: number) {\r\n    //   if (+v != v) {\r\n    //     throw new Error(\"writeChar:arguments type is error\");\r\n    //   }\r\n    //   this.write(v >> 8 & 255);\r\n    //   this.write(v & 255);\r\n    //   this.writen += 2;\r\n    // }\r\n    writeUTF(str) {\r\n        const val = BinaryHelper.writeUTF(str);\r\n        this._pool = this._pool.concat(val);\r\n        this._writen += val.length;\r\n    }\r\n    // PENDING.  write ,  this.poolLen  0, \r\n    // toComplements(): any {\r\n    //   var _tPool = this.pool;\r\n    //   for (var i = 0; i < this.poolLen; i++) {\r\n    //     if (_tPool[i] > 128) {\r\n    //       _tPool[i] -= 256;\r\n    //     }\r\n    //   }\r\n    //   return _tPool;\r\n    // }\r\n    getBytesArray() {\r\n        return this._pool;\r\n    }\r\n}\n\nvar PBName = {\r\n    UpStreamMessage: 'UpStreamMessage',\r\n    DownStreamMessage: 'DownStreamMessage',\r\n    DownStreamMessages: 'DownStreamMessages',\r\n    SessionsAttQryInput: 'SessionsAttQryInput',\r\n    SessionsAttOutput: 'SessionsAttOutput',\r\n    SyncRequestMsg: 'SyncRequestMsg',\r\n    ChrmPullMsg: 'ChrmPullMsg',\r\n    NotifyMsg: 'NotifyMsg',\r\n    HistoryMsgInput: 'HistoryMsgInput',\r\n    HistoryMsgOuput: 'HistoryMsgOuput',\r\n    RelationQryInput: 'RelationQryInput',\r\n    RelationsOutput: 'RelationsOutput',\r\n    DeleteSessionsInput: 'DeleteSessionsInput',\r\n    SessionInfo: 'SessionInfo',\r\n    DeleteSessionsOutput: 'DeleteSessionsOutput',\r\n    RelationsInput: 'RelationsInput',\r\n    DeleteMsgInput: 'DeleteMsgInput',\r\n    CleanHisMsgInput: 'CleanHisMsgInput',\r\n    SessionMsgReadInput: 'SessionMsgReadInput',\r\n    ChrmInput: 'ChrmInput',\r\n    QueryChatRoomInfoInput: 'QueryChatRoomInfoInput',\r\n    QueryChatRoomInfoOutput: 'QueryChatRoomInfoOutput',\r\n    RtcInput: 'RtcInput',\r\n    RtcUserListOutput: 'RtcUserListOutput',\r\n    SetUserStatusInput: 'SetUserStatusInput',\r\n    RtcSetDataInput: 'RtcSetDataInput',\r\n    RtcUserSetDataInput: 'RtcUserSetDataInput',\r\n    RtcDataInput: 'RtcDataInput',\r\n    RtcSetOutDataInput: 'RtcSetOutDataInput',\r\n    MCFollowInput: 'MCFollowInput',\r\n    RtcTokenOutput: 'RtcTokenOutput',\r\n    RtcQryOutput: 'RtcQryOutput',\r\n    RtcQryUserOutDataInput: 'RtcQryUserOutDataInput',\r\n    RtcUserOutDataOutput: 'RtcUserOutDataOutput',\r\n    RtcQueryListInput: 'RtcQueryListInput',\r\n    RtcRoomInfoOutput: 'RtcRoomInfoOutput',\r\n    RtcValueInfo: 'RtcValueInfo',\r\n    RtcKeyDeleteInput: 'RtcKeyDeleteInput',\r\n    GetQNupTokenInput: 'GetQNupTokenInput',\r\n    GetQNupTokenOutput: 'GetQNupTokenOutput',\r\n    GetQNdownloadUrlInput: 'GetQNdownloadUrlInput',\r\n    GetQNdownloadUrlOutput: 'GetQNdownloadUrlOutput',\r\n    SetChrmKV: 'SetChrmKV',\r\n    ChrmKVOutput: 'ChrmKVOutput',\r\n    QueryChrmKV: 'QueryChrmKV',\r\n    SetUserSettingInput: 'SetUserSettingInput',\r\n    SetUserSettingOutput: 'SetUserSettingOutput',\r\n    PullUserSettingInput: 'PullUserSettingInput',\r\n    PullUserSettingOutput: 'PullUserSettingOutput',\r\n    UserSettingNotification: 'UserSettingNotification',\r\n    SessionReq: 'SessionReq',\r\n    SessionStates: 'SessionStates',\r\n    SessionState: 'SessionState',\r\n    SessionStateItem: 'SessionStateItem',\r\n    SessionStateModifyReq: 'SessionStateModifyReq',\r\n    SessionStateModifyResp: 'SessionStateModifyResp' // \r\n};\n\nconst SSMsg = {\r\n    [PBName.UpStreamMessage]: ['sessionId', 'classname', 'content', 'pushText', 'userId', 'configFlag', 'appData', 'extraContent'],\r\n    [PBName.DownStreamMessages]: ['list', 'syncTime', 'finished'],\r\n    [PBName.DownStreamMessage]: ['fromUserId', 'type', 'groupId', 'classname', 'content', 'dataTime', 'status', 'msgId', 'extraContent'],\r\n    [PBName.SessionsAttQryInput]: ['nothing'],\r\n    [PBName.SessionsAttOutput]: ['inboxTime', 'sendboxTime', 'totalUnreadCount'],\r\n    [PBName.SyncRequestMsg]: ['syncTime', 'ispolling', 'isweb', 'isPullSend', 'isKeeping', 'sendBoxSyncTime'],\r\n    [PBName.ChrmPullMsg]: ['syncTime', 'count'],\r\n    [PBName.NotifyMsg]: ['type', 'time', 'chrmId'],\r\n    [PBName.HistoryMsgInput]: ['targetId', 'time', 'count', 'order'],\r\n    [PBName.HistoryMsgOuput]: ['list', 'syncTime', 'hasMsg'],\r\n    [PBName.RelationQryInput]: ['type', 'count', 'startTime', 'order'],\r\n    [PBName.RelationsOutput]: ['info'],\r\n    [PBName.DeleteSessionsInput]: ['sessions'],\r\n    [PBName.SessionInfo]: ['type', 'channelId'],\r\n    [PBName.DeleteSessionsOutput]: ['nothing'],\r\n    [PBName.RelationsInput]: ['type', 'msg', 'count', 'offset', 'startTime', 'endTime'],\r\n    [PBName.DeleteMsgInput]: ['type', 'conversationId', 'msgs'],\r\n    [PBName.CleanHisMsgInput]: ['targetId', 'dataTime', 'conversationType'],\r\n    [PBName.SessionMsgReadInput]: ['type', 'msgTime', 'channelId'],\r\n    [PBName.ChrmInput]: ['nothing'],\r\n    [PBName.QueryChatRoomInfoInput]: ['count', 'order'],\r\n    [PBName.QueryChatRoomInfoOutput]: ['userTotalNums', 'userInfos'],\r\n    [PBName.GetQNupTokenInput]: ['type', 'key'],\r\n    [PBName.GetQNdownloadUrlInput]: ['type', 'key', 'fileName'],\r\n    [PBName.GetQNupTokenOutput]: ['deadline', 'token'],\r\n    [PBName.GetQNdownloadUrlOutput]: ['downloadUrl'],\r\n    [PBName.SetChrmKV]: ['entry', 'bNotify', 'notification', 'type'],\r\n    [PBName.ChrmKVOutput]: ['entries', 'bFullUpdate', 'syncTime'],\r\n    [PBName.QueryChrmKV]: ['timestamp'],\r\n    [PBName.SetUserSettingInput]: ['version', 'value'],\r\n    [PBName.SetUserSettingOutput]: ['version', 'reserve'],\r\n    [PBName.PullUserSettingInput]: ['version', 'reserve'],\r\n    [PBName.PullUserSettingOutput]: ['items', 'version'],\r\n    [PBName.SessionReq]: ['time'],\r\n    [PBName.SessionStates]: ['version', 'state'],\r\n    [PBName.SessionState]: ['type', 'channelId', 'time', 'stateItem'],\r\n    [PBName.SessionStateItem]: ['sessionStateType', 'value'],\r\n    [PBName.SessionStateModifyReq]: ['version', 'state'],\r\n    [PBName.SessionStateModifyResp]: ['version']\r\n};\n\nconst Codec = {};\r\nfor (var key in SSMsg) {\r\n    const paramsList = SSMsg[key];\r\n    Codec[key] = () => {\r\n        const data = {};\r\n        const ins = {\r\n            getArrayData() {\r\n                return data;\r\n            }\r\n        };\r\n        for (let i = 0; i < paramsList.length; i++) {\r\n            const param = paramsList[i];\r\n            const setEventName = `set${toUpperCase(param, 0, 1)}`;\r\n            ins[setEventName] = (item) => {\r\n                data[param] = item;\r\n            };\r\n        }\r\n        return ins;\r\n    };\r\n    Codec[key].decode = function (data) {\r\n        const decodeResult = {};\r\n        if (isString(data)) {\r\n            data = JSON.parse(data);\r\n        }\r\n        for (const key in data) {\r\n            const getEventName = `get${toUpperCase(key, 0, 1)}`;\r\n            decodeResult[key] = data[key];\r\n            decodeResult[getEventName] = () => {\r\n                return data[key];\r\n            };\r\n        }\r\n        return decodeResult;\r\n    };\r\n}\r\nCodec.getModule = (pbName) => {\r\n    return Codec[pbName]();\r\n};\n\nconst SSMsg$1 = `\npackage Modules;\nmessage probuf {\n  message ${PBName.SetUserStatusInput}\n  {\n    optional int32 status=1;\n  }\n\n  message SetUserStatusOutput\n  {\n    optional int32 nothing=1;\n  }\n\n  message GetUserStatusInput\n  {\n    optional int32 nothing=1;\n  }\n\n  message GetUserStatusOutput\n  {\n    optional string status=1;\n    optional string subUserId=2;\n  }\n\n  message SubUserStatusInput\n  {\n    repeated string userid =1;\n  }\n\n  message SubUserStatusOutput\n  {\n    optional int32 nothing=1; \n  }\n  message VoipDynamicInput\n  {\n    required int32  engineType = 1;\n    required string channelName = 2;\n    optional string channelExtra = 3;\n  }\n\n  message VoipDynamicOutput\n  {\n      required string dynamicKey=1;\n  }\n  message ${PBName.NotifyMsg} {\n    required int32 type = 1;\n    optional int64 time = 2;\n    optional string chrmId=3;\n  }\n  message ${PBName.SyncRequestMsg} {\n    required int64 syncTime = 1;\n    required bool ispolling = 2;\n    optional bool isweb=3;\n    optional bool isPullSend=4;\n    optional bool isKeeping=5;\n    optional int64 sendBoxSyncTime=6;\n  }\n  message ${PBName.UpStreamMessage} {\n    required int32 sessionId = 1;\n    required string classname = 2;\n    required bytes content = 3;\n    optional string pushText = 4;\n    optional string appData = 5;\n    repeated string userId = 6;\n    optional int64 delMsgTime = 7;\n    optional string delMsgId = 8;\n    optional int32 configFlag = 9;\n    optional int64 clientUniqueId = 10;\n    optional string extraContent = 11;\n  }\n  message ${PBName.DownStreamMessages} {\n    repeated DownStreamMessage list = 1;\n    required int64 syncTime = 2;\n    optional bool finished = 3;\n  }\n  message ${PBName.DownStreamMessage} {\n    required string fromUserId = 1;\n    required ChannelType type = 2;\n    optional string groupId = 3;\n    required string classname = 4;\n    required bytes content = 5;\n    required int64 dataTime = 6;\n    required int64 status = 7;\n    optional int64 extra = 8;\n    optional string msgId = 9;\n    optional int32 direction = 10;\n    optional int32 plantform =11;\n    optional int32 isRemoved = 12; \n    optional string source = 13; \n    optional int64 clientUniqueId = 14; \n    optional string extraContent = 15; \n\n  }\n  enum ChannelType {\n    PERSON = 1;\n    PERSONS = 2;\n    GROUP = 3;\n    TEMPGROUP = 4;\n    CUSTOMERSERVICE = 5;\n    NOTIFY = 6;\n    MC=7;\n    MP=8;\n  }\n  message CreateDiscussionInput {\n    optional string name = 1;\n  }\n  message CreateDiscussionOutput {\n    required string id = 1;\n  }\n  message ChannelInvitationInput {\n    repeated string users = 1;\n  }\n  message LeaveChannelInput {\n    required int32 nothing = 1;\n  }\n  message ChannelEvictionInput {\n    required string user = 1;\n  }\n  message RenameChannelInput {\n    required string name = 1;\n  }\n  message ChannelInfoInput {\n    required int32 nothing = 1;\n  }\n  message ChannelInfoOutput {\n    required ChannelType type = 1;\n    required string channelId = 2;\n    required string channelName = 3;\n    required string adminUserId = 4;\n    repeated string firstTenUserIds = 5;\n    required int32 openStatus = 6;\n  }\n  message ChannelInfosInput {\n    required int32 page = 1;\n    optional int32 number = 2;\n  }\n  message ChannelInfosOutput {\n    repeated ChannelInfoOutput channels = 1;\n    required int32 total = 2;\n  }\n  message MemberInfo {\n    required string userId = 1;\n    required string userName = 2;\n    required string userPortrait = 3;\n    required string extension = 4;\n  }\n  message GroupMembersInput {\n    required int32 page = 1;\n    optional int32 number = 2;\n  }\n  message GroupMembersOutput {\n    repeated MemberInfo members = 1;\n    required int32 total = 2;\n  }\n  message GetUserInfoInput {\n    required int32 nothing = 1;\n  }\n  message GetUserInfoOutput {\n    required string userId = 1;\n    required string userName = 2;\n    required string userPortrait = 3;\n  }\n  message GetSessionIdInput {\n    required int32 nothing = 1;\n  }\n  message GetSessionIdOutput {\n    required int32 sessionId = 1;\n  }\n  enum FileType {\n    image = ${FileType$1.IMAGE};\n    audio = ${FileType$1.AUDIO};\n    video = ${FileType$1.VIDEO};\n    file = ${FileType$1.FILE};\n  }\n  message ${PBName.GetQNupTokenInput} {\n    required FileType type = 1;\n    optional string key = 2;\n  }\n  message ${PBName.GetQNdownloadUrlInput} {\n    required FileType type = 1;\n    required string key = 2;\n    optional string  fileName = 3;\n  }\n  message ${PBName.GetQNupTokenOutput} {\n    required int64 deadline = 1;\n    required string token = 2;\n    optional string bosToken = 3;\n    optional string bosDate = 4;\n    optional string path = 5;\n  }\n  message ${PBName.GetQNdownloadUrlOutput} {\n    required string downloadUrl = 1;\n  }\n  message Add2BlackListInput {\n    required string userId = 1;\n  }\n  message RemoveFromBlackListInput {\n    required string userId = 1;\n  }\n  message QueryBlackListInput {\n    required int32 nothing = 1;\n  }\n  message QueryBlackListOutput {\n    repeated string userIds = 1;\n  }\n  message BlackListStatusInput {\n    required string userId = 1;\n  }\n  message BlockPushInput {\n    required string blockeeId = 1;\n  }\n  message ModifyPermissionInput {\n    required int32 openStatus = 1;\n  }\n  message GroupInput {\n    repeated GroupInfo groupInfo = 1;\n  }\n  message GroupOutput {\n    required int32 nothing = 1;\n  }\n  message GroupInfo {\n    required string id = 1;\n    required string name = 2;\n  }\n  message GroupHashInput {\n    required string userId = 1;\n    required string groupHashCode = 2;\n  }\n  message GroupHashOutput {\n    required GroupHashType result = 1;\n  }\n  enum GroupHashType {\n    group_success = 0x00;\n    group_failure = 0x01;\n  }\n  message ${PBName.ChrmInput} {\n    required int32 nothing = 1;\n  }\n  message ChrmOutput {\n    required int32 nothing = 1;\n  }\n  message ${PBName.ChrmPullMsg} {\n    required int64 syncTime = 1;\n    required int32 count = 2;\n  }\n  \n  message ChrmPullMsgNew \n  {\n    required int32 count = 1;\n    required int64 syncTime = 2;\n    optional string chrmId=3;\n  }\n  message ${PBName.RelationQryInput}\n  {\n    optional ChannelType type = 1;\n    optional int32 count = 2;\n    optional int64 startTime = 3;\n    optional int32 order = 4;\n  }\n  message ${PBName.RelationsInput}\n  {\n    required ChannelType type = 1;\n    optional DownStreamMessage msg =2;\n    optional int32 count = 3;\n    optional int32 offset = 4;\n    optional int64 startTime = 5;\n    optional int64 endTime = 6;\n  }\n  message ${PBName.RelationsOutput}\n  {\n    repeated RelationInfo info = 1;\n  }\n  message RelationInfo\n  {\n    required ChannelType type = 1;\n    required string userId = 2;\n    optional DownStreamMessage msg =3;\n    optional int64 readMsgTime= 4;\n    optional int64 unreadCount= 5;\n  }\n  message RelationInfoReadTime\n  {\n    required ChannelType type = 1;\n    required int64 readMsgTime= 2;\n    required string targetId = 3;\n  }\n  message ${PBName.CleanHisMsgInput}\n  {\n      required string targetId = 1;\n      required int64 dataTime = 2;\n      optional int32 conversationType= 3;\n  }\n  message HistoryMessageInput\n  {\n    required string targetId = 1;\n    required int64 dataTime =2;\n    required int32 size  = 3;\n  }\n\n  message HistoryMessagesOuput\n  {\n    repeated DownStreamMessage list = 1;\n    required int64 syncTime = 2;\n    required int32 hasMsg = 3;\n  }\n  message ${PBName.QueryChatRoomInfoInput}\n  {\n    required int32 count= 1;\n    optional int32 order= 2;\n  }\n\n  message ${PBName.QueryChatRoomInfoOutput}\n  {\n    optional int32 userTotalNums = 1;\n    repeated ChrmMember userInfos = 2;\n  }\n  message ChrmMember\n  {\n    required int64 time = 1;\n    required string id = 2;\n  }\n  message MPFollowInput\n  {\n    required string id = 1;\n  }\n\n  message MPFollowOutput\n  {\n    required int32 nothing = 1;\n    optional MpInfo info =2;\n  }\n\n  message ${PBName.MCFollowInput}\n  {\n    required string id = 1;\n  }\n\n  message MCFollowOutput\n  {\n    required int32 nothing = 1;\n    optional MpInfo info =2;\n  }\n\n  message MpInfo  \n  {\n    required string mpid=1;\n    required string name = 2;\n    required string type = 3;\n    required int64 time=4;\n    optional string portraitUrl=5;\n    optional string extra =6;\n  }\n\n  message SearchMpInput\n  {\n    required int32 type=1;\n    required string id=2;\n  }\n\n  message SearchMpOutput\n  {\n    required int32 nothing=1;\n    repeated MpInfo info = 2;\n  }\n\n  message PullMpInput\n  {\n    required int64 time=1;\n    required string mpid=2;\n  }\n\n  message PullMpOutput\n  {\n    required int32 status=1;\n    repeated MpInfo info = 2;\n  }\n  message ${PBName.HistoryMsgInput}\n  {\n    optional string targetId = 1;\n    optional int64 time = 2;\n    optional int32 count  = 3;\n    optional int32 order = 4;\n  }\n\n  message ${PBName.HistoryMsgOuput}\n  {\n    repeated DownStreamMessage list=1;\n    required int64 syncTime=2;\n    required int32 hasMsg=3;\n  }\n  message ${PBName.RtcQueryListInput}{\n    optional int32 order=1;\n  }\n\n  message ${PBName.RtcKeyDeleteInput}{\n    repeated string key=1;\n  }\n\n  message ${PBName.RtcValueInfo}{\n    required string key=1;\n    required string value=2;\n  }\n\n  message RtcUserInfo{\n    required string userId=1;\n    repeated ${PBName.RtcValueInfo} userData=2;\n  }\n\n  message ${PBName.RtcUserListOutput}{\n    repeated RtcUserInfo list=1;\n    optional string token=2;\n    optional string sessionId=3;\n  }\n  message RtcRoomInfoOutput{\n    optional string roomId = 1;\n    repeated ${PBName.RtcValueInfo} roomData = 2;\n    optional int32 userCount = 3;\n    repeated RtcUserInfo list=4;\n  }\n  message ${PBName.RtcInput}{\n    required int32 roomType=1;\n    optional int32 broadcastType=2;\n  }\n  message RtcQryInput{ \n    required bool isInterior=1;\n    required targetType target=2;\n    repeated string key=3;\n  }\n  message ${PBName.RtcQryOutput}{\n    repeated ${PBName.RtcValueInfo} outInfo=1;\n  }\n  message RtcDelDataInput{\n    repeated string key=1;\n    required bool isInterior=2;\n    required targetType target=3;\n  }\n  message ${PBName.RtcDataInput}{ \n    required bool interior=1;\n    required targetType target=2;\n    repeated string key=3;\n    optional string objectName=4;\n    optional string content=5;\n  }\n  message ${PBName.RtcSetDataInput}{\n    required bool interior=1;\n    required targetType target=2;\n    required string key=3;\n    required string value=4;\n    optional string objectName=5;\n    optional string content=6;\n  }\n  message ${PBName.RtcUserSetDataInput} {\n    repeated ${PBName.RtcValueInfo} valueInfo = 1;\n    required string objectName = 2;\n    repeated ${PBName.RtcValueInfo} content = 3;\n  }\n  message RtcOutput\n  {\n    optional int32 nothing=1; \n  }\n  message ${PBName.RtcTokenOutput}{\n    required string rtcToken=1;\n  }\n  enum targetType {\n    ROOM =1 ;\n    PERSON = 2;\n  }\n  message ${PBName.RtcSetOutDataInput}{\n    required targetType target=1;\n    repeated ${PBName.RtcValueInfo} valueInfo=2;\n    optional string objectName=3;\n    optional string content=4;\n  }\n  message ${PBName.RtcQryUserOutDataInput}{\n    repeated string userId = 1;\n  }\n  message ${PBName.RtcUserOutDataOutput}{\n    repeated RtcUserInfo user = 1;\n  }\n  message ${PBName.SessionsAttQryInput}{\n    required int32 nothing = 1;\n  }\n  message ${PBName.SessionsAttOutput}{\n    required int64 inboxTime = 1;\n    required int64 sendboxTime = 2;\n    required int64 totalUnreadCount = 3;\n  }\n  message ${PBName.SessionMsgReadInput}\n  {\n    required ChannelType type = 1;\n    required int64 msgTime = 2;\n    required string channelId = 3;\n  }\n  message SessionMsgReadOutput\n  {\n    optional int32 nothing=1; \n  }\n  message ${PBName.DeleteSessionsInput}\n  {\n    repeated SessionInfo sessions = 1;\n  }\n  message ${PBName.SessionInfo}\n  {\n    required ChannelType type = 1;\n    required string channelId = 2;\n  }\n  message ${PBName.DeleteSessionsOutput}\n  {\n    optional int32 nothing=1; \n  }\n  message ${PBName.DeleteMsgInput}\n  {\n    optional ChannelType type = 1;\n    optional string conversationId = 2;\n    repeated DeleteMsg msgs = 3;\n  }\n  message DeleteMsg\n  {\n    optional string msgId = 1;\n    optional int64 msgDataTime = 2;\n    optional int32 direct = 3;\n  }\n  message ChrmKVEntity {\n    required string key = 1;\n    required string value = 2;\n    optional int32 status = 3;\n    optional int64 timestamp = 4;\n    optional string uid = 5;\n  }\n  message ${PBName.SetChrmKV} {\n    required ChrmKVEntity entry = 1;\n    optional bool bNotify = 2;\n    optional UpStreamMessage notification = 3;\n    optional ChannelType type = 4;\n  }\n  message ${PBName.ChrmKVOutput} {\n    repeated ChrmKVEntity entries = 1;\n    optional bool bFullUpdate = 2;\n    optional int64 syncTime = 3;\n  }\n  message ${PBName.QueryChrmKV} {\n    required int64 timestamp = 1;\n  }\n  message ${PBName.SetUserSettingInput} {\n    required int64 version=1;\n    required string value=2;\n  }\n  message ${PBName.SetUserSettingOutput} {\n    required int64 version=1;\n    required bool reserve=2;\n  }\n  message ${PBName.PullUserSettingInput} {\n    required int64 version=1;//\n    optional bool reserve=2;\n  }\n  message ${PBName.PullUserSettingOutput} {\n    repeated UserSettingItem items = 1;\n    required int64 version=2;\n  }\n  message UserSettingItem {\n    required string targetId= 1;\n    required ChannelType type = 2;\n    required string key = 4;\n    required bytes value = 5;\n    required int64 version=6;\n    required int32 status=7;\n  }\n  message ${PBName.SessionReq} {\n    required int64 time = 1;\n  }\n  message ${PBName.SessionStates} {\n    required int64 version=1;\n    repeated SessionState state= 2;\n  }\n  message ${PBName.SessionState} {\n    required ChannelType type = 1;\n    required string channelId = 2;  \n    optional int64 time = 3;\n    repeated SessionStateItem stateItem = 4;\n  }\n  message ${PBName.SessionStateItem} {\n    required SessionStateType sessionStateType = 1;\n    required string value = 2;\n  }\n  enum SessionStateType {\n    IsSilent = 1;\n    IsTop = 2;\n  }\n  message ${PBName.SessionStateModifyReq} {\n    required int64 version=1;\n    repeated SessionState state= 2;\n  }\n  message ${PBName.SessionStateModifyResp} {\n    required int64 version=1;\n  }\n}\n`;\n\nfunction protobuf (a) {\n var c = (function () { function a (a, b, c) { this.low = 0 | a, this.high = 0 | b, this.unsigned = !!c; } function b (a) { return (a && a.__isLong__) === !0 } function e (a, b) { var e, f, h; return b ? (a >>>= 0, (h = a >= 0 && a < 256) && (f = d[a]) ? f : (e = g(a, (0 | a) < 0 ? -1 : 0, !0), h && (d[a] = e), e)) : (a |= 0, (h = a >= -128 && a < 128) && (f = c[a]) ? f : (e = g(a, a < 0 ? -1 : 0, !1), h && (c[a] = e), e)) } function f (a, b) { if (isNaN(a) || !isFinite(a)) return b ? r : q; if (b) { if (a < 0) return r; if (a >= n) return w } else { if (-o >= a) return x; if (a + 1 >= o) return v } return a < 0 ? f(-a, b).neg() : g(0 | a % m, 0 | a / m, b) } function g (b, c, d) { return new a(b, c, d) } function i (a, b, c) { var d, e, g, j, k, l, m; if (a.length === 0) throw Error('empty string'); if (a === 'NaN' || a === 'Infinity' || a === '+Infinity' || a === '-Infinity') return q; if (typeof b === 'number' ? (c = b, b = !1) : b = !!b, c = c || 10, c < 2 || c > 36) throw RangeError('radix'); if ((d = a.indexOf('-')) > 0) throw Error('interior hyphen'); if (d === 0) return i(a.substring(1), b, c).neg(); for (e = f(h(c, 8)), g = q, j = 0; j < a.length; j += 8)k = Math.min(8, a.length - j), l = parseInt(a.substring(j, j + k), c), k < 8 ? (m = f(h(c, k)), g = g.mul(m).add(f(l))) : (g = g.mul(e), g = g.add(f(l))); return g.unsigned = b, g } function j (b) { return b instanceof a ? b : typeof b === 'number' ? f(b) : typeof b === 'string' ? i(b) : g(b.low, b.high, b.unsigned) } var c, d, h, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y; return a.prototype.__isLong__, Object.defineProperty(a.prototype, '__isLong__', { value: !0, enumerable: !1, configurable: !1 }), a.isLong = b, c = {}, d = {}, a.fromInt = e, a.fromNumber = f, a.fromBits = g, h = Math.pow, a.fromString = i, a.fromValue = j, k = 65536, l = 1 << 24, m = k * k, n = m * m, o = n / 2, p = e(l), q = e(0), a.ZERO = q, r = e(0, !0), a.UZERO = r, s = e(1), a.ONE = s, t = e(1, !0), a.UONE = t, u = e(-1), a.NEG_ONE = u, v = g(-1, 2147483647, !1), a.MAX_VALUE = v, w = g(-1, -1, !0), a.MAX_UNSIGNED_VALUE = w, x = g(0, -2147483648, !1), a.MIN_VALUE = x, y = a.prototype, y.toInt = function () { return this.unsigned ? this.low >>> 0 : this.low }, y.toNumber = function () { return this.unsigned ? (this.high >>> 0) * m + (this.low >>> 0) : this.high * m + (this.low >>> 0) }, y.toString = function (a) { var b, c, d, e, g, i, j, k, l; if (a = a || 10, a < 2 || a > 36) throw RangeError('radix'); if (this.isZero()) return '0'; if (this.isNegative()) return this.eq(x) ? (b = f(a), c = this.div(b), d = c.mul(b).sub(this), c.toString(a) + d.toInt().toString(a)) : '-' + this.neg().toString(a); for (e = f(h(a, 6), this.unsigned), g = this, i = ''; ;) { if (j = g.div(e), k = g.sub(j.mul(e)).toInt() >>> 0, l = k.toString(a), g = j, g.isZero()) return l + i; for (;l.length < 6;)l = '0' + l; i = '' + l + i; } }, y.getHighBits = function () { return this.high }, y.getHighBitsUnsigned = function () { return this.high >>> 0 }, y.getLowBits = function () { return this.low }, y.getLowBitsUnsigned = function () { return this.low >>> 0 }, y.getNumBitsAbs = function () { var a, b; if (this.isNegative()) return this.eq(x) ? 64 : this.neg().getNumBitsAbs(); for (a = this.high != 0 ? this.high : this.low, b = 31; b > 0 && (a & 1 << b) == 0; b--);return this.high != 0 ? b + 33 : b + 1 }, y.isZero = function () { return this.high === 0 && this.low === 0 }, y.isNegative = function () { return !this.unsigned && this.high < 0 }, y.isPositive = function () { return this.unsigned || this.high >= 0 }, y.isOdd = function () { return (1 & this.low) === 1 }, y.isEven = function () { return (1 & this.low) === 0 }, y.equals = function (a) { return b(a) || (a = j(a)), this.unsigned !== a.unsigned && this.high >>> 31 === 1 && a.high >>> 31 === 1 ? !1 : this.high === a.high && this.low === a.low }, y.eq = y.equals, y.notEquals = function (a) { return !this.eq(a) }, y.neq = y.notEquals, y.lessThan = function (a) { return this.comp(a) < 0 }, y.lt = y.lessThan, y.lessThanOrEqual = function (a) { return this.comp(a) <= 0 }, y.lte = y.lessThanOrEqual, y.greaterThan = function (a) { return this.comp(a) > 0 }, y.gt = y.greaterThan, y.greaterThanOrEqual = function (a) { return this.comp(a) >= 0 }, y.gte = y.greaterThanOrEqual, y.compare = function (a) { if (b(a) || (a = j(a)), this.eq(a)) return 0; var c = this.isNegative(); var d = a.isNegative(); return c && !d ? -1 : !c && d ? 1 : this.unsigned ? a.high >>> 0 > this.high >>> 0 || a.high === this.high && a.low >>> 0 > this.low >>> 0 ? -1 : 1 : this.sub(a).isNegative() ? -1 : 1 }, y.comp = y.compare, y.negate = function () { return !this.unsigned && this.eq(x) ? x : this.not().add(s) }, y.neg = y.negate, y.add = function (a) { var c, d, e, f, h, i, k, l, m, n, o, p; return b(a) || (a = j(a)), c = this.high >>> 16, d = 65535 & this.high, e = this.low >>> 16, f = 65535 & this.low, h = a.high >>> 16, i = 65535 & a.high, k = a.low >>> 16, l = 65535 & a.low, m = 0, n = 0, o = 0, p = 0, p += f + l, o += p >>> 16, p &= 65535, o += e + k, n += o >>> 16, o &= 65535, n += d + i, m += n >>> 16, n &= 65535, m += c + h, m &= 65535, g(o << 16 | p, m << 16 | n, this.unsigned) }, y.subtract = function (a) { return b(a) || (a = j(a)), this.add(a.neg()) }, y.sub = y.subtract, y.multiply = function (a) { var c, d, e, h, i, k, l, m, n, o, r, s; return this.isZero() ? q : (b(a) || (a = j(a)), a.isZero() ? q : this.eq(x) ? a.isOdd() ? x : q : a.eq(x) ? this.isOdd() ? x : q : this.isNegative() ? a.isNegative() ? this.neg().mul(a.neg()) : this.neg().mul(a).neg() : a.isNegative() ? this.mul(a.neg()).neg() : this.lt(p) && a.lt(p) ? f(this.toNumber() * a.toNumber(), this.unsigned) : (c = this.high >>> 16, d = 65535 & this.high, e = this.low >>> 16, h = 65535 & this.low, i = a.high >>> 16, k = 65535 & a.high, l = a.low >>> 16, m = 65535 & a.low, n = 0, o = 0, r = 0, s = 0, s += h * m, r += s >>> 16, s &= 65535, r += e * m, o += r >>> 16, r &= 65535, r += h * l, o += r >>> 16, r &= 65535, o += d * m, n += o >>> 16, o &= 65535, o += e * l, n += o >>> 16, o &= 65535, o += h * k, n += o >>> 16, o &= 65535, n += c * m + d * l + e * k + h * i, n &= 65535, g(r << 16 | s, n << 16 | o, this.unsigned))) }, y.mul = y.multiply, y.divide = function (a) { var c, d, e, g, i, k, l, m; if (b(a) || (a = j(a)), a.isZero()) throw Error('division by zero'); if (this.isZero()) return this.unsigned ? r : q; if (this.unsigned) { if (a.unsigned || (a = a.toUnsigned()), a.gt(this)) return r; if (a.gt(this.shru(1))) return t; e = r; } else { if (this.eq(x)) return a.eq(s) || a.eq(u) ? x : a.eq(x) ? s : (g = this.shr(1), c = g.div(a).shl(1), c.eq(q) ? a.isNegative() ? s : u : (d = this.sub(a.mul(c)), e = c.add(d.div(a)))); if (a.eq(x)) return this.unsigned ? r : q; if (this.isNegative()) return a.isNegative() ? this.neg().div(a.neg()) : this.neg().div(a).neg(); if (a.isNegative()) return this.div(a.neg()).neg(); e = q; } for (d = this; d.gte(a);) { for (c = Math.max(1, Math.floor(d.toNumber() / a.toNumber())), i = Math.ceil(Math.log(c) / Math.LN2), k = i <= 48 ? 1 : h(2, i - 48), l = f(c), m = l.mul(a); m.isNegative() || m.gt(d);)c -= k, l = f(c, this.unsigned), m = l.mul(a); l.isZero() && (l = s), e = e.add(l), d = d.sub(m); } return e }, y.div = y.divide, y.modulo = function (a) { return b(a) || (a = j(a)), this.sub(this.div(a).mul(a)) }, y.mod = y.modulo, y.not = function () { return g(~this.low, ~this.high, this.unsigned) }, y.and = function (a) { return b(a) || (a = j(a)), g(this.low & a.low, this.high & a.high, this.unsigned) }, y.or = function (a) { return b(a) || (a = j(a)), g(this.low | a.low, this.high | a.high, this.unsigned) }, y.xor = function (a) { return b(a) || (a = j(a)), g(this.low ^ a.low, this.high ^ a.high, this.unsigned) }, y.shiftLeft = function (a) { return b(a) && (a = a.toInt()), (a &= 63) === 0 ? this : a < 32 ? g(this.low << a, this.high << a | this.low >>> 32 - a, this.unsigned) : g(0, this.low << a - 32, this.unsigned) }, y.shl = y.shiftLeft, y.shiftRight = function (a) { return b(a) && (a = a.toInt()), (a &= 63) === 0 ? this : a < 32 ? g(this.low >>> a | this.high << 32 - a, this.high >> a, this.unsigned) : g(this.high >> a - 32, this.high >= 0 ? 0 : -1, this.unsigned) }, y.shr = y.shiftRight, y.shiftRightUnsigned = function (a) { var c, d; return b(a) && (a = a.toInt()), a &= 63, a === 0 ? this : (c = this.high, a < 32 ? (d = this.low, g(d >>> a | c << 32 - a, c >>> a, this.unsigned)) : a === 32 ? g(c, 0, this.unsigned) : g(c >>> a - 32, 0, this.unsigned)) }, y.shru = y.shiftRightUnsigned, y.toSigned = function () { return this.unsigned ? g(this.low, this.high, !1) : this }, y.toUnsigned = function () { return this.unsigned ? this : g(this.low, this.high, !0) }, y.toBytes = function (a) { return a ? this.toBytesLE() : this.toBytesBE() }, y.toBytesLE = function () { var a = this.high; var b = this.low; return [255 & b, 255 & b >>> 8, 255 & b >>> 16, 255 & b >>> 24, 255 & a, 255 & a >>> 8, 255 & a >>> 16, 255 & a >>> 24] }, y.toBytesBE = function () { var a = this.high; var b = this.low; return [255 & a >>> 24, 255 & a >>> 16, 255 & a >>> 8, 255 & a, 255 & b >>> 24, 255 & b >>> 16, 255 & b >>> 8, 255 & b] }, a }()); var d = (function (a) {\n    function f (a) { var b = 0; return function () { return b < a.length ? a.charCodeAt(b++) : null } } function g () { var a = []; var b = []; return function () { return arguments.length === 0 ? b.join('') + e.apply(String, a) : (a.length + arguments.length > 1024 && (b.push(e.apply(String, a)), a.length = 0), Array.prototype.push.apply(a, arguments), void 0) } } function h (a, b, c, d, e) { var f; var g; var h = 8 * e - d - 1; var i = (1 << h) - 1; var j = i >> 1; var k = -7; var l = c ? e - 1 : 0; var m = c ? -1 : 1; var n = a[b + l]; for (l += m, f = n & (1 << -k) - 1, n >>= -k, k += h; k > 0; f = 256 * f + a[b + l], l += m, k -= 8);for (g = f & (1 << -k) - 1, f >>= -k, k += d; k > 0; g = 256 * g + a[b + l], l += m, k -= 8);if (f === 0)f = 1 - j; else { if (f === i) return g ? 0 / 0 : 1 / 0 * (n ? -1 : 1); g += Math.pow(2, d), f -= j; } return (n ? -1 : 1) * g * Math.pow(2, f - d) } function i (a, b, c, d, e, f) { var g; var h; var i; var j = 8 * f - e - 1; var k = (1 << j) - 1; var l = k >> 1; var m = e === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0; var n = d ? 0 : f - 1; var o = d ? 1 : -1; var p = b < 0 || b === 0 && 1 / b < 0 ? 1 : 0; for (b = Math.abs(b), isNaN(b) || 1 / 0 === b ? (h = isNaN(b) ? 1 : 0, g = k) : (g = Math.floor(Math.log(b) / Math.LN2), b * (i = Math.pow(2, -g)) < 1 && (g--, i *= 2), b += g + l >= 1 ? m / i : m * Math.pow(2, 1 - l), b * i >= 2 && (g++, i /= 2), g + l >= k ? (h = 0, g = k) : g + l >= 1 ? (h = (b * i - 1) * Math.pow(2, e), g += l) : (h = b * Math.pow(2, l - 1) * Math.pow(2, e), g = 0)); e >= 8; a[c + n] = 255 & h, n += o, h /= 256, e -= 8);for (g = g << e | h, j += e; j > 0; a[c + n] = 255 & g, n += o, g /= 256, j -= 8);a[c + n - o] |= 128 * p; } var c; var d; var e; var j; var k; var b = function (a, c, e) { if (typeof a === 'undefined' && (a = b.DEFAULT_CAPACITY), typeof c === 'undefined' && (c = b.DEFAULT_ENDIAN), typeof e === 'undefined' && (e = b.DEFAULT_NOASSERT), !e) { if (a = 0 | a, a < 0) throw RangeError('Illegal capacity'); c = !!c, e = !!e; } this.buffer = a === 0 ? d : new ArrayBuffer(a), this.view = a === 0 ? null : new Uint8Array(this.buffer), this.offset = 0, this.markedOffset = -1, this.limit = a, this.littleEndian = c, this.noAssert = e; }; return b.VERSION = '5.0.1', b.LITTLE_ENDIAN = !0, b.BIG_ENDIAN = !1, b.DEFAULT_CAPACITY = 16, b.DEFAULT_ENDIAN = b.BIG_ENDIAN, b.DEFAULT_NOASSERT = !1, b.Long = a || null, c = b.prototype, c.__isByteBuffer__, Object.defineProperty(c, '__isByteBuffer__', { value: !0, enumerable: !1, configurable: !1 }), d = new ArrayBuffer(0), e = String.fromCharCode, b.accessor = function () { return Uint8Array }, b.allocate = function (a, c, d) { return new b(a, c, d) }, b.concat = function (a, c, d, e) { var f, i, g, h, k, j; for ((typeof c === 'boolean' || typeof c !== 'string') && (e = d, d = c, c = void 0), f = 0, g = 0, h = a.length; h > g; ++g)b.isByteBuffer(a[g]) || (a[g] = b.wrap(a[g], c)), i = a[g].limit - a[g].offset, i > 0 && (f += i); if (f === 0) return new b(0, d, e); for (j = new b(f, d, e), g = 0; h > g;)k = a[g++], i = k.limit - k.offset, i <= 0 || (j.view.set(k.view.subarray(k.offset, k.limit), j.offset), j.offset += i); return j.limit = j.offset, j.offset = 0, j }, b.isByteBuffer = function (a) { return (a && a.__isByteBuffer__) === !0 }, b.type = function () { return ArrayBuffer }, b.wrap = function (a, d, e, f) { var g, h; if (typeof d !== 'string' && (f = e, e = d, d = void 0), typeof a === 'string') switch (typeof d === 'undefined' && (d = 'utf8'), d) { case 'base64':return b.fromBase64(a, e); case 'hex':return b.fromHex(a, e); case 'binary':return b.fromBinary(a, e); case 'utf8':return b.fromUTF8(a, e); case 'debug':return b.fromDebug(a, e); default:throw Error('Unsupported encoding: ' + d) } if (a === null || typeof a !== 'object') throw TypeError('Illegal buffer'); if (b.isByteBuffer(a)) return g = c.clone.call(a), g.markedOffset = -1, g; if (a instanceof Uint8Array)g = new b(0, e, f), a.length > 0 && (g.buffer = a.buffer, g.offset = a.byteOffset, g.limit = a.byteOffset + a.byteLength, g.view = new Uint8Array(a.buffer)); else if (a instanceof ArrayBuffer)g = new b(0, e, f), a.byteLength > 0 && (g.buffer = a, g.offset = 0, g.limit = a.byteLength, g.view = a.byteLength > 0 ? new Uint8Array(a) : null); else { if (Object.prototype.toString.call(a) !== '[object Array]') throw TypeError('Illegal buffer'); for (g = new b(a.length, e, f), g.limit = a.length, h = 0; h < a.length; ++h)g.view[h] = a[h]; } return g }, c.writeBitSet = function (a, b) { var h; var d; var e; var f; var g; var i; var c = typeof b === 'undefined'; if (c && (b = this.offset), !this.noAssert) { if (!(a instanceof Array)) throw TypeError('Illegal BitSet: Not an array'); if (typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal offset: ' + b + ' (not an integer)'); if (b >>>= 0, b < 0 || b + 0 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + b + ' (+' + 0 + ') <= ' + this.buffer.byteLength) } for (d = b, e = a.length, f = e >> 3, g = 0, b += this.writeVarint32(e, b); f--;)h = 1 & !!a[g++] | (1 & !!a[g++]) << 1 | (1 & !!a[g++]) << 2 | (1 & !!a[g++]) << 3 | (1 & !!a[g++]) << 4 | (1 & !!a[g++]) << 5 | (1 & !!a[g++]) << 6 | (1 & !!a[g++]) << 7, this.writeByte(h, b++); if (e > g) { for (i = 0, h = 0; e > g;)h |= (1 & !!a[g++]) << i++; this.writeByte(h, b++); } return c ? (this.offset = b, this) : b - d }, c.readBitSet = function (a) { var h; var c; var d; var e; var f; var g; var i; var b = typeof a === 'undefined'; for (b && (a = this.offset), c = this.readVarint32(a), d = c.value, e = d >> 3, f = 0, g = [], a += c.length; e--;)h = this.readByte(a++), g[f++] = !!(1 & h), g[f++] = !!(2 & h), g[f++] = !!(4 & h), g[f++] = !!(8 & h), g[f++] = !!(16 & h), g[f++] = !!(32 & h), g[f++] = !!(64 & h), g[f++] = !!(128 & h); if (d > f) for (i = 0, h = this.readByte(a++); d > f;)g[f++] = !!(1 & h >> i++); return b && (this.offset = a), g }, c.readBytes = function (a, b) { var d; var c = typeof b === 'undefined'; if (c && (b = this.offset), !this.noAssert) { if (typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal offset: ' + b + ' (not an integer)'); if (b >>>= 0, b < 0 || b + a > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + b + ' (+' + a + ') <= ' + this.buffer.byteLength) } return d = this.slice(b, b + a), c && (this.offset += a), d }, c.writeBytes = c.append, c.writeInt8 = function (a, b) { var d; var c = typeof b === 'undefined'; if (c && (b = this.offset), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal value: ' + a + ' (not an integer)'); if (a |= 0, typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal offset: ' + b + ' (not an integer)'); if (b >>>= 0, b < 0 || b + 0 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + b + ' (+' + 0 + ') <= ' + this.buffer.byteLength) } return b += 1, d = this.buffer.byteLength, b > d && this.resize((d *= 2) > b ? d : b), b -= 1, this.view[b] = a, c && (this.offset += 1), this }, c.writeByte = c.writeInt8, c.readInt8 = function (a) { var c; var b = typeof a === 'undefined'; if (b && (a = this.offset), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal offset: ' + a + ' (not an integer)'); if (a >>>= 0, a < 0 || a + 1 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + a + ' (+' + 1 + ') <= ' + this.buffer.byteLength) } return c = this.view[a], (128 & c) === 128 && (c = -(255 - c + 1)), b && (this.offset += 1), c }, c.readByte = c.readInt8, c.writeUint8 = function (a, b) { var d; var c = typeof b === 'undefined'; if (c && (b = this.offset), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal value: ' + a + ' (not an integer)'); if (a >>>= 0, typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal offset: ' + b + ' (not an integer)'); if (b >>>= 0, b < 0 || b + 0 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + b + ' (+' + 0 + ') <= ' + this.buffer.byteLength) } return b += 1, d = this.buffer.byteLength, b > d && this.resize((d *= 2) > b ? d : b), b -= 1, this.view[b] = a, c && (this.offset += 1), this }, c.writeUInt8 = c.writeUint8, c.readUint8 = function (a) { var c; var b = typeof a === 'undefined'; if (b && (a = this.offset), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal offset: ' + a + ' (not an integer)'); if (a >>>= 0, a < 0 || a + 1 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + a + ' (+' + 1 + ') <= ' + this.buffer.byteLength) } return c = this.view[a], b && (this.offset += 1), c }, c.readUInt8 = c.readUint8, c.writeInt16 = function (a, b) { var d; var c = typeof b === 'undefined'; if (c && (b = this.offset), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal value: ' + a + ' (not an integer)'); if (a |= 0, typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal offset: ' + b + ' (not an integer)'); if (b >>>= 0, b < 0 || b + 0 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + b + ' (+' + 0 + ') <= ' + this.buffer.byteLength) } return b += 2, d = this.buffer.byteLength, b > d && this.resize((d *= 2) > b ? d : b), b -= 2, this.littleEndian ? (this.view[b + 1] = (65280 & a) >>> 8, this.view[b] = 255 & a) : (this.view[b] = (65280 & a) >>> 8, this.view[b + 1] = 255 & a), c && (this.offset += 2), this }, c.writeShort = c.writeInt16, c.readInt16 = function (a) { var c; var b = typeof a === 'undefined'; if (b && (a = this.offset), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal offset: ' + a + ' (not an integer)'); if (a >>>= 0, a < 0 || a + 2 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + a + ' (+' + 2 + ') <= ' + this.buffer.byteLength) } return c = 0, this.littleEndian ? (c = this.view[a], c |= this.view[a + 1] << 8) : (c = this.view[a] << 8, c |= this.view[a + 1]), (32768 & c) === 32768 && (c = -(65535 - c + 1)), b && (this.offset += 2), c }, c.readShort = c.readInt16, c.writeUint16 = function (a, b) { var d; var c = typeof b === 'undefined'; if (c && (b = this.offset), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal value: ' + a + ' (not an integer)'); if (a >>>= 0, typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal offset: ' + b + ' (not an integer)'); if (b >>>= 0, b < 0 || b + 0 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + b + ' (+' + 0 + ') <= ' + this.buffer.byteLength) } return b += 2, d = this.buffer.byteLength, b > d && this.resize((d *= 2) > b ? d : b), b -= 2, this.littleEndian ? (this.view[b + 1] = (65280 & a) >>> 8, this.view[b] = 255 & a) : (this.view[b] = (65280 & a) >>> 8, this.view[b + 1] = 255 & a), c && (this.offset += 2), this }, c.writeUInt16 = c.writeUint16, c.readUint16 = function (a) { var c; var b = typeof a === 'undefined'; if (b && (a = this.offset), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal offset: ' + a + ' (not an integer)'); if (a >>>= 0, a < 0 || a + 2 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + a + ' (+' + 2 + ') <= ' + this.buffer.byteLength) } return c = 0, this.littleEndian ? (c = this.view[a], c |= this.view[a + 1] << 8) : (c = this.view[a] << 8, c |= this.view[a + 1]), b && (this.offset += 2), c }, c.readUInt16 = c.readUint16, c.writeInt32 = function (a, b) { var d; var c = typeof b === 'undefined'; if (c && (b = this.offset), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal value: ' + a + ' (not an integer)'); if (a |= 0, typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal offset: ' + b + ' (not an integer)'); if (b >>>= 0, b < 0 || b + 0 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + b + ' (+' + 0 + ') <= ' + this.buffer.byteLength) } return b += 4, d = this.buffer.byteLength, b > d && this.resize((d *= 2) > b ? d : b), b -= 4, this.littleEndian ? (this.view[b + 3] = 255 & a >>> 24, this.view[b + 2] = 255 & a >>> 16, this.view[b + 1] = 255 & a >>> 8, this.view[b] = 255 & a) : (this.view[b] = 255 & a >>> 24, this.view[b + 1] = 255 & a >>> 16, this.view[b + 2] = 255 & a >>> 8, this.view[b + 3] = 255 & a), c && (this.offset += 4), this }, c.writeInt = c.writeInt32, c.readInt32 = function (a) { var c; var b = typeof a === 'undefined'; if (b && (a = this.offset), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal offset: ' + a + ' (not an integer)'); if (a >>>= 0, a < 0 || a + 4 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + a + ' (+' + 4 + ') <= ' + this.buffer.byteLength) } return c = 0, this.littleEndian ? (c = this.view[a + 2] << 16, c |= this.view[a + 1] << 8, c |= this.view[a], c += this.view[a + 3] << 24 >>> 0) : (c = this.view[a + 1] << 16, c |= this.view[a + 2] << 8, c |= this.view[a + 3], c += this.view[a] << 24 >>> 0), c |= 0, b && (this.offset += 4), c }, c.readInt = c.readInt32, c.writeUint32 = function (a, b) { var d; var c = typeof b === 'undefined'; if (c && (b = this.offset), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal value: ' + a + ' (not an integer)'); if (a >>>= 0, typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal offset: ' + b + ' (not an integer)'); if (b >>>= 0, b < 0 || b + 0 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + b + ' (+' + 0 + ') <= ' + this.buffer.byteLength) } return b += 4, d = this.buffer.byteLength, b > d && this.resize((d *= 2) > b ? d : b), b -= 4, this.littleEndian ? (this.view[b + 3] = 255 & a >>> 24, this.view[b + 2] = 255 & a >>> 16, this.view[b + 1] = 255 & a >>> 8, this.view[b] = 255 & a) : (this.view[b] = 255 & a >>> 24, this.view[b + 1] = 255 & a >>> 16, this.view[b + 2] = 255 & a >>> 8, this.view[b + 3] = 255 & a), c && (this.offset += 4), this }, c.writeUInt32 = c.writeUint32, c.readUint32 = function (a) { var c; var b = typeof a === 'undefined'; if (b && (a = this.offset), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal offset: ' + a + ' (not an integer)'); if (a >>>= 0, a < 0 || a + 4 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + a + ' (+' + 4 + ') <= ' + this.buffer.byteLength) } return c = 0, this.littleEndian ? (c = this.view[a + 2] << 16, c |= this.view[a + 1] << 8, c |= this.view[a], c += this.view[a + 3] << 24 >>> 0) : (c = this.view[a + 1] << 16, c |= this.view[a + 2] << 8, c |= this.view[a + 3], c += this.view[a] << 24 >>> 0), b && (this.offset += 4), c }, c.readUInt32 = c.readUint32, a && (c.writeInt64 = function (b, c) { var e; var f; var g; var d = typeof c === 'undefined'; if (d && (c = this.offset), !this.noAssert) { if (typeof b === 'number')b = a.fromNumber(b); else if (typeof b === 'string')b = a.fromString(b); else if (!(b && b instanceof a)) throw TypeError('Illegal value: ' + b + ' (not an integer or Long)'); if (typeof c !== 'number' || c % 1 !== 0) throw TypeError('Illegal offset: ' + c + ' (not an integer)'); if (c >>>= 0, c < 0 || c + 0 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + c + ' (+' + 0 + ') <= ' + this.buffer.byteLength) } return typeof b === 'number' ? b = a.fromNumber(b) : typeof b === 'string' && (b = a.fromString(b)), c += 8, e = this.buffer.byteLength, c > e && this.resize((e *= 2) > c ? e : c), c -= 8, f = b.low, g = b.high, this.littleEndian ? (this.view[c + 3] = 255 & f >>> 24, this.view[c + 2] = 255 & f >>> 16, this.view[c + 1] = 255 & f >>> 8, this.view[c] = 255 & f, c += 4, this.view[c + 3] = 255 & g >>> 24, this.view[c + 2] = 255 & g >>> 16, this.view[c + 1] = 255 & g >>> 8, this.view[c] = 255 & g) : (this.view[c] = 255 & g >>> 24, this.view[c + 1] = 255 & g >>> 16, this.view[c + 2] = 255 & g >>> 8, this.view[c + 3] = 255 & g, c += 4, this.view[c] = 255 & f >>> 24, this.view[c + 1] = 255 & f >>> 16, this.view[c + 2] = 255 & f >>> 8, this.view[c + 3] = 255 & f), d && (this.offset += 8), this }, c.writeLong = c.writeInt64, c.readInt64 = function (b) { var d; var e; var f; var c = typeof b === 'undefined'; if (c && (b = this.offset), !this.noAssert) { if (typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal offset: ' + b + ' (not an integer)'); if (b >>>= 0, b < 0 || b + 8 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + b + ' (+' + 8 + ') <= ' + this.buffer.byteLength) } return d = 0, e = 0, this.littleEndian ? (d = this.view[b + 2] << 16, d |= this.view[b + 1] << 8, d |= this.view[b], d += this.view[b + 3] << 24 >>> 0, b += 4, e = this.view[b + 2] << 16, e |= this.view[b + 1] << 8, e |= this.view[b], e += this.view[b + 3] << 24 >>> 0) : (e = this.view[b + 1] << 16, e |= this.view[b + 2] << 8, e |= this.view[b + 3], e += this.view[b] << 24 >>> 0, b += 4, d = this.view[b + 1] << 16, d |= this.view[b + 2] << 8, d |= this.view[b + 3], d += this.view[b] << 24 >>> 0), f = new a(d, e, !1), c && (this.offset += 8), f }, c.readLong = c.readInt64, c.writeUint64 = function (b, c) { var e; var f; var g; var d = typeof c === 'undefined'; if (d && (c = this.offset), !this.noAssert) { if (typeof b === 'number')b = a.fromNumber(b); else if (typeof b === 'string')b = a.fromString(b); else if (!(b && b instanceof a)) throw TypeError('Illegal value: ' + b + ' (not an integer or Long)'); if (typeof c !== 'number' || c % 1 !== 0) throw TypeError('Illegal offset: ' + c + ' (not an integer)'); if (c >>>= 0, c < 0 || c + 0 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + c + ' (+' + 0 + ') <= ' + this.buffer.byteLength) } return typeof b === 'number' ? b = a.fromNumber(b) : typeof b === 'string' && (b = a.fromString(b)), c += 8, e = this.buffer.byteLength, c > e && this.resize((e *= 2) > c ? e : c), c -= 8, f = b.low, g = b.high, this.littleEndian ? (this.view[c + 3] = 255 & f >>> 24, this.view[c + 2] = 255 & f >>> 16, this.view[c + 1] = 255 & f >>> 8, this.view[c] = 255 & f, c += 4, this.view[c + 3] = 255 & g >>> 24, this.view[c + 2] = 255 & g >>> 16, this.view[c + 1] = 255 & g >>> 8, this.view[c] = 255 & g) : (this.view[c] = 255 & g >>> 24, this.view[c + 1] = 255 & g >>> 16, this.view[c + 2] = 255 & g >>> 8, this.view[c + 3] = 255 & g, c += 4, this.view[c] = 255 & f >>> 24, this.view[c + 1] = 255 & f >>> 16, this.view[c + 2] = 255 & f >>> 8, this.view[c + 3] = 255 & f), d && (this.offset += 8), this }, c.writeUInt64 = c.writeUint64, c.readUint64 = function (b) { var d; var e; var f; var c = typeof b === 'undefined'; if (c && (b = this.offset), !this.noAssert) { if (typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal offset: ' + b + ' (not an integer)'); if (b >>>= 0, b < 0 || b + 8 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + b + ' (+' + 8 + ') <= ' + this.buffer.byteLength) } return d = 0, e = 0, this.littleEndian ? (d = this.view[b + 2] << 16, d |= this.view[b + 1] << 8, d |= this.view[b], d += this.view[b + 3] << 24 >>> 0, b += 4, e = this.view[b + 2] << 16, e |= this.view[b + 1] << 8, e |= this.view[b], e += this.view[b + 3] << 24 >>> 0) : (e = this.view[b + 1] << 16, e |= this.view[b + 2] << 8, e |= this.view[b + 3], e += this.view[b] << 24 >>> 0, b += 4, d = this.view[b + 1] << 16, d |= this.view[b + 2] << 8, d |= this.view[b + 3], d += this.view[b] << 24 >>> 0), f = new a(d, e, !0), c && (this.offset += 8), f }, c.readUInt64 = c.readUint64), c.writeFloat32 = function (a, b) { var d; var c = typeof b === 'undefined'; if (c && (b = this.offset), !this.noAssert) { if (typeof a !== 'number') throw TypeError('Illegal value: ' + a + ' (not a number)'); if (typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal offset: ' + b + ' (not an integer)'); if (b >>>= 0, b < 0 || b + 0 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + b + ' (+' + 0 + ') <= ' + this.buffer.byteLength) } return b += 4, d = this.buffer.byteLength, b > d && this.resize((d *= 2) > b ? d : b), b -= 4, i(this.view, a, b, this.littleEndian, 23, 4), c && (this.offset += 4), this }, c.writeFloat = c.writeFloat32, c.readFloat32 = function (a) { var c; var b = typeof a === 'undefined'; if (b && (a = this.offset), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal offset: ' + a + ' (not an integer)'); if (a >>>= 0, a < 0 || a + 4 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + a + ' (+' + 4 + ') <= ' + this.buffer.byteLength) } return c = h(this.view, a, this.littleEndian, 23, 4), b && (this.offset += 4), c }, c.readFloat = c.readFloat32, c.writeFloat64 = function (a, b) { var d; var c = typeof b === 'undefined'; if (c && (b = this.offset), !this.noAssert) { if (typeof a !== 'number') throw TypeError('Illegal value: ' + a + ' (not a number)'); if (typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal offset: ' + b + ' (not an integer)'); if (b >>>= 0, b < 0 || b + 0 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + b + ' (+' + 0 + ') <= ' + this.buffer.byteLength) } return b += 8, d = this.buffer.byteLength, b > d && this.resize((d *= 2) > b ? d : b), b -= 8, i(this.view, a, b, this.littleEndian, 52, 8), c && (this.offset += 8), this }, c.writeDouble = c.writeFloat64, c.readFloat64 = function (a) { var c; var b = typeof a === 'undefined'; if (b && (a = this.offset), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal offset: ' + a + ' (not an integer)'); if (a >>>= 0, a < 0 || a + 8 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + a + ' (+' + 8 + ') <= ' + this.buffer.byteLength) } return c = h(this.view, a, this.littleEndian, 52, 8), b && (this.offset += 8), c }, c.readDouble = c.readFloat64, b.MAX_VARINT32_BYTES = 5, b.calculateVarint32 = function (a) { return a >>>= 0, a < 128 ? 1 : a < 16384 ? 2 : 1 << 21 > a ? 3 : 1 << 28 > a ? 4 : 5 }, b.zigZagEncode32 = function (a) { return ((a |= 0) << 1 ^ a >> 31) >>> 0 }, b.zigZagDecode32 = function (a) { return 0 | a >>> 1 ^ -(1 & a) }, c.writeVarint32 = function (a, c) { var f; var e; var g; var d = typeof c === 'undefined'; if (d && (c = this.offset), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal value: ' + a + ' (not an integer)'); if (a |= 0, typeof c !== 'number' || c % 1 !== 0) throw TypeError('Illegal offset: ' + c + ' (not an integer)'); if (c >>>= 0, c < 0 || c + 0 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + c + ' (+' + 0 + ') <= ' + this.buffer.byteLength) } for (e = b.calculateVarint32(a), c += e, g = this.buffer.byteLength, c > g && this.resize((g *= 2) > c ? g : c), c -= e, a >>>= 0; a >= 128;)f = 128 | 127 & a, this.view[c++] = f, a >>>= 7; return this.view[c++] = a, d ? (this.offset = c, this) : e }, c.writeVarint32ZigZag = function (a, c) { return this.writeVarint32(b.zigZagEncode32(a), c) }, c.readVarint32 = function (a) { var e; var c; var d; var f; var b = typeof a === 'undefined'; if (b && (a = this.offset), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal offset: ' + a + ' (not an integer)'); if (a >>>= 0, a < 0 || a + 1 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + a + ' (+' + 1 + ') <= ' + this.buffer.byteLength) }c = 0, d = 0; do { if (!this.noAssert && a > this.limit) throw f = Error('Truncated'), f.truncated = !0, f; e = this.view[a++], c < 5 && (d |= (127 & e) << 7 * c), ++c; } while ((128 & e) !== 0); return d |= 0, b ? (this.offset = a, d) : { value: d, length: c } }, c.readVarint32ZigZag = function (a) { var c = this.readVarint32(a); return typeof c === 'object' ? c.value = b.zigZagDecode32(c.value) : c = b.zigZagDecode32(c), c }, a && (b.MAX_VARINT64_BYTES = 10, b.calculateVarint64 = function (b) { typeof b === 'number' ? b = a.fromNumber(b) : typeof b === 'string' && (b = a.fromString(b)); var c = b.toInt() >>> 0; var d = b.shiftRightUnsigned(28).toInt() >>> 0; var e = b.shiftRightUnsigned(56).toInt() >>> 0; return e == 0 ? d == 0 ? c < 16384 ? c < 128 ? 1 : 2 : 1 << 21 > c ? 3 : 4 : d < 16384 ? d < 128 ? 5 : 6 : 1 << 21 > d ? 7 : 8 : e < 128 ? 9 : 10 }, b.zigZagEncode64 = function (b) { return typeof b === 'number' ? b = a.fromNumber(b, !1) : typeof b === 'string' ? b = a.fromString(b, !1) : b.unsigned !== !1 && (b = b.toSigned()), b.shiftLeft(1).xor(b.shiftRight(63)).toUnsigned() }, b.zigZagDecode64 = function (b) { return typeof b === 'number' ? b = a.fromNumber(b, !1) : typeof b === 'string' ? b = a.fromString(b, !1) : b.unsigned !== !1 && (b = b.toSigned()), b.shiftRightUnsigned(1).xor(b.and(a.ONE).toSigned().negate()).toSigned() }, c.writeVarint64 = function (c, d) { var f; var g; var h; var i; var j; var e = typeof d === 'undefined'; if (e && (d = this.offset), !this.noAssert) { if (typeof c === 'number')c = a.fromNumber(c); else if (typeof c === 'string')c = a.fromString(c); else if (!(c && c instanceof a)) throw TypeError('Illegal value: ' + c + ' (not an integer or Long)'); if (typeof d !== 'number' || d % 1 !== 0) throw TypeError('Illegal offset: ' + d + ' (not an integer)'); if (d >>>= 0, d < 0 || d + 0 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + d + ' (+' + 0 + ') <= ' + this.buffer.byteLength) } switch (typeof c === 'number' ? c = a.fromNumber(c, !1) : typeof c === 'string' ? c = a.fromString(c, !1) : c.unsigned !== !1 && (c = c.toSigned()), f = b.calculateVarint64(c), g = c.toInt() >>> 0, h = c.shiftRightUnsigned(28).toInt() >>> 0, i = c.shiftRightUnsigned(56).toInt() >>> 0, d += f, j = this.buffer.byteLength, d > j && this.resize((j *= 2) > d ? j : d), d -= f, f) { case 10:this.view[d + 9] = 1 & i >>> 7; case 9:this.view[d + 8] = f !== 9 ? 128 | i : 127 & i; case 8:this.view[d + 7] = f !== 8 ? 128 | h >>> 21 : 127 & h >>> 21; case 7:this.view[d + 6] = f !== 7 ? 128 | h >>> 14 : 127 & h >>> 14; case 6:this.view[d + 5] = f !== 6 ? 128 | h >>> 7 : 127 & h >>> 7; case 5:this.view[d + 4] = f !== 5 ? 128 | h : 127 & h; case 4:this.view[d + 3] = f !== 4 ? 128 | g >>> 21 : 127 & g >>> 21; case 3:this.view[d + 2] = f !== 3 ? 128 | g >>> 14 : 127 & g >>> 14; case 2:this.view[d + 1] = f !== 2 ? 128 | g >>> 7 : 127 & g >>> 7; case 1:this.view[d] = f !== 1 ? 128 | g : 127 & g; } return e ? (this.offset += f, this) : f }, c.writeVarint64ZigZag = function (a, c) { return this.writeVarint64(b.zigZagEncode64(a), c) }, c.readVarint64 = function (b) { var d; var e; var f; var g; var h; var i; var c = typeof b === 'undefined'; if (c && (b = this.offset), !this.noAssert) { if (typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal offset: ' + b + ' (not an integer)'); if (b >>>= 0, b < 0 || b + 1 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + b + ' (+' + 1 + ') <= ' + this.buffer.byteLength) } if (d = b, e = 0, f = 0, g = 0, h = 0, h = this.view[b++], e = 127 & h, 128 & h && (h = this.view[b++], e |= (127 & h) << 7, (128 & h || this.noAssert && typeof h === 'undefined') && (h = this.view[b++], e |= (127 & h) << 14, (128 & h || this.noAssert && typeof h === 'undefined') && (h = this.view[b++], e |= (127 & h) << 21, (128 & h || this.noAssert && typeof h === 'undefined') && (h = this.view[b++], f = 127 & h, (128 & h || this.noAssert && typeof h === 'undefined') && (h = this.view[b++], f |= (127 & h) << 7, (128 & h || this.noAssert && typeof h === 'undefined') && (h = this.view[b++], f |= (127 & h) << 14, (128 & h || this.noAssert && typeof h === 'undefined') && (h = this.view[b++], f |= (127 & h) << 21, (128 & h || this.noAssert && typeof h === 'undefined') && (h = this.view[b++], g = 127 & h, (128 & h || this.noAssert && typeof h === 'undefined') && (h = this.view[b++], g |= (127 & h) << 7, 128 & h || this.noAssert && typeof h === 'undefined')))))))))) throw Error('Buffer overrun'); return i = a.fromBits(e | f << 28, f >>> 4 | g << 24, !1), c ? (this.offset = b, i) : { value: i, length: b - d } }, c.readVarint64ZigZag = function (c) { var d = this.readVarint64(c); return d && d.value instanceof a ? d.value = b.zigZagDecode64(d.value) : d = b.zigZagDecode64(d), d }), c.writeCString = function (a, b) { var d; var e; var g; var c = typeof b === 'undefined'; if (c && (b = this.offset), e = a.length, !this.noAssert) { if (typeof a !== 'string') throw TypeError('Illegal str: Not a string'); for (d = 0; e > d; ++d) if (a.charCodeAt(d) === 0) throw RangeError('Illegal str: Contains NULL-characters'); if (typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal offset: ' + b + ' (not an integer)'); if (b >>>= 0, b < 0 || b + 0 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + b + ' (+' + 0 + ') <= ' + this.buffer.byteLength) } return e = k.calculateUTF16asUTF8(f(a))[1], b += e + 1, g = this.buffer.byteLength, b > g && this.resize((g *= 2) > b ? g : b), b -= e + 1, k.encodeUTF16toUTF8(f(a), function (a) { this.view[b++] = a; }.bind(this)), this.view[b++] = 0, c ? (this.offset = b, this) : e }, c.readCString = function (a) { var c; var e; var f; var b = typeof a === 'undefined'; if (b && (a = this.offset), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal offset: ' + a + ' (not an integer)'); if (a >>>= 0, a < 0 || a + 1 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + a + ' (+' + 1 + ') <= ' + this.buffer.byteLength) } return c = a, f = -1, k.decodeUTF8toUTF16(function () { if (f === 0) return null; if (a >= this.limit) throw RangeError('Illegal range: Truncated data, ' + a + ' < ' + this.limit); return f = this.view[a++], f === 0 ? null : f }.bind(this), e = g(), !0), b ? (this.offset = a, e()) : { string: e(), length: a - c } }, c.writeIString = function (a, b) { var e; var d; var g; var c = typeof b === 'undefined'; if (c && (b = this.offset), !this.noAssert) { if (typeof a !== 'string') throw TypeError('Illegal str: Not a string'); if (typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal offset: ' + b + ' (not an integer)'); if (b >>>= 0, b < 0 || b + 0 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + b + ' (+' + 0 + ') <= ' + this.buffer.byteLength) } if (d = b, e = k.calculateUTF16asUTF8(f(a), this.noAssert)[1], b += 4 + e, g = this.buffer.byteLength, b > g && this.resize((g *= 2) > b ? g : b), b -= 4 + e, this.littleEndian ? (this.view[b + 3] = 255 & e >>> 24, this.view[b + 2] = 255 & e >>> 16, this.view[b + 1] = 255 & e >>> 8, this.view[b] = 255 & e) : (this.view[b] = 255 & e >>> 24, this.view[b + 1] = 255 & e >>> 16, this.view[b + 2] = 255 & e >>> 8, this.view[b + 3] = 255 & e), b += 4, k.encodeUTF16toUTF8(f(a), function (a) { this.view[b++] = a; }.bind(this)), b !== d + 4 + e) throw RangeError('Illegal range: Truncated data, ' + b + ' == ' + (b + 4 + e)); return c ? (this.offset = b, this) : b - d }, c.readIString = function (a) {\n      var d; var e; var f; var c = typeof a === 'undefined';\n      if (c && (a = this.offset), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal offset: ' + a + ' (not an integer)'); if (a >>>= 0, a < 0 || a + 4 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + a + ' (+' + 4 + ') <= ' + this.buffer.byteLength) } return d = a, e = this.readUint32(a), f = this.readUTF8String(e, b.METRICS_BYTES, a += 4), a += f.length, c ? (this.offset = a, f.string) : { string: f.string, length: a - d }\n    }, b.METRICS_CHARS = 'c', b.METRICS_BYTES = 'b', c.writeUTF8String = function (a, b) { var d; var e; var g; var c = typeof b === 'undefined'; if (c && (b = this.offset), !this.noAssert) { if (typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal offset: ' + b + ' (not an integer)'); if (b >>>= 0, b < 0 || b + 0 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + b + ' (+' + 0 + ') <= ' + this.buffer.byteLength) } return e = b, d = k.calculateUTF16asUTF8(f(a))[1], b += d, g = this.buffer.byteLength, b > g && this.resize((g *= 2) > b ? g : b), b -= d, k.encodeUTF16toUTF8(f(a), function (a) { this.view[b++] = a; }.bind(this)), c ? (this.offset = b, this) : b - e }, c.writeString = c.writeUTF8String, b.calculateUTF8Chars = function (a) { return k.calculateUTF16asUTF8(f(a))[0] }, b.calculateUTF8Bytes = function (a) { return k.calculateUTF16asUTF8(f(a))[1] }, b.calculateString = b.calculateUTF8Bytes, c.readUTF8String = function (a, c, d) { var e, i, f, h, j; if (typeof c === 'number' && (d = c, c = void 0), e = typeof d === 'undefined', e && (d = this.offset), typeof c === 'undefined' && (c = b.METRICS_CHARS), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal length: ' + a + ' (not an integer)'); if (a |= 0, typeof d !== 'number' || d % 1 !== 0) throw TypeError('Illegal offset: ' + d + ' (not an integer)'); if (d >>>= 0, d < 0 || d + 0 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + d + ' (+' + 0 + ') <= ' + this.buffer.byteLength) } if (f = 0, h = d, c === b.METRICS_CHARS) { if (i = g(), k.decodeUTF8(function () { return a > f && d < this.limit ? this.view[d++] : null }.bind(this), function (a) { ++f, k.UTF8toUTF16(a, i); }), f !== a) throw RangeError('Illegal range: Truncated data, ' + f + ' == ' + a); return e ? (this.offset = d, i()) : { string: i(), length: d - h } } if (c === b.METRICS_BYTES) { if (!this.noAssert) { if (typeof d !== 'number' || d % 1 !== 0) throw TypeError('Illegal offset: ' + d + ' (not an integer)'); if (d >>>= 0, d < 0 || d + a > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + d + ' (+' + a + ') <= ' + this.buffer.byteLength) } if (j = d + a, k.decodeUTF8toUTF16(function () { return j > d ? this.view[d++] : null }.bind(this), i = g(), this.noAssert), d !== j) throw RangeError('Illegal range: Truncated data, ' + d + ' == ' + j); return e ? (this.offset = d, i()) : { string: i(), length: d - h } } throw TypeError('Unsupported metrics: ' + c) }, c.readString = c.readUTF8String, c.writeVString = function (a, c) { var g; var h; var e; var i; var d = typeof c === 'undefined'; if (d && (c = this.offset), !this.noAssert) { if (typeof a !== 'string') throw TypeError('Illegal str: Not a string'); if (typeof c !== 'number' || c % 1 !== 0) throw TypeError('Illegal offset: ' + c + ' (not an integer)'); if (c >>>= 0, c < 0 || c + 0 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + c + ' (+' + 0 + ') <= ' + this.buffer.byteLength) } if (e = c, g = k.calculateUTF16asUTF8(f(a), this.noAssert)[1], h = b.calculateVarint32(g), c += h + g, i = this.buffer.byteLength, c > i && this.resize((i *= 2) > c ? i : c), c -= h + g, c += this.writeVarint32(g, c), k.encodeUTF16toUTF8(f(a), function (a) { this.view[c++] = a; }.bind(this)), c !== e + g + h) throw RangeError('Illegal range: Truncated data, ' + c + ' == ' + (c + g + h)); return d ? (this.offset = c, this) : c - e }, c.readVString = function (a) { var d; var e; var f; var c = typeof a === 'undefined'; if (c && (a = this.offset), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal offset: ' + a + ' (not an integer)'); if (a >>>= 0, a < 0 || a + 1 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + a + ' (+' + 1 + ') <= ' + this.buffer.byteLength) } return d = a, e = this.readVarint32(a), f = this.readUTF8String(e.value, b.METRICS_BYTES, a += e.length), a += f.length, c ? (this.offset = a, f.string) : { string: f.string, length: a - d } }, c.append = function (a, c, d) { var e, f, g; if ((typeof c === 'number' || typeof c !== 'string') && (d = c, c = void 0), e = typeof d === 'undefined', e && (d = this.offset), !this.noAssert) { if (typeof d !== 'number' || d % 1 !== 0) throw TypeError('Illegal offset: ' + d + ' (not an integer)'); if (d >>>= 0, d < 0 || d + 0 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + d + ' (+' + 0 + ') <= ' + this.buffer.byteLength) } return a instanceof b || (a = b.wrap(a, c)), f = a.limit - a.offset, f <= 0 ? this : (d += f, g = this.buffer.byteLength, d > g && this.resize((g *= 2) > d ? g : d), d -= f, this.view.set(a.view.subarray(a.offset, a.limit), d), a.offset += f, e && (this.offset += f), this) }, c.appendTo = function (a, b) { return a.append(this, b), this }, c.assert = function (a) { return this.noAssert = !a, this }, c.capacity = function () { return this.buffer.byteLength }, c.clear = function () { return this.offset = 0, this.limit = this.buffer.byteLength, this.markedOffset = -1, this }, c.clone = function (a) { var c = new b(0, this.littleEndian, this.noAssert); return a ? (c.buffer = new ArrayBuffer(this.buffer.byteLength), c.view = new Uint8Array(c.buffer)) : (c.buffer = this.buffer, c.view = this.view), c.offset = this.offset, c.markedOffset = this.markedOffset, c.limit = this.limit, c }, c.compact = function (a, b) { var c, e, f; if (typeof a === 'undefined' && (a = this.offset), typeof b === 'undefined' && (b = this.limit), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal begin: Not an integer'); if (a >>>= 0, typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal end: Not an integer'); if (b >>>= 0, a < 0 || a > b || b > this.buffer.byteLength) throw RangeError('Illegal range: 0 <= ' + a + ' <= ' + b + ' <= ' + this.buffer.byteLength) } return a === 0 && b === this.buffer.byteLength ? this : (c = b - a, c === 0 ? (this.buffer = d, this.view = null, this.markedOffset >= 0 && (this.markedOffset -= a), this.offset = 0, this.limit = 0, this) : (e = new ArrayBuffer(c), f = new Uint8Array(e), f.set(this.view.subarray(a, b)), this.buffer = e, this.view = f, this.markedOffset >= 0 && (this.markedOffset -= a), this.offset = 0, this.limit = c, this)) }, c.copy = function (a, c) { if (typeof a === 'undefined' && (a = this.offset), typeof c === 'undefined' && (c = this.limit), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal begin: Not an integer'); if (a >>>= 0, typeof c !== 'number' || c % 1 !== 0) throw TypeError('Illegal end: Not an integer'); if (c >>>= 0, a < 0 || a > c || c > this.buffer.byteLength) throw RangeError('Illegal range: 0 <= ' + a + ' <= ' + c + ' <= ' + this.buffer.byteLength) } if (a === c) return new b(0, this.littleEndian, this.noAssert); var d = c - a; var e = new b(d, this.littleEndian, this.noAssert); return e.offset = 0, e.limit = d, e.markedOffset >= 0 && (e.markedOffset -= a), this.copyTo(e, 0, a, c), e }, c.copyTo = function (a, c, d, e) { var f, g, h; if (!this.noAssert && !b.isByteBuffer(a)) throw TypeError('Illegal target: Not a ByteBuffer'); if (c = (g = typeof c === 'undefined') ? a.offset : 0 | c, d = (f = typeof d === 'undefined') ? this.offset : 0 | d, e = typeof e === 'undefined' ? this.limit : 0 | e, c < 0 || c > a.buffer.byteLength) throw RangeError('Illegal target range: 0 <= ' + c + ' <= ' + a.buffer.byteLength); if (d < 0 || e > this.buffer.byteLength) throw RangeError('Illegal source range: 0 <= ' + d + ' <= ' + this.buffer.byteLength); return h = e - d, h === 0 ? a : (a.ensureCapacity(c + h), a.view.set(this.view.subarray(d, e), c), f && (this.offset += h), g && (a.offset += h), this) }, c.ensureCapacity = function (a) { var b = this.buffer.byteLength; return a > b ? this.resize((b *= 2) > a ? b : a) : this }, c.fill = function (a, b, c) { var d = typeof b === 'undefined'; if (d && (b = this.offset), typeof a === 'string' && a.length > 0 && (a = a.charCodeAt(0)), typeof b === 'undefined' && (b = this.offset), typeof c === 'undefined' && (c = this.limit), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal value: ' + a + ' (not an integer)'); if (a |= 0, typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal begin: Not an integer'); if (b >>>= 0, typeof c !== 'number' || c % 1 !== 0) throw TypeError('Illegal end: Not an integer'); if (c >>>= 0, b < 0 || b > c || c > this.buffer.byteLength) throw RangeError('Illegal range: 0 <= ' + b + ' <= ' + c + ' <= ' + this.buffer.byteLength) } if (b >= c) return this; for (;c > b;) this.view[b++] = a; return d && (this.offset = b), this }, c.flip = function () { return this.limit = this.offset, this.offset = 0, this }, c.mark = function (a) { if (a = typeof a === 'undefined' ? this.offset : a, !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal offset: ' + a + ' (not an integer)'); if (a >>>= 0, a < 0 || a + 0 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + a + ' (+' + 0 + ') <= ' + this.buffer.byteLength) } return this.markedOffset = a, this }, c.order = function (a) { if (!this.noAssert && typeof a !== 'boolean') throw TypeError('Illegal littleEndian: Not a boolean'); return this.littleEndian = !!a, this }, c.LE = function (a) { return this.littleEndian = typeof a !== 'undefined' ? !!a : !0, this }, c.BE = function (a) { return this.littleEndian = typeof a !== 'undefined' ? !a : !1, this }, c.prepend = function (a, c, d) { var e, f, g, h, i; if ((typeof c === 'number' || typeof c !== 'string') && (d = c, c = void 0), e = typeof d === 'undefined', e && (d = this.offset), !this.noAssert) { if (typeof d !== 'number' || d % 1 !== 0) throw TypeError('Illegal offset: ' + d + ' (not an integer)'); if (d >>>= 0, d < 0 || d + 0 > this.buffer.byteLength) throw RangeError('Illegal offset: 0 <= ' + d + ' (+' + 0 + ') <= ' + this.buffer.byteLength) } return a instanceof b || (a = b.wrap(a, c)), f = a.limit - a.offset, f <= 0 ? this : (g = f - d, g > 0 ? (h = new ArrayBuffer(this.buffer.byteLength + g), i = new Uint8Array(h), i.set(this.view.subarray(d, this.buffer.byteLength), f), this.buffer = h, this.view = i, this.offset += g, this.markedOffset >= 0 && (this.markedOffset += g), this.limit += g, d += g) : new Uint8Array(this.buffer), this.view.set(a.view.subarray(a.offset, a.limit), d - f), a.offset = a.limit, e && (this.offset -= f), this) }, c.prependTo = function (a, b) { return a.prepend(this, b), this }, c.printDebug = function (a) { typeof a !== 'function' && (a = console.log.bind(console)), a(this.toString() + '\\n-------------------------------------------------------------------\\n' + this.toDebug(!0)); }, c.remaining = function () { return this.limit - this.offset }, c.reset = function () { return this.markedOffset >= 0 ? (this.offset = this.markedOffset, this.markedOffset = -1) : this.offset = 0, this }, c.resize = function (a) { var b, c; if (!this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal capacity: ' + a + ' (not an integer)'); if (a |= 0, a < 0) throw RangeError('Illegal capacity: 0 <= ' + a) } return this.buffer.byteLength < a && (b = new ArrayBuffer(a), c = new Uint8Array(b), c.set(this.view), this.buffer = b, this.view = c), this }, c.reverse = function (a, b) { if (typeof a === 'undefined' && (a = this.offset), typeof b === 'undefined' && (b = this.limit), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal begin: Not an integer'); if (a >>>= 0, typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal end: Not an integer'); if (b >>>= 0, a < 0 || a > b || b > this.buffer.byteLength) throw RangeError('Illegal range: 0 <= ' + a + ' <= ' + b + ' <= ' + this.buffer.byteLength) } return a === b ? this : (Array.prototype.reverse.call(this.view.subarray(a, b)), this) }, c.skip = function (a) { if (!this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal length: ' + a + ' (not an integer)'); a |= 0; } var b = this.offset + a; if (!this.noAssert && (b < 0 || b > this.buffer.byteLength)) throw RangeError('Illegal length: 0 <= ' + this.offset + ' + ' + a + ' <= ' + this.buffer.byteLength); return this.offset = b, this }, c.slice = function (a, b) { if (typeof a === 'undefined' && (a = this.offset), typeof b === 'undefined' && (b = this.limit), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal begin: Not an integer'); if (a >>>= 0, typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal end: Not an integer'); if (b >>>= 0, a < 0 || a > b || b > this.buffer.byteLength) throw RangeError('Illegal range: 0 <= ' + a + ' <= ' + b + ' <= ' + this.buffer.byteLength) } var c = this.clone(); return c.offset = a, c.limit = b, c }, c.toBuffer = function (a) { var e; var b = this.offset; var c = this.limit; if (!this.noAssert) { if (typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal offset: Not an integer'); if (b >>>= 0, typeof c !== 'number' || c % 1 !== 0) throw TypeError('Illegal limit: Not an integer'); if (c >>>= 0, b < 0 || b > c || c > this.buffer.byteLength) throw RangeError('Illegal range: 0 <= ' + b + ' <= ' + c + ' <= ' + this.buffer.byteLength) } return a || b !== 0 || c !== this.buffer.byteLength ? b === c ? d : (e = new ArrayBuffer(c - b), new Uint8Array(e).set(new Uint8Array(this.buffer).subarray(b, c), 0), e) : this.buffer }, c.toArrayBuffer = c.toBuffer, c.toString = function (a, b, c) { if (typeof a === 'undefined') return 'ByteBufferAB(offset=' + this.offset + ',markedOffset=' + this.markedOffset + ',limit=' + this.limit + ',capacity=' + this.capacity() + ')'; switch (typeof a === 'number' && (a = 'utf8', b = a, c = b), a) { case 'utf8':return this.toUTF8(b, c); case 'base64':return this.toBase64(b, c); case 'hex':return this.toHex(b, c); case 'binary':return this.toBinary(b, c); case 'debug':return this.toDebug(); case 'columns':return this.toColumns(); default:throw Error('Unsupported encoding: ' + a) } }, j = (function () { var d; var e; var a = {}; var b = [65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 43, 47]; var c = []; for (d = 0, e = b.length; e > d; ++d)c[b[d]] = d; return a.encode = function (a, c) { for (var d, e; (d = a()) !== null;)c(b[63 & d >> 2]), e = (3 & d) << 4, (d = a()) !== null ? (e |= 15 & d >> 4, c(b[63 & (e | 15 & d >> 4)]), e = (15 & d) << 2, (d = a()) !== null ? (c(b[63 & (e | 3 & d >> 6)]), c(b[63 & d])) : (c(b[63 & e]), c(61))) : (c(b[63 & e]), c(61), c(61)); }, a.decode = function (a, b) { function g (a) { throw Error('Illegal character code: ' + a) } for (var d, e, f; (d = a()) !== null;) if (e = c[d], typeof e === 'undefined' && g(d), (d = a()) !== null && (f = c[d], typeof f === 'undefined' && g(d), b(e << 2 >>> 0 | (48 & f) >> 4), (d = a()) !== null)) { if (e = c[d], typeof e === 'undefined') { if (d === 61) break; g(d); } if (b((15 & f) << 4 >>> 0 | (60 & e) >> 2), (d = a()) !== null) { if (f = c[d], typeof f === 'undefined') { if (d === 61) break; g(d); }b((3 & e) << 6 >>> 0 | f); } } }, a.test = function (a) { return /^(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+\\/]{3}=)?$/.test(a) }, a }()), c.toBase64 = function (a, b) { if (typeof a === 'undefined' && (a = this.offset), typeof b === 'undefined' && (b = this.limit), a = 0 | a, b = 0 | b, a < 0 || b > this.capacity || a > b) throw RangeError('begin, end'); var c; return j.encode(function () { return b > a ? this.view[a++] : null }.bind(this), c = g()), c() }, b.fromBase64 = function (a, c) { if (typeof a !== 'string') throw TypeError('str'); var d = new b(3 * (a.length / 4), c); var e = 0; return j.decode(f(a), function (a) { d.view[e++] = a; }), d.limit = e, d }, b.btoa = function (a) { return b.fromBinary(a).toBase64() }, b.atob = function (a) { return b.fromBase64(a).toBinary() }, c.toBinary = function (a, b) { if (typeof a === 'undefined' && (a = this.offset), typeof b === 'undefined' && (b = this.limit), a |= 0, b |= 0, a < 0 || b > this.capacity() || a > b) throw RangeError('begin, end'); if (a === b) return ''; for (var c = [], d = []; b > a;)c.push(this.view[a++]), c.length >= 1024 && (d.push(String.fromCharCode.apply(String, c)), c = []); return d.join('') + String.fromCharCode.apply(String, c) }, b.fromBinary = function (a, c) { if (typeof a !== 'string') throw TypeError('str'); for (var f, d = 0, e = a.length, g = new b(e, c); e > d;) { if (f = a.charCodeAt(d), f > 255) throw RangeError('illegal char code: ' + f); g.view[d++] = f; } return g.limit = e, g }, c.toDebug = function (a) { for (var d, b = -1, c = this.buffer.byteLength, e = '', f = '', g = ''; c > b;) { if (b !== -1 && (d = this.view[b], e += d < 16 ? '0' + d.toString(16).toUpperCase() : d.toString(16).toUpperCase(), a && (f += d > 32 && d < 127 ? String.fromCharCode(d) : '.')), ++b, a && b > 0 && b % 16 === 0 && b !== c) { for (;e.length < 51;)e += ' '; g += e + f + '\\n', e = f = ''; }e += b === this.offset && b === this.limit ? b === this.markedOffset ? '!' : '|' : b === this.offset ? b === this.markedOffset ? '[' : '<' : b === this.limit ? b === this.markedOffset ? ']' : '>' : b === this.markedOffset ? \"'\" : a || b !== 0 && b !== c ? ' ' : ''; } if (a && e !== ' ') { for (;e.length < 51;)e += ' '; g += e + f + '\\n'; } return a ? g : e }, b.fromDebug = function (a, c, d) { for (var i, j, e = a.length, f = new b(0 | (e + 1) / 3, c, d), g = 0, h = 0, k = !1, l = !1, m = !1, n = !1, o = !1; e > g;) { switch (i = a.charAt(g++)) { case '!':if (!d) { if (l || m || n) { o = !0; break }l = m = n = !0; }f.offset = f.markedOffset = f.limit = h, k = !1; break; case '|':if (!d) { if (l || n) { o = !0; break }l = n = !0; }f.offset = f.limit = h, k = !1; break; case '[':if (!d) { if (l || m) { o = !0; break }l = m = !0; }f.offset = f.markedOffset = h, k = !1; break; case '<':if (!d) { if (l) { o = !0; break }l = !0; }f.offset = h, k = !1; break; case ']':if (!d) { if (n || m) { o = !0; break }n = m = !0; }f.limit = f.markedOffset = h, k = !1; break; case '>':if (!d) { if (n) { o = !0; break }n = !0; }f.limit = h, k = !1; break; case \"'\":if (!d) { if (m) { o = !0; break }m = !0; }f.markedOffset = h, k = !1; break; case ' ':k = !1; break; default:if (!d && k) { o = !0; break } if (j = parseInt(i + a.charAt(g++), 16), !d && (isNaN(j) || j < 0 || j > 255)) throw TypeError('Illegal str: Not a debug encoded string'); f.view[h++] = j, k = !0; } if (o) throw TypeError('Illegal str: Invalid symbol at ' + g) } if (!d) { if (!l || !n) throw TypeError('Illegal str: Missing offset or limit'); if (h < f.buffer.byteLength) throw TypeError('Illegal str: Not a debug encoded string (is it hex?) ' + h + ' < ' + e) } return f }, c.toHex = function (a, b) { if (a = typeof a === 'undefined' ? this.offset : a, b = typeof b === 'undefined' ? this.limit : b, !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal begin: Not an integer'); if (a >>>= 0, typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal end: Not an integer'); if (b >>>= 0, a < 0 || a > b || b > this.buffer.byteLength) throw RangeError('Illegal range: 0 <= ' + a + ' <= ' + b + ' <= ' + this.buffer.byteLength) } for (var d, c = new Array(b - a); b > a;)d = this.view[a++], d < 16 ? c.push('0', d.toString(16)) : c.push(d.toString(16)); return c.join('') }, b.fromHex = function (a, c, d) { var g, e, f, h, i; if (!d) { if (typeof a !== 'string') throw TypeError('Illegal str: Not a string'); if (a.length % 2 !== 0) throw TypeError('Illegal str: Length not a multiple of 2') } for (e = a.length, f = new b(0 | e / 2, c), h = 0, i = 0; e > h; h += 2) { if (g = parseInt(a.substring(h, h + 2), 16), !d && (!isFinite(g) || g < 0 || g > 255)) throw TypeError('Illegal str: Contains non-hex characters'); f.view[i++] = g; } return f.limit = i, f }, k = (function () { var a = {}; return a.MAX_CODEPOINT = 1114111, a.encodeUTF8 = function (a, b) { var c = null; for (typeof a === 'number' && (c = a, a = function () { return null }); c !== null || (c = a()) !== null;)c < 128 ? b(127 & c) : c < 2048 ? (b(192 | 31 & c >> 6), b(128 | 63 & c)) : c < 65536 ? (b(224 | 15 & c >> 12), b(128 | 63 & c >> 6), b(128 | 63 & c)) : (b(240 | 7 & c >> 18), b(128 | 63 & c >> 12), b(128 | 63 & c >> 6), b(128 | 63 & c)), c = null; }, a.decodeUTF8 = function (a, b) { for (var c, d, e, f, g = function (a) { a = a.slice(0, a.indexOf(null)); var b = Error(a.toString()); throw b.name = 'TruncatedError', b.bytes = a, b }; (c = a()) !== null;) if ((128 & c) === 0)b(c); else if ((224 & c) === 192)(d = a()) === null && g([c, d]), b((31 & c) << 6 | 63 & d); else if ((240 & c) === 224)((d = a()) === null || (e = a()) === null) && g([c, d, e]), b((15 & c) << 12 | (63 & d) << 6 | 63 & e); else { if ((248 & c) !== 240) throw RangeError('Illegal starting byte: ' + c); ((d = a()) === null || (e = a()) === null || (f = a()) === null) && g([c, d, e, f]), b((7 & c) << 18 | (63 & d) << 12 | (63 & e) << 6 | 63 & f); } }, a.UTF16toUTF8 = function (a, b) { for (var c, d = null; ;) { if ((c = d !== null ? d : a()) === null) break; c >= 55296 && c <= 57343 && (d = a()) !== null && d >= 56320 && d <= 57343 ? (b(1024 * (c - 55296) + d - 56320 + 65536), d = null) : b(c); }d !== null && b(d); }, a.UTF8toUTF16 = function (a, b) { var c = null; for (typeof a === 'number' && (c = a, a = function () { return null }); c !== null || (c = a()) !== null;)c <= 65535 ? b(c) : (c -= 65536, b((c >> 10) + 55296), b(c % 1024 + 56320)), c = null; }, a.encodeUTF16toUTF8 = function (b, c) { a.UTF16toUTF8(b, function (b) { a.encodeUTF8(b, c); }); }, a.decodeUTF8toUTF16 = function (b, c) { a.decodeUTF8(b, function (b) { a.UTF8toUTF16(b, c); }); }, a.calculateCodePoint = function (a) { return a < 128 ? 1 : a < 2048 ? 2 : a < 65536 ? 3 : 4 }, a.calculateUTF8 = function (a) { for (var b, c = 0; (b = a()) !== null;)c += b < 128 ? 1 : b < 2048 ? 2 : b < 65536 ? 3 : 4; return c }, a.calculateUTF16asUTF8 = function (b) { var c = 0; var d = 0; return a.UTF16toUTF8(b, function (a) { ++c, d += a < 128 ? 1 : a < 2048 ? 2 : a < 65536 ? 3 : 4; }), [c, d] }, a }()), c.toUTF8 = function (a, b) { if (typeof a === 'undefined' && (a = this.offset), typeof b === 'undefined' && (b = this.limit), !this.noAssert) { if (typeof a !== 'number' || a % 1 !== 0) throw TypeError('Illegal begin: Not an integer'); if (a >>>= 0, typeof b !== 'number' || b % 1 !== 0) throw TypeError('Illegal end: Not an integer'); if (b >>>= 0, a < 0 || a > b || b > this.buffer.byteLength) throw RangeError('Illegal range: 0 <= ' + a + ' <= ' + b + ' <= ' + this.buffer.byteLength) } var c; try { k.decodeUTF8toUTF16(function () { return b > a ? this.view[a++] : null }.bind(this), c = g()); } catch (d) { if (a !== b) throw RangeError('Illegal range: Truncated data, ' + a + ' != ' + b) } return c() }, b.fromUTF8 = function (a, c, d) { if (!d && typeof a !== 'string') throw TypeError('Illegal str: Not a string'); var e = new b(k.calculateUTF16asUTF8(f(a), !0)[1], c, d); var g = 0; return k.encodeUTF16toUTF8(f(a), function (a) { e.view[g++] = a; }), e.limit = g, e }, b\n  }(c)); var e = (function (b, c) {\n    var f; var h; var i; var e = {}; return e.ByteBuffer = b, e.c = b, f = b, e.Long = c || null, e.VERSION = '5.0.1', e.WIRE_TYPES = {}, e.WIRE_TYPES.VARINT = 0, e.WIRE_TYPES.BITS64 = 1, e.WIRE_TYPES.LDELIM = 2, e.WIRE_TYPES.STARTGROUP = 3, e.WIRE_TYPES.ENDGROUP = 4, e.WIRE_TYPES.BITS32 = 5, e.PACKABLE_WIRE_TYPES = [e.WIRE_TYPES.VARINT, e.WIRE_TYPES.BITS64, e.WIRE_TYPES.BITS32], e.TYPES = { int32: { name: 'int32', wireType: e.WIRE_TYPES.VARINT, defaultValue: 0 }, uint32: { name: 'uint32', wireType: e.WIRE_TYPES.VARINT, defaultValue: 0 }, sint32: { name: 'sint32', wireType: e.WIRE_TYPES.VARINT, defaultValue: 0 }, int64: { name: 'int64', wireType: e.WIRE_TYPES.VARINT, defaultValue: e.Long ? e.Long.ZERO : void 0 }, uint64: { name: 'uint64', wireType: e.WIRE_TYPES.VARINT, defaultValue: e.Long ? e.Long.UZERO : void 0 }, sint64: { name: 'sint64', wireType: e.WIRE_TYPES.VARINT, defaultValue: e.Long ? e.Long.ZERO : void 0 }, bool: { name: 'bool', wireType: e.WIRE_TYPES.VARINT, defaultValue: !1 }, double: { name: 'double', wireType: e.WIRE_TYPES.BITS64, defaultValue: 0 }, string: { name: 'string', wireType: e.WIRE_TYPES.LDELIM, defaultValue: '' }, bytes: { name: 'bytes', wireType: e.WIRE_TYPES.LDELIM, defaultValue: null }, fixed32: { name: 'fixed32', wireType: e.WIRE_TYPES.BITS32, defaultValue: 0 }, sfixed32: { name: 'sfixed32', wireType: e.WIRE_TYPES.BITS32, defaultValue: 0 }, fixed64: { name: 'fixed64', wireType: e.WIRE_TYPES.BITS64, defaultValue: e.Long ? e.Long.UZERO : void 0 }, sfixed64: { name: 'sfixed64', wireType: e.WIRE_TYPES.BITS64, defaultValue: e.Long ? e.Long.ZERO : void 0 }, float: { name: 'float', wireType: e.WIRE_TYPES.BITS32, defaultValue: 0 }, enum: { name: 'enum', wireType: e.WIRE_TYPES.VARINT, defaultValue: 0 }, message: { name: 'message', wireType: e.WIRE_TYPES.LDELIM, defaultValue: null }, group: { name: 'group', wireType: e.WIRE_TYPES.STARTGROUP, defaultValue: null } }, e.MAP_KEY_TYPES = [e.TYPES.int32, e.TYPES.sint32, e.TYPES.sfixed32, e.TYPES.uint32, e.TYPES.fixed32, e.TYPES.int64, e.TYPES.sint64, e.TYPES.sfixed64, e.TYPES.uint64, e.TYPES.fixed64, e.TYPES.bool, e.TYPES.string, e.TYPES.bytes], e.ID_MIN = 1, e.ID_MAX = 536870911, e.convertFieldsToCamelCase = !1, e.populateAccessors = !0, e.populateDefaults = !0, e.Util = (function () { var a = {}; return a.IS_NODE = !(typeof process !== 'object' || process + '' != '[object process]' || process.browser), a.XHR = function () { var c; var a = [function () { return new XMLHttpRequest() }, function () { return new ActiveXObject('Msxml2.XMLHTTP') }, function () { return new ActiveXObject('Msxml3.XMLHTTP') }, function () { return new ActiveXObject('Microsoft.XMLHTTP') }]; var b = null; for (c = 0; c < a.length; c++) { try { b = a[c](); } catch (d) { continue } break } if (!b) throw Error('XMLHttpRequest is not supported'); return b }, a.fetch = function (b, c) { if (c && typeof c !== 'function' && (c = null), a.IS_NODE) if (c)g.readFile(b, function (a, b) { a ? c(null) : c('' + b); }); else try { return g.readFileSync(b) } catch (d) { return null } else { var e = a.XHR(); if (e.open('GET', b, c ? !0 : !1), e.setRequestHeader('Accept', 'text/plain'), typeof e.overrideMimeType === 'function' && e.overrideMimeType('text/plain'), !c) return e.send(null), e.status == 200 || e.status == 0 && typeof e.responseText === 'string' ? e.responseText : null; if (e.onreadystatechange = function () { e.readyState == 4 && (e.status == 200 || e.status == 0 && typeof e.responseText === 'string' ? c(e.responseText) : c(null)); }, e.readyState == 4) return; e.send(null); } }, a.toCamelCase = function (a) { return a.replace(/_([a-zA-Z])/g, function (a, b) { return b.toUpperCase() }) }, a }()), e.Lang = { DELIM: /[\\s\\{\\}=;:\\[\\],'\"\\(\\)<>]/g, RULE: /^(?:required|optional|repeated|map)$/, TYPE: /^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/, NAME: /^[a-zA-Z_][a-zA-Z_0-9]*$/, TYPEDEF: /^[a-zA-Z][a-zA-Z_0-9]*$/, TYPEREF: /^(?:\\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/, FQTYPEREF: /^(?:\\.[a-zA-Z][a-zA-Z_0-9]*)+$/, NUMBER: /^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/, NUMBER_DEC: /^(?:[1-9][0-9]*|0)$/, NUMBER_HEX: /^0[xX][0-9a-fA-F]+$/, NUMBER_OCT: /^0[0-7]+$/, NUMBER_FLT: /^([0-9]*(\\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/, BOOL: /^(?:true|false)$/i, ID: /^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/, NEGID: /^\\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/, WHITESPACE: /\\s/, STRING: /(?:\"([^\"\\\\]*(?:\\\\.[^\"\\\\]*)*)\")|(?:'([^'\\\\]*(?:\\\\.[^'\\\\]*)*)')/g, STRING_DQ: /(?:\"([^\"\\\\]*(?:\\\\.[^\"\\\\]*)*)\")/g, STRING_SQ: /(?:'([^'\\\\]*(?:\\\\.[^'\\\\]*)*)')/g }, e.DotProto = (function (a, b) {\n      function h (a, c) { var d = -1; var e = 1; if (a.charAt(0) == '-' && (e = -1, a = a.substring(1)), b.NUMBER_DEC.test(a))d = parseInt(a); else if (b.NUMBER_HEX.test(a))d = parseInt(a.substring(2), 16); else { if (!b.NUMBER_OCT.test(a)) throw Error('illegal id value: ' + (e < 0 ? '-' : '') + a); d = parseInt(a.substring(1), 8); } if (d = 0 | e * d, !c && d < 0) throw Error('illegal id value: ' + (e < 0 ? '-' : '') + a); return d } function i (a) { var c = 1; if (a.charAt(0) == '-' && (c = -1, a = a.substring(1)), b.NUMBER_DEC.test(a)) return c * parseInt(a, 10); if (b.NUMBER_HEX.test(a)) return c * parseInt(a.substring(2), 16); if (b.NUMBER_OCT.test(a)) return c * parseInt(a.substring(1), 8); if (a === 'inf') return 1 / 0 * c; if (a === 'nan') return 0 / 0; if (b.NUMBER_FLT.test(a)) return c * parseFloat(a); throw Error('illegal number value: ' + (c < 0 ? '-' : '') + a) } function j (a, b, c) { typeof a[b] === 'undefined' ? a[b] = c : (Array.isArray(a[b]) || (a[b] = [a[b]]), a[b].push(c)); } var f; var g; var c = {}; var d = function (a) { this.source = a + '', this.index = 0, this.line = 1, this.stack = [], this._stringOpen = null; }; var e = d.prototype; return e._readString = function () { var c; var a = this._stringOpen === '\"' ? b.STRING_DQ : b.STRING_SQ; if (a.lastIndex = this.index - 1, c = a.exec(this.source), !c) throw Error('unterminated string'); return this.index = a.lastIndex, this.stack.push(this._stringOpen), this._stringOpen = null, c[1] }, e.next = function () { var a, c, d, e, f, g; if (this.stack.length > 0) return this.stack.shift(); if (this.index >= this.source.length) return null; if (this._stringOpen !== null) return this._readString(); do { for (a = !1; b.WHITESPACE.test(d = this.source.charAt(this.index));) if (d === '\\n' && ++this.line, ++this.index === this.source.length) return null; if (this.source.charAt(this.index) === '/') if (++this.index, this.source.charAt(this.index) === '/') { for (;this.source.charAt(++this.index) !== '\\n';) if (this.index == this.source.length) return null; ++this.index, ++this.line, a = !0; } else { if ((d = this.source.charAt(this.index)) !== '*') return '/'; do { if (d === '\\n' && ++this.line, ++this.index === this.source.length) return null; c = d, d = this.source.charAt(this.index); } while (c !== '*' || d !== '/'); ++this.index, a = !0; } } while (a); if (this.index === this.source.length) return null; if (e = this.index, b.DELIM.lastIndex = 0, f = b.DELIM.test(this.source.charAt(e++)), !f) for (;e < this.source.length && !b.DELIM.test(this.source.charAt(e));)++e; return g = this.source.substring(this.index, this.index = e), (g === '\"' || g === \"'\") && (this._stringOpen = g), g }, e.peek = function () { if (this.stack.length === 0) { var a = this.next(); if (a === null) return null; this.stack.push(a); } return this.stack[0] }, e.skip = function (a) { var b = this.next(); if (b !== a) throw Error(\"illegal '\" + b + \"', '\" + a + \"' expected\") }, e.omit = function (a) { return this.peek() === a ? (this.next(), !0) : !1 }, e.toString = function () { return 'Tokenizer (' + this.index + '/' + this.source.length + ' at line ' + this.line + ')' }, c.Tokenizer = d, f = function (a) { this.tn = new d(a), this.proto3 = !1; }, g = f.prototype, g.parse = function () { var c; var a = { name: '[ROOT]', package: null, messages: [], enums: [], imports: [], options: {}, services: [] }; var d = !0; try { for (;c = this.tn.next();) switch (c) { case 'package':if (!d || a.package !== null) throw Error(\"unexpected 'package'\"); if (c = this.tn.next(), !b.TYPEREF.test(c)) throw Error('illegal package name: ' + c); this.tn.skip(';'), a.package = c; break; case 'import':if (!d) throw Error(\"unexpected 'import'\"); c = this.tn.peek(), c === 'public' && this.tn.next(), c = this._readString(), this.tn.skip(';'), a.imports.push(c); break; case 'syntax':if (!d) throw Error(\"unexpected 'syntax'\"); this.tn.skip('='), (a.syntax = this._readString()) === 'proto3' && (this.proto3 = !0), this.tn.skip(';'); break; case 'message':this._parseMessage(a, null), d = !1; break; case 'enum':this._parseEnum(a), d = !1; break; case 'option':this._parseOption(a); break; case 'service':this._parseService(a); break; case 'extend':this._parseExtend(a); break; default:throw Error(\"unexpected '\" + c + \"'\") } } catch (e) { throw e.message = 'Parse error at line ' + this.tn.line + ': ' + e.message, e } return delete a.name, a }, f.parse = function (a) { return new f(a).parse() }, g._readString = function () { var b; var c; var a = ''; do { if (c = this.tn.next(), c !== \"'\" && c !== '\"') throw Error('illegal string delimiter: ' + c); a += this.tn.next(), this.tn.skip(c), b = this.tn.peek(); } while (b === '\"' || b === '\"'); return a }, g._readValue = function (a) { var c = this.tn.peek(); if (c === '\"' || c === \"'\") return this._readString(); if (this.tn.next(), b.NUMBER.test(c)) return i(c); if (b.BOOL.test(c)) return c.toLowerCase() === 'true'; if (a && b.TYPEREF.test(c)) return c; throw Error('illegal value: ' + c) }, g._parseOption = function (a, c) { var f; var d = this.tn.next(); var e = !1; if (d === '(' && (e = !0, d = this.tn.next()), !b.TYPEREF.test(d)) throw Error('illegal option name: ' + d); f = d, e && (this.tn.skip(')'), f = '(' + f + ')', d = this.tn.peek(), b.FQTYPEREF.test(d) && (f += d, this.tn.next())), this.tn.skip('='), this._parseOptionValue(a, f), c || this.tn.skip(';'); }, g._parseOptionValue = function (a, c) { var d = this.tn.peek(); if (d !== '{')j(a.options, c, this._readValue(!0)); else for (this.tn.skip('{'); (d = this.tn.next()) !== '}';) { if (!b.NAME.test(d)) throw Error('illegal option name: ' + c + '.' + d); this.tn.omit(':') ? j(a.options, c + '.' + d, this._readValue(!0)) : this._parseOptionValue(a, c + '.' + d); } }, g._parseService = function (a) { var d; var e; var c = this.tn.next(); if (!b.NAME.test(c)) throw Error('illegal service name at line ' + this.tn.line + ': ' + c); for (d = c, e = { name: d, rpc: {}, options: {} }, this.tn.skip('{'); (c = this.tn.next()) !== '}';) if (c === 'option') this._parseOption(e); else { if (c !== 'rpc') throw Error('illegal service token: ' + c); this._parseServiceRPC(e); } this.tn.omit(';'), a.services.push(e); }, g._parseServiceRPC = function (a) { var e; var f; var c = 'rpc'; var d = this.tn.next(); if (!b.NAME.test(d)) throw Error('illegal rpc service method name: ' + d); if (e = d, f = { request: null, response: null, request_stream: !1, response_stream: !1, options: {} }, this.tn.skip('('), d = this.tn.next(), d.toLowerCase() === 'stream' && (f.request_stream = !0, d = this.tn.next()), !b.TYPEREF.test(d)) throw Error('illegal rpc service request type: ' + d); if (f.request = d, this.tn.skip(')'), d = this.tn.next(), d.toLowerCase() !== 'returns') throw Error('illegal rpc service request type delimiter: ' + d); if (this.tn.skip('('), d = this.tn.next(), d.toLowerCase() === 'stream' && (f.response_stream = !0, d = this.tn.next()), f.response = d, this.tn.skip(')'), d = this.tn.peek(), d === '{') { for (this.tn.next(); (d = this.tn.next()) !== '}';) { if (d !== 'option') throw Error('illegal rpc service token: ' + d); this._parseOption(f); } this.tn.omit(';'); } else this.tn.skip(';'); typeof a[c] === 'undefined' && (a[c] = {}), a[c][e] = f; }, g._parseMessage = function (a, c) { var d = !!c; var e = this.tn.next(); var f = { name: '', fields: [], enums: [], messages: [], options: {}, services: [], oneofs: {} }; if (!b.NAME.test(e)) throw Error('illegal ' + (d ? 'group' : 'message') + ' name: ' + e); for (f.name = e, d && (this.tn.skip('='), c.id = h(this.tn.next()), f.isGroup = !0), e = this.tn.peek(), e === '[' && c && this._parseFieldOptions(c), this.tn.skip('{'); (e = this.tn.next()) !== '}';) if (b.RULE.test(e)) this._parseMessageField(f, e); else if (e === 'oneof') this._parseMessageOneOf(f); else if (e === 'enum') this._parseEnum(f); else if (e === 'message') this._parseMessage(f); else if (e === 'option') this._parseOption(f); else if (e === 'service') this._parseService(f); else if (e === 'extensions')f.extensions = this._parseExtensionRanges(); else if (e === 'reserved') this._parseIgnored(); else if (e === 'extend') this._parseExtend(f); else { if (!b.TYPEREF.test(e)) throw Error('illegal message token: ' + e); if (!this.proto3) throw Error('illegal field rule: ' + e); this._parseMessageField(f, 'optional', e); } return this.tn.omit(';'), a.messages.push(f), f }, g._parseIgnored = function () { for (;this.tn.peek() !== ';';) this.tn.next(); this.tn.skip(';'); }, g._parseMessageField = function (a, c, d) {\n        var e, f, g; if (!b.RULE.test(c)) throw Error('illegal message field rule: ' + c); if (e = { rule: c, type: '', name: '', options: {}, id: 0 }, c === 'map') { if (d) throw Error('illegal type: ' + d); if (this.tn.skip('<'), f = this.tn.next(), !b.TYPE.test(f) && !b.TYPEREF.test(f)) throw Error('illegal message field type: ' + f); if (e.keytype = f, this.tn.skip(','), f = this.tn.next(), !b.TYPE.test(f) && !b.TYPEREF.test(f)) throw Error('illegal message field: ' + f); if (e.type = f, this.tn.skip('>'), f = this.tn.next(), !b.NAME.test(f)) throw Error('illegal message field name: ' + f); e.name = f, this.tn.skip('='), e.id = h(this.tn.next()), f = this.tn.peek(), f === '[' && this._parseFieldOptions(e), this.tn.skip(';'); } else if (d = typeof d !== 'undefined' ? d : this.tn.next(), d === 'group') { if (g = this._parseMessage(a, e), !/^[A-Z]/.test(g.name)) throw Error('illegal group name: ' + g.name); e.type = g.name, e.name = g.name.toLowerCase(), this.tn.omit(';'); } else {\n          if (!b.TYPE.test(d) && !b.TYPEREF.test(d)) throw Error('illegal message field type: ' + d); if (e.type = d, f = this.tn.next(), !b.NAME.test(f)) throw Error('illegal message field name: ' + f)\n          e.name = f, this.tn.skip('='), e.id = h(this.tn.next()), f = this.tn.peek(), f === '[' && this._parseFieldOptions(e), this.tn.skip(';');\n        } return a.fields.push(e), e\n      }, g._parseMessageOneOf = function (a) { var e; var d; var f; var c = this.tn.next(); if (!b.NAME.test(c)) throw Error('illegal oneof name: ' + c); for (d = c, f = [], this.tn.skip('{'); (c = this.tn.next()) !== '}';)e = this._parseMessageField(a, 'optional', c), e.oneof = d, f.push(e.id); this.tn.omit(';'), a.oneofs[d] = f; }, g._parseFieldOptions = function (a) { this.tn.skip('['); for (var b, c = !0; (b = this.tn.peek()) !== ']';)c || this.tn.skip(','), this._parseOption(a, !0), c = !1; this.tn.next(); }, g._parseEnum = function (a) { var e; var c = { name: '', values: [], options: {} }; var d = this.tn.next(); if (!b.NAME.test(d)) throw Error('illegal name: ' + d); for (c.name = d, this.tn.skip('{'); (d = this.tn.next()) !== '}';) if (d === 'option') this._parseOption(c); else { if (!b.NAME.test(d)) throw Error('illegal name: ' + d); this.tn.skip('='), e = { name: d, id: h(this.tn.next(), !0) }, d = this.tn.peek(), d === '[' && this._parseFieldOptions({ options: {} }), this.tn.skip(';'), c.values.push(e); } this.tn.omit(';'), a.enums.push(c); }, g._parseExtensionRanges = function () { var c; var d; var e; var b = []; do { for (d = []; ;) { switch (c = this.tn.next()) { case 'min':e = a.ID_MIN; break; case 'max':e = a.ID_MAX; break; default:e = i(c); } if (d.push(e), d.length === 2) break; if (this.tn.peek() !== 'to') { d.push(e); break } this.tn.next(); }b.push(d); } while (this.tn.omit(',')); return this.tn.skip(';'), b }, g._parseExtend = function (a) { var d; var c = this.tn.next(); if (!b.TYPEREF.test(c)) throw Error('illegal extend reference: ' + c); for (d = { ref: c, fields: [] }, this.tn.skip('{'); (c = this.tn.next()) !== '}';) if (b.RULE.test(c)) this._parseMessageField(d, c); else { if (!b.TYPEREF.test(c)) throw Error('illegal extend token: ' + c); if (!this.proto3) throw Error('illegal field rule: ' + c); this._parseMessageField(d, 'optional', c); } return this.tn.omit(';'), a.messages.push(d), d }, g.toString = function () { return 'Parser at line ' + this.tn.line }, c.Parser = f, c\n    }(e, e.Lang)), e.Reflect = (function (a) { function k (b) { if (typeof b === 'string' && (b = a.TYPES[b]), typeof b.defaultValue === 'undefined') throw Error('default value for type ' + b.name + ' is not supported'); return b == a.TYPES.bytes ? new f(0) : b.defaultValue } function l (b, c) { if (b && typeof b.low === 'number' && typeof b.high === 'number' && typeof b.unsigned === 'boolean' && b.low === b.low && b.high === b.high) return new a.Long(b.low, b.high, typeof c === 'undefined' ? b.unsigned : c); if (typeof b === 'string') return a.Long.fromString(b, c || !1, 10); if (typeof b === 'number') return a.Long.fromNumber(b, c || !1); throw Error('not convertible to Long') } function o (b, c) { var d = c.readVarint32(); var e = 7 & d; var f = d >>> 3; switch (e) { case a.WIRE_TYPES.VARINT:do d = c.readUint8(); while ((128 & d) === 128); break; case a.WIRE_TYPES.BITS64:c.offset += 8; break; case a.WIRE_TYPES.LDELIM:d = c.readVarint32(), c.offset += d; break; case a.WIRE_TYPES.STARTGROUP:o(f, c); break; case a.WIRE_TYPES.ENDGROUP:if (f === b) return !1; throw Error('Illegal GROUPEND after unknown group: ' + f + ' (' + b + ' expected)'); case a.WIRE_TYPES.BITS32:c.offset += 4; break; default:throw Error('Illegal wire type in unknown group ' + b + ': ' + e) } return !0 } var g; var h; var i; var j; var m; var n; var p; var q; var r; var s; var t; var u; var v; var w; var x; var y; var z; var A; var B; var c = {}; var d = function (a, b, c) { this.builder = a, this.parent = b, this.name = c, this.className; }; var e = d.prototype; return e.fqn = function () { for (var a = this.name, b = this; ;) { if (b = b.parent, b == null) break; a = b.name + '.' + a; } return a }, e.toString = function (a) { return (a ? this.className + ' ' : '') + this.fqn() }, e.build = function () { throw Error(this.toString(!0) + ' cannot be built directly') }, c.T = d, g = function (a, b, c, e, f) { d.call(this, a, b, c), this.className = 'Namespace', this.children = [], this.options = e || {}, this.syntax = f || 'proto2'; }, h = g.prototype = Object.create(d.prototype), h.getChildren = function (a) { var b, c, d; if (a = a || null, a == null) return this.children.slice(); for (b = [], c = 0, d = this.children.length; d > c; ++c) this.children[c] instanceof a && b.push(this.children[c]); return b }, h.addChild = function (a) { var b; if (b = this.getChild(a.name)) if (b instanceof m.Field && b.name !== b.originalName && this.getChild(b.originalName) === null)b.name = b.originalName; else { if (!(a instanceof m.Field && a.name !== a.originalName && this.getChild(a.originalName) === null)) throw Error('Duplicate name in namespace ' + this.toString(!0) + ': ' + a.name); a.name = a.originalName; } this.children.push(a); }, h.getChild = function (a) { var c; var d; var b = typeof a === 'number' ? 'id' : 'name'; for (c = 0, d = this.children.length; d > c; ++c) if (this.children[c][b] === a) return this.children[c]; return null }, h.resolve = function (a, b) { var g; var d = typeof a === 'string' ? a.split('.') : a; var e = this; var f = 0; if (d[f] === '') { for (;e.parent !== null;)e = e.parent; f++; } do { do { if (!(e instanceof c.Namespace)) { e = null; break } if (g = e.getChild(d[f]), !(g && g instanceof c.T && (!b || g instanceof c.Namespace))) { e = null; break }e = g, f++; } while (f < d.length); if (e != null) break; if (this.parent !== null) return this.parent.resolve(a, b) } while (e != null); return e }, h.qn = function (a) { var e; var f; var b = []; var d = a; do b.unshift(d.name), d = d.parent; while (d !== null); for (e = 1; e <= b.length; e++) if (f = b.slice(b.length - e), a === this.resolve(f, a instanceof c.Namespace)) return f.join('.'); return a.fqn() }, h.build = function () { var e; var c; var d; var a = {}; var b = this.children; for (c = 0, d = b.length; d > c; ++c)e = b[c], e instanceof g && (a[e.name] = e.build()); return Object.defineProperty && Object.defineProperty(a, '$options', { value: this.buildOpt() }), a }, h.buildOpt = function () { var c; var d; var e; var f; var a = {}; var b = Object.keys(this.options); for (c = 0, d = b.length; d > c; ++c)e = b[c], f = this.options[b[c]], a[e] = f; return a }, h.getOption = function (a) { return typeof a === 'undefined' ? this.options : typeof this.options[a] !== 'undefined' ? this.options[a] : null }, c.Namespace = g, i = function (b, c, d, e) { if (this.type = b, this.resolvedType = c, this.isMapKey = d, this.syntax = e, d && a.MAP_KEY_TYPES.indexOf(b) < 0) throw Error('Invalid map key type: ' + b.name) }, j = i.prototype, i.defaultFieldValue = k, j.verifyValue = function (c) { var f; var g; var h; var d = function (a, b) { throw Error('Illegal value for ' + this.toString(!0) + ' of type ' + this.type.name + ': ' + a + ' (' + b + ')') }.bind(this); switch (this.type) { case a.TYPES.int32:case a.TYPES.sint32:case a.TYPES.sfixed32:return (typeof c !== 'number' || c === c && c % 1 !== 0) && d(typeof c, 'not an integer'), c > 4294967295 ? 0 | c : c; case a.TYPES.uint32:case a.TYPES.fixed32:return (typeof c !== 'number' || c === c && c % 1 !== 0) && d(typeof c, 'not an integer'), c < 0 ? c >>> 0 : c; case a.TYPES.int64:case a.TYPES.sint64:case a.TYPES.sfixed64:if (a.Long) try { return l(c, !1) } catch (e) { d(typeof c, e.message); } else d(typeof c, 'requires Long.js'); case a.TYPES.uint64:case a.TYPES.fixed64:if (a.Long) try { return l(c, !0) } catch (e) { d(typeof c, e.message); } else d(typeof c, 'requires Long.js'); case a.TYPES.bool:return typeof c !== 'boolean' && d(typeof c, 'not a boolean'), c; case a.TYPES.float:case a.TYPES.double:return typeof c !== 'number' && d(typeof c, 'not a number'), c; case a.TYPES.string:return typeof c === 'string' || c && c instanceof String || d(typeof c, 'not a string'), '' + c; case a.TYPES.bytes:return b.isByteBuffer(c) ? c : b.wrap(c); case a.TYPES.enum:for (f = this.resolvedType.getChildren(a.Reflect.Enum.Value), h = 0; h < f.length; h++) { if (f[h].name == c) return f[h].id; if (f[h].id == c) return f[h].id } if (this.syntax === 'proto3') return (typeof c !== 'number' || c === c && c % 1 !== 0) && d(typeof c, 'not an integer'), (c > 4294967295 || c < 0) && d(typeof c, 'not in range for uint32'), c; d(c, 'not a valid enum value'); case a.TYPES.group:case a.TYPES.message:if (c && typeof c === 'object' || d(typeof c, 'object expected'), c instanceof this.resolvedType.clazz) return c; if (c instanceof a.Builder.Message) { g = {}; for (h in c)c.hasOwnProperty(h) && (g[h] = c[h]); c = g; } return new this.resolvedType.clazz(c) } throw Error('[INTERNAL] Illegal value for ' + this.toString(!0) + ': ' + c + ' (undefined type ' + this.type + ')') }, j.calculateLength = function (b, c) { if (c === null) return 0; var d; switch (this.type) { case a.TYPES.int32:return c < 0 ? f.calculateVarint64(c) : f.calculateVarint32(c); case a.TYPES.uint32:return f.calculateVarint32(c); case a.TYPES.sint32:return f.calculateVarint32(f.zigZagEncode32(c)); case a.TYPES.fixed32:case a.TYPES.sfixed32:case a.TYPES.float:return 4; case a.TYPES.int64:case a.TYPES.uint64:return f.calculateVarint64(c); case a.TYPES.sint64:return f.calculateVarint64(f.zigZagEncode64(c)); case a.TYPES.fixed64:case a.TYPES.sfixed64:return 8; case a.TYPES.bool:return 1; case a.TYPES.enum:return f.calculateVarint32(c); case a.TYPES.double:return 8; case a.TYPES.string:return d = f.calculateUTF8Bytes(c), f.calculateVarint32(d) + d; case a.TYPES.bytes:if (c.remaining() < 0) throw Error('Illegal value for ' + this.toString(!0) + ': ' + c.remaining() + ' bytes remaining'); return f.calculateVarint32(c.remaining()) + c.remaining(); case a.TYPES.message:return d = this.resolvedType.calculate(c), f.calculateVarint32(d) + d; case a.TYPES.group:return d = this.resolvedType.calculate(c), d + f.calculateVarint32(b << 3 | a.WIRE_TYPES.ENDGROUP) } throw Error('[INTERNAL] Illegal value to encode in ' + this.toString(!0) + ': ' + c + ' (unknown type)') }, j.encodeValue = function (b, c, d) { var e, g; if (c === null) return d; switch (this.type) { case a.TYPES.int32:c < 0 ? d.writeVarint64(c) : d.writeVarint32(c); break; case a.TYPES.uint32:d.writeVarint32(c); break; case a.TYPES.sint32:d.writeVarint32ZigZag(c); break; case a.TYPES.fixed32:d.writeUint32(c); break; case a.TYPES.sfixed32:d.writeInt32(c); break; case a.TYPES.int64:case a.TYPES.uint64:d.writeVarint64(c); break; case a.TYPES.sint64:d.writeVarint64ZigZag(c); break; case a.TYPES.fixed64:d.writeUint64(c); break; case a.TYPES.sfixed64:d.writeInt64(c); break; case a.TYPES.bool:typeof c === 'string' ? d.writeVarint32(c.toLowerCase() === 'false' ? 0 : !!c) : d.writeVarint32(c ? 1 : 0); break; case a.TYPES.enum:d.writeVarint32(c); break; case a.TYPES.float:d.writeFloat32(c); break; case a.TYPES.double:d.writeFloat64(c); break; case a.TYPES.string:d.writeVString(c); break; case a.TYPES.bytes:if (c.remaining() < 0) throw Error('Illegal value for ' + this.toString(!0) + ': ' + c.remaining() + ' bytes remaining'); e = c.offset, d.writeVarint32(c.remaining()), d.append(c), c.offset = e; break; case a.TYPES.message:g = (new f()).LE(), this.resolvedType.encode(c, g), d.writeVarint32(g.offset), d.append(g.flip()); break; case a.TYPES.group:this.resolvedType.encode(c, d), d.writeVarint32(b << 3 | a.WIRE_TYPES.ENDGROUP); break; default:throw Error('[INTERNAL] Illegal value to encode in ' + this.toString(!0) + ': ' + c + ' (unknown type)') } return d }, j.decode = function (b, c, d) { if (c != this.type.wireType) throw Error('Unexpected wire type for element'); var e, f; switch (this.type) { case a.TYPES.int32:return 0 | b.readVarint32(); case a.TYPES.uint32:return b.readVarint32() >>> 0; case a.TYPES.sint32:return 0 | b.readVarint32ZigZag(); case a.TYPES.fixed32:return b.readUint32() >>> 0; case a.TYPES.sfixed32:return 0 | b.readInt32(); case a.TYPES.int64:return b.readVarint64(); case a.TYPES.uint64:return b.readVarint64().toUnsigned(); case a.TYPES.sint64:return b.readVarint64ZigZag(); case a.TYPES.fixed64:return b.readUint64(); case a.TYPES.sfixed64:return b.readInt64(); case a.TYPES.bool:return !!b.readVarint32(); case a.TYPES.enum:return b.readVarint32(); case a.TYPES.float:return b.readFloat(); case a.TYPES.double:return b.readDouble(); case a.TYPES.string:return b.readVString(); case a.TYPES.bytes:if (f = b.readVarint32(), b.remaining() < f) throw Error('Illegal number of bytes for ' + this.toString(!0) + ': ' + f + ' required but got only ' + b.remaining()); return e = b.clone(), e.limit = e.offset + f, b.offset += f, e; case a.TYPES.message:return f = b.readVarint32(), this.resolvedType.decode(b, f); case a.TYPES.group:return this.resolvedType.decode(b, -1, d) } throw Error('[INTERNAL] Illegal decode type') }, j.valueFromString = function (b) { if (!this.isMapKey) throw Error('valueFromString() called on non-map-key element'); switch (this.type) { case a.TYPES.int32:case a.TYPES.sint32:case a.TYPES.sfixed32:case a.TYPES.uint32:case a.TYPES.fixed32:return this.verifyValue(parseInt(b)); case a.TYPES.int64:case a.TYPES.sint64:case a.TYPES.sfixed64:case a.TYPES.uint64:case a.TYPES.fixed64:return this.verifyValue(b); case a.TYPES.bool:return b === 'true'; case a.TYPES.string:return this.verifyValue(b); case a.TYPES.bytes:return f.fromBinary(b) } }, j.valueToString = function (b) { if (!this.isMapKey) throw Error('valueToString() called on non-map-key element'); return this.type === a.TYPES.bytes ? b.toString('binary') : b.toString() }, c.Element = i, m = function (a, b, c, d, e, f) { g.call(this, a, b, c, d, f), this.className = 'Message', this.extensions = void 0, this.clazz = null, this.isGroup = !!e, this._fields = null, this._fieldsById = null, this._fieldsByName = null; }, n = m.prototype = Object.create(g.prototype), n.build = function (c) { var d, h, e, g; if (this.clazz && !c) return this.clazz; for (d = (function (a, c) { function k (b, c, d, e) { var g, h, i, j, l, m, n; if (b === null || typeof b !== 'object') return e && e instanceof a.Reflect.Enum && (g = a.Reflect.Enum.getName(e.object, b), g !== null) ? g : b; if (f.isByteBuffer(b)) return c ? b.toBase64() : b.toBuffer(); if (a.Long.isLong(b)) return d ? b.toString() : a.Long.fromValue(b); if (Array.isArray(b)) return h = [], b.forEach(function (a, b) { h[b] = k(a, c, d, e); }), h; if (h = {}, b instanceof a.Map) { for (i = b.entries(), j = i.next(); !j.done; j = i.next())h[b.keyElem.valueToString(j.value[0])] = k(j.value[1], c, d, b.valueElem.resolvedType); return h }l = b.$type, m = void 0; for (n in b)b.hasOwnProperty(n) && (h[n] = l && (m = l.getChild(n)) ? k(b[n], c, d, m.resolvedType) : k(b[n], c, d)); return h } var i; var j; var d = c.getChildren(a.Reflect.Message.Field); var e = c.getChildren(a.Reflect.Message.OneOf); var g = function (b) { var i, j, k, l; for (a.Builder.Message.call(this), i = 0, j = e.length; j > i; ++i) this[e[i].name] = null; for (i = 0, j = d.length; j > i; ++i)k = d[i], this[k.name] = k.repeated ? [] : k.map ? new a.Map(k) : null, !k.required && c.syntax !== 'proto3' || k.defaultValue === null || (this[k.name] = k.defaultValue); if (arguments.length > 0) if (arguments.length !== 1 || b === null || typeof b !== 'object' || !(typeof b.encode !== 'function' || b instanceof g) || Array.isArray(b) || b instanceof a.Map || f.isByteBuffer(b) || b instanceof ArrayBuffer || a.Long && b instanceof a.Long) for (i = 0, j = arguments.length; j > i; ++i) typeof (l = arguments[i]) !== 'undefined' && this.$set(d[i].name, l); else this.$set(b); }; var h = g.prototype = Object.create(a.Builder.Message.prototype); for (h.add = function (b, d, e) { var f = c._fieldsByName[b]; if (!e) { if (!f) throw Error(this + '#' + b + ' is undefined'); if (!(f instanceof a.Reflect.Message.Field)) throw Error(this + '#' + b + ' is not a field: ' + f.toString(!0)); if (!f.repeated) throw Error(this + '#' + b + ' is not a repeated field'); d = f.verifyValue(d, !0); } return this[b] === null && (this[b] = []), this[b].push(d), this }, h.$add = h.add, h.set = function (b, d, e) { var f, g, h; if (b && typeof b === 'object') { e = d; for (f in b)b.hasOwnProperty(f) && typeof (d = b[f]) !== 'undefined' && this.$set(f, d, e); return this } if (g = c._fieldsByName[b], e) this[b] = d; else { if (!g) throw Error(this + '#' + b + ' is not a field: undefined'); if (!(g instanceof a.Reflect.Message.Field)) throw Error(this + '#' + b + ' is not a field: ' + g.toString(!0)); this[g.name] = d = g.verifyValue(d); } return g && g.oneof && (h = this[g.oneof.name], d !== null ? (h !== null && h !== g.name && (this[h] = null), this[g.oneof.name] = g.name) : h === b && (this[g.oneof.name] = null)), this }, h.$set = h.set, h.get = function (b, d) { if (d) return this[b]; var e = c._fieldsByName[b]; if (!(e && e instanceof a.Reflect.Message.Field)) throw Error(this + '#' + b + ' is not a field: undefined'); if (!(e instanceof a.Reflect.Message.Field)) throw Error(this + '#' + b + ' is not a field: ' + e.toString(!0)); return this[e.name] }, h.$get = h.get, i = 0; i < d.length; i++)j = d[i], j instanceof a.Reflect.Message.ExtensionField || c.builder.options.populateAccessors && (function (a) { var d; var e; var f; var b = a.originalName.replace(/(_[a-zA-Z])/g, function (a) { return a.toUpperCase().replace('_', '') }); b = b.substring(0, 1).toUpperCase() + b.substring(1), d = a.originalName.replace(/([A-Z])/g, function (a) { return '_' + a }), e = function (b, c) { return this[a.name] = c ? b : a.verifyValue(b), this }, f = function () { return this[a.name] }, c.getChild('set' + b) === null && (h['set' + b] = e), c.getChild('set_' + d) === null && (h['set_' + d] = e), c.getChild('get' + b) === null && (h['get' + b] = f), c.getChild('get_' + d) === null && (h['get_' + d] = f); }(j)); return h.encode = function (a, d) { var e, f; typeof a === 'boolean' && (d = a, a = void 0), e = !1, a || (a = new b(), e = !0), f = a.littleEndian; try { return c.encode(this, a.LE(), d), (e ? a.flip() : a).LE(f) } catch (g) { throw a.LE(f), g } }, g.encode = function (a, b, c) { return new g(a).encode(b, c) }, h.calculate = function () { return c.calculate(this) }, h.encodeDelimited = function (a) { var d; var b = !1; return a || (a = new f(), b = !0), d = (new f()).LE(), c.encode(this, d).flip(), a.writeVarint32(d.remaining()), a.append(d), b ? a.flip() : a }, h.encodeAB = function () { try { return this.encode().toArrayBuffer() } catch (a) { throw a.encoded && (a.encoded = a.encoded.toArrayBuffer()), a } }, h.toArrayBuffer = h.encodeAB, h.encodeNB = function () { try { return this.encode().toBuffer() } catch (a) { throw a.encoded && (a.encoded = a.encoded.toBuffer()), a } }, h.toBuffer = h.encodeNB, h.encode64 = function () { try { return this.encode().toBase64() } catch (a) { throw a.encoded && (a.encoded = a.encoded.toBase64()), a } }, h.toBase64 = h.encode64, h.encodeHex = function () { try { return this.encode().toHex() } catch (a) { throw a.encoded && (a.encoded = a.encoded.toHex()), a } }, h.toHex = h.encodeHex, h.toRaw = function (a, b) { return k(this, !!a, !!b, this.$type) }, h.encodeJSON = function () { return JSON.stringify(k(this, !0, !0, this.$type)) }, g.decode = function (a, b) { var d, e; typeof a === 'string' && (a = f.wrap(a, b || 'base64')), a = f.isByteBuffer(a) ? a : f.wrap(a), d = a.littleEndian; try { return e = c.decode(a.LE()), a.LE(d), e } catch (g) { throw a.LE(d), g } }, g.decodeDelimited = function (a, b) { var d, e, g; if (typeof a === 'string' && (a = f.wrap(a, b || 'base64')), a = f.isByteBuffer(a) ? a : f.wrap(a), a.remaining() < 1) return null; if (d = a.offset, e = a.readVarint32(), a.remaining() < e) return a.offset = d, null; try { return g = c.decode(a.slice(a.offset, a.offset + e).LE()), a.offset += e, g } catch (h) { throw a.offset += e, h } }, g.decode64 = function (a) { return g.decode(a, 'base64') }, g.decodeHex = function (a) { return g.decode(a, 'hex') }, g.decodeJSON = function (a) { return new g(JSON.parse(a)) }, h.toString = function () { return c.toString() }, Object.defineProperty && (Object.defineProperty(g, '$options', { value: c.buildOpt() }), Object.defineProperty(h, '$options', { value: g.$options }), Object.defineProperty(g, '$type', { value: c }), Object.defineProperty(h, '$type', { value: c })), g }(a, this)), this._fields = [], this._fieldsById = {}, this._fieldsByName = {}, e = 0, g = this.children.length; g > e; e++) if (h = this.children[e], h instanceof t || h instanceof m || h instanceof x) { if (d.hasOwnProperty(h.name)) throw Error('Illegal reflect child of ' + this.toString(!0) + ': ' + h.toString(!0) + \" cannot override static property '\" + h.name + \"'\"); d[h.name] = h.build(); } else if (h instanceof m.Field)h.build(), this._fields.push(h), this._fieldsById[h.id] = h, this._fieldsByName[h.name] = h; else if (!(h instanceof m.OneOf || h instanceof w)) throw Error('Illegal reflect child of ' + this.toString(!0) + ': ' + this.children[e].toString(!0)); return this.clazz = d }, n.encode = function (a, b, c) { var e; var h; var f; var g; var i; var d = null; for (f = 0, g = this._fields.length; g > f; ++f)e = this._fields[f], h = a[e.name], e.required && h === null ? d === null && (d = e) : e.encode(c ? h : e.verifyValue(h), b, a); if (d !== null) throw i = Error('Missing at least one required field for ' + this.toString(!0) + ': ' + d), i.encoded = b, i; return b }, n.calculate = function (a) { for (var e, f, b = 0, c = 0, d = this._fields.length; d > c; ++c) { if (e = this._fields[c], f = a[e.name], e.required && f === null) throw Error('Missing at least one required field for ' + this.toString(!0) + ': ' + e); b += e.calculate(f, a); } return b }, n.decode = function (b, c, d) { var g, h, i, j, e, f, k, l, m, n, p, q; for (c = typeof c === 'number' ? c : -1, e = b.offset, f = new this.clazz(); b.offset < e + c || c === -1 && b.remaining() > 0;) { if (g = b.readVarint32(), h = 7 & g, i = g >>> 3, h === a.WIRE_TYPES.ENDGROUP) { if (i !== d) throw Error('Illegal group end indicator for ' + this.toString(!0) + ': ' + i + ' (' + (d ? d + ' expected' : 'not a group') + ')'); break } if (j = this._fieldsById[i])j.repeated && !j.options.packed ? f[j.name].push(j.decode(h, b)) : j.map ? (l = j.decode(h, b), f[j.name].set(l[0], l[1])) : (f[j.name] = j.decode(h, b), j.oneof && (m = f[j.oneof.name], m !== null && m !== j.name && (f[m] = null), f[j.oneof.name] = j.name)); else switch (h) { case a.WIRE_TYPES.VARINT:b.readVarint32(); break; case a.WIRE_TYPES.BITS32:b.offset += 4; break; case a.WIRE_TYPES.BITS64:b.offset += 8; break; case a.WIRE_TYPES.LDELIM:k = b.readVarint32(), b.offset += k; break; case a.WIRE_TYPES.STARTGROUP:for (;o(i, b););break; default:throw Error('Illegal wire type for unknown field ' + i + ' in ' + this.toString(!0) + '#decode: ' + h) } } for (n = 0, p = this._fields.length; p > n; ++n) if (j = this._fields[n], f[j.name] === null) if (this.syntax === 'proto3')f[j.name] = j.defaultValue; else { if (j.required) throw q = Error('Missing at least one required field for ' + this.toString(!0) + ': ' + j.name), q.decoded = f, q; a.populateDefaults && j.defaultValue !== null && (f[j.name] = j.defaultValue); } return f }, c.Message = m, p = function (b, c, e, f, g, h, i, j, k, l) { d.call(this, b, c, h), this.className = 'Message.Field', this.required = e === 'required', this.repeated = e === 'repeated', this.map = e === 'map', this.keyType = f || null, this.type = g, this.resolvedType = null, this.id = i, this.options = j || {}, this.defaultValue = null, this.oneof = k || null, this.syntax = l || 'proto2', this.originalName = this.name, this.element = null, this.keyElement = null, !this.builder.options.convertFieldsToCamelCase || this instanceof m.ExtensionField || (this.name = a.Util.toCamelCase(this.name)); }, q = p.prototype = Object.create(d.prototype), q.build = function () { this.element = new i(this.type, this.resolvedType, !1, this.syntax), this.map && (this.keyElement = new i(this.keyType, void 0, !0, this.syntax)), this.syntax !== 'proto3' || this.repeated || this.map ? typeof this.options.default !== 'undefined' && (this.defaultValue = this.verifyValue(this.options.default)) : this.defaultValue = i.defaultFieldValue(this.type); }, q.verifyValue = function (b, c) { var d, e, f; if (c = c || !1, d = function (a, b) { throw Error('Illegal value for ' + this.toString(!0) + ' of type ' + this.type.name + ': ' + a + ' (' + b + ')') }.bind(this), b === null) return this.required && d(typeof b, 'required'), this.syntax === 'proto3' && this.type !== a.TYPES.message && d(typeof b, 'proto3 field without field presence cannot be null'), null; if (this.repeated && !c) { for (Array.isArray(b) || (b = [b]), f = [], e = 0; e < b.length; e++)f.push(this.element.verifyValue(b[e])); return f } return this.map && !c ? b instanceof a.Map ? b : (b instanceof Object || d(typeof b, 'expected ProtoBuf.Map or raw object for map field'), new a.Map(this, b)) : (!this.repeated && Array.isArray(b) && d(typeof b, 'no array expected'), this.element.verifyValue(b)) }, q.hasWirePresence = function (b, c) { if (this.syntax !== 'proto3') return b !== null; if (this.oneof && c[this.oneof.name] === this.name) return !0; switch (this.type) { case a.TYPES.int32:case a.TYPES.sint32:case a.TYPES.sfixed32:case a.TYPES.uint32:case a.TYPES.fixed32:return b !== 0; case a.TYPES.int64:case a.TYPES.sint64:case a.TYPES.sfixed64:case a.TYPES.uint64:case a.TYPES.fixed64:return b.low !== 0 || b.high !== 0; case a.TYPES.bool:return b; case a.TYPES.float:case a.TYPES.double:return b !== 0; case a.TYPES.string:return b.length > 0; case a.TYPES.bytes:return b.remaining() > 0; case a.TYPES.enum:return b !== 0; case a.TYPES.message:return b !== null; default:return !0 } }, q.encode = function (b, c, d) { var e, g, h, i, j; if (this.type === null || typeof this.type !== 'object') throw Error('[INTERNAL] Unresolved type in ' + this.toString(!0) + ': ' + this.type); if (b === null || this.repeated && b.length == 0) return c; try { if (this.repeated) if (this.options.packed && a.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType) >= 0) { for (c.writeVarint32(this.id << 3 | a.WIRE_TYPES.LDELIM), c.ensureCapacity(c.offset += 1), g = c.offset, e = 0; e < b.length; e++) this.element.encodeValue(this.id, b[e], c); h = c.offset - g, i = f.calculateVarint32(h), i > 1 && (j = c.slice(g, c.offset), g += i - 1, c.offset = g, c.append(j)), c.writeVarint32(h, g - i); } else for (e = 0; e < b.length; e++)c.writeVarint32(this.id << 3 | this.type.wireType), this.element.encodeValue(this.id, b[e], c); else this.map ? b.forEach(function (b, d) { var g = f.calculateVarint32(8 | this.keyType.wireType) + this.keyElement.calculateLength(1, d) + f.calculateVarint32(16 | this.type.wireType) + this.element.calculateLength(2, b); c.writeVarint32(this.id << 3 | a.WIRE_TYPES.LDELIM), c.writeVarint32(g), c.writeVarint32(8 | this.keyType.wireType), this.keyElement.encodeValue(1, d, c), c.writeVarint32(16 | this.type.wireType), this.element.encodeValue(2, b, c); }, this) : this.hasWirePresence(b, d) && (c.writeVarint32(this.id << 3 | this.type.wireType), this.element.encodeValue(this.id, b, c)); } catch (k) { throw Error('Illegal value for ' + this.toString(!0) + ': ' + b + ' (' + k + ')') } return c }, q.calculate = function (b, c) { var d, e, g; if (b = this.verifyValue(b), this.type === null || typeof this.type !== 'object') throw Error('[INTERNAL] Unresolved type in ' + this.toString(!0) + ': ' + this.type); if (b === null || this.repeated && b.length == 0) return 0; d = 0; try { if (this.repeated) if (this.options.packed && a.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType) >= 0) { for (d += f.calculateVarint32(this.id << 3 | a.WIRE_TYPES.LDELIM), g = 0, e = 0; e < b.length; e++)g += this.element.calculateLength(this.id, b[e]); d += f.calculateVarint32(g), d += g; } else for (e = 0; e < b.length; e++)d += f.calculateVarint32(this.id << 3 | this.type.wireType), d += this.element.calculateLength(this.id, b[e]); else this.map ? b.forEach(function (b, c) { var g = f.calculateVarint32(8 | this.keyType.wireType) + this.keyElement.calculateLength(1, c) + f.calculateVarint32(16 | this.type.wireType) + this.element.calculateLength(2, b); d += f.calculateVarint32(this.id << 3 | a.WIRE_TYPES.LDELIM), d += f.calculateVarint32(g), d += g; }, this) : this.hasWirePresence(b, c) && (d += f.calculateVarint32(this.id << 3 | this.type.wireType), d += this.element.calculateLength(this.id, b)); } catch (h) { throw Error('Illegal value for ' + this.toString(!0) + ': ' + b + ' (' + h + ')') } return d }, q.decode = function (b, c, d) { var e; var f; var h; var j; var k; var l; var m; var g = !this.map && b == this.type.wireType || !d && this.repeated && this.options.packed && b == a.WIRE_TYPES.LDELIM || this.map && b == a.WIRE_TYPES.LDELIM; if (!g) throw Error('Illegal wire type for field ' + this.toString(!0) + ': ' + b + ' (' + this.type.wireType + ' expected)'); if (b == a.WIRE_TYPES.LDELIM && this.repeated && this.options.packed && a.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType) >= 0 && !d) { for (f = c.readVarint32(), f = c.offset + f, h = []; c.offset < f;)h.push(this.decode(this.type.wireType, c, !0)); return h } if (this.map) { if (j = i.defaultFieldValue(this.keyType), e = i.defaultFieldValue(this.type), f = c.readVarint32(), c.remaining() < f) throw Error('Illegal number of bytes for ' + this.toString(!0) + ': ' + f + ' required but got only ' + c.remaining()); for (k = c.clone(), k.limit = k.offset + f, c.offset += f; k.remaining() > 0;) if (l = k.readVarint32(), b = 7 & l, m = l >>> 3, m === 1)j = this.keyElement.decode(k, b, m); else { if (m !== 2) throw Error('Unexpected tag in map field key/value submessage'); e = this.element.decode(k, b, m); } return [j, e] } return this.element.decode(c, b, this.id) }, c.Message.Field = p, r = function (a, b, c, d, e, f, g) { p.call(this, a, b, c, null, d, e, f, g), this.extension; }, r.prototype = Object.create(p.prototype), c.Message.ExtensionField = r, s = function (a, b, c) { d.call(this, a, b, c), this.fields = []; }, c.Message.OneOf = s, t = function (a, b, c, d, e) { g.call(this, a, b, c, d, e), this.className = 'Enum', this.object = null; }, t.getName = function (a, b) { var e; var d; var c = Object.keys(a); for (d = 0; d < c.length; ++d) if (a[e = c[d]] === b) return e; return null }, u = t.prototype = Object.create(g.prototype), u.build = function (b) { var c, d, e, f; if (this.object && !b) return this.object; for (c = new a.Builder.Enum(), d = this.getChildren(t.Value), e = 0, f = d.length; f > e; ++e)c[d[e].name] = d[e].id; return Object.defineProperty && Object.defineProperty(c, '$options', { value: this.buildOpt(), enumerable: !1 }), this.object = c }, c.Enum = t, v = function (a, b, c, e) { d.call(this, a, b, c), this.className = 'Enum.Value', this.id = e; }, v.prototype = Object.create(d.prototype), c.Enum.Value = v, w = function (a, b, c, e) { d.call(this, a, b, c), this.field = e; }, w.prototype = Object.create(d.prototype), c.Extension = w, x = function (a, b, c, d) { g.call(this, a, b, c, d), this.className = 'Service', this.clazz = null; }, y = x.prototype = Object.create(g.prototype), y.build = function (b) { return this.clazz && !b ? this.clazz : this.clazz = (function (a, b) { var g; var c = function (b) { a.Builder.Service.call(this), this.rpcImpl = b || function (a, b, c) { setTimeout(c.bind(this, Error('Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services')), 0); }; }; var d = c.prototype = Object.create(a.Builder.Service.prototype); var e = b.getChildren(a.Reflect.Service.RPCMethod); for (g = 0; g < e.length; g++)!(function (a) { d[a.name] = function (c, d) { try { try { c = a.resolvedRequestType.clazz.decode(f.wrap(c)); } catch (e) { if (!(e instanceof TypeError)) throw e } if (c === null || typeof c !== 'object') throw Error('Illegal arguments'); c instanceof a.resolvedRequestType.clazz || (c = new a.resolvedRequestType.clazz(c)), this.rpcImpl(a.fqn(), c, function (c, e) { if (c) return d(c), void 0; try { e = a.resolvedResponseType.clazz.decode(e); } catch (f) {} return e && e instanceof a.resolvedResponseType.clazz ? (d(null, e), void 0) : (d(Error('Illegal response type received in service method ' + b.name + '#' + a.name)), void 0) }); } catch (e) { setTimeout(d.bind(this, e), 0); } }, c[a.name] = function (b, d, e) { new c(b)[a.name](d, e); }, Object.defineProperty && (Object.defineProperty(c[a.name], '$options', { value: a.buildOpt() }), Object.defineProperty(d[a.name], '$options', { value: c[a.name].$options })); }(e[g])); return Object.defineProperty && (Object.defineProperty(c, '$options', { value: b.buildOpt() }), Object.defineProperty(d, '$options', { value: c.$options }), Object.defineProperty(c, '$type', { value: b }), Object.defineProperty(d, '$type', { value: b })), c }(a, this)) }, c.Service = x, z = function (a, b, c, e) { d.call(this, a, b, c), this.className = 'Service.Method', this.options = e || {}; }, A = z.prototype = Object.create(d.prototype), A.buildOpt = h.buildOpt, c.Service.Method = z, B = function (a, b, c, d, e, f, g, h) { z.call(this, a, b, c, h), this.className = 'Service.RPCMethod', this.requestName = d, this.responseName = e, this.requestStream = f, this.responseStream = g, this.resolvedRequestType = null, this.resolvedResponseType = null; }, B.prototype = Object.create(z.prototype), c.Service.RPCMethod = B, c }(e)), e.Builder = (function (a, b, c) {\n      function f (a) { a.messages && a.messages.forEach(function (b) { b.syntax = a.syntax, f(b); }), a.enums && a.enums.forEach(function (b) { b.syntax = a.syntax; }); } var d = function (a) { this.ns = new c.Namespace(this, null, ''), this.ptr = this.ns, this.resolved = !1, this.result = null, this.files = {}, this.importRoot = null, this.options = a || {}; }; var e = d.prototype; return d.isMessage = function (a) { return typeof a.name !== 'string' ? !1 : typeof a.values !== 'undefined' || typeof a.rpc !== 'undefined' ? !1 : !0 }, d.isMessageField = function (a) { return typeof a.rule !== 'string' || typeof a.name !== 'string' || typeof a.type !== 'string' || typeof a.id === 'undefined' ? !1 : !0 }, d.isEnum = function (a) { return typeof a.name !== 'string' ? !1 : typeof a.values !== 'undefined' && Array.isArray(a.values) && a.values.length !== 0 ? !0 : !1 }, d.isService = function (a) { return typeof a.name === 'string' && typeof a.rpc === 'object' && a.rpc ? !0 : !1 }, d.isExtend = function (a) { return typeof a.ref !== 'string' ? !1 : !0 }, e.reset = function () { return this.ptr = this.ns, this }, e.define = function (a) { if (typeof a !== 'string' || !b.TYPEREF.test(a)) throw Error('illegal namespace: ' + a); return a.split('.').forEach(function (a) { var b = this.ptr.getChild(a); b === null && this.ptr.addChild(b = new c.Namespace(this, this.ptr, a)), this.ptr = b; }, this), this }, e.create = function (b) {\n        var e, f, g, h, i; if (!b) return this; if (Array.isArray(b)) { if (b.length === 0) return this; b = b.slice(); } else b = [b]; for (e = [b]; e.length > 0;) {\n          if (b = e.pop(), !Array.isArray(b)) throw Error('not a valid namespace: ' + JSON.stringify(b)); for (;b.length > 0;) {\n            if (f = b.shift(), d.isMessage(f)) { if (g = new c.Message(this, this.ptr, f.name, f.options, f.isGroup, f.syntax), h = {}, f.oneofs && Object.keys(f.oneofs).forEach(function (a) { g.addChild(h[a] = new c.Message.OneOf(this, g, a)); }, this), f.fields && f.fields.forEach(function (a) { if (g.getChild(0 | a.id) !== null) throw Error('duplicate or invalid field id in ' + g.name + ': ' + a.id); if (a.options && typeof a.options !== 'object') throw Error('illegal field options in ' + g.name + '#' + a.name); var b = null; if (typeof a.oneof === 'string' && !(b = h[a.oneof])) throw Error('illegal oneof in ' + g.name + '#' + a.name + ': ' + a.oneof); a = new c.Message.Field(this, g, a.rule, a.keytype, a.type, a.name, a.id, a.options, b, f.syntax), b && b.fields.push(a), g.addChild(a); }, this), i = [], f.enums && f.enums.forEach(function (a) { i.push(a); }), f.messages && f.messages.forEach(function (a) { i.push(a); }), f.services && f.services.forEach(function (a) { i.push(a); }), f.extensions && (g.extensions = typeof f.extensions[0] === 'number' ? [f.extensions] : f.extensions), this.ptr.addChild(g), i.length > 0) { e.push(b), b = i, i = null, this.ptr = g, g = null; continue }i = null; } else if (d.isEnum(f))g = new c.Enum(this, this.ptr, f.name, f.options, f.syntax), f.values.forEach(function (a) { g.addChild(new c.Enum.Value(this, g, a.name, a.id)); }, this), this.ptr.addChild(g); else if (d.isService(f))g = new c.Service(this, this.ptr, f.name, f.options), Object.keys(f.rpc).forEach(function (a) { var b = f.rpc[a]; g.addChild(new c.Service.RPCMethod(this, g, a, b.request, b.response, !!b.request_stream, !!b.response_stream, b.options)); }, this), this.ptr.addChild(g); else {\n              if (!d.isExtend(f)) throw Error('not a valid definition: ' + JSON.stringify(f)); if (g = this.ptr.resolve(f.ref, !0)) {\n                f.fields.forEach(function (b) {\n                  var d, e, f, h; if (g.getChild(0 | b.id) !== null) throw Error('duplicate extended field id in ' + g.name + ': ' + b.id)\n                  if (g.extensions && (d = !1, g.extensions.forEach(function (a) { b.id >= a[0] && b.id <= a[1] && (d = !0); }), !d)) throw Error('illegal extended field id in ' + g.name + ': ' + b.id + ' (not within valid ranges)'); e = b.name, this.options.convertFieldsToCamelCase && (e = a.Util.toCamelCase(e)), f = new c.Message.ExtensionField(this, g, b.rule, b.type, this.ptr.fqn() + '.' + e, b.id, b.options), h = new c.Extension(this, this.ptr, b.name, f), f.extension = h, this.ptr.addChild(h), g.addChild(f);\n                }, this);\n              } else if (!/\\.?google\\.protobuf\\./.test(f.ref)) throw Error('extended message ' + f.ref + ' is not defined')\n            }f = null, g = null;\n          }b = null, this.ptr = this.ptr.parent;\n        } return this.resolved = !1, this.result = null, this\n      }, e.import = function (b, c) { var e; var g; var h; var i; var j; var k; var l; var m; var d = '/'; if (typeof c === 'string') { if (a.Util.IS_NODE, this.files[c] === !0) return this.reset(); this.files[c] = !0; } else if (typeof c === 'object') { if (e = c.root, a.Util.IS_NODE, (e.indexOf('\\\\') >= 0 || c.file.indexOf('\\\\') >= 0) && (d = '\\\\'), g = e + d + c.file, this.files[g] === !0) return this.reset(); this.files[g] = !0; } if (b.imports && b.imports.length > 0) { for (i = !1, typeof c === 'object' ? (this.importRoot = c.root, i = !0, h = this.importRoot, c = c.file, (h.indexOf('\\\\') >= 0 || c.indexOf('\\\\') >= 0) && (d = '\\\\')) : typeof c === 'string' ? this.importRoot ? h = this.importRoot : c.indexOf('/') >= 0 ? (h = c.replace(/\\/[^\\/]*$/, ''), h === '' && (h = '/')) : c.indexOf('\\\\') >= 0 ? (h = c.replace(/\\\\[^\\\\]*$/, ''), d = '\\\\') : h = '.' : h = null, j = 0; j < b.imports.length; j++) if (typeof b.imports[j] === 'string') { if (!h) throw Error('cannot determine import root'); if (k = b.imports[j], k === 'google/protobuf/descriptor.proto') continue; if (k = h + d + k, this.files[k] === !0) continue; if (/\\.proto$/i.test(k) && !a.DotProto && (k = k.replace(/\\.proto$/, '.json')), l = a.Util.fetch(k), l === null) throw Error(\"failed to import '\" + k + \"' in '\" + c + \"': file not found\"); /\\.json$/i.test(k) ? this.import(JSON.parse(l + ''), k) : this.import(a.DotProto.Parser.parse(l), k); } else c ? /\\.(\\w+)$/.test(c) ? this.import(b.imports[j], c.replace(/^(.+)\\.(\\w+)$/, function (a, b, c) { return b + '_import' + j + '.' + c })) : this.import(b.imports[j], c + '_import' + j) : this.import(b.imports[j]); i && (this.importRoot = null); } return b.package && this.define(b.package), b.syntax && f(b), m = this.ptr, b.options && Object.keys(b.options).forEach(function (a) { m.options[a] = b.options[a]; }), b.messages && (this.create(b.messages), this.ptr = m), b.enums && (this.create(b.enums), this.ptr = m), b.services && (this.create(b.services), this.ptr = m), b.extends && this.create(b.extends), this.reset() }, e.resolveAll = function () { var d; if (this.ptr == null || typeof this.ptr.type === 'object') return this; if (this.ptr instanceof c.Namespace) this.ptr.children.forEach(function (a) { this.ptr = a, this.resolveAll(); }, this); else if (this.ptr instanceof c.Message.Field) { if (b.TYPE.test(this.ptr.type)) this.ptr.type = a.TYPES[this.ptr.type]; else { if (!b.TYPEREF.test(this.ptr.type)) throw Error('illegal type reference in ' + this.ptr.toString(!0) + ': ' + this.ptr.type); if (d = (this.ptr instanceof c.Message.ExtensionField ? this.ptr.extension.parent : this.ptr.parent).resolve(this.ptr.type, !0), !d) throw Error('unresolvable type reference in ' + this.ptr.toString(!0) + ': ' + this.ptr.type); if (this.ptr.resolvedType = d, d instanceof c.Enum) { if (this.ptr.type = a.TYPES.enum, this.ptr.syntax === 'proto3' && d.syntax !== 'proto3') throw Error('proto3 message cannot reference proto2 enum') } else { if (!(d instanceof c.Message)) throw Error('illegal type reference in ' + this.ptr.toString(!0) + ': ' + this.ptr.type); this.ptr.type = d.isGroup ? a.TYPES.group : a.TYPES.message; } } if (this.ptr.map) { if (!b.TYPE.test(this.ptr.keyType)) throw Error('illegal key type for map field in ' + this.ptr.toString(!0) + ': ' + this.ptr.keyType); this.ptr.keyType = a.TYPES[this.ptr.keyType]; } } else if (this.ptr instanceof a.Reflect.Service.Method) { if (!(this.ptr instanceof a.Reflect.Service.RPCMethod)) throw Error('illegal service type in ' + this.ptr.toString(!0)); if (d = this.ptr.parent.resolve(this.ptr.requestName, !0), !(d && d instanceof a.Reflect.Message)) throw Error('Illegal type reference in ' + this.ptr.toString(!0) + ': ' + this.ptr.requestName); if (this.ptr.resolvedRequestType = d, d = this.ptr.parent.resolve(this.ptr.responseName, !0), !(d && d instanceof a.Reflect.Message)) throw Error('Illegal type reference in ' + this.ptr.toString(!0) + ': ' + this.ptr.responseName); this.ptr.resolvedResponseType = d; } else if (!(this.ptr instanceof a.Reflect.Message.OneOf || this.ptr instanceof a.Reflect.Extension || this.ptr instanceof a.Reflect.Enum.Value)) throw Error('illegal object in namespace: ' + typeof this.ptr + ': ' + this.ptr); return this.reset() }, e.build = function (a) { var b, c, d; if (this.reset(), this.resolved || (this.resolveAll(), this.resolved = !0, this.result = null), this.result === null && (this.result = this.ns.build()), !a) return this.result; for (b = typeof a === 'string' ? a.split('.') : a, c = this.result, d = 0; d < b.length; d++) { if (!c[b[d]]) { c = null; break }c = c[b[d]]; } return c }, e.lookup = function (a, b) { return a ? this.ns.resolve(a, b) : this.ns }, e.toString = function () { return 'Builder' }, d.Message = function () {}, d.Enum = function () {}, d.Service = function () {}, d\n    }(e, e.Lang, e.Reflect)), e.Map = (function (a, b) { function e (a) { var b = 0; return { next: function () { return b < a.length ? { done: !1, value: a[b++] } : { done: !0 } } } } var c = function (a, c) { var d, e, f, g; if (!a.map) throw Error('field is not a map'); if (this.field = a, this.keyElem = new b.Element(a.keyType, null, !0, a.syntax), this.valueElem = new b.Element(a.type, a.resolvedType, !1, a.syntax), this.map = {}, Object.defineProperty(this, 'size', { get: function () { return Object.keys(this.map).length } }), c) for (d = Object.keys(c), e = 0; e < d.length; e++)f = this.keyElem.valueFromString(d[e]), g = this.valueElem.verifyValue(c[d[e]]), this.map[this.keyElem.valueToString(f)] = { key: f, value: g }; }; var d = c.prototype; return d.clear = function () { this.map = {}; }, d.delete = function (a) { var b = this.keyElem.valueToString(this.keyElem.verifyValue(a)); var c = b in this.map; return delete this.map[b], c }, d.entries = function () { var d; var c; var a = []; var b = Object.keys(this.map); for (c = 0; c < b.length; c++)a.push([(d = this.map[b[c]]).key, d.value]); return e(a) }, d.keys = function () { var c; var a = []; var b = Object.keys(this.map); for (c = 0; c < b.length; c++)a.push(this.map[b[c]].key); return e(a) }, d.values = function () { var c; var a = []; var b = Object.keys(this.map); for (c = 0; c < b.length; c++)a.push(this.map[b[c]].value); return e(a) }, d.forEach = function (a, b) { var e; var d; var c = Object.keys(this.map); for (d = 0; d < c.length; d++)a.call(b, (e = this.map[c[d]]).value, e.key, this); }, d.set = function (a, b) { var c = this.keyElem.verifyValue(a); var d = this.valueElem.verifyValue(b); return this.map[this.keyElem.valueToString(c)] = { key: c, value: d }, this }, d.get = function (a) { var b = this.keyElem.valueToString(this.keyElem.verifyValue(a)); return b in this.map ? this.map[b].value : void 0 }, d.has = function (a) { var b = this.keyElem.valueToString(this.keyElem.verifyValue(a)); return b in this.map }, c }(e, e.Reflect)), e.loadProto = function (a, b, c) { return (typeof b === 'string' || b && typeof b.file === 'string' && typeof b.root === 'string') && (c = b, b = void 0), e.loadJson(e.DotProto.Parser.parse(a), b, c) }, e.protoFromString = e.loadProto, e.loadProtoFile = function (a, b, c) { if (b && typeof b === 'object' ? (c = b, b = null) : b && typeof b === 'function' || (b = null), b) return e.Util.fetch(typeof a === 'string' ? a : a.root + '/' + a.file, function (d) { if (d === null) return b(Error('Failed to fetch file')), void 0; try { b(null, e.loadProto(d, c, a)); } catch (f) { b(f); } }); var d = e.Util.fetch(typeof a === 'object' ? a.root + '/' + a.file : a); return d === null ? null : e.loadProto(d, c, a) }, e.protoFromFile = e.loadProtoFile, e.newBuilder = function (a) { return a = a || {}, typeof a.convertFieldsToCamelCase === 'undefined' && (a.convertFieldsToCamelCase = e.convertFieldsToCamelCase), typeof a.populateAccessors === 'undefined' && (a.populateAccessors = e.populateAccessors), new e.Builder(a) }, e.loadJson = function (a, b, c) { return (typeof b === 'string' || b && typeof b.file === 'string' && typeof b.root === 'string') && (c = b, b = null), b && typeof b === 'object' || (b = e.newBuilder()), typeof a === 'string' && (a = JSON.parse(a)), b.import(a, c), b.resolveAll(), b }, e.loadJsonFile = function (a, b, c) { if (b && typeof b === 'object' ? (c = b, b = null) : b && typeof b === 'function' || (b = null), b) return e.Util.fetch(typeof a === 'string' ? a : a.root + '/' + a.file, function (d) { if (d === null) return b(Error('Failed to fetch file')), void 0; try { b(null, e.loadJson(JSON.parse(d), c, a)); } catch (f) { b(f); } }); var d = e.Util.fetch(typeof a === 'object' ? a.root + '/' + a.file : a); return d === null ? null : e.loadJson(JSON.parse(d), c, a) }, h = a, i = e.loadProto(h, void 0, '').build('Modules').probuf\n  }(d, c)); return e\n}\n\nconst Codec$1 = protobuf(SSMsg$1);\r\nCodec$1.getModule = (pbName) => {\r\n    const modules = new Codec$1[pbName]();\r\n    modules.getArrayData = () => {\r\n        let data = modules.toArrayBuffer();\r\n        data = isArrayBuffer(data) ? [].slice.call(new Int8Array(data)) : data;\r\n        return data;\r\n    };\r\n    return modules;\r\n};\n\n/**\r\n *  @ \r\n*/\r\nvar MentionedType;\r\n(function (MentionedType) {\r\n    /**\r\n     * \r\n    */\r\n    MentionedType[MentionedType[\"ALL\"] = 1] = \"ALL\";\r\n    /**\r\n     * \r\n    */\r\n    MentionedType[MentionedType[\"SINGAL\"] = 2] = \"SINGAL\";\r\n})(MentionedType || (MentionedType = {}));\r\nvar MentionedType$1 = MentionedType;\n\n/**\r\n * \r\n */\r\nvar MessageType;\r\n(function (MessageType) {\r\n    /**\r\n     * \r\n    */\r\n    MessageType[\"TextMessage\"] = \"RC:TxtMsg\";\r\n    /**\r\n     * \r\n    */\r\n    MessageType[\"VOICE\"] = \"RC:VcMsg\";\r\n    /**\r\n     * \r\n    */\r\n    MessageType[\"HQ_VOICE\"] = \"RC:HQVCMsg\";\r\n    /**\r\n     * \r\n    */\r\n    MessageType[\"IMAGE\"] = \"RC:ImgMsg\";\r\n    /**\r\n     * GIF \r\n    */\r\n    MessageType[\"GIF\"] = \"RC:GIFMsg\";\r\n    /**\r\n     * \r\n    */\r\n    MessageType[\"RICH_CONTENT\"] = \"RC:ImgTextMsg\";\r\n    /**\r\n     * \r\n    */\r\n    MessageType[\"LOCATION\"] = \"RC:LBSMsg\";\r\n    /**\r\n     * \r\n    */\r\n    MessageType[\"FILE\"] = \"RC:FileMsg\";\r\n    /**\r\n     * \r\n    */\r\n    MessageType[\"SIGHT\"] = \"RC:SightMsg\";\r\n    /**\r\n     * \r\n    */\r\n    MessageType[\"COMBINE\"] = \"RC:CombineMsg\";\r\n    /**\r\n     *  KV \r\n    */\r\n    MessageType[\"CHRM_KV_NOTIFY\"] = \"RC:chrmKVNotiMsg\";\r\n    /**\r\n     * \r\n    */\r\n    MessageType[\"LOG_COMMAND\"] = \"RC:LogCmdMsg\";\r\n    /**\r\n     * \r\n    */\r\n    MessageType[\"EXPANSION_NOTIFY\"] = \"RC:MsgExMsg\";\r\n    /**\r\n     * \r\n    */\r\n    MessageType[\"REFERENCE\"] = \"RC:ReferenceMsg\";\r\n    /**\r\n     * \r\n    */\r\n    MessageType[\"RECALL\"] = \"RC:RcCmd\";\r\n})(MessageType || (MessageType = {}));\r\nvar MessageType$1 = MessageType;\n\nvar NotificationStatus;\r\n(function (NotificationStatus) {\r\n    /**\r\n     * \r\n    */\r\n    NotificationStatus[NotificationStatus[\"OPEN\"] = 1] = \"OPEN\";\r\n    /**\r\n     * \r\n    */\r\n    NotificationStatus[NotificationStatus[\"CLOSE\"] = 2] = \"CLOSE\";\r\n})(NotificationStatus || (NotificationStatus = {}));\r\nvar NotificationStatus$1 = NotificationStatus;\n\nconst PublishTopic = {\r\n    // , \r\n    PRIVATE: 'ppMsgP',\r\n    GROUP: 'pgMsgP',\r\n    CHATROOM: 'chatMsg',\r\n    CUSTOMER_SERVICE: 'pcMsgP',\r\n    RECALL: 'recallMsg',\r\n    // RTC \r\n    RTC_MSG: 'prMsgS',\r\n    // \r\n    NOTIFY_PULL_MSG: 's_ntf',\r\n    RECEIVE_MSG: 's_msg',\r\n    SYNC_STATUS: 's_stat',\r\n    SERVER_NOTIFY: 's_cmd',\r\n    SETTING_NOTIFY: 's_us' // \r\n};\r\n// \r\nconst PublishStatusTopic = {\r\n    PRIVATE: 'ppMsgS',\r\n    GROUP: 'pgMsgS',\r\n    CHATROOM: 'chatMsgS'\r\n};\r\nconst QueryTopic = {\r\n    GET_SYNC_TIME: 'qrySessionsAtt',\r\n    PULL_MSG: 'pullMsg',\r\n    GET_CONVERSATION_LIST: 'qrySessions',\r\n    REMOVE_CONVERSATION_LIST: 'delSessions',\r\n    DELETE_MESSAGES: 'delMsg',\r\n    CLEAR_UNREAD_COUNT: 'updRRTime',\r\n    PULL_USER_SETTING: 'pullUS',\r\n    PULL_CHRM_MSG: 'chrmPull',\r\n    JOIN_CHATROOM: 'joinChrm',\r\n    JOIN_EXIST_CHATROOM: 'joinChrmR',\r\n    QUIT_CHATROOM: 'exitChrm',\r\n    GET_CHATROOM_INFO: 'queryChrmI',\r\n    UPDATE_CHATROOM_KV: 'setKV',\r\n    DELETE_CHATROOM_KV: 'delKV',\r\n    PULL_CHATROOM_KV: 'pullKV',\r\n    GET_OLD_CONVERSATION_LIST: 'qryRelationR',\r\n    REMOVE_OLD_CONVERSATION: 'delRelation',\r\n    GET_CONVERSATION_STATUS: 'pullSeAtts',\r\n    SET_CONVERSATION_STATUS: 'setSeAtt',\r\n    GET_UPLOAD_FILE_TOKEN: 'qnTkn',\r\n    GET_UPLOAD_FILE_URL: 'qnUrl',\r\n    CLEAR_MESSAGES: {\r\n        PRIVATE: 'cleanPMsg',\r\n        GROUP: 'cleanGMsg',\r\n        CUSTOMER_SERVICE: 'cleanCMsg',\r\n        SYSTEM: 'cleanSMsg'\r\n    },\r\n    //  RTC \r\n    JOIN_RTC_ROOM: 'rtcRJoin_data',\r\n    QUIT_RTC_ROOM: 'rtcRExit',\r\n    PING_RTC: 'rtcPing',\r\n    SET_RTC_DATA: 'rtcSetData',\r\n    USER_SET_RTC_DATA: 'userSetData',\r\n    GET_RTC_DATA: 'rtcQryData',\r\n    DEL_RTC_DATA: 'rtcDelData',\r\n    SET_RTC_OUT_DATA: 'rtcSetOutData',\r\n    GET_RTC_OUT_DATA: 'rtcQryUserOutData',\r\n    GET_RTC_TOKEN: 'rtcToken',\r\n    SET_RTC_STATE: 'rtcUserState',\r\n    GET_RTC_ROOM_INFO: 'rtcRInfo',\r\n    GET_RTC_USER_INFO_LIST: 'rtcUData',\r\n    SET_RTC_USER_INFO: 'rtcUPut',\r\n    DEL_RTC_USER_INFO: 'rtcUDel',\r\n    GET_RTC_USER_LIST: 'rtcUList'\r\n};\r\nconst QueryHistoryTopic = {\r\n    PRIVATE: 'qryPMsg',\r\n    GROUP: 'qryGMsg',\r\n    CHATROOM: 'qryCHMsg',\r\n    CUSTOMER_SERVICE: 'qryCMsg',\r\n    SYSTEM: 'qrySMsg'\r\n};\r\nconst PublishTopicToConversationType = {\r\n    [PublishTopic.PRIVATE]: ConversationType$1.PRIVATE,\r\n    [PublishTopic.GROUP]: ConversationType$1.GROUP,\r\n    [PublishTopic.CHATROOM]: ConversationType$1.CHATROOM,\r\n    [PublishTopic.CUSTOMER_SERVICE]: ConversationType$1.CUSTOMER_SERVICE\r\n};\r\nconst ConversationTypeToQueryHistoryTopic = {\r\n    [ConversationType$1.PRIVATE]: QueryHistoryTopic.PRIVATE,\r\n    [ConversationType$1.GROUP]: QueryHistoryTopic.GROUP,\r\n    [ConversationType$1.CHATROOM]: QueryHistoryTopic.CHATROOM,\r\n    [ConversationType$1.CUSTOMER_SERVICE]: QueryHistoryTopic.CUSTOMER_SERVICE,\r\n    [ConversationType$1.SYSTEM]: QueryHistoryTopic.SYSTEM\r\n};\r\nconst ConversationTypeToClearMessageTopic = {\r\n    [ConversationType$1.PRIVATE]: QueryTopic.CLEAR_MESSAGES.PRIVATE,\r\n    [ConversationType$1.GROUP]: QueryTopic.CLEAR_MESSAGES.GROUP,\r\n    [ConversationType$1.CUSTOMER_SERVICE]: QueryTopic.CLEAR_MESSAGES.CUSTOMER_SERVICE,\r\n    [ConversationType$1.SYSTEM]: QueryTopic.CLEAR_MESSAGES.SYSTEM\r\n};\r\nconst ConversationStatusConfig = {\r\n    ENABLED: '1',\r\n    DISABLED: '0'\r\n};\r\nconst ConversationStatusType = {\r\n    DO_NOT_DISTURB: 1,\r\n    TOP: 2\r\n};\n\nvar MessageDirection;\r\n(function (MessageDirection) {\r\n    /**\r\n     * \r\n     */\r\n    MessageDirection[MessageDirection[\"SEND\"] = 1] = \"SEND\";\r\n    /**\r\n     * \r\n     */\r\n    MessageDirection[MessageDirection[\"RECEIVE\"] = 2] = \"RECEIVE\";\r\n})(MessageDirection || (MessageDirection = {}));\r\nvar MessageDirection$1 = MessageDirection;\n\n/**\r\n * \r\n*/\r\nclass DataCodec {\r\n    constructor(connectType) {\r\n        this._codec = connectType === 'websocket' ? Codec$1 : Codec;\r\n        this._connectType = connectType;\r\n    }\r\n    /**\r\n     * PB   rmtp   \r\n     *  PBName . .  pb \r\n    */\r\n    decodeByPBName(data, pbName, option) {\r\n        const self = this;\r\n        const formatEventMap = {\r\n            [PBName.DownStreamMessages]: self._formatSyncMessages,\r\n            [PBName.DownStreamMessage]: self._formatReceivedMessage,\r\n            [PBName.UpStreamMessage]: self._formatSentMessage,\r\n            [PBName.HistoryMsgOuput]: self._formatHistoryMessages,\r\n            [PBName.RelationsOutput]: self._formatConversationList,\r\n            [PBName.QueryChatRoomInfoOutput]: self._formatChatRoomInfos,\r\n            [PBName.RtcUserListOutput]: self._formatRTCUserList,\r\n            [PBName.RtcQryOutput]: self._formatRTCData,\r\n            [PBName.ChrmKVOutput]: self._formatChatRoomKVList,\r\n            [PBName.PullUserSettingOutput]: self._formatUserSetting,\r\n            [PBName.SessionStates]: self._formatConversationStatus\r\n        };\r\n        let decodedData = data;\r\n        const formatEvent = formatEventMap[pbName];\r\n        try {\r\n            const hasData = data.length > 0; // ,  pb \r\n            decodedData = hasData && self._codec[pbName].decode(data); // pb \r\n            if (isObject(decodedData)) {\r\n                decodedData = batchInt64ToTimestamp(decodedData); // \r\n            }\r\n            if (isFunction(formatEvent)) {\r\n                decodedData = formatEvent.call(this, decodedData, option); // \r\n            }\r\n        }\r\n        catch (e) {\r\n            logger.error('PB parse error\\n', e);\r\n        }\r\n        return decodedData;\r\n    }\r\n    _readBytes(content) {\r\n        const { offset, buffer, limit } = content;\r\n        if (offset) {\r\n            try {\r\n                const content = isArrayBuffer(buffer) ? new Uint8Array(buffer) : buffer;\r\n                // content = utils.ArrayBufferToUint8Array(buffer).subarray(offset, limit)\r\n                return BinaryHelper.readUTF(content.subarray(offset, limit));\r\n            }\r\n            catch (e) {\r\n                logger.info('readBytes error\\n', e);\r\n            }\r\n        }\r\n        return content;\r\n    }\r\n    /**\r\n     * ======  rmtp    ======\r\n     */\r\n    _formatBytes(content) {\r\n        // 1. socket , content.buffer  ArrayBuffer,  ArrayBufferToUint8Array \r\n        // 2. comet , content  JSON . socketcomet  JSON to Object\r\n        let formatRes = this._readBytes(content);\r\n        try {\r\n            formatRes = JSON.parse(formatRes);\r\n        }\r\n        catch (e) {\r\n            logger.info('formatBytes error\\n', e);\r\n        }\r\n        return formatRes || content;\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    _formatSyncMessages(data, option) {\r\n        option = option || {};\r\n        const self = this;\r\n        const { list, syncTime, finished } = data;\r\n        // Comet   finished  true\r\n        if (isUndefined(finished) || finished === null) {\r\n            data.finished = true;\r\n        }\r\n        data.syncTime = int64ToTimestamp(syncTime);\r\n        data.list = map(list, (msgData) => {\r\n            const message = self._formatReceivedMessage(msgData, option);\r\n            return message;\r\n        });\r\n        return data;\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    _formatReceivedMessage(data, option) {\r\n        // TODO: \r\n        option = option || {};\r\n        const self = this;\r\n        const { currentUserId, connectedTime } = option;\r\n        const { content, fromUserId, type, groupId, status, dataTime, classname: messageType, msgId: messageUId, extraContent } = data;\r\n        const direction = data.direction || MessageDirection$1.RECEIVE; // null || 0 \r\n        const isSelfSend = direction === MessageDirection$1.SEND;\r\n        const { isPersited, isCounted, isMentioned, disableNotification, receivedStatus, canIncludeExpansion } = getMessageOptionByStatus(status);\r\n        const targetId = type === ConversationType$1.GROUP || type === ConversationType$1.CHATROOM ? groupId : fromUserId;\r\n        const senderUserId = isSelfSend ? currentUserId : fromUserId;\r\n        const sentTime = int64ToTimestamp(dataTime);\r\n        const isOffLineMessage = sentTime < connectedTime;\r\n        const isChatRoomMsg = type === ConversationType$1.CHATROOM;\r\n        const utfContent = self._formatBytes(content);\r\n        let messageDirection = isSelfSend ? MessageDirection$1.SEND : MessageDirection$1.RECEIVE;\r\n        // , , direction  null\r\n        if (isChatRoomMsg && (fromUserId === currentUserId)) {\r\n            messageDirection = MessageDirection$1.SEND;\r\n        }\r\n        let expansion;\r\n        if (extraContent) {\r\n            expansion = {};\r\n            expansion = formatExtraContent(extraContent);\r\n        }\r\n        return {\r\n            conversationType: type,\r\n            targetId,\r\n            senderUserId,\r\n            messageType,\r\n            messageUId,\r\n            isPersited,\r\n            isCounted,\r\n            isMentioned,\r\n            sentTime,\r\n            isOffLineMessage,\r\n            messageDirection,\r\n            receivedTime: DelayTimer.getTime(),\r\n            disableNotification,\r\n            receivedStatus,\r\n            canIncludeExpansion,\r\n            content: utfContent,\r\n            expansion\r\n        };\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    _formatSentMessage(data, option) {\r\n        const self = this;\r\n        const { content, classname: messageType, sessionId, msgId: messageUId, extraContent } = data;\r\n        const { signal, currentUserId } = option;\r\n        const { date, topic, targetId } = signal;\r\n        const { isPersited, isCounted, disableNotification, canIncludeExpansion } = getUpMessageOptionBySessionId(sessionId);\r\n        const type = PublishTopicToConversationType[topic] || ConversationType$1.PRIVATE;\r\n        const isStatusMessage = isInObject(PublishStatusTopic, topic);\r\n        let expansion;\r\n        if (extraContent) {\r\n            expansion = {};\r\n            expansion = formatExtraContent(extraContent);\r\n        }\r\n        return {\r\n            conversationType: type,\r\n            targetId,\r\n            messageType,\r\n            messageUId,\r\n            isPersited,\r\n            isCounted,\r\n            isStatusMessage,\r\n            senderUserId: currentUserId,\r\n            content: self._formatBytes(content),\r\n            sentTime: date * 1000,\r\n            receivedTime: DelayTimer.getTime(),\r\n            messageDirection: MessageDirection$1.SEND,\r\n            isOffLineMessage: false,\r\n            disableNotification,\r\n            canIncludeExpansion,\r\n            expansion //  KV \r\n        };\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    _formatHistoryMessages(data, option) {\r\n        const conversation = option.conversation || {};\r\n        const { list: msgList, hasMsg } = data;\r\n        const targetId = conversation.targetId;\r\n        const syncTime = int64ToTimestamp(data.syncTime);\r\n        const list = [];\r\n        forEach(msgList, (msgData) => {\r\n            const msg = this._formatReceivedMessage(msgData, option);\r\n            msg.targetId = targetId;\r\n            list.push(msg);\r\n        }, {\r\n            isReverse: true\r\n        });\r\n        return { syncTime, list, hasMore: !!hasMsg };\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    _formatConversationList(serverData, option) {\r\n        const self = this;\r\n        let { info: conversationList } = serverData;\r\n        const afterDecode = option.afterDecode || function () { };\r\n        conversationList = map(conversationList, (serverConversation) => {\r\n            const { msg, userId, type, unreadCount } = serverConversation;\r\n            const latestMessage = self._formatReceivedMessage(msg, option);\r\n            latestMessage.targetId = userId;\r\n            const conversation = {\r\n                targetId: userId,\r\n                conversationType: type,\r\n                unreadMessageCount: unreadCount,\r\n                latestMessage\r\n            };\r\n            return afterDecode(conversation) || conversation;\r\n        });\r\n        return conversationList || [];\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    _formatChatRoomInfos(data) {\r\n        const { userTotalNums, userInfos } = data;\r\n        const chrmInfos = map(userInfos, (user) => {\r\n            const { id, time } = user;\r\n            const timestamp = int64ToTimestamp(time);\r\n            return { id, time: timestamp };\r\n        });\r\n        return {\r\n            userCount: userTotalNums,\r\n            userInfos: chrmInfos\r\n        };\r\n    }\r\n    /**\r\n     *   KV \r\n    */\r\n    _formatChatRoomKVList(data) {\r\n        let { entries: kvEntries, bFullUpdate: isFullUpdate, syncTime } = data;\r\n        kvEntries = kvEntries || [];\r\n        kvEntries = map(kvEntries, (kv) => {\r\n            const { key, value, status, timestamp, uid } = kv;\r\n            const { isAutoDelete, isOverwrite, type } = getChatRoomKVByStatus(status);\r\n            return {\r\n                key,\r\n                value,\r\n                isAutoDelete,\r\n                isOverwrite,\r\n                type,\r\n                userId: uid,\r\n                timestamp: int64ToTimestamp(timestamp)\r\n            };\r\n        });\r\n        return {\r\n            kvEntries, isFullUpdate, syncTime\r\n        };\r\n    }\r\n    /**\r\n     *  \r\n    */\r\n    _formatUserSetting(data) {\r\n        const { items, version } = data;\r\n        const settings = {};\r\n        forEach(items || [], (setting) => {\r\n            const { key, version, value } = setting;\r\n            setting.version = int64ToTimestamp(version);\r\n            setting.value = this._readBytes(value);\r\n            settings[key] = setting;\r\n        });\r\n        return { settings, version };\r\n    }\r\n    /**\r\n     *   \r\n    */\r\n    _formatConversationStatus(data) {\r\n        const { state: stateList } = data;\r\n        const statusList = [];\r\n        forEach(stateList, (session) => {\r\n            const { type, channelId: targetId, time: updatedTime, stateItem } = session;\r\n            let notificationStatus = NotificationStatus$1.CLOSE;\r\n            let isTop = false;\r\n            forEach(stateItem, (item) => {\r\n                const { sessionStateType, value } = item;\r\n                switch (sessionStateType) {\r\n                    case ConversationStatusType.DO_NOT_DISTURB:\r\n                        notificationStatus = value === ConversationStatusConfig.ENABLED ? NotificationStatus$1.OPEN : NotificationStatus$1.CLOSE;\r\n                        break;\r\n                    case ConversationStatusType.TOP:\r\n                        isTop = value === ConversationStatusConfig.ENABLED;\r\n                        break;\r\n                }\r\n            });\r\n            statusList.push({\r\n                type,\r\n                targetId,\r\n                notificationStatus,\r\n                isTop,\r\n                updatedTime: int64ToTimestamp(updatedTime)\r\n            });\r\n        });\r\n        return statusList;\r\n    }\r\n    /**\r\n     *  RTC \r\n    */\r\n    _formatRTCUserList(rtcInfos) {\r\n        const { list, token, sessionId } = rtcInfos;\r\n        const users = {};\r\n        forEach(list, (item) => {\r\n            const { userId, userData } = item;\r\n            const tmpData = {};\r\n            forEach(userData, (data) => {\r\n                const { key, value } = data;\r\n                tmpData[key] = value;\r\n            });\r\n            users[userId] = tmpData;\r\n        });\r\n        return { users, token, sessionId };\r\n    }\r\n    /**\r\n      *  RTC \r\n    */\r\n    _formatRTCData(data) {\r\n        const { outInfo: list } = data;\r\n        const props = {};\r\n        forEach(list, (item) => {\r\n            props[item.key] = item.value;\r\n        });\r\n        return props;\r\n    }\r\n    /**\r\n      *  RTC \r\n    */\r\n    _formatRTCRoomInfo(data) {\r\n        const { roomId: id, userCount: total, roomData } = data;\r\n        const room = {\r\n            id, total\r\n        };\r\n        forEach(roomData, (data) => {\r\n            room[data.key] = data.value;\r\n        });\r\n        return room;\r\n    }\r\n    /**\r\n     * =====   PB  =====\r\n     * Engine Index \r\n    */\r\n    /**\r\n     * ? \r\n    */\r\n    encodeServerConfParams() {\r\n        const modules = this._codec.getModule(PBName.SessionsAttQryInput);\r\n        modules.setNothing(1);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    _getUpMsgModule(conversation, option) {\r\n        const { type } = conversation;\r\n        const { messageType, isMentioned, mentionedType, mentionedUserIdList, content, pushContent, pushData, directionalUserIdList, isFilerWhiteBlacklist, isVoipPush, canIncludeExpansion, expansion } = option;\r\n        const isGroupType = type === ConversationType$1.GROUP;\r\n        const modules = this._codec.getModule(PBName.UpStreamMessage);\r\n        const sessionId = getSessionId(option);\r\n        let flag = 0;\r\n        modules.setSessionId(sessionId);\r\n        if (isGroupType && isMentioned && content) {\r\n            content.mentionedInfo = {\r\n                userIdList: mentionedUserIdList,\r\n                type: mentionedType || MentionedType$1.ALL\r\n            };\r\n        }\r\n        pushContent && modules.setPushText(pushContent); //  pushContent\r\n        pushData && modules.setAppData(pushData); //  pushData\r\n        directionalUserIdList && modules.setUserId(directionalUserIdList); // \r\n        //  flag. : 1iOS VoipPush  2/\r\n        flag |= (isVoipPush ? 0x01 : 0);\r\n        flag |= (isFilerWhiteBlacklist ? 0x02 : 0);\r\n        modules.setConfigFlag(flag);\r\n        modules.setClassname(messageType); //  objectName\r\n        modules.setContent(JSON.stringify(content));\r\n        if (canIncludeExpansion && expansion) {\r\n            const extraContent = {};\r\n            forEach(expansion, (val, key) => {\r\n                extraContent[key] = { v: val };\r\n            });\r\n            modules.setExtraContent(JSON.stringify(extraContent)); // \r\n        }\r\n        return modules;\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    encodeUpMsg(conversation, option) {\r\n        const modules = this._getUpMsgModule(conversation, option);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    encodeSyncMsg(syncMsgArgs) {\r\n        const { sendboxTime, inboxTime } = syncMsgArgs;\r\n        const modules = this._codec.getModule(PBName.SyncRequestMsg);\r\n        modules.setIspolling(false);\r\n        modules.setIsPullSend(true);\r\n        modules.setSendBoxSyncTime(sendboxTime);\r\n        modules.setSyncTime(inboxTime);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    encodeChrmSyncMsg(time, count) {\r\n        time = time || 0;\r\n        count = count || 0;\r\n        const modules = this._codec.getModule(PBName.ChrmPullMsg);\r\n        modules.setCount(count);\r\n        modules.setSyncTime(time);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    encodeGetHistoryMsg(targetId, option) {\r\n        const { count, order, timestamp } = option;\r\n        const modules = this._codec.getModule(PBName.HistoryMsgInput);\r\n        modules.setTargetId(targetId);\r\n        modules.setTime(timestamp);\r\n        modules.setCount(count);\r\n        modules.setOrder(order);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    encodeGetConversationList(option) {\r\n        option = option || {};\r\n        const { count, startTime } = option;\r\n        const modules = this._codec.getModule(PBName.RelationQryInput);\r\n        //  modules . , \r\n        modules.setType(1); // type \r\n        modules.setCount(count);\r\n        modules.setStartTime(startTime);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     * . \r\n    */\r\n    encodeOldConversationList(option) {\r\n        option = option || {};\r\n        let { count, type, startTime, order } = option;\r\n        count = count || 0; //  count  0 , setCount  count \r\n        startTime = startTime || 0;\r\n        order = order || 0;\r\n        const modules = this._codec.getModule(PBName.RelationQryInput);\r\n        modules.setType(type);\r\n        modules.setCount(count);\r\n        modules.setStartTime(startTime);\r\n        modules.setOrder(order);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    encodeRemoveConversationList(conversationList) {\r\n        const modules = this._codec.getModule(PBName.DeleteSessionsInput);\r\n        const sessions = [];\r\n        forEach(conversationList, (conversation) => {\r\n            const { type, targetId } = conversation;\r\n            const session = this._codec.getModule(PBName.SessionInfo);\r\n            session.setType(type);\r\n            session.setChannelId(targetId);\r\n            sessions.push(session);\r\n        });\r\n        modules.setSessions(sessions);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     *  ID\r\n    */\r\n    encodeDeleteMessages(conversationType, targetId, list) {\r\n        const modules = this._codec.getModule(PBName.DeleteMsgInput);\r\n        const encodeMsgs = [];\r\n        forEach(list, (message) => {\r\n            encodeMsgs.push({\r\n                msgId: message.messageUId,\r\n                msgDataTime: message.sentTime,\r\n                direct: message.messageDirection\r\n            });\r\n        });\r\n        modules.setType(conversationType);\r\n        modules.setConversationId(targetId);\r\n        modules.setMsgs(encodeMsgs);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    encodeClearMessages(targetId, timestamp) {\r\n        const modules = this._codec.getModule(PBName.CleanHisMsgInput);\r\n        timestamp = timestamp || new Date().getTime(); // \r\n        modules.setDataTime(timestamp);\r\n        modules.setTargetId(targetId);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    encodeClearUnreadCount(conversation, option) {\r\n        const { type, targetId } = conversation;\r\n        let { timestamp } = option;\r\n        const modules = this._codec.getModule(PBName.SessionMsgReadInput);\r\n        timestamp = timestamp || +new Date();\r\n        modules.setType(type);\r\n        modules.setChannelId(targetId);\r\n        modules.setMsgTime(timestamp);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    encodeJoinOrQuitChatRoom() {\r\n        const modules = this._codec.getModule(PBName.ChrmInput);\r\n        modules.setNothing(1);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     * \r\n     * @param count \r\n     * @param order \r\n    */\r\n    encodeGetChatRoomInfo(count, order) {\r\n        const modules = this._codec.getModule(PBName.QueryChatRoomInfoInput);\r\n        modules.setCount(count);\r\n        modules.setOrder(order);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    encodeGetFileToken(fileType, fileName) {\r\n        const modules = this._codec.getModule(PBName.GetQNupTokenInput);\r\n        modules.setType(fileType);\r\n        modules.setKey(fileName);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n      * url\r\n    */\r\n    encodeGetFileUrl(fileType, fileName, originName) {\r\n        const modules = this._codec.getModule(PBName.GetQNdownloadUrlInput);\r\n        modules.setType(fileType);\r\n        modules.setKey(fileName);\r\n        if (originName) {\r\n            modules.setFileName(originName);\r\n        }\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n      *  KV \r\n    */\r\n    encodeModifyChatRoomKV(chrmId, entry, currentUserId) {\r\n        const isComet = this._connectType === 'comet';\r\n        const modules = this._codec.getModule(PBName.SetChrmKV);\r\n        const { key, value, notificationExtra: extra, isSendNotification, type } = entry;\r\n        const action = type || ChatroomEntryType$1.UPDATE;\r\n        const status = getChatRoomKVOptStatus(entry, action);\r\n        const serverEntry = {\r\n            key,\r\n            value: value || '',\r\n            uid: currentUserId\r\n        };\r\n        //  status , server \r\n        if (!isUndefined(status)) {\r\n            serverEntry.status = status;\r\n        }\r\n        modules.setEntry(serverEntry);\r\n        if (isSendNotification) { // , \r\n            const conversation = {\r\n                type: ConversationType$1.CHATROOM,\r\n                targetId: chrmId\r\n            };\r\n            const msgContent = { key, value, extra, type: action };\r\n            // ,  Server \r\n            const msgModule = this._getUpMsgModule(conversation, {\r\n                messageType: MessageType$1.CHRM_KV_NOTIFY,\r\n                content: msgContent,\r\n                isPersited: false,\r\n                isCounted: false\r\n            });\r\n            isComet ? modules.setNotification(msgModule.getArrayData()) : modules.setNotification(msgModule);\r\n            modules.setBNotify(true);\r\n            modules.setType(ConversationType$1.CHATROOM);\r\n        }\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n      * KV \r\n    */\r\n    encodePullChatRoomKV(time) {\r\n        const modules = this._codec.getModule(PBName.QueryChrmKV);\r\n        modules.setTimestamp(time);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n      * \r\n    */\r\n    encodePullUserSetting(version) {\r\n        const modules = this._codec.getModule(PBName.PullUserSettingInput);\r\n        modules.setVersion(version);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n      *  ()\r\n    */\r\n    encodeGetConversationStatus(time) {\r\n        const modules = this._codec.getModule(PBName.SessionReq);\r\n        modules.setTime(time);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n      *  ()\r\n    */\r\n    encodeSetConversationStatus(statusList) {\r\n        const isComet = this._connectType === 'comet';\r\n        const modules = this._codec.getModule(PBName.SessionStateModifyReq);\r\n        const currentTime = DelayTimer.getTime();\r\n        const stateModuleList = [];\r\n        forEach(statusList, (status) => {\r\n            const stateModules = this._codec.getModule(PBName.SessionState);\r\n            const { conversationType: type, targetId, notificationStatus, isTop } = status;\r\n            const stateItemModuleList = [];\r\n            stateModules.setType(type);\r\n            stateModules.setChannelId(targetId);\r\n            stateModules.setTime(currentTime);\r\n            const isNotDisturb = notificationStatus === NotificationStatus$1.OPEN;\r\n            const TypeToVal = {};\r\n            if (!isUndefined(notificationStatus)) {\r\n                TypeToVal[ConversationStatusType.DO_NOT_DISTURB] = isNotDisturb;\r\n            }\r\n            if (!isUndefined(isTop)) {\r\n                TypeToVal[ConversationStatusType.TOP] = isTop;\r\n            }\r\n            forEach(TypeToVal, (val, type) => {\r\n                if (!isUndefined(val)) {\r\n                    const stateItemModules = this._codec.getModule(PBName.SessionStateItem);\r\n                    val = val ? ConversationStatusConfig.ENABLED : ConversationStatusConfig.DISABLED;\r\n                    stateItemModules.setSessionStateType(Number(type)); // TODO \r\n                    stateItemModules.setValue(val);\r\n                    const stateItemModulesData = isComet ? stateItemModules.getArrayData() : stateItemModules;\r\n                    stateItemModuleList.push(stateItemModulesData);\r\n                }\r\n            });\r\n            stateModules.setStateItem(stateItemModuleList);\r\n            const stateModulesData = isComet ? stateModules.getArrayData() : stateModules;\r\n            stateModuleList.push(stateModulesData);\r\n        });\r\n        modules.setVersion(currentTime);\r\n        modules.setState(stateModuleList);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     * ============  RTC  ============\r\n     */\r\n    /**\r\n     *  RTC \r\n     */\r\n    encodeJoinRTCRoom(mode, broadcastType) {\r\n        const modules = this._codec.getModule(PBName.RtcInput);\r\n        mode = mode || 0;\r\n        modules.setRoomType(mode);\r\n        isUndefined(broadcastType) || modules.setBroadcastType(broadcastType);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     *  RTC \r\n    */\r\n    encodeQuitRTCRoom() {\r\n        return this._codec.getModule(PBName.SetUserStatusInput).getArrayData();\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    encodeSetRTCData(key, value, isInner, apiType, message) {\r\n        const modules = this._codec.getModule(PBName.RtcSetDataInput);\r\n        modules.setInterior(isInner);\r\n        modules.setTarget(apiType);\r\n        modules.setKey(key);\r\n        modules.setValue(value);\r\n        message = message || {};\r\n        let { name, content } = message;\r\n        !isUndefined(name) && modules.setObjectName(name);\r\n        if (!isUndefined(content)) {\r\n            if (isObject(content)) {\r\n                content = JSON.stringify(content);\r\n            }\r\n            modules.setContent(content);\r\n        }\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     *  URI\r\n    */\r\n    encodeUserSetRTCData(message, valueInfo, objectName) {\r\n        const modules = this._codec.getModule(PBName.RtcUserSetDataInput);\r\n        //  URI \r\n        // \r\n        // valueInfo: key  uris \r\n        // content: key  RCRTC:ModifyResourcevalue \r\n        modules.setObjectName(objectName);\r\n        // content\r\n        let val = this._codec.getModule(PBName.RtcValueInfo);\r\n        val.setKey(message.name);\r\n        val.setValue(message.content);\r\n        modules.setContent(val);\r\n        // valueInfo\r\n        val = this._codec.getModule(PBName.RtcValueInfo);\r\n        val.setKey('uris');\r\n        val.setValue(valueInfo);\r\n        modules.setValueInfo(val);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    encodeGetRTCData(keys, isInner, apiType) {\r\n        const modules = this._codec.getModule(PBName.RtcDataInput);\r\n        modules.setInterior(isInner);\r\n        modules.setTarget(apiType);\r\n        modules.setKey(keys);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    encodeRemoveRTCData(keys, isInner, apiType, message) {\r\n        const modules = this._codec.getModule(PBName.RtcDataInput);\r\n        modules.setInterior(isInner);\r\n        modules.setTarget(apiType);\r\n        modules.setKey(keys);\r\n        message = message || {};\r\n        let { name, content } = message;\r\n        !isUndefined(name) && modules.setObjectName(name);\r\n        if (!isUndefined(content)) {\r\n            if (isObject(content)) {\r\n                content = JSON.stringify(content);\r\n            }\r\n            modules.setContent(content);\r\n        }\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    encodeSetRTCOutData(data, type, message) {\r\n        const modules = this._codec.getModule(PBName.RtcSetOutDataInput);\r\n        modules.setTarget(type);\r\n        if (!isArray(data)) {\r\n            data = [data];\r\n        }\r\n        forEach(data, (item, index) => {\r\n            item.key = item.key ? item.key.toString() : item.key;\r\n            item.value = item.value ? item.value.toString() : item.value;\r\n            data[index] = item;\r\n        });\r\n        modules.setValueInfo(data);\r\n        message = message || {};\r\n        let { name, content } = message;\r\n        !isUndefined(name) && modules.setObjectName(name);\r\n        if (!isUndefined(content)) {\r\n            if (isObject(content)) {\r\n                content = JSON.stringify(content);\r\n            }\r\n            modules.setContent(content);\r\n        }\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    ecnodeGetRTCOutData(userIds) {\r\n        const modules = this._codec.getModule(PBName.RtcQryUserOutDataInput);\r\n        modules.setUserId(userIds);\r\n        return modules.getArrayData();\r\n    }\r\n    encodeSetRTCState(report) {\r\n        const modules = this._codec.getModule(PBName.MCFollowInput);\r\n        modules.setId(report);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    encodeGetRTCRoomInfo() {\r\n        const modules = this._codec.getModule(PBName.RtcQueryListInput);\r\n        modules.setOrder(2);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    encodeSetRTCUserInfo(key, value) {\r\n        const modules = this._codec.getModule(PBName.RtcValueInfo);\r\n        modules.setKey(key);\r\n        modules.setValue(value);\r\n        return modules.getArrayData();\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    encodeRemoveRTCUserInfo(keys) {\r\n        const modules = this._codec.getModule(PBName.RtcKeyDeleteInput);\r\n        modules.setKey(keys);\r\n        return modules.getArrayData();\r\n    }\r\n}\n\n/**\r\n *  long-polling  websocket \r\n */\r\nclass ADataChannel {\r\n    constructor(type, _watcher) {\r\n        this._watcher = _watcher;\r\n        this.codec = new DataCodec(type);\r\n    }\r\n    /**\r\n     * apiVersion  `/\\d+(\\.\\d+){2}/`  `3.1.0-alpha.1` `3.1.0`\r\n     * @param apiVersion\r\n     */\r\n    static matchVersion(apiVersion) {\r\n        const matches = apiVersion.match(/\\d+(\\.\\d+){2}/);\r\n        return matches[0];\r\n    }\r\n}\n\nconst getIdentifier = (messageId, identifier) => {\r\n    if (messageId && identifier) {\r\n        return identifier + '_' + messageId;\r\n    }\r\n    else if (messageId) {\r\n        return messageId;\r\n    }\r\n    else {\r\n        return Date.now(); //  messageIdidentifer, , \r\n    }\r\n};\r\n/**\r\n * @description\r\n *  Server \r\n*/\r\n/**\r\n * @description\r\n * \r\n*/\r\nclass BaseReader {\r\n    constructor(header) {\r\n        this.header = header;\r\n        this._name = null;\r\n        this.lengthSize = 0;\r\n        this.messageId = 0;\r\n        this.timestamp = 0;\r\n        this.syncMsg = false;\r\n        this.identifier = ''; // string + messageId , :  PubQuery  Promise,  PubQuery \r\n    }\r\n    getIdentifier() {\r\n        const { messageId, identifier } = this;\r\n        return getIdentifier(messageId, identifier);\r\n    }\r\n    read(stream, length) {\r\n        this.readMessage(stream, length);\r\n        // return { stream, length }\r\n    }\r\n    readMessage(stream, length) {\r\n        return {\r\n            stream,\r\n            length\r\n        };\r\n    }\r\n}\r\n/**\r\n * @description\r\n * \r\n */\r\nclass BaseWriter {\r\n    constructor(headerType) {\r\n        this.lengthSize = 0;\r\n        this.messageId = 0;\r\n        this.topic = '';\r\n        this.targetId = '';\r\n        this.identifier = '';\r\n        this._header = new Header(headerType, false, QOS.AT_MOST_ONCE, false);\r\n    }\r\n    getIdentifier() {\r\n        const { messageId, identifier } = this;\r\n        return getIdentifier(messageId, identifier);\r\n    }\r\n    write(stream) {\r\n        var headerCode = this.getHeaderFlag();\r\n        stream.write(headerCode); //  Header\r\n        this.writeMessage(stream);\r\n    }\r\n    setHeaderQos(qos) {\r\n        this._header.qos = qos;\r\n    }\r\n    getHeaderFlag() {\r\n        return this._header.encode();\r\n    }\r\n    getLengthSize() {\r\n        return this.lengthSize;\r\n    }\r\n    getBufferData() {\r\n        const stream = new RongStreamWriter();\r\n        this.write(stream);\r\n        const val = stream.getBytesArray();\r\n        const binary = new Int8Array(val);\r\n        return binary;\r\n    }\r\n    getCometData() {\r\n        const data = this.data || {};\r\n        return JSON.stringify(data);\r\n    }\r\n}\r\n/**\r\n * @description\r\n * \r\n */\r\nclass ConnAckReader extends BaseReader {\r\n    constructor() {\r\n        super(...arguments);\r\n        this._name = MessageName.CONN_ACK;\r\n        this.status = null; // \r\n        this.userId = null; //  id\r\n        // sessionId: string;\r\n        this.timestamp = 0;\r\n    }\r\n    readMessage(stream, length) {\r\n        stream.readByte(); //  Header\r\n        this.status = +stream.readByte();\r\n        if (length > ConnAckReader.MESSAGE_LENGTH) {\r\n            this.userId = stream.readUTF();\r\n            stream.readUTF(); //  sessionId, ws , , \r\n            this.timestamp = stream.readLong();\r\n        }\r\n        return {\r\n            stream,\r\n            length\r\n        };\r\n    }\r\n}\r\nConnAckReader.MESSAGE_LENGTH = 2;\r\n/**\r\n * @description\r\n * . : \r\n */\r\nclass DisconnectReader extends BaseReader {\r\n    constructor() {\r\n        super(...arguments);\r\n        this._name = MessageName.DISCONNECT;\r\n        this.status = 0;\r\n    }\r\n    readMessage(stream, length) {\r\n        stream.readByte();\r\n        // (1)  (2)2.0  status  0 - 5, . \r\n        this.status = +stream.readByte();\r\n        return {\r\n            stream,\r\n            length\r\n        };\r\n    }\r\n}\r\nDisconnectReader.MESSAGE_LENGTH = 2;\r\n/**\r\n * @description\r\n * ping \r\n */\r\nclass PingReqWriter extends BaseWriter {\r\n    constructor() {\r\n        super(OperationType.PING_REQ);\r\n        this._name = MessageName.PING_REQ;\r\n    }\r\n    writeMessage(stream) { }\r\n}\r\n/**\r\n * @description\r\n * ping \r\n */\r\nclass PingRespReader extends BaseReader {\r\n    constructor(header) {\r\n        super(header);\r\n        this._name = MessageName.PING_RESP;\r\n    }\r\n}\r\nclass RetryableReader extends BaseReader {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.messageId = 0;\r\n    }\r\n    readMessage(stream, length) {\r\n        const msgId = stream.readByte() * 256 + stream.readByte();\r\n        this.messageId = parseInt(msgId.toString(), 10);\r\n        return {\r\n            stream,\r\n            length\r\n        };\r\n    }\r\n}\r\nclass RetryableWriter extends BaseWriter {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.messageId = 0;\r\n    }\r\n    writeMessage(stream) {\r\n        const id = this.messageId;\r\n        const lsb = id & 255;\r\n        const msb = (id & 65280) >> 8; // 65280 -> 1111111100000000\r\n        stream.write(msb);\r\n        stream.write(lsb);\r\n    }\r\n}\r\nclass PublishReader extends RetryableReader {\r\n    constructor() {\r\n        super(...arguments);\r\n        this._name = MessageName.PUBLISH;\r\n        this.topic = '';\r\n        this.targetId = '';\r\n        this.syncMsg = false;\r\n        this.identifier = IDENTIFIER.PUB;\r\n    }\r\n    readMessage(stream, length) {\r\n        // let pos = 6;\r\n        this.date = stream.readInt();\r\n        this.topic = stream.readUTF();\r\n        // pos += BinaryHelper.writeUTF(this.topic).length;\r\n        this.targetId = stream.readUTF();\r\n        // pos += BinaryHelper.writeUTF(this.targetId).length;\r\n        // RetryableReader.prototype.readMessage.apply(this, arguments)\r\n        super.readMessage(stream, length);\r\n        // this.data = new Array(msgLength - pos);\r\n        this.data = stream.readAll();\r\n        return {\r\n            stream,\r\n            length\r\n        };\r\n    }\r\n}\r\n/**\r\n * @description\r\n * \r\n */\r\nclass PublishWriter extends RetryableWriter {\r\n    constructor(topic, data, targetId) {\r\n        super(OperationType.PUBLISH);\r\n        this._name = MessageName.PUBLISH;\r\n        this.syncMsg = false;\r\n        this.identifier = IDENTIFIER.PUB;\r\n        this.topic = topic;\r\n        this.data = isString(data) ? BinaryHelper.writeUTF(data) : data;\r\n        this.targetId = targetId;\r\n    }\r\n    writeMessage(stream) {\r\n        stream.writeUTF(this.topic);\r\n        stream.writeUTF(this.targetId);\r\n        super.writeMessage(stream);\r\n        stream.write(this.data);\r\n    }\r\n}\r\n/**\r\n * @description\r\n * , Server  Ack \r\n */\r\nclass PubAckReader extends RetryableReader {\r\n    constructor() {\r\n        super(...arguments);\r\n        this._name = MessageName.PUB_ACK;\r\n        this.status = 0;\r\n        this.date = 0;\r\n        this.millisecond = 0;\r\n        this.messageUId = '';\r\n        this.timestamp = 0;\r\n        this.identifier = IDENTIFIER.PUB;\r\n        this.topic = '';\r\n        this.targetId = '';\r\n    }\r\n    readMessage(stream, length) {\r\n        super.readMessage(stream, length);\r\n        this.date = stream.readInt();\r\n        this.status = stream.readByte() * 256 + stream.readByte();\r\n        this.millisecond = stream.readByte() * 256 + stream.readByte();\r\n        this.timestamp = this.date * 1000 + this.millisecond;\r\n        this.messageUId = stream.readUTF();\r\n        return {\r\n            stream,\r\n            length\r\n        };\r\n    }\r\n}\r\n/**\r\n * @description\r\n * Server  Pub, Web  Server \r\n */\r\nclass PubAckWriter extends RetryableWriter {\r\n    constructor(messageId) {\r\n        super(OperationType.PUB_ACK);\r\n        this._name = MessageName.PUB_ACK;\r\n        this.status = 0;\r\n        this.date = 0;\r\n        this.millisecond = 0;\r\n        this.messageUId = '';\r\n        this.timestamp = 0;\r\n        this.messageId = messageId;\r\n    }\r\n    writeMessage(stream) {\r\n        super.writeMessage(stream);\r\n    }\r\n}\r\n/**\r\n * @description\r\n * Web \r\n */\r\nclass QueryWriter extends RetryableWriter {\r\n    constructor(topic, data, targetId) {\r\n        super(OperationType.QUERY);\r\n        this.name = MessageName.QUERY;\r\n        this.identifier = IDENTIFIER.QUERY;\r\n        this.topic = topic;\r\n        this.data = isString(data) ? BinaryHelper.writeUTF(data) : data;\r\n        this.targetId = targetId;\r\n    }\r\n    writeMessage(stream) {\r\n        stream.writeUTF(this.topic);\r\n        stream.writeUTF(this.targetId);\r\n        // RetryableWriter.prototype.writeMessage.call(this, stream)\r\n        super.writeMessage(stream);\r\n        stream.write(this.data);\r\n    }\r\n}\r\n/**\r\n * @description\r\n * Server  Query, Web  Server \r\n */\r\nclass QueryConWriter extends RetryableWriter {\r\n    constructor(messageId) {\r\n        super(OperationType.QUERY_CONFIRM);\r\n        this._name = MessageName.QUERY_CON;\r\n        this.messageId = messageId;\r\n    }\r\n}\r\n/**\r\n * @description\r\n * Server  Web \r\n */\r\nclass QueryAckReader extends RetryableReader {\r\n    constructor() {\r\n        super(...arguments);\r\n        this._name = MessageName.QUERY_ACK;\r\n        this.status = 0;\r\n        this.identifier = IDENTIFIER.QUERY;\r\n        this.topic = '';\r\n        this.targetId = '';\r\n    }\r\n    readMessage(stream, length) {\r\n        // RetryableReader.prototype.readMessage.call(this, stream)\r\n        super.readMessage(stream, length);\r\n        this.date = stream.readInt();\r\n        this.status = stream.readByte() * 256 + stream.readByte();\r\n        this.data = stream.readAll();\r\n        // if (msgLength > 0) {\r\n        //   this.data = new Array(msgLength - 8);\r\n        //   this.data = stream.readAll();\r\n        // }\r\n        return {\r\n            stream,\r\n            length\r\n        };\r\n    }\r\n}\r\nconst getReaderByHeader = (header) => {\r\n    const type = header.type;\r\n    let msg;\r\n    switch (type) {\r\n        case OperationType.CONN_ACK:\r\n            msg = new ConnAckReader(header);\r\n            break;\r\n        case OperationType.PUBLISH:\r\n            msg = new PublishReader(header);\r\n            msg.syncMsg = header.syncMsg;\r\n            break;\r\n        case OperationType.PUB_ACK:\r\n            msg = new PubAckReader(header);\r\n            break;\r\n        case OperationType.QUERY_ACK:\r\n            msg = new QueryAckReader(header);\r\n            break;\r\n        case OperationType.SUB_ACK:\r\n        case OperationType.UNSUB_ACK:\r\n        case OperationType.PING_RESP:\r\n            msg = new PingRespReader(header);\r\n            break;\r\n        case OperationType.DISCONNECT:\r\n            msg = new DisconnectReader(header);\r\n            break;\r\n        default:\r\n            msg = new BaseReader(header);\r\n            logger.error('No support for deserializing ' + type + ' messages');\r\n    }\r\n    return msg;\r\n};\r\n/**\r\n *  websocket  ArrayBuffer \r\n * @param {ArrayBuffer} data server  webscoekt \r\n */\r\nconst readWSBuffer = (data) => {\r\n    const arr = new Uint8Array(data);\r\n    const stream = new RongStreamReader(arr);\r\n    const flags = stream.readByte();\r\n    const header = new Header(flags);\r\n    const msg = getReaderByHeader(header);\r\n    msg.read(stream, arr.length - 1);\r\n    return msg;\r\n};\r\nconst readCometData = (data) => {\r\n    const flags = data.headerCode;\r\n    const header = new Header(flags);\r\n    const msg = getReaderByHeader(header);\r\n    // utils.forEach(data, (item: any, key: string) => {\r\n    //   if (key in msg) {\r\n    //     msg[key] = item;\r\n    //   }\r\n    // });\r\n    for (const key in data) {\r\n        // if (key in msg) {\r\n        msg[key] = data[key];\r\n        // }\r\n    }\r\n    return msg;\r\n};\n\n/**\r\n * CMP/Comet \r\n */\r\nconst ConnectResultCode = {\r\n    /**\r\n     * \r\n     */\r\n    ACCEPTED: 0,\r\n    /**\r\n     * \r\n     * @description \r\n     */\r\n    UNACCEPTABLE_PROTOCOL_VERSION: 1,\r\n    /**\r\n     *  TCP `info` \r\n     * @description `{}-{}-{sdk}`\r\n     * {}{}{4G/WIFI}{, //}\r\n     */\r\n    IDENTIFIER_REJECTED: 2,\r\n    /**\r\n     *  PC \r\n     */\r\n    SERVER_UNAVAILABLE: 3,\r\n    /**\r\n     * TokenToken\r\n     */\r\n    TOKEN_INCORRECT: 4,\r\n    /**\r\n     * \r\n     */\r\n    NOT_AUTHORIZED: 5,\r\n    /**\r\n     *  userId \r\n     *  CMP \r\n     */\r\n    REDIRECT: 6,\r\n    /**\r\n     * \r\n     */\r\n    PACKAGE_ERROR: 7,\r\n    /**\r\n     *  AppKey \r\n     */\r\n    APP_BLOCK_OR_DELETE: 8,\r\n    /**\r\n     *  ID \r\n     */\r\n    BLOCK: 9,\r\n    /**\r\n     * Token \r\n     */\r\n    TOKEN_EXPIRE: 10,\r\n    /**\r\n     * Token  deviceId  Token  deviceId  deviceId \r\n     */\r\n    DEVICE_ERROR: 11,\r\n    /**\r\n     * Web \r\n     */\r\n    HOSTNAME_ERROR: 12,\r\n    /**\r\n     * ``\r\n     */\r\n    HASOHTERSAMECLIENTONLINE: 13\r\n};\n\n/**\r\n * \r\n */\r\nvar ConnectionStatus;\r\n(function (ConnectionStatus) {\r\n    /**\r\n     * \r\n     */\r\n    ConnectionStatus[ConnectionStatus[\"CONNECTED\"] = 0] = \"CONNECTED\";\r\n    /**\r\n     * \r\n     */\r\n    ConnectionStatus[ConnectionStatus[\"CONNECTING\"] = 1] = \"CONNECTING\";\r\n    /**\r\n     * \r\n     */\r\n    ConnectionStatus[ConnectionStatus[\"DISCONNECTED\"] = 2] = \"DISCONNECTED\";\r\n    /**\r\n     * \r\n     */\r\n    ConnectionStatus[ConnectionStatus[\"NETWORK_UNAVAILABLE\"] = 3] = \"NETWORK_UNAVAILABLE\";\r\n    /**\r\n     * \r\n     */\r\n    ConnectionStatus[ConnectionStatus[\"CONNECTION_CLOSED\"] = 4] = \"CONNECTION_CLOSED\";\r\n    /**\r\n     * \r\n     */\r\n    ConnectionStatus[ConnectionStatus[\"KICKED_OFFLINE_BY_OTHER_CLIENT\"] = 6] = \"KICKED_OFFLINE_BY_OTHER_CLIENT\";\r\n    /**\r\n     * websocket \r\n     */\r\n    ConnectionStatus[ConnectionStatus[\"WEBSOCKET_UNAVAILABLE\"] = 7] = \"WEBSOCKET_UNAVAILABLE\";\r\n    /**\r\n     * websocket \r\n     */\r\n    ConnectionStatus[ConnectionStatus[\"WEBSOCKET_ERROR\"] = 8] = \"WEBSOCKET_ERROR\";\r\n    /**\r\n     * \r\n     */\r\n    ConnectionStatus[ConnectionStatus[\"BLOCKED\"] = 9] = \"BLOCKED\";\r\n    /**\r\n     * \r\n     */\r\n    ConnectionStatus[ConnectionStatus[\"DOMAIN_INCORRECT\"] = 12] = \"DOMAIN_INCORRECT\";\r\n    /**\r\n     * appkey \r\n     */\r\n    ConnectionStatus[ConnectionStatus[\"APPKEY_IS_FAKE\"] = 20] = \"APPKEY_IS_FAKE\";\r\n    /**\r\n     * `count > 5` reconnect \r\n     */\r\n    ConnectionStatus[ConnectionStatus[\"ULTRALIMIT\"] = 1101] = \"ULTRALIMIT\";\r\n    /**\r\n     * \r\n     */\r\n    ConnectionStatus[ConnectionStatus[\"REQUEST_NAVI\"] = 201] = \"REQUEST_NAVI\";\r\n    /**\r\n     * \r\n     */\r\n    ConnectionStatus[ConnectionStatus[\"RESPONSE_NAVI\"] = 202] = \"RESPONSE_NAVI\";\r\n    /**\r\n     *  \r\n     */\r\n    ConnectionStatus[ConnectionStatus[\"RESPONSE_NAVI_ERROR\"] = 203] = \"RESPONSE_NAVI_ERROR\";\r\n    /**\r\n     *  \r\n     */\r\n    ConnectionStatus[ConnectionStatus[\"RESPONSE_NAVI_TIMEOUT\"] = 204] = \"RESPONSE_NAVI_TIMEOUT\";\r\n})(ConnectionStatus || (ConnectionStatus = {}));\r\nvar ConnectionStatus$1 = ConnectionStatus;\n\n/* eslint-disable camelcase */\r\n/**\r\n * \r\n */\r\nvar Topic;\r\n(function (Topic) {\r\n    /**  */\r\n    Topic[Topic[\"ppMsgP\"] = 1] = \"ppMsgP\";\r\n    /**  */\r\n    Topic[Topic[\"ppMsgN\"] = 2] = \"ppMsgN\";\r\n    /**  */\r\n    Topic[Topic[\"ppMsgS\"] = 3] = \"ppMsgS\";\r\n    Topic[Topic[\"pgMsgP\"] = 4] = \"pgMsgP\";\r\n    Topic[Topic[\"chatMsg\"] = 5] = \"chatMsg\";\r\n    Topic[Topic[\"pcMsgP\"] = 6] = \"pcMsgP\";\r\n    Topic[Topic[\"qryPMsg\"] = 7] = \"qryPMsg\";\r\n    Topic[Topic[\"qryGMsg\"] = 8] = \"qryGMsg\";\r\n    Topic[Topic[\"qryCHMsg\"] = 9] = \"qryCHMsg\";\r\n    Topic[Topic[\"qryCMsg\"] = 10] = \"qryCMsg\";\r\n    Topic[Topic[\"qrySMsg\"] = 11] = \"qrySMsg\";\r\n    Topic[Topic[\"recallMsg\"] = 12] = \"recallMsg\";\r\n    Topic[Topic[\"prMsgS\"] = 13] = \"prMsgS\";\r\n    /**  */\r\n    Topic[Topic[\"s_ntf\"] = 14] = \"s_ntf\";\r\n    /**  */\r\n    Topic[Topic[\"s_msg\"] = 15] = \"s_msg\";\r\n    /**\r\n     * \r\n     * @todo \r\n     */\r\n    Topic[Topic[\"s_stat\"] = 16] = \"s_stat\";\r\n    /**  kv  */\r\n    Topic[Topic[\"s_cmd\"] = 17] = \"s_cmd\";\r\n    /**  */\r\n    Topic[Topic[\"s_us\"] = 18] = \"s_us\";\r\n    /**  */\r\n    Topic[Topic[\"pullUS\"] = 19] = \"pullUS\";\r\n    Topic[Topic[\"pgMsgS\"] = 20] = \"pgMsgS\";\r\n    Topic[Topic[\"chatMsgS\"] = 21] = \"chatMsgS\";\r\n    Topic[Topic[\"qrySessionsAtt\"] = 22] = \"qrySessionsAtt\";\r\n    Topic[Topic[\"pullMsg\"] = 23] = \"pullMsg\";\r\n    Topic[Topic[\"qrySessions\"] = 24] = \"qrySessions\";\r\n    Topic[Topic[\"delSessions\"] = 25] = \"delSessions\";\r\n    Topic[Topic[\"delMsg\"] = 26] = \"delMsg\";\r\n    Topic[Topic[\"updRRTime\"] = 27] = \"updRRTime\";\r\n    /**  */\r\n    Topic[Topic[\"chrmPull\"] = 28] = \"chrmPull\";\r\n    Topic[Topic[\"joinChrm\"] = 29] = \"joinChrm\";\r\n    Topic[Topic[\"joinChrmR\"] = 30] = \"joinChrmR\";\r\n    Topic[Topic[\"exitChrm\"] = 31] = \"exitChrm\";\r\n    Topic[Topic[\"queryChrmI\"] = 32] = \"queryChrmI\";\r\n    Topic[Topic[\"setKV\"] = 33] = \"setKV\";\r\n    Topic[Topic[\"delKV\"] = 34] = \"delKV\";\r\n    /**  KV  */\r\n    Topic[Topic[\"pullKV\"] = 35] = \"pullKV\";\r\n    Topic[Topic[\"qryRelation\"] = 36] = \"qryRelation\";\r\n    Topic[Topic[\"delRelation\"] = 37] = \"delRelation\";\r\n    Topic[Topic[\"pullSeAtts\"] = 38] = \"pullSeAtts\";\r\n    Topic[Topic[\"setSeAtt\"] = 39] = \"setSeAtt\";\r\n    Topic[Topic[\"qnTkn\"] = 40] = \"qnTkn\";\r\n    Topic[Topic[\"qnUrl\"] = 41] = \"qnUrl\";\r\n    Topic[Topic[\"cleanPMsg\"] = 42] = \"cleanPMsg\";\r\n    Topic[Topic[\"cleanGMsg\"] = 43] = \"cleanGMsg\";\r\n    Topic[Topic[\"cleanCMsg\"] = 44] = \"cleanCMsg\";\r\n    Topic[Topic[\"cleanSMsg\"] = 45] = \"cleanSMsg\";\r\n    Topic[Topic[\"rtcRJoin_data\"] = 46] = \"rtcRJoin_data\";\r\n    Topic[Topic[\"rtcRExit\"] = 47] = \"rtcRExit\";\r\n    Topic[Topic[\"rtcPing\"] = 48] = \"rtcPing\";\r\n    Topic[Topic[\"rtcSetData\"] = 49] = \"rtcSetData\";\r\n    /**  URI  */\r\n    Topic[Topic[\"userSetData\"] = 50] = \"userSetData\";\r\n    Topic[Topic[\"rtcQryData\"] = 51] = \"rtcQryData\";\r\n    Topic[Topic[\"rtcDelData\"] = 52] = \"rtcDelData\";\r\n    Topic[Topic[\"rtcSetOutData\"] = 53] = \"rtcSetOutData\";\r\n    Topic[Topic[\"rtcQryUserOutData\"] = 54] = \"rtcQryUserOutData\";\r\n    Topic[Topic[\"rtcToken\"] = 55] = \"rtcToken\";\r\n    Topic[Topic[\"rtcUserState\"] = 56] = \"rtcUserState\";\r\n    Topic[Topic[\"rtcRInfo\"] = 57] = \"rtcRInfo\";\r\n    Topic[Topic[\"rtcUData\"] = 58] = \"rtcUData\";\r\n    Topic[Topic[\"rtcUPut\"] = 59] = \"rtcUPut\";\r\n    Topic[Topic[\"rtcUDel\"] = 60] = \"rtcUDel\";\r\n    Topic[Topic[\"rtcUList\"] = 61] = \"rtcUList\";\r\n})(Topic || (Topic = {}));\r\nvar Topic$1 = Topic;\n\n/**\r\n *  /ping \r\n * @todo \r\n * @param hosts\r\n * @param protocol\r\n * @param runtime\r\n */\r\nconst getValidHosts = (hosts, protocol, runtime) => __awaiter(void 0, void 0, void 0, function* () {\r\n    //  /ping?r=<random>  hosts \r\n    let pingRes = yield Promise.all(hosts.map((host) => __awaiter(void 0, void 0, void 0, function* () {\r\n        const now = Date.now();\r\n        const url = `${protocol}://${host}/ping?r=${randomNum(1000, 9999)}`;\r\n        const res = yield runtime.httpReq({\r\n            url,\r\n            timeout: PING_REQ_TIMEOUT\r\n        });\r\n        return { status: res.status, host, cost: Date.now() - now };\r\n    })));\r\n    // \r\n    pingRes = pingRes.filter(item => item.status === 200);\r\n    // \r\n    if (pingRes.length > 1) {\r\n        pingRes = pingRes.sort((a, b) => a.cost - b.cost);\r\n    }\r\n    return pingRes.map(item => item.host);\r\n});\r\nconst formatWSUrl = (protocol, host, appkey, token, runtime, apiVersion, pid) => {\r\n    return `${protocol}://${host}/websocket?appId=${appkey}&token=${encodeURIComponent(token)}&sdkVer=${apiVersion}&pid=${pid}&apiVer=${runtime.isFromUniapp ? 'uniapp' : 'normal'}${runtime.connectPlatform ? '&platform=' + runtime.connectPlatform : ''}`;\r\n};\r\nconst formatResolveKey = (messageId, identifier) => [messageId, identifier].join('-');\r\nconst isStatusMessage = (topic) => {\r\n    return [Topic$1.ppMsgS, Topic$1.pgMsgS, Topic$1.chatMsgS].map(item => Topic$1[item]).indexOf(topic) >= 0;\r\n};\n\nconst sendWSData = (writer, socket) => {\r\n    if (!(writer instanceof PingReqWriter)) {\r\n        logger.debug('Websocket ==>', writer);\r\n    }\r\n    const binary = writer.getBufferData();\r\n    socket.send(binary.buffer);\r\n};\r\n/**\r\n * @todo  DataCodec  xhr-polling \r\n * @description\r\n * 1.  WebSocket \r\n * 2.  Protobuf \r\n */\r\nclass WebSocketChannel extends ADataChannel {\r\n    //  Circular dependency runtime \r\n    constructor(_runtime, watcher) {\r\n        super('websocket', watcher);\r\n        this._runtime = _runtime;\r\n        this._socket = null;\r\n        /**\r\n         *  PubAck  Promise.resolve \r\n         */\r\n        this._messageIds = {};\r\n        /**\r\n         *  PubAck  Promise.resolve \r\n         */\r\n        this._syncMessageIds = {};\r\n        /**\r\n         * \r\n         */\r\n        this._failedCount = 0;\r\n        /**\r\n         *  PING \r\n         */\r\n        this.ALLOW_FAILED_TIMES = 4;\r\n        /**\r\n         *  0 - 65535 65535 \r\n         */\r\n        this._idCount = 0;\r\n        this._generateMessageId = () => {\r\n            if (this._idCount >= 65535) {\r\n                this._idCount = 0;\r\n            }\r\n            return ++this._idCount;\r\n        };\r\n    }\r\n    /**\r\n     *  websocket \r\n     * @param appkey\r\n     * @param token\r\n     * @param hosts\r\n     * @param protocol\r\n     * @param apiVersion - apiVersion  `/\\d+(\\.\\d+){2}/` \r\n     */\r\n    connect(appkey, token, hosts, protocol, apiVersion) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            // \r\n            apiVersion = ADataChannel.matchVersion(apiVersion);\r\n            // \r\n            this._watcher.status(ConnectionStatus$1.CONNECTING);\r\n            // \r\n            const validHosts = yield getValidHosts(hosts, protocol, this._runtime);\r\n            if (validHosts.length === 0) {\r\n                logger.error('No valid websocket server hosts!');\r\n                return ErrorCode$1.RC_SOCKET_NOT_CREATED;\r\n            }\r\n            // http -> ws, https -> wss\r\n            const wsProtocol = protocol.replace('http', 'ws');\r\n            //  websocket \r\n            for (let i = 0, len = validHosts.length; i < len; i += 1) {\r\n                const url = formatWSUrl(wsProtocol, validHosts[i], appkey, token, this._runtime, apiVersion);\r\n                //  socket ConnAck \r\n                const socket = this._runtime.createWebSocket(url);\r\n                // \r\n                const disconnected = (code) => {\r\n                    if (this._socket === socket) {\r\n                        this._socket = null;\r\n                        this._watcher.status(code);\r\n                    }\r\n                };\r\n                // \r\n                const code = yield new Promise((resolve) => {\r\n                    socket.onMessage((data) => {\r\n                        if (Object.prototype.toString.call(data) !== '[object ArrayBuffer]') {\r\n                            logger.warn('Socket received invalid data:', data);\r\n                            return;\r\n                        }\r\n                        const signal = readWSBuffer(data);\r\n                        // Ping \r\n                        if (signal instanceof PingRespReader && this._pingResolve) {\r\n                            this._pingResolve(ErrorCode$1.SUCCESS);\r\n                            this._pingResolve = undefined;\r\n                            return;\r\n                        }\r\n                        logger.debug('Websocket <==', signal);\r\n                        // \r\n                        if (signal instanceof ConnAckReader) {\r\n                            if (signal.status !== ConnectResultCode.ACCEPTED) {\r\n                                logger.error('Websocket connAck status:', signal.status);\r\n                                resolve(signal.status);\r\n                                return;\r\n                            }\r\n                            this.connectedTime = signal.timestamp;\r\n                            this.userId = signal.userId || '';\r\n                            resolve(ErrorCode$1.SUCCESS);\r\n                            return;\r\n                        }\r\n                        // \r\n                        if (signal instanceof DisconnectReader) {\r\n                            //  Server , \r\n                            // 1 \r\n                            // 2 \r\n                            const { status } = signal;\r\n                            const connStatus = status === 1\r\n                                ? ConnectionStatus$1.KICKED_OFFLINE_BY_OTHER_CLIENT\r\n                                : (status === 2 ? ConnectionStatus$1.BLOCKED : status);\r\n                            this._watcher.status(connStatus);\r\n                            return;\r\n                        }\r\n                        // \r\n                        this._onReceiveSignal(signal);\r\n                    });\r\n                    socket.onClose((code, reason) => {\r\n                        logger.warn('websocket closed! code:', code, 'reason:', reason);\r\n                        disconnected(ConnectionStatus$1.CONNECTION_CLOSED);\r\n                        resolve(code);\r\n                    });\r\n                    socket.onError((error) => {\r\n                        logger.error('websocket error!', error);\r\n                        disconnected(ConnectionStatus$1.WEBSOCKET_ERROR);\r\n                        resolve(ErrorCode$1.NETWORK_ERROR);\r\n                    });\r\n                    socket.onOpen(() => logger.debug('websocket open =>', url));\r\n                    // ConnAck \r\n                    timerSetTimeout(() => {\r\n                        resolve(ErrorCode$1.TIMEOUT);\r\n                    }, WEB_SOCKET_TIMEOUT);\r\n                });\r\n                if (code === ErrorCode$1.SUCCESS) {\r\n                    this._socket = socket;\r\n                    // \r\n                    this._checkAlive();\r\n                    // \r\n                    this._watcher.status(ConnectionStatus$1.CONNECTED);\r\n                    return code;\r\n                }\r\n                socket.close();\r\n            }\r\n            return ErrorCode$1.RC_NET_UNAVAILABLE;\r\n        });\r\n    }\r\n    _checkAlive() {\r\n        var _a;\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._socket) {\r\n                //  Ping\r\n                return;\r\n            }\r\n            this.sendOnly(new PingReqWriter());\r\n            // \r\n            const code = yield new Promise((resolve) => {\r\n                this._pingResolve = resolve;\r\n                setTimeout(() => {\r\n                    this._pingResolve = undefined;\r\n                    resolve(ErrorCode$1.TIMEOUT);\r\n                }, IM_SIGNAL_TIMEOUT);\r\n            });\r\n            // \r\n            if (code !== ErrorCode$1.SUCCESS && ++this._failedCount >= this.ALLOW_FAILED_TIMES) {\r\n                (_a = this._socket) === null || _a === void 0 ? void 0 : _a.close();\r\n                return;\r\n            }\r\n            this._failedCount = 0;\r\n            // \r\n            setTimeout(() => this._checkAlive(), IM_PING_INTERVAL_TIME);\r\n        });\r\n    }\r\n    _onReceiveSignal(signal) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const { messageId, identifier } = signal;\r\n            //  Ack, , \r\n            const isQosNeedAck = signal.header && signal.header.qos !== QOS.AT_MOST_ONCE;\r\n            if (isQosNeedAck) {\r\n                // Pub \r\n                if (signal instanceof PublishReader && !signal.syncMsg) {\r\n                    this.sendOnly(new PubAckWriter(messageId));\r\n                }\r\n                // qry \r\n                if (signal instanceof QueryAckReader) {\r\n                    this.sendOnly(new QueryConWriter(messageId));\r\n                }\r\n            }\r\n            const key = formatResolveKey(messageId, identifier);\r\n            //  pubAckqueryAck \r\n            if (messageId > 0) {\r\n                const resolve = this._messageIds[key];\r\n                resolve && resolve(signal);\r\n                //  pubAck\r\n                this._syncMessageIds[key] && this._syncMessageIds[key](signal);\r\n            }\r\n            // PublishReader \r\n            if (signal instanceof PublishReader) {\r\n                const { syncMsg, topic } = signal;\r\n                // ppMsgSpgMsgSchatMsgS\r\n                if (!syncMsg || isStatusMessage(topic)) {\r\n                    this._watcher.signal(signal);\r\n                    return;\r\n                }\r\n                //  CMP  PubAckComet \r\n                const ack = yield new Promise(resolve => {\r\n                    this._syncMessageIds[key] = resolve;\r\n                });\r\n                delete this._syncMessageIds[key];\r\n                this._watcher.signal(signal, ack);\r\n            }\r\n        });\r\n    }\r\n    sendOnly(writer) {\r\n        if (this._socket) {\r\n            sendWSData(writer, this._socket);\r\n        }\r\n    }\r\n    send(writer, respPBName, option, timeout = IM_SIGNAL_TIMEOUT) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (this._socket) {\r\n                const messageId = this._generateMessageId();\r\n                writer.messageId = messageId;\r\n                const identifier = writer.identifier;\r\n                sendWSData(writer, this._socket);\r\n                // \r\n                const respSignal = yield new Promise((resolve) => {\r\n                    const key = formatResolveKey(messageId, identifier);\r\n                    this._messageIds[key] = resolve;\r\n                    setTimeout(() => {\r\n                        delete this._messageIds[key];\r\n                        resolve(); //  timeout \r\n                    }, timeout);\r\n                });\r\n                if (!respSignal) {\r\n                    return { code: ErrorCode$1.TIMEOUT };\r\n                }\r\n                if (respSignal.status !== 0) {\r\n                    return { code: respSignal.status };\r\n                }\r\n                const data = respPBName ? this.codec.decodeByPBName(respSignal.data, respPBName, option) : respSignal;\r\n                return { code: ErrorCode$1.SUCCESS, data };\r\n            }\r\n            return { code: ErrorCode$1.RC_NET_CHANNEL_INVALID };\r\n        });\r\n    }\r\n    close() {\r\n        if (this._socket) {\r\n            this._socket.close();\r\n            this._socket = null;\r\n            this._watcher.status(ConnectionStatus$1.DISCONNECTED);\r\n        }\r\n    }\r\n}\n\n(function (HttpMethod) {\r\n    HttpMethod[\"GET\"] = \"GET\";\r\n    HttpMethod[\"POST\"] = \"POST\";\r\n})(exports.HttpMethod || (exports.HttpMethod = {}));\n\nconst isValidJSON = (jsonStr) => {\r\n    if (isObject(jsonStr)) {\r\n        return true;\r\n    }\r\n    let isValid = false;\r\n    try {\r\n        const obj = JSON.parse(jsonStr);\r\n        const str = JSON.stringify(obj);\r\n        isValid = str === jsonStr;\r\n    }\r\n    catch (e) {\r\n        isValid = false;\r\n    }\r\n    return isValid;\r\n};\r\nclass CometChannel extends ADataChannel {\r\n    constructor(_runtime, watcher) {\r\n        super('comet', watcher);\r\n        this._runtime = _runtime;\r\n        this._messageIds = {};\r\n        this._syncMessageIds = {};\r\n        this._idCount = 0;\r\n        this._generateMessageId = () => {\r\n            return ++this._idCount;\r\n        };\r\n        this._pid = encodeURIComponent(new Date().getTime() + Math.random() + '');\r\n    }\r\n    /**\r\n     * \r\n     * @param data\r\n     */\r\n    handleCometRes(res) {\r\n        if (res.status !== 200 && res.status !== 202) {\r\n            return false;\r\n        }\r\n        const data = isString(res.data) ? JSON.parse(res.data) : res.data;\r\n        if (!data) {\r\n            logger.warn('received data is not a validJson', data);\r\n            return false;\r\n        }\r\n        if (!isArray(data)) {\r\n            return true;\r\n        }\r\n        forEach(data, (item) => __awaiter(this, void 0, void 0, function* () {\r\n            const { sessionid } = item;\r\n            if (sessionid) {\r\n                this._sessionid = sessionid;\r\n            }\r\n            const signal = readCometData(item);\r\n            const { messageId, _header, status, identifier } = signal;\r\n            const isQosNeedAck = _header && _header.qos !== QOS.AT_MOST_ONCE;\r\n            const key = formatResolveKey(messageId, identifier);\r\n            //  pubAckqueryAck \r\n            if (messageId && signal.getIdentifier) {\r\n                const resolve = this._messageIds[key];\r\n                resolve && resolve(signal);\r\n                //  pubAck\r\n                this._syncMessageIds[key] && this._syncMessageIds[key](signal);\r\n            }\r\n            // \r\n            if (isQosNeedAck) {\r\n                if (signal instanceof PublishReader && !signal.syncMsg) {\r\n                    const writer = new PubAckWriter(messageId);\r\n                    this.sendOnly(writer);\r\n                }\r\n                if (signal instanceof QueryAckReader) {\r\n                    const writer = new QueryConWriter(messageId);\r\n                    this.sendOnly(writer);\r\n                }\r\n            }\r\n            // \r\n            if (signal instanceof DisconnectReader) {\r\n                const connStatus = status === 1\r\n                    ? ConnectionStatus$1.KICKED_OFFLINE_BY_OTHER_CLIENT\r\n                    : (status === 2 ? ConnectionStatus$1.BLOCKED : status);\r\n                this._watcher.status(connStatus);\r\n            }\r\n            //  publish\r\n            if (signal instanceof PublishReader) {\r\n                const { syncMsg, topic } = signal;\r\n                // ppMsgSpgMsgSchatMsgS\r\n                if (!syncMsg || isStatusMessage(topic)) {\r\n                    this._watcher.signal(signal);\r\n                    return false;\r\n                }\r\n                //  CMP  PubAck\r\n                const ack = yield new Promise(resolve => {\r\n                    this._syncMessageIds[key] = resolve;\r\n                });\r\n                delete this._syncMessageIds[key];\r\n                this._watcher.signal(signal, ack);\r\n            }\r\n        }));\r\n        return true;\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    _startPullSignal(protocol) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const timestamp = new Date().getTime();\r\n            const url = `${protocol}://${this._domain}/pullmsg.js?sessionid=${this._sessionid}&timestrap=${timestamp}&pid=${this._pid}`;\r\n            const res = yield this._runtime.httpReq({\r\n                url,\r\n                body: { pid: this._pid },\r\n                timeout: IM_COMET_PULLMSG_TIMEOUT\r\n            });\r\n            const isSuccess = this.handleCometRes(res);\r\n            if (!this._isDisconnected) {\r\n                if (isSuccess) {\r\n                    this._startPullSignal(protocol);\r\n                }\r\n                else {\r\n                    this._watcher.status(ConnectionStatus$1.NETWORK_UNAVAILABLE);\r\n                    this.close();\r\n                }\r\n            }\r\n        });\r\n    }\r\n    connect(appkey, token, hosts, protocol, apiVersion) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            // \r\n            apiVersion = ADataChannel.matchVersion(apiVersion);\r\n            this._protocol = protocol;\r\n            this._isDisconnected = false;\r\n            this._watcher.status(ConnectionStatus$1.CONNECTING);\r\n            const validHosts = yield getValidHosts(hosts, protocol, this._runtime);\r\n            if (validHosts.length === 0) {\r\n                logger.error('No valid websocket server hosts!');\r\n                return ErrorCode$1.RC_SOCKET_NOT_CREATED;\r\n            }\r\n            /**\r\n             * \r\n             */\r\n            const handleConnectRes = (res) => {\r\n                if (res.status !== 200 && res.status !== 202) {\r\n                    return false;\r\n                }\r\n                if (res.data) {\r\n                    if (!isValidJSON(res.data)) {\r\n                        logger.warn('received data is not a validJson', res.data);\r\n                        return false;\r\n                    }\r\n                    return isObject(res.data) ? res.data : JSON.parse(res.data);\r\n                }\r\n                return false;\r\n            };\r\n            for (let i = 0, len = validHosts.length; i < len; i += 1) {\r\n                const url = formatWSUrl(protocol, validHosts[i], appkey, token, this._runtime, apiVersion, this._pid);\r\n                const res = yield this._runtime.httpReq({\r\n                    url,\r\n                    body: {\r\n                        pid: this._pid\r\n                    },\r\n                    timeout: WEB_SOCKET_TIMEOUT\r\n                });\r\n                const response = handleConnectRes(res);\r\n                this._domain = validHosts[i];\r\n                if (response && response.status === 0) {\r\n                    this._watcher.status(ConnectionStatus$1.CONNECTED);\r\n                    this._sessionid = response.sessionid;\r\n                    this._startPullSignal(protocol);\r\n                    this.userId = response.userId;\r\n                    this.connectedTime = response.timestamp;\r\n                    return response.status;\r\n                }\r\n            }\r\n            return ErrorCode$1.RC_NET_UNAVAILABLE;\r\n        });\r\n    }\r\n    sendCometData(writer, timeout = IM_SIGNAL_TIMEOUT) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const { _domain, _sessionid, _pid } = this;\r\n            const { messageId, topic, targetId, identifier } = writer;\r\n            const headerCode = writer.getHeaderFlag();\r\n            let url;\r\n            if (topic) {\r\n                url = `${this._protocol}://${_domain}/websocket?messageid=${messageId}&header=${headerCode}&sessionid=${_sessionid}&topic=${topic}&targetid=${targetId}&pid=${_pid}`;\r\n            }\r\n            else {\r\n                url = `${this._protocol}://${_domain}/websocket?messageid=${messageId}&header=${headerCode}&sessionid=${_sessionid}&pid=${_pid}`;\r\n            }\r\n            const res = yield this._runtime.httpReq({\r\n                url,\r\n                method: exports.HttpMethod.POST,\r\n                body: writer.getCometData()\r\n            });\r\n            this.handleCometRes(res);\r\n        });\r\n    }\r\n    sendOnly(writer) {\r\n        this.sendCometData(writer);\r\n    }\r\n    send(writer, respPBName, option, timeout = IM_SIGNAL_TIMEOUT) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const messageId = this._generateMessageId();\r\n            writer.messageId = messageId;\r\n            this.sendCometData(writer);\r\n            const { identifier } = writer;\r\n            const respSignal = yield new Promise((resolve) => {\r\n                const key = formatResolveKey(messageId, identifier);\r\n                this._messageIds[key] = resolve;\r\n                setTimeout(() => {\r\n                    delete this._messageIds[key];\r\n                    resolve(); //  timeout \r\n                }, timeout);\r\n            });\r\n            if (!respSignal) {\r\n                return { code: ErrorCode$1.TIMEOUT };\r\n            }\r\n            if (respSignal.status !== 0) {\r\n                return { code: respSignal.status };\r\n            }\r\n            const data = respPBName ? this.codec.decodeByPBName(respSignal.data, respPBName, option) : respSignal;\r\n            return { code: ErrorCode$1.SUCCESS, data };\r\n        });\r\n    }\r\n    close() {\r\n        this._isDisconnected = true;\r\n        this._watcher.status(ConnectionStatus$1.DISCONNECTED);\r\n    }\r\n}\n\nconst getKey = (appkey, token) => {\r\n    return ['navi', appkey, token].join('_');\r\n};\r\nconst getNaviInfoFromCache = (appkey, token, storage) => {\r\n    const key = getKey(appkey, token);\r\n    const jsonStr = storage.getItem(key);\r\n    if (!jsonStr) {\r\n        return null;\r\n    }\r\n    let data;\r\n    try {\r\n        data = JSON.parse(jsonStr);\r\n    }\r\n    catch (err) {\r\n        // \r\n        storage.removeItem(key);\r\n        return null;\r\n    }\r\n    // \r\n    if (Date.now() - data.timestamp >= NAVI_CACHE_DURATION) {\r\n        storage.removeItem(key);\r\n        return null;\r\n    }\r\n    return data.naviInfo;\r\n};\r\nconst setNaviInfo2Cache = (appkey, token, naviInfo, storage) => {\r\n    const key = getKey(appkey, token);\r\n    const data = {\r\n        naviInfo,\r\n        timestamp: Date.now()\r\n    };\r\n    storage.setItem(key, JSON.stringify(data));\r\n};\r\nconst clearCache = (appkey, token, storage) => {\r\n    storage.removeItem(getKey(appkey, token));\r\n};\r\nclass Navi {\r\n    constructor(_runtime, _appkey, \r\n    /**\r\n     *  token \r\n     */\r\n    _navigators, _customCMP = [], _apiVersion, _connectType) {\r\n        this._runtime = _runtime;\r\n        this._appkey = _appkey;\r\n        this._navigators = _navigators;\r\n        this._customCMP = _customCMP;\r\n        this._apiVersion = _apiVersion;\r\n        this._connectType = _connectType;\r\n    }\r\n    _formatNaviUrl(url, token, appkey, jsonpFunc, connectType) {\r\n        const path = this._runtime.isSupportSocket() && (connectType === 'websocket') ? 'navi' : 'cometnavi';\r\n        const tmpUrl = `${url}/${path}.js?appId=${appkey}&token=${encodeURIComponent(token)}&callBack=${jsonpFunc}&v=${this._apiVersion}&r=${Date.now()}`;\r\n        return tmpUrl;\r\n    }\r\n    _reqNavi(uris, appkey, token, connectType) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const jsonpFunc = 'getServerEndpoint';\r\n            for (let i = 0, len = uris.length; i < len; i += 1) {\r\n                const url = this._formatNaviUrl(uris[i], token, appkey, jsonpFunc, connectType);\r\n                logger.debug(`req navi => ${url}`);\r\n                const res = yield this._runtime.httpReq({\r\n                    url,\r\n                    timeout: NAVI_REQ_TIMEOUT\r\n                });\r\n                if (res.status !== 200) {\r\n                    continue;\r\n                }\r\n                try {\r\n                    //  ; \r\n                    //  res  naviInfo \r\n                    const jsonStr = res.data.replace(`${jsonpFunc}(`, '').replace(/\\);?$/, '');\r\n                    const naviInfo = JSON.parse(jsonStr);\r\n                    // \r\n                    const protocol = /^https/.test(url) ? 'https' : 'http';\r\n                    naviInfo.protocol = protocol;\r\n                    return naviInfo;\r\n                }\r\n                catch (err) {\r\n                    logger.error('parse navi err =>', err);\r\n                }\r\n            }\r\n            return null;\r\n        });\r\n    }\r\n    /**\r\n     * \r\n     * @param force \r\n     */\r\n    getInfo(token, dynamicUris, force) {\r\n        var _a;\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            // TODO: \r\n            if (!this._runtime.useNavi) {\r\n                let connectUrl;\r\n                if (this._runtime.isSupportSocket()) {\r\n                    connectUrl = MINI_SOCKET_CONNECT_URIS.join(',');\r\n                }\r\n                else {\r\n                    connectUrl = MINI_COMET_CONNECT_URIS.join(',');\r\n                }\r\n                const naviInfo = {\r\n                    code: 200,\r\n                    protocol: 'https',\r\n                    server: '',\r\n                    voipCallInfo: '',\r\n                    kvStorage: 0,\r\n                    openHttpDNS: false,\r\n                    historyMsg: false,\r\n                    chatroomMsg: false,\r\n                    uploadServer: 'https://upload.qiniup.com',\r\n                    bosAddr: 'https://gz.bcebos.com',\r\n                    location: '',\r\n                    monitor: 0,\r\n                    joinMChrm: false,\r\n                    openMp: 0,\r\n                    openUS: 0,\r\n                    grpMsgLimit: 0,\r\n                    isFormatted: 0,\r\n                    gifSize: 2048,\r\n                    logSwitch: 0,\r\n                    logPolicy: '',\r\n                    compDays: 0,\r\n                    msgAck: '',\r\n                    activeServer: '',\r\n                    qnAddr: '',\r\n                    extkitSwitch: 0,\r\n                    alone: false,\r\n                    voipServer: '',\r\n                    offlinelogserver: '',\r\n                    backupServer: ((_a = this._customCMP) === null || _a === void 0 ? void 0 : _a.length) ? this._customCMP.join(',') : connectUrl\r\n                };\r\n                setNaviInfo2Cache(this._appkey, token, naviInfo, this._runtime.localStorage);\r\n                return naviInfo;\r\n            }\r\n            // \r\n            if (force) {\r\n                this._clear(token);\r\n            }\r\n            // \r\n            let naviInfo = getNaviInfoFromCache(this._appkey, token, this._runtime.localStorage);\r\n            if (naviInfo) {\r\n                return naviInfo;\r\n            }\r\n            const uris = this._navigators.slice();\r\n            dynamicUris.length && dynamicUris.forEach(uri => {\r\n                uris.indexOf(uri) < 0 && uris.push(uri);\r\n            });\r\n            // \r\n            // TODO: \r\n            naviInfo = yield this._reqNavi(uris, this._appkey, token, this._connectType);\r\n            if (naviInfo) {\r\n                setNaviInfo2Cache(this._appkey, token, naviInfo, this._runtime.localStorage);\r\n                return naviInfo;\r\n            }\r\n            // TODO: \r\n            return naviInfo;\r\n        });\r\n    }\r\n    getInfoFromCache(token) {\r\n        return getNaviInfoFromCache(this._appkey, token, this._runtime.localStorage);\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    _clear(token) {\r\n        clearCache(this._appkey, token, this._runtime.localStorage);\r\n    }\r\n}\n\n/**\r\n * \r\n */\r\nclass AEngine {\r\n    /**\r\n     * \r\n     * @param _appkey\r\n     */\r\n    constructor(runtime, _appkey, _watcher, _apiVersion) {\r\n        this.runtime = runtime;\r\n        this._appkey = _appkey;\r\n        this._watcher = _watcher;\r\n        this._apiVersion = _apiVersion;\r\n        /**\r\n         *  Id\r\n         */\r\n        this.currentUserId = '';\r\n        /**\r\n         * \r\n        */\r\n        this.connectedTime = 0;\r\n    }\r\n}\n\nconst OUTBOX_KEY = 'outbox';\r\nconst INBOX_KEY = 'inbox';\r\nconst generateKey = (prefix, appkey, userId) => {\r\n    return [prefix, appkey, userId].join('_');\r\n};\r\n/**\r\n * \r\n */\r\nclass Letterbox {\r\n    constructor(_runtime, _appkey) {\r\n        this._runtime = _runtime;\r\n        this._appkey = _appkey;\r\n        // \r\n        this._inboxTime = 0;\r\n        this._outboxTime = 0;\r\n    }\r\n    /**\r\n     * \r\n     * @param timestamp\r\n     * @param userId\r\n     */\r\n    setInboxTime(timestamp, userId) {\r\n        if (this._inboxTime > timestamp) {\r\n            return;\r\n        }\r\n        this._inboxTime = timestamp;\r\n        const key = generateKey(INBOX_KEY, this._appkey, userId);\r\n        this._runtime.localStorage.setItem(key, timestamp.toString());\r\n    }\r\n    /**\r\n     * \r\n     * @param userId\r\n     */\r\n    getInboxTime(userId) {\r\n        if (this._inboxTime === 0) {\r\n            const key = generateKey(INBOX_KEY, this._appkey, userId);\r\n            this._inboxTime = parseInt(this._runtime.localStorage.getItem(key)) || 0;\r\n        }\r\n        return this._inboxTime;\r\n    }\r\n    /**\r\n     * \r\n     * @param timestamp\r\n     * @param userId\r\n     */\r\n    setOutboxTime(timestamp, userId) {\r\n        if (this._outboxTime > timestamp) {\r\n            return;\r\n        }\r\n        this._outboxTime = timestamp;\r\n        const key = generateKey(OUTBOX_KEY, this._appkey, userId);\r\n        this._runtime.localStorage.setItem(key, timestamp.toString());\r\n    }\r\n    /**\r\n     * \r\n     * @param userId\r\n     */\r\n    getOutboxTime(userId) {\r\n        if (this._outboxTime === 0) {\r\n            const key = generateKey(OUTBOX_KEY, this._appkey, userId);\r\n            this._outboxTime = parseInt(this._runtime.localStorage.getItem(key)) || 0;\r\n        }\r\n        return this._outboxTime;\r\n    }\r\n}\n\nconst PullTimeCache = {\r\n    _caches: {},\r\n    set(chrmId, time) {\r\n        this._caches[chrmId] = time;\r\n    },\r\n    get(chrmId) {\r\n        return this._caches[chrmId] || 0;\r\n    },\r\n    clear(chrmId) {\r\n        this._caches[chrmId] = 0;\r\n    }\r\n};\r\nclass KVStore {\r\n    constructor(chatroomId, currentUserId) {\r\n        this._kvCaches = {};\r\n        this._chatroomId = chatroomId;\r\n        this._currentUserId = currentUserId;\r\n    }\r\n    _add(kv) {\r\n        const { key } = kv;\r\n        kv.isDeleted = false;\r\n        this._kvCaches[key] = kv;\r\n    }\r\n    _remove(kv) {\r\n        const { key } = kv;\r\n        const cacheKV = this._kvCaches[key];\r\n        cacheKV.isDeleted = true;\r\n        this._kvCaches[key] = cacheKV;\r\n    }\r\n    _setEntry(data, isFullUpdate) {\r\n        const { key, type, isOverwrite, userId } = data;\r\n        const latestUserId = this._getSetUserId(key);\r\n        const isDeleteOpt = type === ChatroomEntryType$1.DELETE;\r\n        const isSameAtLastSetUser = latestUserId === userId;\r\n        const isKeyNotExist = !this._isExisted(key);\r\n        const event = isDeleteOpt ? this._remove : this._add;\r\n        if (isFullUpdate) {\r\n            event.call(this, data);\r\n        }\r\n        else if (isOverwrite || isSameAtLastSetUser || isKeyNotExist) {\r\n            event.call(this, data);\r\n        }\r\n        else ;\r\n    }\r\n    getValue(key) {\r\n        const kv = this._kvCaches[key] || {};\r\n        const { isDeleted } = kv;\r\n        return isDeleted ? null : kv.value;\r\n    }\r\n    getAllValue() {\r\n        const entries = {};\r\n        for (const key in this._kvCaches) {\r\n            if (!this._kvCaches[key].isDeleted) {\r\n                entries[key] = this._kvCaches[key].value;\r\n            }\r\n        }\r\n        return entries;\r\n    }\r\n    _getSetUserId(key) {\r\n        const cache = this._kvCaches[key] || {};\r\n        return cache.userId;\r\n    }\r\n    _isExisted(key) {\r\n        const cache = this._kvCaches[key] || {};\r\n        const { value, isDeleted } = cache;\r\n        return (value && !isDeleted);\r\n    }\r\n    setEntries(data) {\r\n        let { kvEntries, isFullUpdate } = data;\r\n        kvEntries = kvEntries || [];\r\n        isFullUpdate = isFullUpdate || false;\r\n        isFullUpdate && this.clear();\r\n        kvEntries.forEach((kv) => {\r\n            this._setEntry(kv, isFullUpdate);\r\n        });\r\n    }\r\n    clear() {\r\n        this._kvCaches = {};\r\n    }\r\n}\r\nclass ChrmEntryHandler {\r\n    constructor(engine) {\r\n        this._pullQueue = [];\r\n        this._isPulling = false;\r\n        this._storeCaches = {}; //  Store \r\n        this._engine = engine;\r\n    }\r\n    _startPull() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (this._isPulling || this._pullQueue.length === 0) {\r\n                return;\r\n            }\r\n            this._isPulling = true;\r\n            const { chrmId, timestamp } = this._pullQueue.splice(0, 1)[0];\r\n            const pulledUpTime = PullTimeCache.get(chrmId);\r\n            if (pulledUpTime > timestamp) { // \r\n                this._isPulling = false;\r\n                return;\r\n            }\r\n            const { code, data } = yield this._engine.pullChatroomEntry(chrmId, timestamp);\r\n            if (code === ErrorCode$1.SUCCESS) {\r\n                this._isPulling = false;\r\n                PullTimeCache.set(chrmId, data.syncTime || 0);\r\n                this._startPull();\r\n            }\r\n            else {\r\n                this._startPull();\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     *  kv    kv \r\n    */\r\n    reset(chrmId) {\r\n        // throw new Error('Method not implemented.')\r\n        PullTimeCache.clear(chrmId);\r\n        const kvStore = this._storeCaches[chrmId];\r\n        kvStore.clear();\r\n    }\r\n    /**\r\n     *  kv\r\n     * @description\r\n     * : 1 2 Server \r\n    */\r\n    pullEntry(chrmId, timestamp) {\r\n        this._pullQueue.push({ chrmId, timestamp });\r\n        this._startPull();\r\n    }\r\n    /**\r\n     *  kv\r\n    */\r\n    setLocal(chrmId, data, userId) {\r\n        // throw new Error('Method not implemented.')\r\n        let kvStore = this._storeCaches[chrmId];\r\n        if (!notEmptyObject(kvStore)) {\r\n            kvStore = new KVStore(chrmId, userId);\r\n        }\r\n        kvStore.setEntries(data);\r\n        this._storeCaches[chrmId] = kvStore;\r\n    }\r\n    /**\r\n     *  key  value\r\n     * @param chrmId\r\n     * @param key\r\n    */\r\n    getValue(chrmId, key) {\r\n        // throw new Error('Method not implemented.')\r\n        const kvStore = this._storeCaches[chrmId];\r\n        return kvStore ? kvStore.getValue(key) : null;\r\n    }\r\n    /**\r\n     *  key value\r\n     * @param chrmId\r\n    */\r\n    getAll(chrmId) {\r\n        // throw new Error('Method not implemented.')\r\n        const kvStore = this._storeCaches[chrmId];\r\n        let entries = {};\r\n        if (kvStore) {\r\n            entries = kvStore.getAllValue();\r\n        }\r\n        return entries;\r\n    }\r\n}\r\nclass JoinedChrmManager {\r\n    constructor(_runtime, _appkey, _userId, _canJoinMulipleChrm) {\r\n        this._runtime = _runtime;\r\n        this._appkey = _appkey;\r\n        this._userId = _userId;\r\n        this._canJoinMulipleChrm = _canJoinMulipleChrm;\r\n        this._sessionKey = '';\r\n        this._joinedChrmsInfo = {};\r\n        this._sessionKey = `sync-chrm-${this._appkey}-${this._userId}`;\r\n    }\r\n    set(chrmId, count = 10) {\r\n        !this._canJoinMulipleChrm && (this._joinedChrmsInfo = {});\r\n        this._joinedChrmsInfo[chrmId] = count;\r\n        this._runtime.sessionStorage.setItem(this._sessionKey, JSON.stringify(this._joinedChrmsInfo));\r\n    }\r\n    get() {\r\n        let infos;\r\n        try {\r\n            infos = this._runtime.sessionStorage.getItem(this._sessionKey);\r\n        }\r\n        catch (err) {\r\n            logger.error('parse rejoined chrm infos error', err);\r\n            infos = {};\r\n        }\r\n        return infos;\r\n    }\r\n    remove(chrmId) {\r\n        delete this._joinedChrmsInfo[chrmId];\r\n        if (notEmptyObject(this._joinedChrmsInfo)) {\r\n            this._runtime.sessionStorage.setItem(this._sessionKey, JSON.stringify(this._joinedChrmsInfo));\r\n        }\r\n        else {\r\n            this.clear();\r\n        }\r\n    }\r\n    clear() {\r\n        this._joinedChrmsInfo = {};\r\n        this._runtime.sessionStorage.removeItem(this._sessionKey);\r\n    }\r\n}\n\nclass EventDispatcher {\r\n    constructor() {\r\n        this._map = {};\r\n    }\r\n    /**\r\n     * \r\n     * @param eventType\r\n     * @param listener\r\n     */\r\n    on(eventType, listener) {\r\n        const arr = this._map[eventType] || (this._map[eventType] = []);\r\n        if (arr.includes(listener)) {\r\n            return;\r\n        }\r\n        arr.push(listener);\r\n    }\r\n    /**\r\n     * \r\n     * @param eventType\r\n     * @param listener\r\n     */\r\n    off(eventType, listener) {\r\n        const arr = this._map[eventType];\r\n        if (!arr) {\r\n            return;\r\n        }\r\n        const len = arr.length;\r\n        for (let i = len - 1; i >= 0; i -= 1) {\r\n            if (arr[i] === listener) {\r\n                arr.splice(i, 1);\r\n                if (len === 1) {\r\n                    delete this._map[eventType];\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * \r\n     * @param eventType\r\n     * @param data\r\n     */\r\n    emit(eventType, data) {\r\n        const arr = this._map[eventType];\r\n        if (!arr) {\r\n            return;\r\n        }\r\n        arr.forEach(item => item(data));\r\n    }\r\n    /**\r\n     * \r\n     * @param eventType\r\n     */\r\n    removeAll(eventType) {\r\n        delete this._map[eventType];\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    clear() {\r\n        Object.keys(this._map).forEach(this.removeAll, this);\r\n    }\r\n}\n\nconst EventName = {\r\n    STATUS_CHANGED: 'converStatusChanged'\r\n};\r\nclass ConversationStatus {\r\n    constructor(engine, appkey, currentUserId) {\r\n        this._eventEmitter = new EventDispatcher();\r\n        this._pullQueue = [];\r\n        this._isPulling = false;\r\n        this._storage = createRootStorage(engine.runtime);\r\n        this._appkey = appkey;\r\n        this._currentUserId = currentUserId;\r\n        this._engine = engine;\r\n        this._storagePullTimeKey = `con-s-${appkey}-${currentUserId}`;\r\n    }\r\n    /**\r\n     * , \r\n    */\r\n    _set(list) {\r\n        // todo('ConversationStatus set')\r\n        if (isUndefined(list)) {\r\n            return;\r\n        }\r\n        let localTime = this._storage.get(this._storagePullTimeKey) || 0;\r\n        const listCount = list.length;\r\n        list.forEach((statusItem, index) => {\r\n            const updatedTime = statusItem.updatedTime || 0;\r\n            localTime = updatedTime > localTime ? updatedTime : localTime;\r\n            statusItem.conversationType = statusItem.type;\r\n            this._eventEmitter.emit(EventName.STATUS_CHANGED, {\r\n                statusItem,\r\n                isLastPull: index === listCount - 1\r\n            });\r\n        });\r\n        this._storage.set(this._storagePullTimeKey, localTime);\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    _startPull() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (this._isPulling || this._pullQueue.length === 0) {\r\n                return;\r\n            }\r\n            this._isPulling = true;\r\n            const time = this._pullQueue.splice(0, 1)[0];\r\n            const { code, data } = yield this._engine.pullConversationStatus(time);\r\n            if (code === ErrorCode$1.SUCCESS) {\r\n                this._isPulling = false;\r\n                this._set(data);\r\n                this._startPull();\r\n            }\r\n            else {\r\n                this._startPull();\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    pull(newPullTime) {\r\n        const time = this._storage.get(this._storagePullTimeKey) || 0;\r\n        if (newPullTime > time || newPullTime === 0) {\r\n            // ,\r\n            this._pullQueue.push(time);\r\n            this._startPull();\r\n        }\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    watch(event) {\r\n        this._eventEmitter.on(EventName.STATUS_CHANGED, (data) => {\r\n            event(data);\r\n        });\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    unwatch() {\r\n        this._eventEmitter.off(EventName.STATUS_CHANGED, (data) => { });\r\n    }\r\n}\n\nconst StorageKey2ConversationKey = {\r\n    c: { keyName: 'unreadMessageCount', defaultVal: 0 },\r\n    hm: { keyName: 'hasMentioned', defaultVal: false },\r\n    m: { keyName: 'mentionedInfo', defaultVal: null },\r\n    t: { keyName: 'lastUnreadTime', defaultVal: 0 },\r\n    nc: { keyName: 'notificationStatus', defaultVal: 2 },\r\n    to: { keyName: 'isTop', defaultVal: false }\r\n};\r\nconst ConversationKey2StorageKey = {};\r\nfor (const key in StorageKey2ConversationKey) {\r\n    const keyName = StorageKey2ConversationKey[key].keyName;\r\n    ConversationKey2StorageKey[keyName] = key;\r\n}\r\n/**\r\n *  conversation \r\n * \r\n *  \r\n *   @  \r\n *  @ \r\n *  \r\n *  \r\n * \r\n *  unreadMessageCount\r\n *  hasMentioned\r\n *  mentionedInfo\r\n *  notificationStatus\r\n *  isTop\r\n*/\r\nclass ConversationStore {\r\n    constructor(runtime, _appkey, _currentUserId) {\r\n        this._appkey = _appkey;\r\n        this._currentUserId = _currentUserId;\r\n        const suffix = `con-${_appkey}-${_currentUserId}`;\r\n        this.storage = new AppStorage(runtime, suffix);\r\n    }\r\n    _getStoreKey(type, targetId) {\r\n        return `${type}_${targetId}`;\r\n    }\r\n    _getConOptionByKey(key) {\r\n        key = key || '';\r\n        const arr = key.split('_');\r\n        if (arr.length === 2) {\r\n            return {\r\n                conversationType: arr[0],\r\n                targetId: arr[1]\r\n            };\r\n        }\r\n        else {\r\n            return {\r\n                conversationType: ConversationType$1.PRIVATE,\r\n                targetId: ''\r\n            };\r\n        }\r\n    }\r\n    /**\r\n     *  hasMentioned mentionedInfo \r\n    */\r\n    updateMentionedData(message) {\r\n        const { conversationType, targetId, messageType, isMentioned, content, senderUserId } = message;\r\n        const key = this._getStoreKey(conversationType, targetId);\r\n        const local = this.storage.get(key) || {};\r\n        const storageMetionedInfoKey = ConversationKey2StorageKey.mentionedInfo;\r\n        const storageHasMentionedKey = ConversationKey2StorageKey.hasMentioned;\r\n        let updatedUserIdList = [];\r\n        // let mentionedInfo = {}\r\n        const localMentionedInfo = local[storageMetionedInfoKey] || {};\r\n        const localUserIdList = localMentionedInfo.userIdList || [];\r\n        let mentionedInfo = content.mentionedInfo;\r\n        //  @ ,  @ ,  MentionInfo.userIdList\r\n        if (isMentioned && conversationType === ConversationType$1.GROUP && mentionedInfo.userIdList) {\r\n            const receiveUserIdList = mentionedInfo.userIdList;\r\n            const isNotIncludeSender = localUserIdList.indexOf(senderUserId) < 0;\r\n            receiveUserIdList.forEach(userId => {\r\n                if (userId === this._currentUserId && isNotIncludeSender) {\r\n                    localUserIdList.push(senderUserId);\r\n                }\r\n            });\r\n            if (mentionedInfo.type === MentionedType$1.ALL && isNotIncludeSender) {\r\n                localUserIdList.push(senderUserId);\r\n            }\r\n            updatedUserIdList = localUserIdList;\r\n        }\r\n        //  @ ,  userIdList userIdList  hasMentioned  false\r\n        if (messageType === MessageType$1.RECALL && conversationType === ConversationType$1.GROUP) {\r\n            const list = localUserIdList;\r\n            localUserIdList.forEach((userId, index) => {\r\n                if (userId === senderUserId) {\r\n                    list.splice(index, 1);\r\n                }\r\n            });\r\n            updatedUserIdList = list;\r\n        }\r\n        mentionedInfo = {\r\n            userIdList: updatedUserIdList,\r\n            type: mentionedInfo === null || mentionedInfo === void 0 ? void 0 : mentionedInfo.type\r\n        };\r\n        if (updatedUserIdList.length !== 0) {\r\n            local[storageMetionedInfoKey] = mentionedInfo;\r\n            local[storageHasMentionedKey] = true;\r\n        }\r\n        else {\r\n            delete local[storageMetionedInfoKey];\r\n            delete local[storageHasMentionedKey];\r\n        }\r\n        if (notEmptyObject(local)) {\r\n            this.storage.set(key, local);\r\n        }\r\n        else {\r\n            this.storage.remove(key);\r\n        }\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    set(type, targetId, conversation) {\r\n        const key = this._getStoreKey(type, targetId);\r\n        const local = this.storage.get(key) || {};\r\n        for (const key in conversation) {\r\n            const storageKey = ConversationKey2StorageKey[key];\r\n            const val = conversation[key];\r\n            if (isUndefined(storageKey) || isUndefined(val) || key === 'hasMentioned' || key === 'MentionedInfo') {\r\n                continue;\r\n            }\r\n            const defaultVal = StorageKey2ConversationKey[storageKey].defaultVal;\r\n            if (val === defaultVal) {\r\n                // \r\n                delete local[storageKey];\r\n            }\r\n            else {\r\n                local[storageKey] = val;\r\n            }\r\n            if (!local.c) {\r\n                // \r\n                delete local.t;\r\n            }\r\n        }\r\n        if (notEmptyObject(local)) {\r\n            this.storage.set(key, local);\r\n        }\r\n        else {\r\n            this.storage.remove(key);\r\n        }\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    get(type, targetId) {\r\n        const key = this._getStoreKey(type, targetId);\r\n        const local = this.storage.get(key) || {};\r\n        const conversation = {};\r\n        for (const key in StorageKey2ConversationKey) {\r\n            const { keyName, defaultVal } = StorageKey2ConversationKey[key];\r\n            conversation[keyName] = local[key] || defaultVal;\r\n        }\r\n        return conversation;\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    getValue(func) {\r\n        const values = this.storage.getValues() || {};\r\n        const storageConversationList = [];\r\n        for (const key in values) {\r\n            const { conversationType, targetId } = this._getConOptionByKey(key);\r\n            let conversation = {};\r\n            const store = values[key];\r\n            for (const storeKey in store) {\r\n                const { keyName, defaultVal } = StorageKey2ConversationKey[storeKey];\r\n                conversation[keyName] = store[storeKey] || defaultVal;\r\n            }\r\n            conversation = Object.assign(conversation, {\r\n                conversationType,\r\n                targetId\r\n            });\r\n            conversation = func ? func(conversation) : conversation;\r\n            storageConversationList.push(conversation);\r\n        }\r\n        return storageConversationList;\r\n    }\r\n}\n\nconst saveConversationType = [ConversationType$1.PRIVATE, ConversationType$1.GROUP, ConversationType$1.SYSTEM];\r\nconst EventName$1 = {\r\n    CHANGED: 'conversationChanged'\r\n};\r\nclass ConversationManager {\r\n    constructor(engine, appkey, userId, updatedConversationFunc) {\r\n        this._updatedConversations = {};\r\n        this._eventEmitter = new EventDispatcher();\r\n        this._draftMap = {};\r\n        this._appkey = appkey;\r\n        this._loginUserId = userId;\r\n        this._store = new ConversationStore(engine.runtime, appkey, userId);\r\n        this._statusManager = new ConversationStatus(engine, appkey, userId);\r\n        this._statusManager.watch((data) => {\r\n            const { statusItem, isLastPull } = data;\r\n            this.addStatus(statusItem, isLastPull);\r\n        });\r\n        this._eventEmitter.on(EventName$1.CHANGED, (data) => {\r\n            updatedConversationFunc(data);\r\n        });\r\n    }\r\n    /**\r\n     *  localConversation   \r\n    */\r\n    _calcUnreadCount(message, localConversation) {\r\n        const { content, messageType, sentTime, isCounted, messageDirection, senderUserId } = message;\r\n        const isSelfSend = messageDirection === MessageDirection$1.SEND && senderUserId === this._loginUserId;\r\n        const isRecall = messageType === MessageType$1.RECALL;\r\n        const hasContent = isObject(content);\r\n        let hasChanged = false;\r\n        const lastUnreadTime = localConversation.lastUnreadTime || 0;\r\n        const unreadMessageCount = localConversation.unreadMessageCount || 0;\r\n        const hasBeenAdded = lastUnreadTime > sentTime;\r\n        //  \r\n        if (hasBeenAdded || isSelfSend) {\r\n            return { hasChanged, localConversation };\r\n        }\r\n        //  + 1\r\n        if (isCounted) {\r\n            localConversation.unreadMessageCount = unreadMessageCount + 1;\r\n            localConversation.lastUnreadTime = sentTime;\r\n            hasChanged = true;\r\n        }\r\n        //     content: {conversationType, targetId, messageUId, sentTime} \r\n        if (isRecall && hasContent) {\r\n            const isNotRead = lastUnreadTime >= content.sentTime;\r\n            if (isNotRead && unreadMessageCount) {\r\n                localConversation.unreadMessageCount = unreadMessageCount - 1;\r\n                hasChanged = true;\r\n            }\r\n        }\r\n        return { hasChanged, localConversation };\r\n    }\r\n    /**\r\n     *  localConversation    mentionedInfo\r\n    */\r\n    _calcMentionedInfo(message, localConversation) {\r\n        const { content, messageDirection, isMentioned } = message;\r\n        const isSelfSend = messageDirection === MessageDirection$1.SEND;\r\n        const hasContent = isObject(content);\r\n        let hasChanged = false;\r\n        if (isMentioned && hasContent && content.mentionedInfo) {\r\n            localConversation.hasMentioned = true;\r\n            localConversation.mentionedInfo = content.mentionedInfo;\r\n            hasChanged = true;\r\n        }\r\n        return { hasChanged, localConversation };\r\n    }\r\n    /**\r\n     *  updatedConversation \r\n    */\r\n    _setUpdatedConversation(updatedConOptions) {\r\n        if (isObject(updatedConOptions)) {\r\n            const { conversationType, targetId } = updatedConOptions;\r\n            const key = `${conversationType}_${targetId}`;\r\n            const cacheConversation = this._store.get(conversationType, targetId) || {};\r\n            this._updatedConversations[key] = Object.assign(cacheConversation, updatedConOptions);\r\n        }\r\n    }\r\n    addStatus(statusItem, isLastPull) {\r\n        const { conversationType, targetId, updatedTime, notificationStatus, isTop } = statusItem;\r\n        const updatedItems = {};\r\n        if (!isUndefined(notificationStatus)) {\r\n            updatedItems.notificationStatus = { time: updatedTime, val: notificationStatus };\r\n        }\r\n        if (!isUndefined(isTop)) {\r\n            updatedItems.isTop = { time: updatedTime, val: isTop };\r\n        }\r\n        this._store.set(conversationType, targetId, {\r\n            notificationStatus,\r\n            isTop\r\n        });\r\n        this._setUpdatedConversation({\r\n            conversationType,\r\n            targetId,\r\n            updatedItems\r\n        });\r\n        if (isLastPull) {\r\n            this._notifyConversationChanged();\r\n        }\r\n    }\r\n    /**\r\n     * \r\n     * @description\r\n     * :  @ hasMentionedmentionedInfo\r\n    */\r\n    _notifyConversationChanged() {\r\n        const list = [];\r\n        for (const key in this._updatedConversations) {\r\n            list.push(this._updatedConversations[key]);\r\n        }\r\n        this._eventEmitter.emit(EventName$1.CHANGED, list);\r\n        this._updatedConversations = {};\r\n    }\r\n    /**\r\n     *  localstorage  @  hasMentionedMentionedInfo   \r\n     * @description\r\n     * 1 2 3\r\n    */\r\n    setConversationCacheByMessage(message, isPullMessageFinished) {\r\n        // (: ), \r\n        const { conversationType, isPersited, targetId } = message;\r\n        const isSaveConversationType = saveConversationType.indexOf(conversationType) >= 0;\r\n        if (!isSaveConversationType) {\r\n            return;\r\n        }\r\n        let hasChanged = false;\r\n        let storageConversation = this._store.get(conversationType, targetId);\r\n        // \r\n        const CalcEvents = [this._calcUnreadCount, this._calcMentionedInfo];\r\n        CalcEvents.forEach((func) => {\r\n            const { hasChanged: hasCaclChanged, localConversation } = func.call(this, message, storageConversation);\r\n            hasChanged = hasChanged || hasCaclChanged;\r\n            storageConversation = localConversation;\r\n        });\r\n        if (hasChanged) {\r\n            this._store.set(conversationType, targetId, storageConversation);\r\n        }\r\n        this._store.updateMentionedData(message);\r\n        // \r\n        if (isPersited) {\r\n            const conversation = this._store.get(conversationType, targetId);\r\n            conversation.updatedItems = {\r\n                latestMessage: {\r\n                    time: message.sentTime,\r\n                    val: message\r\n                }\r\n            };\r\n            conversation.latestMessage = message;\r\n            const updateConOptions = Object.assign(conversation, { conversationType, targetId });\r\n            this._setUpdatedConversation(updateConOptions);\r\n        }\r\n        //   API Context \r\n        if (isPullMessageFinished) {\r\n            this._notifyConversationChanged();\r\n        }\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    get(conversationType, targetId) {\r\n        return this._store.get(conversationType, targetId);\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    getAllUnreadCount() {\r\n        const conversationList = this._store.getValue();\r\n        let totalCount = 0;\r\n        conversationList.forEach(({ unreadMessageCount }) => {\r\n            unreadMessageCount = unreadMessageCount || 0;\r\n            totalCount += Number(unreadMessageCount);\r\n        });\r\n        return totalCount;\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    getUnreadCount(conversationType, targetId) {\r\n        const conversation = this._store.get(conversationType, targetId);\r\n        return conversation.unreadMessageCount || 0;\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    clearUnreadCount(conversationType, targetId) {\r\n        const conversation = this._store.get(conversationType, targetId);\r\n        const { unreadMessageCount, hasMentioned } = conversation;\r\n        if (unreadMessageCount || hasMentioned) {\r\n            conversation.unreadMessageCount = 0;\r\n            conversation.hasMentioned = false;\r\n            // conversation.mentionedInfo = null\r\n        }\r\n        this._store.set(conversationType, targetId, conversation);\r\n        const updateConOptions = Object.assign(conversation, { conversationType, targetId });\r\n        this._setUpdatedConversation(updateConOptions);\r\n        this._notifyConversationChanged();\r\n    }\r\n    startPullConversationStatus(time) {\r\n        this._statusManager.pull(time);\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    setDraft(conversationType, targetId, draft) {\r\n        const key = `${conversationType}_${targetId}`;\r\n        this._draftMap[key] = draft;\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    getDraft(conversationType, targetId) {\r\n        const key = `${conversationType}_${targetId}`;\r\n        return this._draftMap[key];\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    clearDraft(conversationType, targetId) {\r\n        const key = `${conversationType}_${targetId}`;\r\n        delete this._draftMap[key];\r\n    }\r\n}\n\nconst getPubTopic = (type) => {\r\n    return {\r\n        [ConversationType$1.PRIVATE]: Topic$1.ppMsgP,\r\n        [ConversationType$1.GROUP]: Topic$1.pgMsgP,\r\n        [ConversationType$1.CHATROOM]: Topic$1.chatMsg,\r\n        [ConversationType$1.CUSTOMER_SERVICE]: Topic$1.pcMsgP,\r\n        [ConversationType$1.RTC_ROOM]: Topic$1.prMsgS\r\n    }[type];\r\n};\r\nconst getStatPubTopic = (type) => {\r\n    return {\r\n        [ConversationType$1.PRIVATE]: Topic$1.ppMsgS,\r\n        [ConversationType$1.GROUP]: Topic$1.pgMsgS\r\n    }[type];\r\n};\r\nconst transSentAttrs2IReceivedMessage = (conversationType, targetId, options, messageUId, sentTime, senderUserId) => {\r\n    return {\r\n        conversationType,\r\n        targetId,\r\n        senderUserId,\r\n        messageDirection: MessageDirection$1.SEND,\r\n        isCounted: !!options.isCounted,\r\n        isMentioned: !!options.isMentioned,\r\n        content: options.content,\r\n        messageType: options.messageType,\r\n        isOffLineMessage: false,\r\n        isPersited: !!options.isPersited,\r\n        messageUId,\r\n        sentTime,\r\n        receivedTime: 0,\r\n        disableNotification: !!options.disableNotification,\r\n        isStatusMessage: !!options.isStatusMessage,\r\n        canIncludeExpansion: !!options.canIncludeExpansion,\r\n        expansion: options.canIncludeExpansion ? options.expansion : null,\r\n        receivedStatus: ReceivedStatus$1.UNREAD //   \r\n    };\r\n};\r\nclass JSEngine extends AEngine {\r\n    constructor(runtime, appkey, watcher, apiVersion) {\r\n        super(runtime, appkey, watcher, apiVersion);\r\n        this._customMessageType = {};\r\n        /**\r\n         * \r\n         */\r\n        this._pullingMsg = false;\r\n        /**\r\n         * \r\n         */\r\n        this._pullQueue = [];\r\n        /**\r\n         * \r\n         */\r\n        this._chrmsQueue = {};\r\n        // \r\n        this._letterbox = new Letterbox(runtime, appkey);\r\n        //  Chrm KV \r\n        this._chrmEntryHandler = new ChrmEntryHandler(this);\r\n    }\r\n    connect(token, naviInfo, connectType) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const hosts = [];\r\n            this._naviInfo = naviInfo;\r\n            if (naviInfo.server) {\r\n                hosts.push(naviInfo.server);\r\n            }\r\n            else {\r\n                //  Navi \r\n                logger.warn('navi.server is invalid');\r\n            }\r\n            const backupServer = naviInfo.backupServer;\r\n            // \r\n            backupServer && backupServer.split(',').forEach(host => {\r\n                if (hosts.indexOf(host) < 0) {\r\n                    hosts.push(host);\r\n                }\r\n            });\r\n            if (hosts.length === 0) {\r\n                logger.error('navi invaild.', hosts);\r\n                return ErrorCode$1.UNKNOWN;\r\n            }\r\n            // \r\n            const channel = this.runtime.createDataChannel({\r\n                status: (status) => {\r\n                    this._connectionStatusHandler(status, token, hosts, naviInfo.protocol);\r\n                },\r\n                signal: this._signalHandler.bind(this)\r\n            }, connectType);\r\n            // \r\n            const code = yield channel.connect(this._appkey, token, hosts, naviInfo.protocol, this._apiVersion);\r\n            if (code === ErrorCode$1.SUCCESS) {\r\n                this._channel = channel;\r\n                this.currentUserId = channel.userId;\r\n                this.connectedTime = channel.connectedTime;\r\n                this._conversationManager = new ConversationManager(this, this._appkey, this.currentUserId, this._watcher.conversation);\r\n                this._conversationManager.startPullConversationStatus(0);\r\n                //  chrm \r\n                this._joinedChrmManager = new JoinedChrmManager(this.runtime, this._appkey, this.currentUserId, naviInfo.joinMChrm);\r\n                // \r\n                this._syncMsg();\r\n            }\r\n            else {\r\n                channel.close();\r\n            }\r\n            return code;\r\n        });\r\n    }\r\n    _connectionStatusHandler(status, token, hosts, protocol) {\r\n        logger.warn('connection status changed:', status);\r\n        if (status === ConnectionStatus$1.CONNECTING || status === ConnectionStatus$1.CONNECTED) {\r\n            this._watcher.status(status);\r\n            return;\r\n        }\r\n        if (!this._channel || status === ConnectionStatus$1.DISCONNECTED) {\r\n            // \r\n            this._watcher.status(status);\r\n            return;\r\n        }\r\n        if (status === ConnectionStatus$1.BLOCKED || status === ConnectionStatus$1.KICKED_OFFLINE_BY_OTHER_CLIENT) {\r\n            //  websocket \r\n            this.disconnect();\r\n            this._watcher.status(status);\r\n            return;\r\n        }\r\n        // \r\n        this._try2Reconnect(token, hosts, protocol);\r\n    }\r\n    _try2Reconnect(token, hosts, protocol) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._channel) {\r\n                return;\r\n            }\r\n            const code = yield this._channel.connect(this._appkey, token, hosts, protocol, this._apiVersion);\r\n            if (code === ErrorCode$1.SUCCESS) {\r\n                this._rejoinChrm();\r\n                return;\r\n            }\r\n            this._watcher.status(ConnectionStatus$1.WEBSOCKET_UNAVAILABLE);\r\n            //  5s \r\n            setTimeout(() => {\r\n                this._try2Reconnect(token, hosts, protocol);\r\n            }, 5000);\r\n        });\r\n    }\r\n    _signalHandler(signal, ack) {\r\n        const { syncMsg, topic } = signal;\r\n        if (syncMsg) {\r\n            // \r\n            this._receiveSyncMsg(signal, ack);\r\n            return;\r\n        }\r\n        const tmpTopic = Topic$1[topic];\r\n        if (!tmpTopic) {\r\n            logger.error('unknown topic:', topic);\r\n            return;\r\n        }\r\n        switch (tmpTopic) {\r\n            case Topic$1.s_ntf:\r\n                this._pullMsg(signal); // \r\n                break;\r\n            case Topic$1.s_msg:\r\n                this._receiveMsg(signal); // \r\n                break;\r\n            case Topic$1.s_cmd:\r\n                this._receiveStateNotify(signal);\r\n                break;\r\n            case Topic$1.s_us:\r\n                this._receiveSettingNotify(signal);\r\n                break;\r\n        }\r\n    }\r\n    /**\r\n     *  kv \r\n     * @param signal\r\n     */\r\n    _receiveStateNotify(signal) {\r\n        var _a;\r\n        const { time, type, chrmId } = (_a = this._channel) === null || _a === void 0 ? void 0 : _a.codec.decodeByPBName(signal.data, PBName.NotifyMsg);\r\n        switch (type) {\r\n            case 2:\r\n                logger.warn('server notify chrm:', chrmId, time);\r\n                this._chrmEntryHandler.pullEntry(chrmId, time);\r\n                break;\r\n            case 3:\r\n                this._conversationManager.startPullConversationStatus(time);\r\n                break;\r\n        }\r\n    }\r\n    /**\r\n     * \r\n     * @param signal\r\n     */\r\n    _receiveSettingNotify(signal) {\r\n        //  comet \r\n        // const notice = this._channel?.codec.decodeByPBName(signal.data, PBName.UserSettingNotification)\r\n        // logger.error('TODO: ', notice)\r\n    }\r\n    /**\r\n     *  API Content \r\n    */\r\n    _receiveMessageExpansion(message) {\r\n        const { content } = message;\r\n        const { put, del, mid } = content;\r\n        if (put) {\r\n            this._watcher.expansion({\r\n                updatedExpansion: {\r\n                    messageUId: mid,\r\n                    expansion: put\r\n                }\r\n            });\r\n        }\r\n        if (del) {\r\n            this._watcher.expansion({\r\n                deletedExpansion: {\r\n                    messageUId: mid,\r\n                    deletedKeys: del\r\n                }\r\n            });\r\n        }\r\n    }\r\n    /**\r\n     * \r\n     * @param signal\r\n     * @param ack  ack comet \r\n     */\r\n    _receiveSyncMsg(signal, ack) {\r\n        var _a;\r\n        let msg = (_a = this._channel) === null || _a === void 0 ? void 0 : _a.codec.decodeByPBName(signal.data, PBName.UpStreamMessage, {\r\n            currentUserId: this.currentUserId, signal\r\n        });\r\n        msg = this._handleMsgProperties(msg);\r\n        // \r\n        msg.sentTime = ack.timestamp;\r\n        msg.messageUId = ack.messageUId;\r\n        // \r\n        if (this._pullingMsg) {\r\n            this._pullQueue.push(ack.timestamp);\r\n            return;\r\n        }\r\n        // \r\n        this._letterbox.setOutboxTime(ack.timestamp, this.currentUserId);\r\n        if (msg.messageType === MessageType$1.EXPANSION_NOTIFY) {\r\n            this._receiveMessageExpansion(msg);\r\n            return;\r\n        }\r\n        this._watcher.message(msg);\r\n        this._conversationManager.setConversationCacheByMessage(msg, true);\r\n    }\r\n    /**\r\n     * \r\n     * @description \r\n     * @param signal\r\n     */\r\n    _pullMsg(signal) {\r\n        if (!this._channel) {\r\n            return;\r\n        }\r\n        const { type, chrmId, time } = this._channel.codec.decodeByPBName(signal.data, PBName.NotifyMsg);\r\n        if (type === 2) {\r\n            const info = this._chrmsQueue[chrmId];\r\n            info.queue.push(time);\r\n            this._pullChrmMsg(chrmId);\r\n        }\r\n        else {\r\n            // \r\n            this._pullQueue.push(time);\r\n            this._syncMsg();\r\n        }\r\n    }\r\n    /**\r\n     *  Or \r\n     */\r\n    _syncMsg() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            // \r\n            if (this._pullingMsg) {\r\n                return;\r\n            }\r\n            if (!this._channel) {\r\n                // \r\n                this._pullingMsg = false;\r\n                return;\r\n            }\r\n            this._pullingMsg = true;\r\n            // \r\n            const outboxTime = this._letterbox.getOutboxTime(this.currentUserId);\r\n            const inboxTime = this._letterbox.getInboxTime(this.currentUserId);\r\n            logger.warn('outboxTime', outboxTime);\r\n            logger.warn('inboxTime', inboxTime);\r\n            const reqBody = this._channel.codec.encodeSyncMsg({ sendboxTime: outboxTime, inboxTime });\r\n            const writer = new QueryWriter(Topic$1[Topic$1.pullMsg], reqBody, this.currentUserId);\r\n            const { code, data } = yield this._channel.send(writer, PBName.DownStreamMessages, {\r\n                connectedTime: this._channel.connectedTime,\r\n                currentUserId: this.currentUserId\r\n            });\r\n            if (code !== ErrorCode$1.SUCCESS || !data) {\r\n                logger.warn('Pull msg failed, code:', code, ', data: ', data);\r\n                this._pullingMsg = false;\r\n                return;\r\n            }\r\n            const { list, finished, syncTime } = data;\r\n            let newOutboxTime = 0;\r\n            // let newInboxTime = 0\r\n            // \r\n            list.forEach(item => {\r\n                if (item.messageDirection === MessageDirection$1.SEND) {\r\n                    newOutboxTime = Math.max(item.sentTime, newOutboxTime);\r\n                }\r\n                // else {\r\n                //   newInboxTime = Math.max(item.sentTime, newInboxTime)\r\n                // }\r\n                if (item.messageType === MessageType$1.EXPANSION_NOTIFY) {\r\n                    this._receiveMessageExpansion(item);\r\n                    return;\r\n                }\r\n                this._watcher.message(item);\r\n                this._conversationManager.setConversationCacheByMessage(item, true);\r\n            });\r\n            // \r\n            // this.letterbox.setInboxTime(newInboxTime, this.currentUserId)\r\n            this._letterbox.setInboxTime(syncTime, this.currentUserId);\r\n            // \r\n            this._letterbox.setOutboxTime(newOutboxTime, this.currentUserId);\r\n            this._pullingMsg = false;\r\n            //  syncTime \r\n            const tmpPullQueue = this._pullQueue.filter(timestamp => timestamp > syncTime);\r\n            this._pullQueue.length = 0;\r\n            this._pullQueue.push(...tmpPullQueue);\r\n            if (!finished || tmpPullQueue.length > 0) {\r\n                // \r\n                this._syncMsg();\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * \r\n     * @description \r\n     * @param signal\r\n     */\r\n    _receiveMsg(signal) {\r\n        if (!this._channel) {\r\n            return;\r\n        }\r\n        let msg = this._channel.codec.decodeByPBName(signal.data, PBName.DownStreamMessage, {\r\n            currentUserId: this.currentUserId, connectedTime: this._channel.connectedTime\r\n        });\r\n        msg = this._handleMsgProperties(msg);\r\n        // \r\n        if (this._pullingMsg) {\r\n            return;\r\n        }\r\n        // \r\n        this._letterbox.setInboxTime(msg.sentTime, this.currentUserId);\r\n        if (msg.messageType === MessageType$1.EXPANSION_NOTIFY) {\r\n            this._receiveMessageExpansion(msg);\r\n            return;\r\n        }\r\n        this._watcher.message(msg);\r\n        this._conversationManager.setConversationCacheByMessage(msg, true);\r\n    }\r\n    /**\r\n     *  API Context \r\n     * @description\r\n     * \r\n    */\r\n    _handleMsgProperties(msgOptions, isSendMsg = false) {\r\n        const { messageType, isCounted, isPersited, isStatusMessage } = msgOptions;\r\n        let options;\r\n        const inRCMessageType = messageType in SEND_MESSAGE_TYPE_OPTION;\r\n        const inCustomMessageType = messageType in this._customMessageType;\r\n        if (inRCMessageType) { // \r\n            options = SEND_MESSAGE_TYPE_OPTION[messageType];\r\n        }\r\n        else if (inCustomMessageType) { // \r\n            options = this._customMessageType[messageType];\r\n        }\r\n        else { // , ,  false. \r\n            options = {\r\n                isCounted: isNull(isCounted) ? false : isCounted,\r\n                isPersited: isNull(isPersited) ? false : isPersited\r\n            };\r\n        }\r\n        Object.assign(msgOptions, {\r\n            isCounted: options.isCounted,\r\n            isPersited: options.isPersited,\r\n            isStatusMessage: !(msgOptions.isCounted && msgOptions.isPersited)\r\n        });\r\n        isSendMsg && (msgOptions.isStatusMessage = isStatusMessage);\r\n        return msgOptions;\r\n    }\r\n    getConnectTime() {\r\n        if (this._channel) {\r\n            return Promise.resolve({\r\n                code: ErrorCode$1.SUCCESS,\r\n                data: this._channel.connectedTime\r\n            });\r\n        }\r\n        return Promise.resolve({ code: ErrorCode$1.RC_NET_CHANNEL_INVALID });\r\n    }\r\n    getHistoryMessage(conversationType, targetId, timestamp, count, order) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const { currentUserId, _channel: channel } = this;\r\n            const hisTopic = ConversationTypeToQueryHistoryTopic[conversationType] || QueryHistoryTopic.PRIVATE;\r\n            if (channel) {\r\n                const data = channel.codec.encodeGetHistoryMsg(targetId, { timestamp, count, order });\r\n                const resp = yield channel.send(new QueryWriter(hisTopic, data, currentUserId), PBName.HistoryMsgOuput, {\r\n                    currentUserId, connectedTime: channel.connectedTime, conversation: { targetId }\r\n                });\r\n                const { code } = resp;\r\n                if (code !== ErrorCode$1.SUCCESS) {\r\n                    return { code };\r\n                }\r\n                // \r\n                const downstreamData = resp.data;\r\n                return {\r\n                    code,\r\n                    data: { list: downstreamData.list, hasMore: downstreamData.hasMore }\r\n                };\r\n            }\r\n            return { code: ErrorCode$1.RC_NET_CHANNEL_INVALID };\r\n        });\r\n    }\r\n    deleteRemoteMessage(conversationType, targetId, list) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const { currentUserId, _channel: channel } = this;\r\n            if (channel) {\r\n                const data = channel.codec.encodeDeleteMessages(conversationType, targetId, list);\r\n                const writer = new QueryWriter(QueryTopic.DELETE_MESSAGES, data, currentUserId);\r\n                const resp = yield channel.send(writer);\r\n                const { code } = resp;\r\n                if (code !== ErrorCode$1.SUCCESS) {\r\n                    return code;\r\n                }\r\n                return code;\r\n            }\r\n            return ErrorCode$1.RC_NET_CHANNEL_INVALID;\r\n        });\r\n    }\r\n    deleteRemoteMessageByTimestamp(conversationType, targetId, timestamp) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const { currentUserId, _channel: channel } = this;\r\n            if (channel) {\r\n                const data = channel.codec.encodeClearMessages(targetId, timestamp);\r\n                const topic = ConversationTypeToClearMessageTopic[conversationType];\r\n                const writer = new QueryWriter(topic, data, currentUserId);\r\n                const resp = yield channel.send(writer);\r\n                const { code } = resp;\r\n                if (code !== ErrorCode$1.SUCCESS) {\r\n                    return code;\r\n                }\r\n                return code;\r\n            }\r\n            return ErrorCode$1.RC_NET_CHANNEL_INVALID;\r\n        });\r\n    }\r\n    getConversationList(count = 300, conversationType, startTime, order) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const { currentUserId, _channel: channel } = this;\r\n            conversationType = conversationType || ConversationType$1.PRIVATE;\r\n            if (channel) {\r\n                const buff = channel.codec.encodeOldConversationList({ count, type: conversationType, startTime, order });\r\n                const writer = new QueryWriter(QueryTopic.GET_OLD_CONVERSATION_LIST, buff, currentUserId);\r\n                const resp = yield channel.send(writer, PBName.RelationsOutput, {\r\n                    currentUserId,\r\n                    connectedTime: channel.connectedTime,\r\n                    afterDecode: (conversation) => {\r\n                        const { conversationType, targetId } = conversation;\r\n                        const localConversation = this._conversationManager.get(conversationType, targetId);\r\n                        //  Server \r\n                        Object.assign(conversation, localConversation);\r\n                        return conversation;\r\n                    }\r\n                });\r\n                logger.info('GetConversationList =>', resp);\r\n                const { code, data } = resp;\r\n                if (code !== ErrorCode$1.SUCCESS) {\r\n                    return { code };\r\n                }\r\n                return {\r\n                    code,\r\n                    data: data\r\n                };\r\n            }\r\n            return { code: ErrorCode$1.RC_NET_CHANNEL_INVALID };\r\n        });\r\n    }\r\n    removeConversation(conversationType, targetId) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const { _channel: channel } = this;\r\n            if (channel) {\r\n                const data = channel.codec.encodeOldConversationList({ type: conversationType });\r\n                const writer = new QueryWriter(QueryTopic.REMOVE_OLD_CONVERSATION, data, targetId);\r\n                const resp = yield channel.send(writer);\r\n                logger.info('RemoveConversation =>', resp);\r\n                const { code } = resp;\r\n                if (code !== ErrorCode$1.SUCCESS) {\r\n                    return code;\r\n                }\r\n                return code;\r\n            }\r\n            return ErrorCode$1.RC_NET_CHANNEL_INVALID;\r\n        });\r\n    }\r\n    getConversation(conversationType, targetId) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    getAllConversationUnreadCount() {\r\n        const allUnreadCount = this._conversationManager.getAllUnreadCount();\r\n        return Promise.resolve({\r\n            code: ErrorCode$1.SUCCESS,\r\n            data: allUnreadCount\r\n        });\r\n    }\r\n    getConversationUnreadCount(conversationType, targetId) {\r\n        const unreadCount = this._conversationManager.getUnreadCount(conversationType, targetId);\r\n        return Promise.resolve({\r\n            code: ErrorCode$1.SUCCESS,\r\n            data: unreadCount\r\n        });\r\n    }\r\n    clearConversationUnreadCount(conversationType, targetId) {\r\n        this._conversationManager.clearUnreadCount(conversationType, targetId);\r\n        return Promise.resolve(ErrorCode$1.SUCCESS);\r\n    }\r\n    saveConversationMessageDraft(conversationType, targetId, draft) {\r\n        this._conversationManager.setDraft(conversationType, targetId, draft);\r\n        return Promise.resolve(ErrorCode$1.SUCCESS);\r\n    }\r\n    getConversationMessageDraft(conversationType, targetId) {\r\n        const draft = this._conversationManager.getDraft(conversationType, targetId);\r\n        return Promise.resolve({\r\n            code: ErrorCode$1.SUCCESS,\r\n            data: draft\r\n        });\r\n    }\r\n    clearConversationMessageDraft(conversationType, targetId) {\r\n        this._conversationManager.clearDraft(conversationType, targetId);\r\n        return Promise.resolve(ErrorCode$1.SUCCESS);\r\n    }\r\n    pullConversationStatus(timestamp) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const { _channel: channel, currentUserId } = this;\r\n            if (channel) {\r\n                const buff = channel.codec.encodeGetConversationStatus(timestamp);\r\n                const writer = new QueryWriter(Topic$1[Topic$1.pullSeAtts], buff, currentUserId);\r\n                const resp = yield channel.send(writer, PBName.SessionStates);\r\n                const { code, data } = resp;\r\n                if (code !== ErrorCode$1.SUCCESS) {\r\n                    return { code };\r\n                }\r\n                return { code, data: data };\r\n            }\r\n            return { code: ErrorCode$1.RC_NET_CHANNEL_INVALID };\r\n        });\r\n    }\r\n    batchSetConversationStatus(statusList) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const { currentUserId, _channel: channel } = this;\r\n            if (channel) {\r\n                const buff = channel.codec.encodeSetConversationStatus(statusList);\r\n                const writer = new QueryWriter(QueryTopic.SET_CONVERSATION_STATUS, buff, currentUserId);\r\n                const resp = yield channel.send(writer, PBName.SessionStateModifyResp);\r\n                const { code, data } = resp;\r\n                if (code === ErrorCode$1.SUCCESS) {\r\n                    const versionData = data;\r\n                    statusList.forEach((item) => {\r\n                        this._conversationManager.addStatus(Object.assign(Object.assign({}, item), { updatedTime: versionData.version }), true);\r\n                    });\r\n                    return code;\r\n                }\r\n                return code;\r\n            }\r\n            return ErrorCode$1.RC_NET_CHANNEL_INVALID;\r\n        });\r\n    }\r\n    _joinChrm(chrmId, count, isJoinExist) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const { _channel: channel } = this;\r\n            if (!channel)\r\n                return ErrorCode$1.RC_NET_CHANNEL_INVALID;\r\n            const buff = channel.codec.encodeJoinOrQuitChatRoom();\r\n            const topic = isJoinExist ? QueryTopic.JOIN_EXIST_CHATROOM : QueryTopic.JOIN_CHATROOM;\r\n            const writer = new QueryWriter(topic, buff, chrmId);\r\n            const { code, data } = yield channel.send(writer);\r\n            // , \r\n            if (code === ErrorCode$1.SUCCESS) {\r\n                const info = this._chrmsQueue[chrmId];\r\n                // \r\n                if (!info) {\r\n                    this._chrmsQueue[chrmId] = { pulling: false, queue: [], timestamp: 0 };\r\n                }\r\n                this._pullChrmMsg(chrmId, count);\r\n                //  KV ,  KV \r\n                const { kvStorage: isOpenKVService } = this._naviInfo;\r\n                if (isOpenKVService) {\r\n                    this._chrmEntryHandler.pullEntry(chrmId, 0);\r\n                }\r\n                // sessionStorage \r\n                this._joinedChrmManager.set(chrmId, count);\r\n            }\r\n            return code;\r\n        });\r\n    }\r\n    /**\r\n     *  sessionStorage \r\n    */\r\n    _rejoinChrm() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const joinedChrms = this._joinedChrmManager.get();\r\n            for (const chrmId in joinedChrms) {\r\n                const code = yield this._joinChrm(chrmId, joinedChrms[chrmId], true);\r\n                if (code === ErrorCode$1.SUCCESS) {\r\n                    this._watcher.chatroom({\r\n                        rejoinedRoom: {\r\n                            chatroomId: chrmId,\r\n                            count: joinedChrms[chrmId]\r\n                        }\r\n                    });\r\n                }\r\n                else {\r\n                    this._watcher.chatroom({\r\n                        rejoinedRoom: {\r\n                            chatroomId: chrmId,\r\n                            errorCode: code\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * \r\n     * @param chrmId\r\n     * @param count  10  50 \r\n     */\r\n    _pullChrmMsg(chrmId, count = 10) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._channel) {\r\n                return;\r\n            }\r\n            const chrmInfo = this._chrmsQueue[chrmId];\r\n            const { pulling, timestamp } = chrmInfo;\r\n            if (pulling) {\r\n                return;\r\n            }\r\n            const reqBody = this._channel.codec.encodeChrmSyncMsg(timestamp, count);\r\n            const signal = new QueryWriter(Topic$1[Topic$1.chrmPull], reqBody, chrmId);\r\n            const { code, data } = yield this._channel.send(signal, PBName.DownStreamMessages, {\r\n                connectedTime: this._channel.connectedTime,\r\n                currentUserId: this.currentUserId\r\n            });\r\n            if (code !== ErrorCode$1.SUCCESS || !data) {\r\n                logger.warn('pull chatroom msg failed, code:', code, ', data:', data);\r\n                return;\r\n            }\r\n            const { list, syncTime, finished } = data;\r\n            chrmInfo.timestamp = syncTime;\r\n            chrmInfo.pulling = false;\r\n            // \r\n            chrmInfo.queue = chrmInfo.queue.filter(item => item > timestamp);\r\n            // \r\n            list.forEach(item => {\r\n                if (item.sentTime < timestamp) {\r\n                    return;\r\n                }\r\n                this._watcher.message(item);\r\n            });\r\n            if (!finished || chrmInfo.queue.length > 0) {\r\n                this._pullChrmMsg(chrmId);\r\n            }\r\n        });\r\n    }\r\n    joinChatroom(chatroomId, count) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            return this._joinChrm(chatroomId, count, false);\r\n        });\r\n    }\r\n    joinExistChatroom(chatroomId, count) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            return this._joinChrm(chatroomId, count, true);\r\n        });\r\n    }\r\n    quitChatroom(chrmId) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const { _channel: channel } = this;\r\n            if (!channel) {\r\n                return ErrorCode$1.RC_NET_CHANNEL_INVALID;\r\n            }\r\n            const buff = channel.codec.encodeJoinOrQuitChatRoom();\r\n            const writer = new QueryWriter(QueryTopic.QUIT_CHATROOM, buff, chrmId);\r\n            const resp = yield channel.send(writer);\r\n            const { code } = resp;\r\n            if (code === ErrorCode$1.SUCCESS) {\r\n                delete this._chrmsQueue[chrmId];\r\n                this._chrmEntryHandler.reset(chrmId);\r\n                // \r\n                this._joinedChrmManager.remove(chrmId);\r\n            }\r\n            return code;\r\n        });\r\n    }\r\n    getChatroomInfo(chatroomId, count, order) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const { _channel: channel } = this;\r\n            if (!channel)\r\n                return { code: ErrorCode$1.RC_NET_CHANNEL_INVALID };\r\n            const buff = channel.codec.encodeGetChatRoomInfo(count, order);\r\n            const writer = new QueryWriter(Topic$1[Topic$1.queryChrmI], buff, chatroomId);\r\n            const resp = yield channel.send(writer, PBName.QueryChatRoomInfoOutput);\r\n            const { code, data } = resp;\r\n            if (code !== ErrorCode$1.SUCCESS)\r\n                return { code };\r\n            return { code, data: data };\r\n        });\r\n    }\r\n    getChatroomHistoryMessages(chatroomId, timestamp, count, order) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const { _channel: channel } = this;\r\n            if (!channel) {\r\n                return { code: ErrorCode$1.RC_NET_CHANNEL_INVALID };\r\n            }\r\n            const buff = channel.codec.encodeGetHistoryMsg(chatroomId, { timestamp, count, order });\r\n            const writer = new QueryWriter(QueryHistoryTopic.CHATROOM, buff, chatroomId);\r\n            const resp = yield channel.send(writer, PBName.HistoryMsgOuput, {\r\n                conversation: { targetId: chatroomId }\r\n            });\r\n            const { code } = resp;\r\n            const data = resp.data;\r\n            if (code !== ErrorCode$1.SUCCESS)\r\n                return { code };\r\n            return { code, data: { list: data.list, hasMore: data.hasMore } };\r\n        });\r\n    }\r\n    _modifyChatroomKV(chatroomId, entry) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const { _channel: channel, currentUserId } = this;\r\n            if (!channel)\r\n                return ErrorCode$1.RC_NET_CHANNEL_INVALID;\r\n            const buff = channel.codec.encodeModifyChatRoomKV(chatroomId, entry, currentUserId);\r\n            const topic = entry.type === ChatroomEntryType$1.UPDATE ? QueryTopic.UPDATE_CHATROOM_KV : QueryTopic.DELETE_CHATROOM_KV;\r\n            const writer = new QueryWriter(topic, buff, chatroomId);\r\n            const resp = yield channel.send(writer);\r\n            const { code } = resp;\r\n            if (code === ErrorCode$1.SUCCESS) {\r\n                this._chrmEntryHandler.setLocal(chatroomId, {\r\n                    kvEntries: [entry],\r\n                    syncTime: new Date().getTime()\r\n                }, currentUserId);\r\n                return code;\r\n            }\r\n            return code;\r\n        });\r\n    }\r\n    setChatroomEntry(chatroomId, entry) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            entry.type = ChatroomEntryType$1.UPDATE;\r\n            return this._modifyChatroomKV(chatroomId, entry);\r\n        });\r\n    }\r\n    forceSetChatroomEntry(chatroomId, entry) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            entry.type = ChatroomEntryType$1.UPDATE;\r\n            entry.isOverwrite = true;\r\n            return this._modifyChatroomKV(chatroomId, entry);\r\n        });\r\n    }\r\n    removeChatroomEntry(chatroomId, entry) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            entry.type = ChatroomEntryType$1.DELETE;\r\n            return this._modifyChatroomKV(chatroomId, entry);\r\n        });\r\n    }\r\n    forceRemoveChatroomEntry(chatroomId, entry) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            entry.type = ChatroomEntryType$1.DELETE;\r\n            entry.isOverwrite = true;\r\n            return this._modifyChatroomKV(chatroomId, entry);\r\n        });\r\n    }\r\n    getChatroomEntry(chatroomId, key) {\r\n        // 1   2 key value \r\n        const entry = this._chrmEntryHandler.getValue(chatroomId, key);\r\n        if (entry) {\r\n            return Promise.resolve({\r\n                code: ErrorCode$1.SUCCESS,\r\n                data: entry\r\n            });\r\n        }\r\n        else {\r\n            return Promise.resolve({\r\n                code: ErrorCode$1.CHATROOM_KEY_NOT_EXIST\r\n            });\r\n        }\r\n    }\r\n    getAllChatroomEntry(chatroomId) {\r\n        // 1   2 key value \r\n        const entries = this._chrmEntryHandler.getAll(chatroomId);\r\n        return Promise.resolve({\r\n            code: ErrorCode$1.SUCCESS,\r\n            data: entries\r\n        });\r\n    }\r\n    /**\r\n     *  KV \r\n     * @param chatroomId\r\n     * @param timestamp\r\n    */\r\n    pullChatroomEntry(chatroomId, timestamp) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const { _channel: channel, currentUserId } = this;\r\n            if (!channel) {\r\n                return { code: ErrorCode$1.RC_NET_CHANNEL_INVALID };\r\n            }\r\n            const buff = channel.codec.encodePullChatRoomKV(timestamp);\r\n            const writer = new QueryWriter(Topic$1[Topic$1.pullKV], buff, chatroomId);\r\n            const resp = yield channel.send(writer, PBName.ChrmKVOutput);\r\n            const { code, data } = resp;\r\n            if (code === ErrorCode$1.SUCCESS) {\r\n                //  kv\r\n                this._chrmEntryHandler.setLocal(chatroomId, data, currentUserId);\r\n                // ,  entry  KV \r\n                const { kvEntries } = data;\r\n                const updatedEntries = [];\r\n                if (kvEntries.length > 0) {\r\n                    kvEntries.forEach(entry => {\r\n                        const { key, value, type, timestamp } = entry;\r\n                        updatedEntries.push({\r\n                            key,\r\n                            value: value,\r\n                            type: type,\r\n                            timestamp: timestamp,\r\n                            chatroomId\r\n                        });\r\n                    });\r\n                    this._watcher.chatroom({ updatedEntries });\r\n                }\r\n                return {\r\n                    code,\r\n                    data: data\r\n                };\r\n            }\r\n            return { code };\r\n        });\r\n    }\r\n    /**\r\n     * \r\n     * @param conversationType\r\n     * @param targetId\r\n     * @param options\r\n     */\r\n    sendMessage(conversationType, targetId, options) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._channel) {\r\n                return { code: ErrorCode$1.RC_NET_CHANNEL_INVALID };\r\n            }\r\n            options = this._handleMsgProperties(options, true);\r\n            // \r\n            const isStatusMessage = [\r\n                ConversationType$1.PRIVATE, ConversationType$1.GROUP\r\n            ].includes(conversationType) ? options.isStatusMessage : false;\r\n            const topic = isStatusMessage ? getStatPubTopic(conversationType) : (getPubTopic(conversationType) || Topic$1.ppMsgP);\r\n            const data = this._channel.codec.encodeUpMsg({ type: conversationType, targetId }, options);\r\n            const signal = new PublishWriter(Topic$1[topic], data, targetId);\r\n            signal.setHeaderQos(QOS.AT_LEAST_ONCE);\r\n            //  Ack \r\n            if (isStatusMessage) {\r\n                this._channel.sendOnly(signal);\r\n                return {\r\n                    code: ErrorCode$1.SUCCESS,\r\n                    data: transSentAttrs2IReceivedMessage(conversationType, targetId, Object.assign({}, options), '', 0, this.currentUserId)\r\n                };\r\n            }\r\n            const { code, data: resp } = yield this._channel.send(signal);\r\n            if (code !== ErrorCode$1.SUCCESS) {\r\n                return { code };\r\n            }\r\n            const pubAck = resp;\r\n            // \r\n            this._letterbox.setOutboxTime(pubAck.timestamp, this.currentUserId);\r\n            // \r\n            const receivedMessage = transSentAttrs2IReceivedMessage(conversationType, targetId, Object.assign({}, options), pubAck.messageUId, pubAck.timestamp, this.currentUserId);\r\n            this._conversationManager.setConversationCacheByMessage(receivedMessage, true);\r\n            return {\r\n                code: ErrorCode$1.SUCCESS,\r\n                data: receivedMessage\r\n            };\r\n        });\r\n    }\r\n    recallMsg(conversationType, targetId, messageUId, sentTime, user) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._channel) {\r\n                return { code: ErrorCode$1.RC_NET_CHANNEL_INVALID };\r\n            }\r\n            // user \r\n            const msg = {\r\n                content: { conversationType, targetId, messageUId, sentTime, user },\r\n                messageType: 'RC:RcCmd'\r\n            };\r\n            const topic = Topic$1[Topic$1.recallMsg];\r\n            const data = this._channel.codec.encodeUpMsg({ type: conversationType, targetId }, msg);\r\n            const signal = new PublishWriter(topic, data, this.currentUserId);\r\n            signal.setHeaderQos(QOS.AT_LEAST_ONCE);\r\n            const { code, data: resp } = yield this._channel.send(signal);\r\n            if (code !== ErrorCode$1.SUCCESS) {\r\n                return { code };\r\n            }\r\n            const pubAck = resp;\r\n            return {\r\n                code: ErrorCode$1.SUCCESS,\r\n                data: transSentAttrs2IReceivedMessage(conversationType, targetId, Object.assign({}, msg), pubAck.messageUId, pubAck.timestamp, this.currentUserId)\r\n            };\r\n        });\r\n    }\r\n    /**\r\n     * \r\n     * @todo  version \r\n     * @param version\r\n     */\r\n    pullUserSettings(version) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._channel) {\r\n                return { code: ErrorCode$1.RC_NET_CHANNEL_INVALID };\r\n            }\r\n            const buff = this._channel.codec.encodePullUserSetting(version);\r\n            const writer = new QueryWriter(Topic$1[Topic$1.pullUS], buff, this.currentUserId);\r\n            return this._channel.send(writer, PBName.PullUserSettingOutput);\r\n        });\r\n    }\r\n    getFileToken(fileType, fileName) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._channel) {\r\n                return { code: ErrorCode$1.RC_NET_CHANNEL_INVALID };\r\n            }\r\n            //  fileName  null\r\n            const uploadFileName = getUploadFileName(fileType, fileName);\r\n            const buff = this._channel.codec.encodeGetFileToken(fileType, uploadFileName);\r\n            const writer = new QueryWriter(Topic$1[Topic$1.qnTkn], buff, this.currentUserId);\r\n            const { code, data } = yield this._channel.send(writer, PBName.GetQNupTokenOutput);\r\n            if (code === ErrorCode$1.SUCCESS) {\r\n                return {\r\n                    code,\r\n                    data: data\r\n                };\r\n            }\r\n            return { code };\r\n        });\r\n    }\r\n    getFileUrl(fileType, fileName, originName) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._channel) {\r\n                return { code: ErrorCode$1.RC_NET_CHANNEL_INVALID };\r\n            }\r\n            const buff = this._channel.codec.encodeGetFileUrl(fileType, fileName, originName);\r\n            const writer = new QueryWriter(Topic$1[Topic$1.qnUrl], buff, this.currentUserId);\r\n            const { code, data } = yield this._channel.send(writer, PBName.GetQNdownloadUrlOutput);\r\n            const resp = data;\r\n            if (code === ErrorCode$1.SUCCESS) {\r\n                return {\r\n                    code,\r\n                    data: resp\r\n                };\r\n            }\r\n            return { code };\r\n        });\r\n    }\r\n    disconnect() {\r\n        if (this._channel) {\r\n            this._channel.close();\r\n            this._channel = undefined;\r\n        }\r\n    }\r\n    destroy() {\r\n        throw new Error('JSEngine\\'s method not implemented.');\r\n    }\r\n    registerMessageType(objectName, isPersited, isCounted, searchProps) {\r\n        //   objectName  [objectName]: {isPersited, isCounted}\r\n        this._customMessageType[objectName] = { isPersited, isCounted };\r\n        //  messageName searchProps  V3  V2 API \r\n        //  SDK  \r\n        //  SDK \r\n    }\r\n    // ===================== RTC  =====================\r\n    joinRTCRoom(roomId, mode, broadcastType) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._channel) {\r\n                return { code: ErrorCode$1.RC_NET_CHANNEL_INVALID };\r\n            }\r\n            const reqBody = this._channel.codec.encodeJoinRTCRoom(mode, broadcastType);\r\n            const writer = new QueryWriter(Topic$1[Topic$1.rtcRJoin_data], reqBody, roomId);\r\n            return this._channel.send(writer, PBName.RtcUserListOutput);\r\n        });\r\n    }\r\n    quitRTCRoom(roomId) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._channel) {\r\n                return ErrorCode$1.RC_NET_CHANNEL_INVALID;\r\n            }\r\n            const reqBody = this._channel.codec.encodeQuitRTCRoom();\r\n            const writer = new QueryWriter(Topic$1[Topic$1.rtcRExit], reqBody, roomId);\r\n            const { code } = yield this._channel.send(writer);\r\n            return code;\r\n        });\r\n    }\r\n    rtcPing(roomId, mode, broadcastType) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._channel) {\r\n                return ErrorCode$1.RC_NET_CHANNEL_INVALID;\r\n            }\r\n            const reqBody = this._channel.codec.encodeJoinRTCRoom(mode, broadcastType);\r\n            const writer = new QueryWriter(Topic$1[Topic$1.rtcPing], reqBody, roomId);\r\n            const { code } = yield this._channel.send(writer);\r\n            return code;\r\n        });\r\n    }\r\n    getRTCRoomInfo(roomId) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._channel) {\r\n                return { code: ErrorCode$1.RC_NET_CHANNEL_INVALID };\r\n            }\r\n            const reqBody = this._channel.codec.encodeGetRTCRoomInfo();\r\n            const writer = new QueryWriter(Topic$1[Topic$1.rtcRInfo], reqBody, roomId);\r\n            return this._channel.send(writer, PBName.RtcRoomInfoOutput);\r\n        });\r\n    }\r\n    getRTCUserInfoList(roomId) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._channel) {\r\n                return { code: ErrorCode$1.RC_NET_CHANNEL_INVALID };\r\n            }\r\n            const reqBody = this._channel.codec.encodeGetRTCRoomInfo();\r\n            const writer = new QueryWriter(Topic$1[Topic$1.rtcUData], reqBody, roomId);\r\n            const { code, data } = yield this._channel.send(writer, PBName.RtcUserListOutput);\r\n            return { code, data: data ? { users: data.users } : data };\r\n        });\r\n    }\r\n    // TODO:  rtcUPut \r\n    setRTCUserInfo(roomId, key, value) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._channel) {\r\n                return ErrorCode$1.RC_NET_CHANNEL_INVALID;\r\n            }\r\n            const reqBody = this._channel.codec.encodeSetRTCUserInfo(key, value);\r\n            const writer = new QueryWriter(Topic$1[Topic$1.rtcUPut], reqBody, roomId);\r\n            const { code } = yield this._channel.send(writer);\r\n            return code;\r\n        });\r\n    }\r\n    removeRTCUserInfo(roomId, keys) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._channel) {\r\n                return ErrorCode$1.RC_NET_CHANNEL_INVALID;\r\n            }\r\n            const reqBody = this._channel.codec.encodeRemoveRTCUserInfo(keys);\r\n            const writer = new PublishWriter(Topic$1[Topic$1.rtcUDel], reqBody, roomId);\r\n            const { code } = yield this._channel.send(writer);\r\n            return code;\r\n        });\r\n    }\r\n    setRTCData(roomId, key, value, isInner, apiType, message) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._channel) {\r\n                return ErrorCode$1.RC_NET_CHANNEL_INVALID;\r\n            }\r\n            const reqBody = this._channel.codec.encodeSetRTCData(key, value, isInner, apiType, message);\r\n            const writer = new PublishWriter(Topic$1[Topic$1.rtcSetData], reqBody, roomId);\r\n            const { code } = yield this._channel.send(writer);\r\n            return code;\r\n        });\r\n    }\r\n    setRTCTotalRes(roomId, message, valueInfo, objectName) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._channel) {\r\n                return ErrorCode$1.RC_NET_CHANNEL_INVALID;\r\n            }\r\n            const reqBody = this._channel.codec.encodeUserSetRTCData(message, valueInfo, objectName);\r\n            const writer = new PublishWriter(Topic$1[Topic$1.userSetData], reqBody, roomId);\r\n            const { code } = yield this._channel.send(writer);\r\n            return code;\r\n        });\r\n    }\r\n    getRTCData(roomId, keys, isInner, apiType) {\r\n        if (!this._channel) {\r\n            return Promise.resolve({ code: ErrorCode$1.RC_NET_CHANNEL_INVALID });\r\n        }\r\n        const reqBody = this._channel.codec.encodeGetRTCData(keys, isInner, apiType);\r\n        const writer = new QueryWriter(Topic$1[Topic$1.rtcQryData], reqBody, roomId);\r\n        return this._channel.send(writer, PBName.RtcQryOutput);\r\n    }\r\n    removeRTCData(roomId, keys, isInner, apiType, message) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._channel) {\r\n                return ErrorCode$1.RC_NET_CHANNEL_INVALID;\r\n            }\r\n            const reqBody = this._channel.codec.encodeRemoveRTCData(keys, isInner, apiType, message);\r\n            const writer = new PublishWriter(Topic$1[Topic$1.rtcDelData], reqBody, roomId);\r\n            const { code } = yield this._channel.send(writer);\r\n            return code;\r\n        });\r\n    }\r\n    setRTCOutData(roomId, rtcData, type, message) {\r\n        // const data = this._serverDataCodec.encodeSetRTCOutData(rtcData, type, message);\r\n        // let writer = new PublishWriter(QUERY_TOPIC.SET_RTC_OUT_DATA, data, roomId);\r\n        // return this._sendSignalForData(writer);\r\n        throw new Error('JSEngine\\'s method not implemented.');\r\n    }\r\n    getRTCOutData(roomId, userIds) {\r\n        // const data = this._serverDataCodec.ecnodeGetRTCOutData(userIds);\r\n        // let writer = new QueryWriter(QUERY_TOPIC.GET_RTC_OUT_DATA, data, roomId);\r\n        // return this._sendSignalForData(writer, PBName.RtcUserOutDataOutput);\r\n        throw new Error('JSEngine\\'s method not implemented.');\r\n    }\r\n    getRTCToken(roomId, mode, broadcastType) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._channel) {\r\n                return { code: ErrorCode$1.RC_NET_CHANNEL_INVALID };\r\n            }\r\n            const reqBody = this._channel.codec.encodeJoinRTCRoom(mode, broadcastType);\r\n            const writer = new QueryWriter(Topic$1[Topic$1.rtcToken], reqBody, roomId);\r\n            return this._channel.send(writer, PBName.RtcTokenOutput);\r\n        });\r\n    }\r\n    setRTCState(roomId, report) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._channel) {\r\n                return ErrorCode$1.RC_NET_CHANNEL_INVALID;\r\n            }\r\n            const reqBody = this._channel.codec.encodeSetRTCState(report);\r\n            const writer = new QueryWriter(Topic$1[Topic$1.rtcUserState], reqBody, roomId);\r\n            const { code } = yield this._channel.send(writer);\r\n            return code;\r\n        });\r\n    }\r\n    getRTCUserInfo(roomId) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            throw new Error('Method not implemented.');\r\n        });\r\n    }\r\n    getRTCUserList(roomId) {\r\n        if (!this._channel) {\r\n            return Promise.resolve({ code: ErrorCode$1.RC_NET_CHANNEL_INVALID });\r\n        }\r\n        const data = this._channel.codec.encodeGetRTCRoomInfo();\r\n        const writer = new QueryWriter(Topic$1[Topic$1.rtcUList], data, roomId);\r\n        return this._channel.send(writer, PBName.RtcUserListOutput);\r\n    }\r\n}\n\n/**\r\n * \r\n */\r\nclass CPPEngine extends AEngine {\r\n    constructor(runtime, appkey, watcher, apiVersion, _cppProtocol) {\r\n        super(runtime, appkey, watcher, apiVersion);\r\n        this._cppProtocol = _cppProtocol;\r\n    }\r\n    connect(token, naviInfo) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    getConnectTime() {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    getHistoryMessage(conversationType, targetId, timestamp, count, order) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    deleteRemoteMessage(conversationType, targetId, messages) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    recallMsg(conversationType, targetId, messageUId, sentTime, user) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    deleteRemoteMessageByTimestamp(conversationType, targetId, timestamp) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    getConversationList(count, conversationType, startTime, order) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    getConversation(conversationType, targetId) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    removeConversation(conversationType, targetId) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    getAllConversationUnreadCount() {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    getConversationUnreadCount(conversationType, targetId) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    clearConversationUnreadCount(conversationType, targetId) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    saveConversationMessageDraft(conversationType, targetId, draft) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    getConversationMessageDraft(conversationType, targetId) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    clearConversationMessageDraft(conversationType, targetId) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    pullConversationStatus(timestamp) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    batchSetConversationStatus(statusList) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    sendMessage(conversationType, targetId, options) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    disconnect() {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    pullUserSettings(version) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    registerMessageType(objectName, isPersited, isCounted, searchProps) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    joinChatroom(chatroomId, count) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    joinExistChatroom(chatroomId, count) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    quitChatroom(chatroomId) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    getChatroomInfo(chatroomId, count, order) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    getChatroomHistoryMessages(chatroomId, timestamp, count, order) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    setChatroomEntry(chatroomId, entry) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    forceSetChatroomEntry(chatroomId, entry) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    removeChatroomEntry(chatroomId, entry) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    forceRemoveChatroomEntry(chatroomId, entry) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    getChatroomEntry(chatroomId, key) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    getAllChatroomEntry(chatroomId) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    getFileToken(fileType, fileName) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    getFileUrl(fileType, fileName, originName) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    joinRTCRoom(roomId, mode, broadcastType) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    quitRTCRoom(roomId) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    rtcPing(roomId, mode, broadcastType) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    getRTCRoomInfo(roomId) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    getRTCUserInfoList(roomId) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    getRTCUserInfo(roomId) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    setRTCUserInfo(roomId, key, value) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    removeRTCUserInfo(roomId, keys) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    setRTCData(roomId, key, value, isInner, apiType, message) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    setRTCTotalRes(roomId, message, valueInfo, objectName) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    getRTCData(roomId, keys, isInner, apiType) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    removeRTCData(roomId, keys, isInner, apiType, message) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    setRTCOutData(roomId, rtcData, type, message) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    getRTCOutData(roomId, userIds) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    getRTCToken(roomId, mode, broadcastType) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    setRTCState(roomId, reportId) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    getRTCUserList(roomId) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n}\n\n/**\r\n * \r\n */\r\n(function (RTCMode) {\r\n    /**\r\n     * \r\n     */\r\n    RTCMode[RTCMode[\"RTC\"] = 0] = \"RTC\";\r\n    /**\r\n     * \r\n     */\r\n    RTCMode[RTCMode[\"LIVE\"] = 2] = \"LIVE\";\r\n})(exports.RTCMode || (exports.RTCMode = {}));\r\n(function (LiveType) {\r\n    /**\r\n     * \r\n     */\r\n    LiveType[LiveType[\"AUDIO_AND_VIDEO\"] = 0] = \"AUDIO_AND_VIDEO\";\r\n    /**\r\n     * \r\n     */\r\n    LiveType[LiveType[\"AUDIO\"] = 1] = \"AUDIO\";\r\n})(exports.LiveType || (exports.LiveType = {}));\r\n(function (LiveRole) {\r\n    /**\r\n     * \r\n     */\r\n    LiveRole[LiveRole[\"ANCHOR\"] = 1] = \"ANCHOR\";\r\n    /**\r\n     * \r\n     */\r\n    LiveRole[LiveRole[\"AUDIENCE\"] = 2] = \"AUDIENCE\";\r\n})(exports.LiveRole || (exports.LiveRole = {}));\r\n/**\r\n * CallLib \r\n */\r\nconst CallLibMsgType = {\r\n    'RC:VCAccept': 'RC:VCAccept',\r\n    'RC:VCRinging': 'RC:VCRinging',\r\n    'RC:VCSummary': 'RC:VCSummary',\r\n    'RC:VCHangup': 'RC:VCHangup',\r\n    'RC:VCInvite': 'RC:VCInvite',\r\n    'RC:VCModifyMedia': 'RC:VCModifyMedia',\r\n    'RC:VCModifyMem': 'RC:VCModifyMem'\r\n};\r\n(function (RTCApiType) {\r\n    RTCApiType[RTCApiType[\"ROOM\"] = 1] = \"ROOM\";\r\n    RTCApiType[RTCApiType[\"PERSON\"] = 2] = \"PERSON\";\r\n})(exports.RTCApiType || (exports.RTCApiType = {}));\n\nclass PluginContext {\r\n    constructor(_context) {\r\n        this._context = _context;\r\n    }\r\n    /**\r\n     *  `@rongcloud/engine` \r\n     */\r\n    getCoreVersion() {\r\n        return this._context.coreVersion;\r\n    }\r\n    /**\r\n     *  IMLib \r\n     */\r\n    getAPIVersion() {\r\n        return this._context.apiVersion;\r\n    }\r\n    /**\r\n     *  appkey\r\n     */\r\n    getAppkey() {\r\n        return this._context.appkey;\r\n    }\r\n    /**\r\n     *  userId\r\n     *  disconnect  '' \r\n     */\r\n    getCurrentId() {\r\n        return this._context.getCurrentUserId();\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    getConnectionStatus() {\r\n        return this._context.getConnectionStatus();\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    sendMessage(conversationType, targetId, options) {\r\n        return this._context.sendMessage(conversationType, targetId, options);\r\n    }\r\n    /**\r\n     * \r\n     * @description \r\n     * @param objectName RC:TxtMsg\r\n     * @param isPersited \r\n     * @param isCounted \r\n     * @param searchProps \r\n     */\r\n    registerMessageType(objectName, isPersited, isCounted, searchProps = []) {\r\n        this._context.registerMessageType(objectName, isPersited, isCounted, searchProps);\r\n    }\r\n}\n\nclass RTCPluginContext extends PluginContext {\r\n    /**\r\n     * \r\n     */\r\n    getNaviInfo() {\r\n        return this._context.getInfoFromCache();\r\n    }\r\n    /**\r\n     *  RTC \r\n     * @todo  `broadcastType` \r\n     * @param roomId\r\n     * @param mode  or \r\n     * @param broadcastType\r\n     */\r\n    joinRTCRoom(roomId, mode, broadcastType) {\r\n        return this._context.joinRTCRoom(roomId, mode, broadcastType);\r\n    }\r\n    quitRTCRoom(roomId) {\r\n        return this._context.quitRTCRoom(roomId);\r\n    }\r\n    rtcPing(roomId, mode, broadcastType) {\r\n        return this._context.rtcPing(roomId, mode, broadcastType);\r\n    }\r\n    getRTCRoomInfo(roomId) {\r\n        return this._context.getRTCRoomInfo(roomId);\r\n    }\r\n    getRTCUserInfoList(roomId) {\r\n        return this._context.getRTCUserInfoList(roomId);\r\n    }\r\n    getRTCUserInfo(roomId) {\r\n        return this._context.getRTCUserInfo(roomId);\r\n    }\r\n    setRTCUserInfo(roomId, key, value) {\r\n        return this._context.setRTCUserInfo(roomId, key, value);\r\n    }\r\n    removeRTCUserInfo(roomId, keys) {\r\n        return this._context.removeRTCUserInfo(roomId, keys);\r\n    }\r\n    setRTCData(roomId, key, value, isInner, apiType, message) {\r\n        return this._context.setRTCData(roomId, key, value, isInner, apiType, message);\r\n    }\r\n    /**\r\n     * @param - roomId\r\n     * @param - message  SDK\r\n     * ```\r\n     * JSON.stringify({\r\n     *  name: 'RCRTC:PublishResource',\r\n     *  content: {\r\n     *  }\r\n     * })\r\n     * ```\r\n     * @param - valueInfo \r\n     * @param -  URI  `RCRTC:TotalContentResources`\r\n     */\r\n    setRTCTotalRes(roomId, \r\n    /**\r\n     *  RTCLib \r\n     */\r\n    message, valueInfo, objectName) {\r\n        return this._context.setRTCTotalRes(roomId, message, valueInfo, objectName);\r\n    }\r\n    getRTCData(roomId, keys, isInner, apiType) {\r\n        return this._context.getRTCData(roomId, keys, isInner, apiType);\r\n    }\r\n    removeRTCData(roomId, keys, isInner, apiType, message) {\r\n        return this._context.removeRTCData(roomId, keys, isInner, apiType, message);\r\n    }\r\n    setRTCOutData(roomId, rtcData, type, message) {\r\n        return this._context.setRTCOutData(roomId, rtcData, type, message);\r\n    }\r\n    getRTCOutData(roomId, userIds) {\r\n        return this._context.getRTCOutData(roomId, userIds);\r\n    }\r\n    getRTCToken(roomId, mode, broadcastType) {\r\n        return this._context.getRTCToken(roomId, mode, broadcastType);\r\n    }\r\n    setRTCState(roomId, report) {\r\n        return this._context.setRTCState(roomId, report);\r\n    }\r\n    getRTCUserList(roomId) {\r\n        return this._context.getRTCUserList(roomId);\r\n    }\r\n}\n\nfunction cloneMessage(message) {\r\n    return Object.assign({}, message);\r\n}\r\nclass APIContext {\r\n    constructor(_runtime, options) {\r\n        this._runtime = _runtime;\r\n        this._token = '';\r\n        /**\r\n         * \r\n         */\r\n        this._pluginContextQueue = [];\r\n        /**\r\n         *  4.0 IM SDK \r\n         */\r\n        this.coreVersion = \"0.1.0\";\r\n        this._connectionStatus = ConnectionStatus$1.DISCONNECTED;\r\n        /**\r\n         * \r\n         */\r\n        this._watcher = {\r\n            message: undefined,\r\n            conversationState: undefined,\r\n            chatroomState: undefined,\r\n            connectionState: undefined,\r\n            rtcInnerWatcher: undefined,\r\n            expansion: undefined\r\n        };\r\n        this._options = Object.assign({}, options);\r\n        this.appkey = this._options.appkey;\r\n        this.apiVersion = this._options.apiVersion;\r\n        const { isEnterPrise, appkey, miniCMPProxy, apiVersion, connectionType } = this._options;\r\n        // electron , cppProtocol \r\n        if (_runtime.tag === \"electron\" && !this._options.cppProtocol) {\r\n            const msg = 'cppProtocol is required';\r\n            logger.error(msg);\r\n            throw new Error(msg);\r\n        }\r\n        /*\r\n         *  SDK  navigators \r\n         */\r\n        if (isEnterPrise && this._options.navigators.length === 0) {\r\n            const msg = 'private navigators is required';\r\n            logger.error(msg);\r\n            throw new Error(msg);\r\n        }\r\n        // \r\n        this._options.navigators = this._options.navigators.filter(item => /^https?:\\/\\//.test(item));\r\n        // \r\n        if (this._options.navigators.length === 0) {\r\n            if (isEnterPrise) {\r\n                const msg = 'navi urls is invalid';\r\n                logger.error(msg);\r\n                throw new Error(msg);\r\n            }\r\n            this._options.navigators.push(...PUBLIC_CLOUD_NAVI_URIS);\r\n        }\r\n        //  Navi \r\n        this._navi = new Navi(_runtime, appkey, this._options.navigators, miniCMPProxy, apiVersion, connectionType);\r\n        // \r\n        const engineWatcher = {\r\n            status: this._connectionStatusListener.bind(this),\r\n            message: this._messageReceiver.bind(this),\r\n            chatroom: this._chatroomInfoListener.bind(this),\r\n            conversation: this._conversationInfoListener.bind(this),\r\n            expansion: this._expansionInfoListener.bind(this)\r\n        };\r\n        // \r\n        this._engine = _runtime.tag === \"electron\"\r\n            ? new CPPEngine(_runtime, appkey, engineWatcher, apiVersion, this._options.cppProtocol)\r\n            : new JSEngine(_runtime, appkey, engineWatcher, apiVersion);\r\n    }\r\n    static init(runtime, options) {\r\n        logger.debug('APIContext.init =>', options.appkey, options.navigators);\r\n        if (this._context) {\r\n            logger.error('Repeat initialize!');\r\n            return this._context;\r\n        }\r\n        this._context = new APIContext(runtime, options);\r\n        return this._context;\r\n    }\r\n    static destroy() {\r\n        if (this._context) {\r\n            this._context._destroy();\r\n            this._context = undefined;\r\n        }\r\n    }\r\n    /**\r\n     * \r\n     * @param plugin\r\n     * @param options\r\n     */\r\n    install(plugin, options) {\r\n        const context = plugin.tag === 'RCRTC' ? new RTCPluginContext(this) : new PluginContext(this);\r\n        let pluginClient = null;\r\n        try {\r\n            if (!plugin.verify(this._runtime)) {\r\n                return null;\r\n            }\r\n            pluginClient = plugin.setup(context, this._runtime, options);\r\n        }\r\n        catch (error) {\r\n            logger.error('install plugin error!\\n', error);\r\n        }\r\n        pluginClient && this._pluginContextQueue.push(context);\r\n        return pluginClient;\r\n    }\r\n    /**\r\n     * \r\n     * @param message\r\n     */\r\n    _connectionStatusListener(status) {\r\n        var _a;\r\n        this._connectionStatus = status;\r\n        //  RTCLibCallLib\r\n        ((_a = this._watcher.rtcInnerWatcher) === null || _a === void 0 ? void 0 : _a.status) && this._watcher.rtcInnerWatcher.status(status);\r\n        // \r\n        this._pluginContextQueue.forEach(item => {\r\n            item.onconnectionstatechange && item.onconnectionstatechange(status);\r\n        });\r\n        // \r\n        this._watcher.connectionState && this._watcher.connectionState(status);\r\n    }\r\n    _messageReceiver(message) {\r\n        /**\r\n         *  RTCLibCallLib\r\n         * conversationType === 12\r\n         * \r\n         * RCRTC:AcceptMsg...  RTCLib\\CallLib\r\n         */\r\n        if (message.conversationType === ConversationType$1.RTC_ROOM ||\r\n            Object.prototype.hasOwnProperty.call(CallLibMsgType, message.messageType)) {\r\n            /**\r\n             *  RTCLib  CallLib  RTCLib  CallLib \r\n             *  RTCLib  CallLib\r\n             */\r\n            if (this._watcher.rtcInnerWatcher && this._watcher.rtcInnerWatcher.message) {\r\n                this._watcher.rtcInnerWatcher.message(cloneMessage(message));\r\n                return;\r\n            }\r\n        }\r\n        // \r\n        if (this._pluginContextQueue.some((item) => {\r\n            // \r\n            if (!item.onmessage) {\r\n                return false;\r\n            }\r\n            try {\r\n                return item.onmessage(cloneMessage(message));\r\n            }\r\n            catch (err) {\r\n                logger.error('plugin error =>', err);\r\n                return false;\r\n            }\r\n        })) {\r\n            return;\r\n        }\r\n        // \r\n        this._watcher.message && this._watcher.message(cloneMessage(message));\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    _chatroomInfoListener(info) {\r\n        this._watcher.chatroomState && this._watcher.chatroomState(info);\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    _conversationInfoListener(info) {\r\n        this._watcher.conversationState && this._watcher.conversationState(info);\r\n    }\r\n    /**\r\n     * \r\n    */\r\n    _expansionInfoListener(info) {\r\n        this._watcher.expansion && this._watcher.expansion(info);\r\n    }\r\n    /**\r\n     * \r\n     * @param options\r\n     */\r\n    assignWatcher(watcher) {\r\n        //  key\r\n        Object.keys(this._watcher).forEach((key) => {\r\n            if (Object.prototype.hasOwnProperty.call(watcher, key)) {\r\n                const value = watcher[key];\r\n                this._watcher[key] = isFunction(value) || isObject(value) ? value : undefined;\r\n            }\r\n        });\r\n    }\r\n    getConnectedTime() {\r\n        return this._engine.connectedTime;\r\n    }\r\n    getCurrentUserId() {\r\n        return this._engine.currentUserId;\r\n    }\r\n    getConnectionStatus() {\r\n        return this._connectionStatus;\r\n    }\r\n    /**\r\n     *  userId\r\n     * @param token\r\n     * @param refreshNavi  `false` \r\n     */\r\n    connect(token, refreshNavi = false) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (this._connectionStatus === ConnectionStatus$1.CONNECTED) {\r\n                return { code: ErrorCode$1.SUCCESS, userId: this._engine.currentUserId };\r\n            }\r\n            if (this._connectionStatus === ConnectionStatus$1.CONNECTING) {\r\n                return { code: ErrorCode$1.BIZ_ERROR_CONNECTING };\r\n            }\r\n            if (typeof token !== 'string' || token.length === 0) {\r\n                return { code: ErrorCode$1.RC_CONN_USER_OR_PASSWD_ERROR };\r\n            }\r\n            this._token = token;\r\n            //  token \r\n            const tmpArr = token.split('@');\r\n            const dynamicUris = tmpArr[1] ? tmpArr[1].split(';').map(item => {\r\n                return /^https?:/.test(item) ? item : `https://${item}`;\r\n            }) : [];\r\n            // \r\n            const naviInfo = yield this._navi.getInfo(this._getTokenWithoutNavi(), dynamicUris, refreshNavi);\r\n            if (!naviInfo) {\r\n                return { code: ErrorCode$1.RC_NAVI_RESOURCE_ERROR };\r\n            }\r\n            //  0 \r\n            const code = yield this._engine.connect(this._getTokenWithoutNavi(), naviInfo, this._options.connectionType);\r\n            if (code === ErrorCode$1.SUCCESS) {\r\n                // \r\n                naviInfo.openUS === 1 && this._pullUserSettings();\r\n            }\r\n            return { code, userId: this._engine.currentUserId };\r\n        });\r\n    }\r\n    getConnectTime() {\r\n        return this._engine.getConnectTime();\r\n    }\r\n    /**\r\n     *  web  voipCall \r\n     */\r\n    _pullUserSettings() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            // TODO:  comet \r\n            // const res = await this._engine.pullUserSettings(version)\r\n            // logger.error('TODO', res)\r\n        });\r\n    }\r\n    disconnect() {\r\n        this._engine.disconnect();\r\n        this._pluginContextQueue.forEach(item => {\r\n            if (!item.ondisconnect) {\r\n                return;\r\n            }\r\n            try {\r\n                item.ondisconnect();\r\n            }\r\n            catch (err) {\r\n                logger.error('plugin error =>', err);\r\n            }\r\n        });\r\n        //  API  Promise  Promise\r\n        return Promise.resolve();\r\n    }\r\n    reconnect() {\r\n        return this.connect(this._getTokenWithoutNavi());\r\n    }\r\n    //  token \r\n    _getTokenWithoutNavi() {\r\n        return this._token.replace(/@.+$/, '@');\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    getInfoFromCache() {\r\n        return this._navi.getInfoFromCache(this._getTokenWithoutNavi());\r\n    }\r\n    /**\r\n     * \r\n     * @description \r\n     * @param objectName RC:TxtMsg\r\n     * @param isPersited \r\n     * @param isCounted \r\n     * @param searchProps \r\n     */\r\n    registerMessageType(objectName, isPersited, isCounted, searchProps = []) {\r\n        this._engine.registerMessageType(objectName, isPersited, isCounted, searchProps);\r\n    }\r\n    /**\r\n     * \r\n     * @param conversationType\r\n     * @param targetId\r\n     * @param objectName\r\n     * @param content\r\n     * @param options\r\n     */\r\n    sendMessage(conversationType, targetId, options) {\r\n        //  content  128 KB\r\n        const contentJson = JSON.stringify(options.content);\r\n        if (getByteLength(contentJson) > MAX_MESSAGE_CONTENT_BYTES) {\r\n            return Promise.resolve({ code: ErrorCode$1.RC_MSG_CONTENT_EXCEED_LIMIT });\r\n        }\r\n        return this._engine.sendMessage(conversationType, targetId, options);\r\n    }\r\n    /**\r\n     * \r\n     * @param messageUId  Id\r\n     * @param keys  key\r\n     * @param expansion \r\n    */\r\n    sendExpansionMessage(options) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            let { conversationType, targetId, messageUId, keys, expansion, originExpansion, removeAll, canIncludeExpansion } = options;\r\n            // \r\n            if (!canIncludeExpansion) {\r\n                return { code: ErrorCode$1.MESSAGE_KV_NOT_SUPPORT };\r\n            }\r\n            let isExceedLimit = false;\r\n            let isIllgalEx = false;\r\n            if (isObject(expansion)) {\r\n                //   300\r\n                originExpansion = originExpansion || {};\r\n                const exKeysLength = Object.keys(expansion).length;\r\n                const totalExpansion = Object.assign(originExpansion, expansion);\r\n                const totalExKeysLength = Object.keys(totalExpansion).length;\r\n                isExceedLimit = totalExKeysLength > 300 || exKeysLength > 20;\r\n                //  expansion key value \r\n                for (const key in expansion) {\r\n                    const val = expansion[key];\r\n                    isExceedLimit = key.length > 32 || val.length > 64;\r\n                    isIllgalEx = !/^[A-Za-z0-9_=+-]+$/.test(key);\r\n                }\r\n            }\r\n            if (isExceedLimit) {\r\n                return { code: ErrorCode$1.EXPANSION_LIMIT_EXCEET };\r\n            }\r\n            if (isIllgalEx) {\r\n                return { code: ErrorCode$1.BIZ_ERROR_INVALID_PARAMETER };\r\n            }\r\n            const content = {\r\n                mid: messageUId\r\n            };\r\n            expansion && (content.put = expansion);\r\n            keys && (content.del = keys);\r\n            removeAll && (content.removeAll = 1);\r\n            // RC:MsgExMsg ppMsgPpgMsgP Server \r\n            const { code } = yield this._engine.sendMessage(conversationType, targetId, {\r\n                content,\r\n                messageType: MessageType$1.EXPANSION_NOTIFY\r\n            });\r\n            return { code };\r\n        });\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    _destroy() {\r\n        this._watcher = {};\r\n        this._engine.disconnect();\r\n        this._pluginContextQueue.forEach(item => {\r\n            if (!item.ondestroy) {\r\n                return;\r\n            }\r\n            try {\r\n                item.ondestroy();\r\n            }\r\n            catch (err) {\r\n                logger.error('plugin error =>', err);\r\n            }\r\n        });\r\n        this._pluginContextQueue.length = 0;\r\n    }\r\n    /**\r\n     * @param conversationType\r\n     * @param targetId  Id\r\n     * @param timestamp \r\n     * @param count \r\n     * @param order 1 0 \r\n     */\r\n    getHistoryMessage(conversationType, targetId, timestamp = 0, count = 20, order = 0) {\r\n        return this._engine.getHistoryMessage(conversationType, targetId, timestamp, count, order);\r\n    }\r\n    /**\r\n     * \r\n     * @param count ,  `300`\r\n     */\r\n    getConversationList(count = 300, conversationType, startTime, order) {\r\n        return this._engine.getConversationList(count, conversationType, startTime, order);\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    removeConversation(conversationType, targetId) {\r\n        return this._engine.removeConversation(conversationType, targetId);\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    clearUnreadCount(conversationType, targetId) {\r\n        return this._engine.clearConversationUnreadCount(conversationType, targetId);\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    getUnreadCount(conversationType, targetId) {\r\n        return this._engine.getConversationUnreadCount(conversationType, targetId);\r\n    }\r\n    getTotalUnreadCount() {\r\n        return this._engine.getAllConversationUnreadCount();\r\n    }\r\n    setConversationStatus(conversationType, targetId, isTop, notificationStatus) {\r\n        const statusList = [{ conversationType, targetId, isTop, notificationStatus }];\r\n        return this._engine.batchSetConversationStatus(statusList);\r\n    }\r\n    saveConversationMessageDraft(conversationType, targetId, draft) {\r\n        return this._engine.saveConversationMessageDraft(conversationType, targetId, draft);\r\n    }\r\n    getConversationMessageDraft(conversationType, targetId) {\r\n        return this._engine.getConversationMessageDraft(conversationType, targetId);\r\n    }\r\n    clearConversationMessageDraft(conversationType, targetId) {\r\n        return this._engine.clearConversationMessageDraft(conversationType, targetId);\r\n    }\r\n    recallMessage(conversationType, targetId, messageUId, sentTime, user) {\r\n        return this._engine.recallMsg(conversationType, targetId, messageUId, sentTime, user);\r\n    }\r\n    /**\r\n     * \r\n     * @param conversationType\r\n     * @param targetId\r\n     * @param list\r\n     */\r\n    deleteRemoteMessage(conversationType, targetId, list) {\r\n        return this._engine.deleteRemoteMessage(conversationType, targetId, list);\r\n    }\r\n    /**\r\n     * \r\n     * @param conversationType\r\n     * @param targetId\r\n     * @param timestamp\r\n     */\r\n    deleteRemoteMessageByTimestamp(conversationType, targetId, timestamp) {\r\n        return this._engine.deleteRemoteMessageByTimestamp(conversationType, targetId, timestamp);\r\n    }\r\n    /**\r\n     * \r\n     * @param roomId  Id\r\n     * @param count  `10` `50``-1` \r\n     */\r\n    joinChatroom(roomId, count = 10) {\r\n        return this._engine.joinChatroom(roomId, count);\r\n    }\r\n    /**\r\n     * \r\n     * @param roomId  Id\r\n     * @param count  `10` `50``-1` \r\n     */\r\n    joinExistChatroom(roomId, count = 10) {\r\n        return this._engine.joinExistChatroom(roomId, count);\r\n    }\r\n    /**\r\n     * \r\n     * @param roomId\r\n     */\r\n    quitChatroom(roomId) {\r\n        return this._engine.quitChatroom(roomId);\r\n    }\r\n    /**\r\n     * \r\n     * @description count  order  0 \r\n     * @param roomId  Id\r\n     * @param count  `20` `0` 0\r\n     * @param order `1` `2`  0\r\n     */\r\n    getChatroomInfo(roomId, count = 0, order = 0) {\r\n        return this._engine.getChatroomInfo(roomId, count, order);\r\n    }\r\n    /**\r\n     * \r\n     * @description \r\n     * @param roomId  id\r\n     * @param entry \r\n     */\r\n    setChatroomEntry(roomId, entry) {\r\n        return this._engine.setChatroomEntry(roomId, entry);\r\n    }\r\n    /**\r\n     *  / \r\n     * @description \r\n     * @param roomId  id\r\n     * @param entry \r\n     */\r\n    forceSetChatroomEntry(roomId, entry) {\r\n        return this._engine.forceSetChatroomEntry(roomId, entry);\r\n    }\r\n    /**\r\n     * \r\n     * @description \r\n     * @param roomId  id\r\n     * @param entry \r\n     */\r\n    removeChatroomEntry(roomId, entry) {\r\n        return this._engine.removeChatroomEntry(roomId, entry);\r\n    }\r\n    /**\r\n     * \r\n     * @description \r\n     * @param roomId  id\r\n     * @param entry \r\n     */\r\n    forceRemoveChatroomEntry(roomId, entry) {\r\n        return this._engine.forceRemoveChatroomEntry(roomId, entry);\r\n    }\r\n    /**\r\n     * \r\n     * @param roomId  id\r\n     * @param key \r\n     */\r\n    getChatroomEntry(roomId, key) {\r\n        return this._engine.getChatroomEntry(roomId, key);\r\n    }\r\n    /**\r\n     * \r\n     * @param roomId  id\r\n     */\r\n    getAllChatroomEntries(roomId) {\r\n        return this._engine.getAllChatroomEntry(roomId);\r\n    }\r\n    /**\r\n     * \r\n     * @param roomId\r\n     * @param count ,  `1 - 20`\r\n     * @param order  0\r\n     * * 0\r\n     * * 1\r\n     * @param timestamp  `0`\r\n     */\r\n    getChatRoomHistoryMessages(roomId, count = 20, order = 0, timestamp = 0) {\r\n        return this._engine.getChatroomHistoryMessages(roomId, timestamp, count, order);\r\n    }\r\n    /**\r\n     *  \r\n     * @param fileType \r\n     * @param fileName \r\n    */\r\n    getFileToken(fileType, fileName) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const naviInfo = this.getInfoFromCache();\r\n            const bos = (naviInfo === null || naviInfo === void 0 ? void 0 : naviInfo.bosAddr) || '';\r\n            const qiniu = (naviInfo === null || naviInfo === void 0 ? void 0 : naviInfo.uploadServer) || '';\r\n            const { code, data } = yield this._engine.getFileToken(fileType, fileName);\r\n            if (code === ErrorCode$1.SUCCESS) {\r\n                return Promise.resolve(Object.assign(data, { bos, qiniu }));\r\n            }\r\n            return Promise.reject(code);\r\n        });\r\n    }\r\n    /**\r\n     *   URL\r\n     * @param fileType \r\n     * @param fileName \r\n     * @param originName \r\n     * @param uploadRes \r\n    */\r\n    getFileUrl(fileType, fileName, originName, uploadRes) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (uploadRes === null || uploadRes === void 0 ? void 0 : uploadRes.isBosRes) {\r\n                return Promise.resolve(uploadRes);\r\n            }\r\n            const { code, data } = yield this._engine.getFileUrl(fileType, fileName, originName);\r\n            if (code === ErrorCode$1.SUCCESS) {\r\n                return Promise.resolve(data);\r\n            }\r\n            return Promise.reject(code);\r\n        });\r\n    }\r\n    /* =============================  RTC  ============================== */\r\n    /**\r\n     * \r\n     * @param roomId\r\n     * @param mode  or \r\n     * @param mediaType \r\n     */\r\n    joinRTCRoom(roomId, mode, mediaType) {\r\n        return this._engine.joinRTCRoom(roomId, mode, mediaType);\r\n    }\r\n    quitRTCRoom(roomId) {\r\n        return this._engine.quitRTCRoom(roomId);\r\n    }\r\n    rtcPing(roomId, mode, mediaType) {\r\n        return this._engine.rtcPing(roomId, mode, mediaType);\r\n    }\r\n    getRTCRoomInfo(roomId) {\r\n        return this._engine.getRTCRoomInfo(roomId);\r\n    }\r\n    getRTCUserInfoList(roomId) {\r\n        return this._engine.getRTCUserInfoList(roomId);\r\n    }\r\n    getRTCUserInfo(roomId) {\r\n        return this._engine.getRTCUserInfo(roomId);\r\n    }\r\n    setRTCUserInfo(roomId, key, value) {\r\n        return this._engine.setRTCUserInfo(roomId, key, value);\r\n    }\r\n    removeRTCUserInfo(roomId, keys) {\r\n        return this._engine.removeRTCUserInfo(roomId, keys);\r\n    }\r\n    setRTCData(roomId, key, value, isInner, apiType, message) {\r\n        return this._engine.setRTCData(roomId, key, value, isInner, apiType, message);\r\n    }\r\n    setRTCTotalRes(roomId, message, valueInfo, objectName) {\r\n        return this._engine.setRTCTotalRes(roomId, message, valueInfo, objectName);\r\n    }\r\n    getRTCData(roomId, keys, isInner, apiType) {\r\n        return this._engine.getRTCData(roomId, keys, isInner, apiType);\r\n    }\r\n    removeRTCData(roomId, keys, isInner, apiType, message) {\r\n        return this._engine.removeRTCData(roomId, keys, isInner, apiType, message);\r\n    }\r\n    setRTCOutData(roomId, rtcData, type, message) {\r\n        return this._engine.setRTCOutData(roomId, rtcData, type, message);\r\n    }\r\n    getRTCOutData(roomId, userIds) {\r\n        return this._engine.getRTCOutData(roomId, userIds);\r\n    }\r\n    getRTCToken(roomId, mode, broadcastType) {\r\n        return this._engine.getRTCToken(roomId, mode, broadcastType);\r\n    }\r\n    // RTC \r\n    setRTCState(roomId, report) {\r\n        return !this._options.isEnterPrise ? this._engine.setRTCState(roomId, report) : Promise.resolve(ErrorCode$1.SUCCESS);\r\n    }\r\n    getRTCUserList(roomId) {\r\n        return this._engine.getRTCUserList(roomId);\r\n    }\r\n}\n\n{\r\n    logger.warn('RCEngineVersion:', \"0.1.0\");\r\n    logger.warn('VersionCode:', \"535393139458d1b8d7dc5d2b8d49803a2a30e278\");\r\n}\n\nexports.APIContext = APIContext;\nexports.AppStorage = AppStorage;\nexports.CallLibMsgType = CallLibMsgType;\nexports.CometChannel = CometChannel;\nexports.ConnectResultCode = ConnectResultCode;\nexports.ConnectionStatus = ConnectionStatus$1;\nexports.ConversationType = ConversationType$1;\nexports.DelayTimer = DelayTimer;\nexports.ErrorCode = ErrorCode$1;\nexports.FileType = FileType$1;\nexports.Logger = Logger;\nexports.MentionedType = MentionedType$1;\nexports.MessageDirection = MessageDirection$1;\nexports.MessageType = MessageType$1;\nexports.NotificationStatus = NotificationStatus$1;\nexports.PluginContext = PluginContext;\nexports.RCAssertError = RCAssertError;\nexports.RTCPluginContext = RTCPluginContext;\nexports.ReceivedStatus = ReceivedStatus$1;\nexports.WebSocketChannel = WebSocketChannel;\nexports.appendUrl = appendUrl;\nexports.assert = assert;\nexports.forEach = forEach;\nexports.getUploadFileName = getUploadFileName;\nexports.indexOf = indexOf;\nexports.isArray = isArray;\nexports.isArrayBuffer = isArrayBuffer;\nexports.isFunction = isFunction;\nexports.isHttpUrl = isHttpUrl;\nexports.isInObject = isInObject;\nexports.isInclude = isInclude;\nexports.isNull = isNull;\nexports.isNumber = isNumber;\nexports.isObject = isObject;\nexports.isString = isString;\nexports.isUndefined = isUndefined;\nexports.isValidConversationType = isValidConversationType;\nexports.isValidFileType = isValidFileType;\nexports.map = map;\nexports.notEmptyArray = notEmptyArray;\nexports.notEmptyObject = notEmptyObject;\nexports.notEmptyString = notEmptyString;\nexports.todo = todo;\nexports.validate = validate;\n"]}